(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(Buffer){"use strict";module.exports={fp64:{interface:"fp64",source:Buffer("Ly8gQ29weXJpZ2h0IChjKSAyMDE2IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuCi8vCi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwovLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwovLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgovLwovLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgovLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KLy8KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQovLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KLy8gVEhFIFNPRlRXQVJFLgp1bmlmb3JtIGZsb2F0IE9ORTsKCmNvbnN0IHZlYzIgRV9GUDY0ID0gdmVjMigyLjcxODI4MTc0NTkxMDY0NDVlKzAwLCA4LjI1NDg0MDM2NjgxNzAwN2UtMDgpOwpjb25zdCB2ZWMyIExPRzJfRlA2NCA9IHZlYzIoMC42OTMxNDcxODI0NjQ1OTk2ZSswMCwgLTEuOTA0NjU0MjEyMTI1OTMzNmUtMDkpOwpjb25zdCB2ZWMyIFBJX0ZQNjQgPSB2ZWMyKDMuMTQxNTkyNzQxMDEyNTczMiwgLTguNzQyMjc4MDEyNjE4OTU0ZS04KTsKY29uc3QgdmVjMiBUV09fUElfRlA2NCA9IHZlYzIoNi4yODMxODU0ODIwMjUxNDY1LCAtMS43NDg0NTU2MDI1MjM3OTA3ZS03KTsKY29uc3QgdmVjMiBQSV8yX0ZQNjQgPSB2ZWMyKDEuNTcwNzk2MzcwNTA2Mjg2NiwgLTQuMzcxMTM5MDA2MzA5NDc3ZS04KTsKY29uc3QgdmVjMiBQSV80X0ZQNjQgPSB2ZWMyKDAuNzg1Mzk4MTg1MjUzMTQzMywgLTIuMTg1NTY5NTAzMTU0NzM4NGUtOCk7CmNvbnN0IHZlYzIgUElfMTZfRlA2NCA9IHZlYzIoMC4xOTYzNDk1NDYzMTMyODU4MywgLTUuNDYzOTIzNzU3ODg2ODQ2ZS05KTsKY29uc3QgdmVjMiBQSV8xNl8yX0ZQNjQgPSB2ZWMyKDAuMzkyNjk5MDkyNjI2NTcxNjYsIC0xLjA5Mjc4NDc1MTU3NzM2OTJlLTgpOwpjb25zdCB2ZWMyIFBJXzE2XzNfRlA2NCA9IHZlYzIoMC41ODkwNDg2MjQwMzg2OTYzLCAtMS40OTA2MTAwNzk4MTI4ODE4ZS05KTsKCmNvbnN0IHZlYzIgU0lOX1RBQkxFXzBfRlA2NCA9IHZlYzIoMC4xOTUwOTAzMjM2ODY1OTk3MywgLTEuNjcwNDcxNDgzMzYxNTI0MmUtOSk7CmNvbnN0IHZlYzIgU0lOX1RBQkxFXzFfRlA2NCA9IHZlYzIoMC4zODI2ODM0MjYxNDE3Mzg5LCA2LjIyMzM1MDg5MDE3NzY3ZS05KTsKY29uc3QgdmVjMiBTSU5fVEFCTEVfMl9GUDY0ID0gdmVjMigwLjU1NTU3MDI0NDc4OTEyMzUsIC0xLjE3Njk1MjEzNTc1MDc1MjllLTgpOwpjb25zdCB2ZWMyIFNJTl9UQUJMRV8zX0ZQNjQgPSB2ZWMyKDAuNzA3MTA2NzY5MDg0OTMwNCwgMS4yMTAxNjE3MDQxNzkzMTMzZS04KTsKCmNvbnN0IHZlYzIgQ09TX1RBQkxFXzBfRlA2NCA9IHZlYzIoMC45ODA3ODUyNTA2NjM3NTczLCAyLjk3Mzk0NzMxMDYzNjA0OTJlLTgpOwpjb25zdCB2ZWMyIENPU19UQUJMRV8xX0ZQNjQgPSB2ZWMyKDAuOTIzODc5NTA0MjAzNzk2NCwgMi44MzA3NDkwMzUxNzY0Mzg2ZS04KTsKY29uc3QgdmVjMiBDT1NfVEFCTEVfMl9GUDY0ID0gdmVjMigwLjgzMTQ2OTU5NTQzMjI4MTUsIDEuNjg3MDI2Mzc0MTUzMDc3OGUtOCk7CmNvbnN0IHZlYzIgQ09TX1RBQkxFXzNfRlA2NCA9IHZlYzIoMC43MDcxMDY3NjkwODQ5MzA0LCAxLjIxMDE2MTcxNTI4MTU0MzZlLTgpOwoKY29uc3QgdmVjMiBJTlZFUlNFX0ZBQ1RPUklBTF8zX0ZQNjQgPSB2ZWMyKDEuNjY2NjY2NzE2MzM3MjA0ZS0wMSwgLTQuOTY3MDUzODc5MzEyMjg5ZS0wOSk7IC8vIDEvMyEKY29uc3QgdmVjMiBJTlZFUlNFX0ZBQ1RPUklBTF80X0ZQNjQgPSB2ZWMyKDQuMTY2NjY2NzkwODQzMDFlLTAyLCAtMS4yNDE3NjM0Njk4MjgwNzIyZS0wOSk7IC8vIDEvNCEKY29uc3QgdmVjMiBJTlZFUlNFX0ZBQ1RPUklBTF81X0ZQNjQgPSB2ZWMyKDguMzMzMzMzNzY3OTUwNTM1ZS0wMywgLTQuMzQ2MTcyMDMzMzc1OTVlLTEwKTsgLy8gMS81IQpjb25zdCB2ZWMyIElOVkVSU0VfRkFDVE9SSUFMXzZfRlA2NCA9IHZlYzIoMS4zODg4ODg5MjI1MTk5ODE5ZS0wMywgLTMuMzYzMTA5NDQzNzEwMzIxNWUtMTEpOyAvLyAxLzYhCmNvbnN0IHZlYzIgSU5WRVJTRV9GQUNUT1JJQUxfN19GUDY0ID0gdmVjMigxLjk4NDEyNzAxMTM4Mjk1MjNlLTA0LCAgLTIuNzI1NTk2ODc0OTMzNDU2ZS0xMik7IC8vIDEvNyEKY29uc3QgdmVjMiBJTlZFUlNFX0ZBQ1RPUklBTF84X0ZQNjQgPSB2ZWMyKDIuNDgwMTU4NzY0MjI4NjkwNGUtMDUsIC0zLjQwNjk5NjAyNTkwNDE4NGUtMTMpOyAvLyAxLzghCmNvbnN0IHZlYzIgSU5WRVJTRV9GQUNUT1JJQUxfOV9GUDY0ID0gdmVjMigyLjc1NTczMTg4NDQ2Mjg3NTMzZS0wNiwgMy43OTM1NzEzOTM3MDM4MTg2ZS0xNCk7IC8vIDEvOSEKY29uc3QgdmVjMiBJTlZFUlNFX0ZBQ1RPUklBTF8xMF9GUDY0ID0gdmVjMigyLjc1NTczMTk5ODE0OTcxM2UtMDcsIC03LjU3NTExMjM2Nzg2OTg3M2UtMTUpOyAvLyAxLzEwIQoKZmxvYXQgbmludChmbG9hdCBkKSB7CiAgICBpZiAoZCA9PSBmbG9vcihkKSkgcmV0dXJuIGQ7CiAgICByZXR1cm4gZmxvb3IoZCArIDAuNSk7Cn0KCiNpZiBkZWZpbmVkKE5WSURJQV9GUDY0X1dPUktBUk9VTkQpIHx8IGRlZmluZWQoSU5URUxfRlA2NF9XT1JLQVJPVU5EKQp2ZWMyIHNwbGl0KGZsb2F0IGEpIHsKICBjb25zdCBmbG9hdCBTUExJVCA9IDQwOTcuMDsKICBmbG9hdCB0ID0gYSAqIFNQTElUOwogIGZsb2F0IGFfaGkgPSB0ICogT05FIC0gKHQgLSBhKTsKICBmbG9hdCBhX2xvID0gYSAqIE9ORSAtIGFfaGk7CiAgcmV0dXJuIHZlYzIoYV9oaSwgYV9sbyk7Cn0KI2Vsc2UKdmVjMiBzcGxpdChmbG9hdCBhKSB7CiAgY29uc3QgZmxvYXQgU1BMSVQgPSA0MDk3LjA7CiAgZmxvYXQgdCA9IGEgKiBTUExJVDsKICBmbG9hdCBhX2hpID0gdCAtICh0IC0gYSk7CiAgZmxvYXQgYV9sbyA9IGEgLSBhX2hpOwogIHJldHVybiB2ZWMyKGFfaGksIGFfbG8pOwp9CiNlbmRpZgoKI2lmIGRlZmluZWQoTlZJRElBX0VRVUFUSU9OX1dPUktBUk9VTkQpIHx8IGRlZmluZWQoSU5URUxfRVFVQVRJT05fV09SS0FST1VORCkKdmVjMiBxdWlja1R3b1N1bShmbG9hdCBhLCBmbG9hdCBiKSB7CiAgZmxvYXQgc3VtID0gKGEgKyBiKSAqIE9ORTsKICBmbG9hdCBlcnIgPSBiIC0gKHN1bSAtIGEpICogT05FOwogIHJldHVybiB2ZWMyKHN1bSwgZXJyKTsKfQojZWxzZQp2ZWMyIHF1aWNrVHdvU3VtKGZsb2F0IGEsIGZsb2F0IGIpIHsKICBmbG9hdCBzdW0gPSBhICsgYjsKICBmbG9hdCBlcnIgPSBiIC0gKHN1bSAtIGEpOwogIHJldHVybiB2ZWMyKHN1bSwgZXJyKTsKfQojZW5kaWYKCnZlYzIgbmludF9mcDY0KHZlYzIgYSkgewogICAgZmxvYXQgaGkgPSBuaW50KGEueCk7CiAgICBmbG9hdCBsbzsKICAgIHZlYzIgdG1wOwogICAgaWYgKGhpID09IGEueCkgewogICAgICAgIGxvID0gbmludChhLnkpOwogICAgICAgIHRtcCA9IHF1aWNrVHdvU3VtKGhpLCBsbyk7CiAgICB9IGVsc2UgewogICAgICAgIGxvID0gMC4wOwogICAgICAgIGlmIChhYnMoaGkgLSBhLngpID09IDAuNSAmJiBhLnkgPCAwLjApIHsKICAgICAgICAgICAgaGkgLT0gMS4wOwogICAgICAgIH0KICAgICAgICB0bXAgPSB2ZWMyKGhpLCBsbyk7CiAgICB9CiAgICByZXR1cm4gdG1wOwp9CgojaWYgZGVmaW5lZChOVklESUFfRVFVQVRJT05fV09SS0FST1VORCkgfHwgZGVmaW5lZChJTlRFTF9FUVVBVElPTl9XT1JLQVJPVU5EKQp2ZWMyIHR3b1N1bShmbG9hdCBhLCBmbG9hdCBiKSB7CiAgZmxvYXQgcyA9IChhICsgYikgKiBPTkU7CiAgZmxvYXQgdiA9IChzIC0gYSk7CiAgZmxvYXQgZXJyID0gKGEgLSAocyAtIHYpICogT05FKSAqIE9ORSArIChiIC0gdik7CiAgcmV0dXJuIHZlYzIocywgZXJyKTsKfQojZWxzZQp2ZWMyIHR3b1N1bShmbG9hdCBhLCBmbG9hdCBiKSB7CiAgZmxvYXQgcyA9IGEgKyBiOwogIGZsb2F0IHYgPSBzIC0gYTsKICBmbG9hdCBlcnIgPSAoYSAtIChzIC0gdikpICsgKGIgLSB2KTsKICByZXR1cm4gdmVjMihzLCBlcnIpOwp9CiNlbmRpZgoKI2lmIGRlZmluZWQoTlZJRElBX0VRVUFUSU9OX1dPUktBUk9VTkQpIHx8IGRlZmluZWQoSU5URUxfRVFVQVRJT05fV09SS0FST1VORCkKdmVjMiB0d29TdWIoZmxvYXQgYSwgZmxvYXQgYikgewogIGZsb2F0IHMgPSAoYSAtIGIpICogT05FOwogIGZsb2F0IHYgPSAocyAtIGEpOwogIGZsb2F0IGVyciA9IChhIC0gKHMgLSB2KSAqIE9ORSkgKiBPTkUgLSAoYiArIHYpOwogIHJldHVybiB2ZWMyKHMsIGVycik7Cn0KI2Vsc2UKdmVjMiB0d29TdWIoZmxvYXQgYSwgZmxvYXQgYikgewogIGZsb2F0IHMgPSBhIC0gYjsKICBmbG9hdCB2ID0gcyAtIGE7CiAgZmxvYXQgZXJyID0gKGEgLSAocyAtIHYpKSAtIChiICsgdik7CiAgcmV0dXJuIHZlYzIocywgZXJyKTsKfQojZW5kaWYKCnZlYzIgdHdvUHJvZChmbG9hdCBhLCBmbG9hdCBiKSB7CiAgZmxvYXQgcHJvZCA9IGEgKiBiOwogIHZlYzIgYV9mcDY0ID0gc3BsaXQoYSk7CiAgdmVjMiBiX2ZwNjQgPSBzcGxpdChiKTsKICBmbG9hdCBlcnIgPSAoKGFfZnA2NC54ICogYl9mcDY0LnggLSBwcm9kKSArIGFfZnA2NC54ICogYl9mcDY0LnkgKwogICAgYV9mcDY0LnkgKiBiX2ZwNjQueCkgKyBhX2ZwNjQueSAqIGJfZnA2NC55OwogIHJldHVybiB2ZWMyKHByb2QsIGVycik7Cn0KCiNpZiBkZWZpbmVkKE5WSURJQV9FUVVBVElPTl9XT1JLQVJPVU5EKSB8fCBkZWZpbmVkKElOVEVMX0VRVUFUSU9OX1dPUktBUk9VTkQpCnZlYzIgdHdvU3FyKGZsb2F0IGEpIHsKICBmbG9hdCBwcm9kID0gYSAqIGE7CiAgdmVjMiBhX2ZwNjQgPSBzcGxpdChhKTsKCiAgZmxvYXQgZXJyID0gKChhX2ZwNjQueCAqIGFfZnA2NC54IC0gcHJvZCkgKiBPTkUgKyAyLjAgKiBhX2ZwNjQueCAqIGFfZnA2NC55ICogT05FICogT05FKSArIGFfZnA2NC55ICogYV9mcDY0LnkgKiBPTkUgKiBPTkUgKiBPTkU7CiAgcmV0dXJuIHZlYzIocHJvZCwgZXJyKTsKfQojZWxzZQp2ZWMyIHR3b1NxcihmbG9hdCBhKSB7CiAgZmxvYXQgcHJvZCA9IGEgKiBhOwogIHZlYzIgYV9mcDY0ID0gc3BsaXQoYSk7CgogIGZsb2F0IGVyciA9ICgoYV9mcDY0LnggKiBhX2ZwNjQueCAtIHByb2QpICsgMi4wICogYV9mcDY0LnggKiBhX2ZwNjQueSkgKyBhX2ZwNjQueSAqIGFfZnA2NC55OwogIHJldHVybiB2ZWMyKHByb2QsIGVycik7Cn0KI2VuZGlmCgp2ZWMyIHN1bV9mcDY0KHZlYzIgYSwgdmVjMiBiKSB7CiAgdmVjMiBzLCB0OwogIHMgPSB0d29TdW0oYS54LCBiLngpOwogIHQgPSB0d29TdW0oYS55LCBiLnkpOwogIHMueSArPSB0Lng7CiAgcyA9IHF1aWNrVHdvU3VtKHMueCwgcy55KTsKICBzLnkgKz0gdC55OwogIHMgPSBxdWlja1R3b1N1bShzLngsIHMueSk7CiAgcmV0dXJuIHM7Cn0KCnZlYzIgc3ViX2ZwNjQodmVjMiBhLCB2ZWMyIGIpIHsKICB2ZWMyIHMsIHQ7CiAgcyA9IHR3b1N1YihhLngsIGIueCk7CiAgdCA9IHR3b1N1YihhLnksIGIueSk7CiAgcy55ICs9IHQueDsKICBzID0gcXVpY2tUd29TdW0ocy54LCBzLnkpOwogIHMueSArPSB0Lnk7CiAgcyA9IHF1aWNrVHdvU3VtKHMueCwgcy55KTsKICByZXR1cm4gczsKfQoKdmVjMiBtdWxfZnA2NCh2ZWMyIGEsIHZlYzIgYikgewogIHZlYzIgcHJvZCA9IHR3b1Byb2QoYS54LCBiLngpOwogIC8vIHkgY29tcG9uZW50IGlzIGZvciB0aGUgZXJyb3IKICBwcm9kLnkgKz0gYS54ICogYi55OwogIHByb2QueSArPSBhLnkgKiBiLng7CiAgcHJvZCA9IHF1aWNrVHdvU3VtKHByb2QueCwgcHJvZC55KTsKICByZXR1cm4gcHJvZDsKfQoKdmVjMiBkaXZfZnA2NCh2ZWMyIGEsIHZlYzIgYikgewogIGZsb2F0IHhuID0gMS4wIC8gYi54OwogIHZlYzIgeW4gPSBhICogeG47CiAgZmxvYXQgZGlmZiA9IChzdWJfZnA2NChhLCBtdWxfZnA2NChiLCB5bikpKS54OwogIHZlYzIgcHJvZCA9IHR3b1Byb2QoeG4sIGRpZmYpOwogIHJldHVybiBzdW1fZnA2NCh5biwgcHJvZCk7Cn0KCnZlYzIgc3FydF9mcDY0KHZlYzIgYSkgewoKICBpZiAoYS54ID09IDAuMCAmJiBhLnkgPT0gMC4wKSByZXR1cm4gdmVjMigwLjAsIDAuMCk7CiAgaWYgKGEueCA8IDAuMCkgcmV0dXJuIHZlYzIoMC4wIC8gMC4wLCAwLjAgLyAwLjApOwoKICBmbG9hdCB4ID0gMS4wIC8gc3FydChhLngpOwogIGZsb2F0IHluID0gYS54ICogeDsKI2lmIGRlZmluZWQoTlZJRElBX0ZQNjRfV09SS0FST1VORCkgfHwgZGVmaW5lZChJTlRFTF9GUDY0X1dPUktBUk9VTkQpCiAgdmVjMiB5bl9zcXIgPSB0d29TcXIoeW4pICogT05FOwojZWxzZQogIHZlYzIgeW5fc3FyID0gdHdvU3FyKHluKTsKI2VuZGlmCiAgZmxvYXQgZGlmZiA9IHN1Yl9mcDY0KGEsIHluX3NxcikueDsKICB2ZWMyIHByb2QgPSB0d29Qcm9kKHggKiAwLjUsIGRpZmYpOwogIHJldHVybiBzdW1fZnA2NCh2ZWMyKHluLCAwLjApLCBwcm9kKTsKfQoKdmVjMiBleHBfZnA2NCh2ZWMyIGEpIHsKICBjb25zdCBmbG9hdCBrID0gNTEyLjA7CiAgY29uc3QgZmxvYXQgaW52X2sgPSAxLjAgLyBrOwoKICBpZiAoYS54IDw9IC04OC4wKSByZXR1cm4gdmVjMigwLjAsIDAuMCk7CiAgaWYgKGEueCA+PSA4OC4wKSByZXR1cm4gdmVjMigxLjAgLyAwLjAsIDEuMCAvIDAuMCk7CiAgaWYgKGEueCA9PSAwLjAgJiYgYS55ID09IDAuMCkgcmV0dXJuIHZlYzIoMS4wLCAwLjApOwogIGlmIChhLnggPT0gMS4wICYmIGEueSA9PSAwLjApIHJldHVybiBFX0ZQNjQ7CgogIC8vIFJhbmdlIHJlZHVjdGlvbiB1c2luZyBhc3N1bWUgYSA9IGtyICsgbSAqIGxvZygyKSwgayBhbmQgbSBiZWluZyBpbnRlZ2Vycy4KICAvLyBTZXQgayA9IDkgKHdlIGNhbiBjaG9vc2Ugb3RoZXIgayB0byB0cmFkZSBhY2N1cmFjeSB3aXRoIHBlcmZvcm1hbmNlLgogIC8vIHdlIG9ubHkgbmVlZCB0byBjYWxjdWxhdGUgZXhwKHIpIGFuZCB1c2luZyBleHAoYSkgPSAyXm0gKiBleHAocileawoKICBmbG9hdCBtID0gZmxvb3IoYS54IC8gTE9HMl9GUDY0LnggKyAwLjUpOwogIHZlYzIgciA9IHN1Yl9mcDY0KGEsIG11bF9mcDY0KExPRzJfRlA2NCwgdmVjMihtLCAwLjApKSkgKiBpbnZfazsKICB2ZWMyIHMsIHQsIHA7CgogIHAgPSBtdWxfZnA2NChyLCByKTsKICBzID0gc3VtX2ZwNjQociwgcCAqIDAuNSk7CiAgcCA9IG11bF9mcDY0KHAsIHIpOwogIHQgPSBtdWxfZnA2NChwLCBJTlZFUlNFX0ZBQ1RPUklBTF8zX0ZQNjQpOwoKICBzID0gc3VtX2ZwNjQocywgdCk7CiAgcCA9IG11bF9mcDY0KHAsIHIpOwogIHQgPSBtdWxfZnA2NChwLCBJTlZFUlNFX0ZBQ1RPUklBTF80X0ZQNjQpOwoKICBzID0gc3VtX2ZwNjQocywgdCk7CiAgcCA9IG11bF9mcDY0KHAsIHIpOwogIHQgPSBtdWxfZnA2NChwLCBJTlZFUlNFX0ZBQ1RPUklBTF81X0ZQNjQpOwoKICBzID0gc3VtX2ZwNjQocywgdCk7CiAgcCA9IG11bF9mcDY0KHAsIHIpOwogIHQgPSBtdWxfZnA2NChwLCBJTlZFUlNFX0ZBQ1RPUklBTF82X0ZQNjQpOwoKICBzID0gc3VtX2ZwNjQocywgdCk7CiAgcCA9IG11bF9mcDY0KHAsIHIpOwogIHQgPSBtdWxfZnA2NChwLCBJTlZFUlNFX0ZBQ1RPUklBTF83X0ZQNjQpOwoKICBzID0gc3VtX2ZwNjQocywgdCk7CgogIC8vIEF0IHRoaXMgcG9pbnQsIHMgPSBleHAocikgLSAxOyBidXQgYWZ0ZXIgZm9sbG93aW5nIDQgcmVjdXJzaW9ucywgd2Ugd2lsbCBnZXQgZXhwKHIpIF4gNTEyIC0gMS4KCiAgcyA9IHN1bV9mcDY0KHMgKiAyLjAsIG11bF9mcDY0KHMsIHMpKTsKICBzID0gc3VtX2ZwNjQocyAqIDIuMCwgbXVsX2ZwNjQocywgcykpOwogIHMgPSBzdW1fZnA2NChzICogMi4wLCBtdWxfZnA2NChzLCBzKSk7CiAgcyA9IHN1bV9mcDY0KHMgKiAyLjAsIG11bF9mcDY0KHMsIHMpKTsKCiAgLy8gV2UgY2FuIGFkZCBtb3JlIGl0ZXJhdGlvbnMgaGVyZSBhbmQgaW5jcmVhc2Ugay4KICBzID0gc3VtX2ZwNjQocyAqIDIuMCwgbXVsX2ZwNjQocywgcykpOwogIHMgPSBzdW1fZnA2NChzICogMi4wLCBtdWxfZnA2NChzLCBzKSk7CiAgcyA9IHN1bV9mcDY0KHMgKiAyLjAsIG11bF9mcDY0KHMsIHMpKTsKICBzID0gc3VtX2ZwNjQocyAqIDIuMCwgbXVsX2ZwNjQocywgcykpOwogIHMgPSBzdW1fZnA2NChzICogMi4wLCBtdWxfZnA2NChzLCBzKSk7CgojaWYgZGVmaW5lZChOVklESUFfRlA2NF9XT1JLQVJPVU5EKSB8fCBkZWZpbmVkKElOVEVMX0ZQNjRfV09SS0FST1VORCkKICBzID0gc3VtX2ZwNjQocywgdmVjMigxLjAsIDAuMCkgKiBPTkUpOwojZWxzZQogIHMgPSBzdW1fZnA2NChzLCB2ZWMyKDEuMCwgMC4wKSk7CiNlbmRpZgoKICByZXR1cm4gcyAqIHBvdygyLjAsIG0pOwovLyAgIHJldHVybiByOwp9Cgp2ZWMyIGxvZ19mcDY0KHZlYzIgYSkKewogIGlmIChhLnggPT0gMS4wICYmIGEueSA9PSAwLjApIHJldHVybiB2ZWMyKDAuMCwgMC4wKTsKICBpZiAoYS54IDw9IDAuMCkgcmV0dXJuIHZlYzIoMC4wIC8gMC4wLCAwLjAgLyAwLjApOwogIHZlYzIgeCA9IHZlYzIobG9nKGEueCksIDAuMCk7CiAgeCA9IHN1Yl9mcDY0KHN1bV9mcDY0KHgsIG11bF9mcDY0KGEsIGV4cF9mcDY0KC14KSkpLCB2ZWMyKDEuMCwgMC4wKSk7CiAgcmV0dXJuIHg7Cn0KCnZlYzIgc2luX3RheWxvcl9mcDY0KHZlYzIgYSkgewogIHZlYzIgciwgcywgdCwgeDsKCiAgaWYgKGEueCA9PSAwLjAgJiYgYS55ID09IDAuMCkgewogICAgcmV0dXJuIHZlYzIoMC4wLCAwLjApOwogIH0KCiAgeCA9IC1tdWxfZnA2NChhLCBhKTsKICBzID0gYTsKICByID0gYTsKCiAgciA9IG11bF9mcDY0KHIsIHgpOwogIHQgPSBtdWxfZnA2NChyLCBJTlZFUlNFX0ZBQ1RPUklBTF8zX0ZQNjQpOwogIHMgPSBzdW1fZnA2NChzLCB0KTsKCiAgciA9IG11bF9mcDY0KHIsIHgpOwogIHQgPSBtdWxfZnA2NChyLCBJTlZFUlNFX0ZBQ1RPUklBTF81X0ZQNjQpOwogIHMgPSBzdW1fZnA2NChzLCB0KTsKCiAgciA9IG11bF9mcDY0KHIsIHgpOwogIHQgPSBtdWxfZnA2NChyLCBJTlZFUlNFX0ZBQ1RPUklBTF83X0ZQNjQpOwogIHMgPSBzdW1fZnA2NChzLCB0KTsKCiAgciA9IG11bF9mcDY0KHIsIHgpOwogIHQgPSBtdWxfZnA2NChyLCBJTlZFUlNFX0ZBQ1RPUklBTF85X0ZQNjQpOwogIHMgPSBzdW1fZnA2NChzLCB0KTsKCiAgcmV0dXJuIHM7Cn0KCnZlYzIgY29zX3RheWxvcl9mcDY0KHZlYzIgYSkgewogIHZlYzIgciwgcywgdCwgeDsKCiAgaWYgKGEueCA9PSAwLjAgJiYgYS55ID09IDAuMCkgewogICAgcmV0dXJuIHZlYzIoMS4wLCAwLjApOwogIH0KCiAgeCA9IC1tdWxfZnA2NChhLCBhKTsKICByID0geDsKICBzID0gc3VtX2ZwNjQodmVjMigxLjAsIDAuMCksIHIgKiAwLjUpOwoKICByID0gbXVsX2ZwNjQociwgeCk7CiAgdCA9IG11bF9mcDY0KHIsIElOVkVSU0VfRkFDVE9SSUFMXzRfRlA2NCk7CiAgcyA9IHN1bV9mcDY0KHMsIHQpOwoKICByID0gbXVsX2ZwNjQociwgeCk7CiAgdCA9IG11bF9mcDY0KHIsIElOVkVSU0VfRkFDVE9SSUFMXzZfRlA2NCk7CiAgcyA9IHN1bV9mcDY0KHMsIHQpOwoKICByID0gbXVsX2ZwNjQociwgeCk7CiAgdCA9IG11bF9mcDY0KHIsIElOVkVSU0VfRkFDVE9SSUFMXzhfRlA2NCk7CiAgcyA9IHN1bV9mcDY0KHMsIHQpOwoKICByID0gbXVsX2ZwNjQociwgeCk7CiAgdCA9IG11bF9mcDY0KHIsIElOVkVSU0VfRkFDVE9SSUFMXzEwX0ZQNjQpOwogIHMgPSBzdW1fZnA2NChzLCB0KTsKCiAgcmV0dXJuIHM7Cn0KCnZvaWQgc2luY29zX3RheWxvcl9mcDY0KHZlYzIgYSwgb3V0IHZlYzIgc2luX3QsIG91dCB2ZWMyIGNvc190KSB7CiAgaWYgKGEueCA9PSAwLjAgJiYgYS55ID09IDAuMCkgewogICAgc2luX3QgPSB2ZWMyKDAuMCwgMC4wKTsKICAgIGNvc190ID0gdmVjMigxLjAsIDAuMCk7CiAgfQoKICBzaW5fdCA9IHNpbl90YXlsb3JfZnA2NChhKTsKICBjb3NfdCA9IHNxcnRfZnA2NChzdWJfZnA2NCh2ZWMyKDEuMCwgMC4wKSwgbXVsX2ZwNjQoc2luX3QsIHNpbl90KSkpOwp9Cgp2ZWMyIHNpbl9mcDY0KHZlYzIgYSkgewogICAgaWYgKGEueCA9PSAwLjAgJiYgYS55ID09IDAuMCkgewogICAgICAgIHJldHVybiB2ZWMyKDAuMCwgMC4wKTsKICAgIH0KCiAgICAvLyAycGkgcmFuZ2UgcmVkdWN0aW9uCiAgICB2ZWMyIHogPSBuaW50X2ZwNjQoZGl2X2ZwNjQoYSwgVFdPX1BJX0ZQNjQpKTsKICAgIHZlYzIgciA9IHN1Yl9mcDY0KGEsIG11bF9mcDY0KFRXT19QSV9GUDY0LCB6KSk7CgogICAgdmVjMiB0OwogICAgZmxvYXQgcSA9IGZsb29yKHIueCAvIFBJXzJfRlA2NC54ICsgMC41KTsKICAgIGludCBqID0gaW50KHEpOwoKICAgIGlmIChqIDwgLTIgfHwgaiA+IDIpIHsKICAgICAgICByZXR1cm4gdmVjMigwLjAgLyAwLjAsIDAuMCAvIDAuMCk7CiAgICB9CgogICAgdCA9IHN1Yl9mcDY0KHIsIG11bF9mcDY0KFBJXzJfRlA2NCwgdmVjMihxLCAwLjApKSk7CgogICAgcSA9IGZsb29yKHQueCAvIFBJXzE2X0ZQNjQueCArIDAuNSk7CiAgICBpbnQgayA9IGludChxKTsKCiAgICBpZiAoayA9PSAwKSB7CiAgICAgICAgaWYgKGogPT0gMCkgewogICAgICAgICAgICByZXR1cm4gc2luX3RheWxvcl9mcDY0KHQpOwogICAgICAgIH0gZWxzZSBpZiAoaiA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBjb3NfdGF5bG9yX2ZwNjQodCk7CiAgICAgICAgfSBlbHNlIGlmIChqID09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiAtY29zX3RheWxvcl9mcDY0KHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAtc2luX3RheWxvcl9mcDY0KHQpOwogICAgICAgIH0KICAgIH0KCiAgICBpbnQgYWJzX2sgPSBpbnQoYWJzKGZsb2F0KGspKSk7CgogICAgaWYgKGFic19rID4gNCkgewogICAgICAgIHJldHVybiB2ZWMyKDAuMCAvIDAuMCwgMC4wIC8gMC4wKTsKICAgIH0gZWxzZSBpZiAoayA9PSAzKSB7CiAgICAgICAgdCA9IHN1Yl9mcDY0KHQsIFBJXzE2XzNfRlA2NCk7CiAgICB9IGVsc2UgaWYgKGsgPT0gLTMpIHsKICAgICAgICB0ID0gc3VtX2ZwNjQodCwgUElfMTZfM19GUDY0KTsKICAgIH0gZWxzZSB7CiAgICAgICAgdCA9IHN1Yl9mcDY0KHQsIG11bF9mcDY0KFBJXzE2X0ZQNjQsIHZlYzIocSwgMC4wKSkpOwogICAgfQoKICAgIHZlYzIgdSA9IHZlYzIoMC4wLCAwLjApOwogICAgdmVjMiB2ID0gdmVjMigwLjAsIDAuMCk7CgojaWYgZGVmaW5lZChOVklESUFfRVFVQVRJT05fV09SS0FST1VORCkgfHwgZGVmaW5lZChJTlRFTF9FUVVBVElPTl9XT1JLQVJPVU5EKQogICAgaWYgKGFicyhmbG9hdChhYnNfaykgLSAxLjApIDwgMC41KSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8wX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8wX0ZQNjQ7CiAgICB9IGVsc2UgaWYgKGFicyhmbG9hdChhYnNfaykgLSAyLjApIDwgMC41KSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8xX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8xX0ZQNjQ7CiAgICB9IGVsc2UgaWYgKGFicyhmbG9hdChhYnNfaykgLSAzLjApIDwgMC41KSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8yX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8yX0ZQNjQ7CiAgICB9IGVsc2UgaWYgKGFicyhmbG9hdChhYnNfaykgLSA0LjApIDwgMC41KSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8zX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8zX0ZQNjQ7CiAgICB9CiNlbHNlCiAgICBpZiAoYWJzX2sgPT0gMSkgewogICAgICAgIHUgPSBDT1NfVEFCTEVfMF9GUDY0OwogICAgICAgIHYgPSBTSU5fVEFCTEVfMF9GUDY0OwogICAgfSBlbHNlIGlmIChhYnNfayA9PSAyKSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8xX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8xX0ZQNjQ7CiAgICB9IGVsc2UgaWYgKGFic19rID09IDMpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzJfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzJfRlA2NDsKICAgIH0gZWxzZSBpZiAoYWJzX2sgPT0gNCkgewogICAgICAgIHUgPSBDT1NfVEFCTEVfM19GUDY0OwogICAgICAgIHYgPSBTSU5fVEFCTEVfM19GUDY0OwogICAgfQojZW5kaWYKCiAgICB2ZWMyIHNpbl90LCBjb3NfdDsKICAgIHNpbmNvc190YXlsb3JfZnA2NCh0LCBzaW5fdCwgY29zX3QpOwoKICAgIHZlYzIgcmVzdWx0ID0gdmVjMigwLjAsIDAuMCk7CiAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgaWYgKGsgPiAwKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHN1bV9mcDY0KG11bF9mcDY0KHUsIHNpbl90KSwgbXVsX2ZwNjQodiwgY29zX3QpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBzdWJfZnA2NChtdWxfZnA2NCh1LCBzaW5fdCksIG11bF9mcDY0KHYsIGNvc190KSk7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChqID09IDEpIHsKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcmVzdWx0ID0gc3ViX2ZwNjQobXVsX2ZwNjQodSwgY29zX3QpLCBtdWxfZnA2NCh2LCBzaW5fdCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHN1bV9mcDY0KG11bF9mcDY0KHUsIGNvc190KSwgbXVsX2ZwNjQodiwgc2luX3QpKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGogPT0gLTEpIHsKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcmVzdWx0ID0gc3ViX2ZwNjQobXVsX2ZwNjQodiwgc2luX3QpLCBtdWxfZnA2NCh1LCBjb3NfdCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IC1zdW1fZnA2NChtdWxfZnA2NCh2LCBzaW5fdCksIG11bF9mcDY0KHUsIGNvc190KSk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcmVzdWx0ID0gLXN1bV9mcDY0KG11bF9mcDY0KHUsIHNpbl90KSwgbXVsX2ZwNjQodiwgY29zX3QpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBzdWJfZnA2NChtdWxfZnA2NCh2LCBjb3NfdCksIG11bF9mcDY0KHUsIHNpbl90KSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCnZlYzIgY29zX2ZwNjQodmVjMiBhKSB7CiAgICBpZiAoYS54ID09IDAuMCAmJiBhLnkgPT0gMC4wKSB7CiAgICAgICAgcmV0dXJuIHZlYzIoMS4wLCAwLjApOwogICAgfQoKICAgIC8vIDJwaSByYW5nZSByZWR1Y3Rpb24KICAgIHZlYzIgeiA9IG5pbnRfZnA2NChkaXZfZnA2NChhLCBUV09fUElfRlA2NCkpOwogICAgdmVjMiByID0gc3ViX2ZwNjQoYSwgbXVsX2ZwNjQoVFdPX1BJX0ZQNjQsIHopKTsKCiAgICB2ZWMyIHQ7CiAgICBmbG9hdCBxID0gZmxvb3Ioci54IC8gUElfMl9GUDY0LnggKyAwLjUpOwogICAgaW50IGogPSBpbnQocSk7CgogICAgaWYgKGogPCAtMiB8fCBqID4gMikgewogICAgICAgIHJldHVybiB2ZWMyKDAuMCAvIDAuMCwgMC4wIC8gMC4wKTsKICAgIH0KCiAgICB0ID0gc3ViX2ZwNjQociwgbXVsX2ZwNjQoUElfMl9GUDY0LCB2ZWMyKHEsIDAuMCkpKTsKCiAgICBxID0gZmxvb3IodC54IC8gUElfMTZfRlA2NC54ICsgMC41KTsKICAgIGludCBrID0gaW50KHEpOwoKICAgIGlmIChrID09IDApIHsKICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBjb3NfdGF5bG9yX2ZwNjQodCk7CiAgICAgICAgfSBlbHNlIGlmIChqID09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIC1zaW5fdGF5bG9yX2ZwNjQodCk7CiAgICAgICAgfSBlbHNlIGlmIChqID09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiBzaW5fdGF5bG9yX2ZwNjQodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIC1jb3NfdGF5bG9yX2ZwNjQodCk7CiAgICAgICAgfQogICAgfQoKICAgIGludCBhYnNfayA9IGludChhYnMoZmxvYXQoaykpKTsKCiAgICBpZiAoYWJzX2sgPiA0KSB7CiAgICAgICAgcmV0dXJuIHZlYzIoMC4wIC8gMC4wLCAwLjAgLyAwLjApOwogICAgfSBlbHNlIGlmIChrID09IDMpIHsKICAgICAgICB0ID0gc3ViX2ZwNjQodCwgUElfMTZfM19GUDY0KTsKICAgIH0gZWxzZSBpZiAoayA9PSAtMykgewogICAgICAgIHQgPSBzdW1fZnA2NCh0LCBQSV8xNl8zX0ZQNjQpOwogICAgfSBlbHNlIHsKICAgICAgICB0ID0gc3ViX2ZwNjQodCwgbXVsX2ZwNjQoUElfMTZfRlA2NCwgdmVjMihxLCAwLjApKSk7CiAgICB9CgogICAgdmVjMiB1ID0gdmVjMigwLjAsIDAuMCk7CiAgICB2ZWMyIHYgPSB2ZWMyKDAuMCwgMC4wKTsKCiNpZiBkZWZpbmVkKE5WSURJQV9FUVVBVElPTl9XT1JLQVJPVU5EKSB8fCBkZWZpbmVkKElOVEVMX0VRVUFUSU9OX1dPUktBUk9VTkQpCiAgICBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDEuMCkgPCAwLjUpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzBfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzBfRlA2NDsKICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDIuMCkgPCAwLjUpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzFfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzFfRlA2NDsKICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDMuMCkgPCAwLjUpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzJfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzJfRlA2NDsKICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDQuMCkgPCAwLjUpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzNfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzNfRlA2NDsKICAgIH0KI2Vsc2UKICAgIGlmIChhYnNfayA9PSAxKSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8wX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8wX0ZQNjQ7CiAgICB9IGVsc2UgaWYgKGFic19rID09IDIpIHsKICAgICAgICB1ID0gQ09TX1RBQkxFXzFfRlA2NDsKICAgICAgICB2ID0gU0lOX1RBQkxFXzFfRlA2NDsKICAgIH0gZWxzZSBpZiAoYWJzX2sgPT0gMykgewogICAgICAgIHUgPSBDT1NfVEFCTEVfMl9GUDY0OwogICAgICAgIHYgPSBTSU5fVEFCTEVfMl9GUDY0OwogICAgfSBlbHNlIGlmIChhYnNfayA9PSA0KSB7CiAgICAgICAgdSA9IENPU19UQUJMRV8zX0ZQNjQ7CiAgICAgICAgdiA9IFNJTl9UQUJMRV8zX0ZQNjQ7CiAgICB9CiNlbmRpZgoKICAgIHZlYzIgc2luX3QsIGNvc190OwogICAgc2luY29zX3RheWxvcl9mcDY0KHQsIHNpbl90LCBjb3NfdCk7CgogICAgdmVjMiByZXN1bHQgPSB2ZWMyKDAuMCwgMC4wKTsKICAgIGlmIChqID09IDApIHsKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcmVzdWx0ID0gc3ViX2ZwNjQobXVsX2ZwNjQodSwgY29zX3QpLCBtdWxfZnA2NCh2LCBzaW5fdCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHN1bV9mcDY0KG11bF9mcDY0KHUsIGNvc190KSwgbXVsX2ZwNjQodiwgc2luX3QpKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGogPT0gMSkgewogICAgICAgIGlmIChrID4gMCkgewogICAgICAgICAgICByZXN1bHQgPSAtc3VtX2ZwNjQobXVsX2ZwNjQodSwgc2luX3QpLCBtdWxfZnA2NCh2LCBjb3NfdCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHN1Yl9mcDY0KG11bF9mcDY0KHYsIGNvc190KSwgbXVsX2ZwNjQodSwgc2luX3QpKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGogPT0gLTEpIHsKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcmVzdWx0ID0gc3VtX2ZwNjQobXVsX2ZwNjQodSwgc2luX3QpLCBtdWxfZnA2NCh2LCBjb3NfdCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHN1Yl9mcDY0KG11bF9mcDY0KHUsIHNpbl90KSwgbXVsX2ZwNjQodiwgY29zX3QpKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmIChrID4gMCkgewogICAgICAgICAgICByZXN1bHQgPSBzdWJfZnA2NChtdWxfZnA2NCh2LCBzaW5fdCksIG11bF9mcDY0KHUsIGNvc190KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gLXN1bV9mcDY0KG11bF9mcDY0KHUsIGNvc190KSwgbXVsX2ZwNjQodiwgc2luX3QpKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfQoKdmVjMiB0YW5fZnA2NCh2ZWMyIGEpIHsKICAgIHZlYzIgc2luX2E7CiAgICB2ZWMyIGNvc19hOwoKICAgIGlmIChhLnggPT0gMC4wICYmIGEueSA9PSAwLjApIHsKICAgICAgICByZXR1cm4gdmVjMigwLjAsIDAuMCk7CiAgICB9CgogICAgLy8gMnBpIHJhbmdlIHJlZHVjdGlvbgogICAgdmVjMiB6ID0gbmludF9mcDY0KGRpdl9mcDY0KGEsIFRXT19QSV9GUDY0KSk7CiAgICB2ZWMyIHIgPSBzdWJfZnA2NChhLCBtdWxfZnA2NChUV09fUElfRlA2NCwgeikpOwoKICAgIHZlYzIgdDsKICAgIGZsb2F0IHEgPSBmbG9vcihyLnggLyBQSV8yX0ZQNjQueCArIDAuNSk7CiAgICBpbnQgaiA9IGludChxKTsKCgogICAgaWYgKGogPCAtMiB8fCBqID4gMikgewogICAgICAgIHJldHVybiB2ZWMyKDAuMCAvIDAuMCwgMC4wIC8gMC4wKTsKICAgIH0KCiAgICB0ID0gc3ViX2ZwNjQociwgbXVsX2ZwNjQoUElfMl9GUDY0LCB2ZWMyKHEsIDAuMCkpKTsKCiAgICBxID0gZmxvb3IodC54IC8gUElfMTZfRlA2NC54ICsgMC41KTsKICAgIGludCBrID0gaW50KHEpOwogICAgaW50IGFic19rID0gaW50KGFicyhmbG9hdChrKSkpOwoKICAgIC8vIFdlIGp1c3QgY2FuJ3QgZ2V0IFBJLzE2ICogMy4wIHZlcnkgYWNjdXJhdGVseS4KICAgIC8vIHNvIGxldCdzIGp1c3Qgc3RvcmUgaXQKICAgIGlmIChhYnNfayA+IDQpIHsKICAgICAgICByZXR1cm4gdmVjMigwLjAgLyAwLjAsIDAuMCAvIDAuMCk7CiAgICB9IGVsc2UgaWYgKGsgPT0gMykgewogICAgICAgIHQgPSBzdWJfZnA2NCh0LCBQSV8xNl8zX0ZQNjQpOwogICAgfSBlbHNlIGlmIChrID09IC0zKSB7CiAgICAgICAgdCA9IHN1bV9mcDY0KHQsIFBJXzE2XzNfRlA2NCk7CiAgICB9IGVsc2UgewogICAgICAgIHQgPSBzdWJfZnA2NCh0LCBtdWxfZnA2NChQSV8xNl9GUDY0LCB2ZWMyKHEsIDAuMCkpKTsKICAgIH0KCgogICAgdmVjMiB1ID0gdmVjMigwLjAsIDAuMCk7CiAgICB2ZWMyIHYgPSB2ZWMyKDAuMCwgMC4wKTsKCiAgICB2ZWMyIHNpbl90LCBjb3NfdDsKICAgIHZlYzIgcywgYzsKICAgIHNpbmNvc190YXlsb3JfZnA2NCh0LCBzaW5fdCwgY29zX3QpOwoKICAgIGlmIChrID09IDApIHsKICAgICAgICBzID0gc2luX3Q7CiAgICAgICAgYyA9IGNvc190OwogICAgfSBlbHNlIHsKI2lmIGRlZmluZWQoTlZJRElBX0VRVUFUSU9OX1dPUktBUk9VTkQpIHx8IGRlZmluZWQoSU5URUxfRVFVQVRJT05fV09SS0FST1VORCkKICAgICAgICBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDEuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8wX0ZQNjQ7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfMF9GUDY0OwogICAgICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDIuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8xX0ZQNjQ7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfMV9GUDY0OwogICAgICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDMuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8yX0ZQNjQ7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfMl9GUDY0OwogICAgICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDQuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8zX0ZQNjQ7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfM19GUDY0OwogICAgICAgIH0KI2Vsc2UKICAgICAgICBpZiAoYWJzX2sgPT0gMSkgewogICAgICAgICAgICB1ID0gQ09TX1RBQkxFXzBfRlA2NDsKICAgICAgICAgICAgdiA9IFNJTl9UQUJMRV8wX0ZQNjQ7CiAgICAgICAgfSBlbHNlIGlmIChhYnNfayA9PSAyKSB7CiAgICAgICAgICAgIHUgPSBDT1NfVEFCTEVfMV9GUDY0OwogICAgICAgICAgICB2ID0gU0lOX1RBQkxFXzFfRlA2NDsKICAgICAgICB9IGVsc2UgaWYgKGFic19rID09IDMpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8yX0ZQNjQ7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfMl9GUDY0OwogICAgICAgIH0gZWxzZSBpZiAoYWJzX2sgPT0gNCkgewogICAgICAgICAgICB1ID0gQ09TX1RBQkxFXzNfRlA2NDsKICAgICAgICAgICAgdiA9IFNJTl9UQUJMRV8zX0ZQNjQ7CiAgICAgICAgfQojZW5kaWYKICAgICAgICBpZiAoayA+IDApIHsKICAgICAgICAgICAgcyA9IHN1bV9mcDY0KG11bF9mcDY0KHUsIHNpbl90KSwgbXVsX2ZwNjQodiwgY29zX3QpKTsKICAgICAgICAgICAgYyA9IHN1Yl9mcDY0KG11bF9mcDY0KHUsIGNvc190KSwgbXVsX2ZwNjQodiwgc2luX3QpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzID0gc3ViX2ZwNjQobXVsX2ZwNjQodSwgc2luX3QpLCBtdWxfZnA2NCh2LCBjb3NfdCkpOwogICAgICAgICAgICBjID0gc3VtX2ZwNjQobXVsX2ZwNjQodSwgY29zX3QpLCBtdWxfZnA2NCh2LCBzaW5fdCkpOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgc2luX2EgPSBzOwogICAgICAgIGNvc19hID0gYzsKICAgIH0gZWxzZSBpZiAoaiA9PSAxKSB7CiAgICAgICAgc2luX2EgPSBjOwogICAgICAgIGNvc19hID0gLXM7CiAgICB9IGVsc2UgaWYgKGogPT0gLTEpIHsKICAgICAgICBzaW5fYSA9IC1jOwogICAgICAgIGNvc19hID0gczsKICAgIH0gZWxzZSB7CiAgICAgICAgc2luX2EgPSAtczsKICAgICAgICBjb3NfYSA9IC1jOwogICAgfQogICAgcmV0dXJuIGRpdl9mcDY0KHNpbl9hLCBjb3NfYSk7Cn0KCnZlYzIgcmFkaWFuc19mcDY0KHZlYzIgZGVncmVlKSB7CiAgcmV0dXJuIGRpdl9mcDY0KG11bF9mcDY0KGRlZ3JlZSwgUElfRlA2NCksIHZlYzIoMTgwLjAsIDAuMCkpOwp9CgovLyBWZWN0b3IgZnVuY3Rpb25zCi8vIHZlYzIgZnVuY3Rpb25zCnZvaWQgdmVjMl9zdW1fZnA2NCh2ZWMyIGFbMl0sIHZlYzIgYlsyXSwgb3V0IHZlYzIgb3V0X3ZhbFsyXSkgewogICAgb3V0X3ZhbFswXSA9IHN1bV9mcDY0KGFbMF0sIGJbMF0pOwogICAgb3V0X3ZhbFsxXSA9IHN1bV9mcDY0KGFbMV0sIGJbMV0pOwp9Cgp2b2lkIHZlYzJfc3ViX2ZwNjQodmVjMiBhWzJdLCB2ZWMyIGJbMl0sIG91dCB2ZWMyIG91dF92YWxbMl0pIHsKICAgIG91dF92YWxbMF0gPSBzdWJfZnA2NChhWzBdLCBiWzBdKTsKICAgIG91dF92YWxbMV0gPSBzdWJfZnA2NChhWzFdLCBiWzFdKTsKfQoKdm9pZCB2ZWMyX21peF9mcDY0KHZlYzIgeFsyXSwgdmVjMiB5WzJdLCBmbG9hdCBhLCBvdXQgdmVjMiBvdXRfdmFsWzJdKSB7CiAgdmVjMiByYW5nZVsyXTsKICB2ZWMyX3N1Yl9mcDY0KHksIHgsIHJhbmdlKTsKICB2ZWMyIHBvcnRpb25bMl07CiAgcG9ydGlvblswXSA9IHJhbmdlWzBdICogYTsKICBwb3J0aW9uWzFdID0gcmFuZ2VbMV0gKiBhOwogIHZlYzJfc3VtX2ZwNjQoeCwgcG9ydGlvbiwgb3V0X3ZhbCk7Cn0KCnZlYzIgdmVjMl9sZW5ndGhfZnA2NCh2ZWMyIHhbMl0pIHsKICByZXR1cm4gc3FydF9mcDY0KHN1bV9mcDY0KG11bF9mcDY0KHhbMF0sIHhbMF0pLCBtdWxfZnA2NCh4WzFdLCB4WzFdKSkpOwp9Cgp2ZWMyIHZlYzJfZGlzdGFuY2VfZnA2NCh2ZWMyIHhbMl0sIHZlYzIgeVsyXSkgewogIHZlYzIgZGlmZlsyXTsKICB2ZWMyX3N1Yl9mcDY0KHgsIHksIGRpZmYpOwogIHJldHVybiB2ZWMyX2xlbmd0aF9mcDY0KGRpZmYpOwp9CgovLyB2ZWMzIGZ1bmN0aW9ucwp2b2lkIHZlYzNfc3ViX2ZwNjQodmVjMiBhWzNdLCB2ZWMyIGJbM10sIG91dCB2ZWMyIG91dF92YWxbM10pIHsKICBmb3IgKGludCBpID0gMDsgaSA8IDM7IGkrKykgewogICAgb3V0X3ZhbFtpXSA9IHN1bV9mcDY0KGFbaV0sIGJbaV0pOwogIH0KfQoKdm9pZCB2ZWMzX3N1bV9mcDY0KHZlYzIgYVszXSwgdmVjMiBiWzNdLCBvdXQgdmVjMiBvdXRfdmFsWzNdKSB7CiAgZm9yIChpbnQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgIG91dF92YWxbaV0gPSBzdW1fZnA2NChhW2ldLCBiW2ldKTsKICB9Cn0KCnZlYzIgdmVjM19sZW5ndGhfZnA2NCh2ZWMyIHhbM10pIHsKICByZXR1cm4gc3FydF9mcDY0KHN1bV9mcDY0KHN1bV9mcDY0KG11bF9mcDY0KHhbMF0sIHhbMF0pLCBtdWxfZnA2NCh4WzFdLCB4WzFdKSksIG11bF9mcDY0KHhbMl0sIHhbMl0pKSk7Cn0KCnZlYzIgdmVjM19kaXN0YW5jZV9mcDY0KHZlYzIgeFszXSwgdmVjMiB5WzNdKSB7CiAgdmVjMiBkaWZmWzNdOwogIHZlYzNfc3ViX2ZwNjQoeCwgeSwgZGlmZik7CiAgcmV0dXJuIHZlYzNfbGVuZ3RoX2ZwNjQoZGlmZik7Cn0KCi8vIHZlYzQgZnVuY3Rpb25zCnZvaWQgdmVjNF9mcDY0KHZlYzQgYSwgb3V0IHZlYzIgb3V0X3ZhbFs0XSkgewogIG91dF92YWxbMF0ueCA9IGFbMF07CiAgb3V0X3ZhbFswXS55ID0gMC4wOwoKICBvdXRfdmFsWzFdLnggPSBhWzFdOwogIG91dF92YWxbMV0ueSA9IDAuMDsKCiAgb3V0X3ZhbFsyXS54ID0gYVsyXTsKICBvdXRfdmFsWzJdLnkgPSAwLjA7CgogIG91dF92YWxbM10ueCA9IGFbM107CiAgb3V0X3ZhbFszXS55ID0gMC4wOwp9Cgp2b2lkIHZlYzRfc2NhbGFyX211bF9mcDY0KHZlYzIgYVs0XSwgdmVjMiBiLCBvdXQgdmVjMiBvdXRfdmFsWzRdKSB7CiAgb3V0X3ZhbFswXSA9IG11bF9mcDY0KGFbMF0sIGIpOwogIG91dF92YWxbMV0gPSBtdWxfZnA2NChhWzFdLCBiKTsKICBvdXRfdmFsWzJdID0gbXVsX2ZwNjQoYVsyXSwgYik7CiAgb3V0X3ZhbFszXSA9IG11bF9mcDY0KGFbM10sIGIpOwp9Cgp2b2lkIHZlYzRfc3VtX2ZwNjQodmVjMiBhWzRdLCB2ZWMyIGJbNF0sIG91dCB2ZWMyIG91dF92YWxbNF0pIHsKICBmb3IgKGludCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgb3V0X3ZhbFtpXSA9IHN1bV9mcDY0KGFbaV0sIGJbaV0pOwogIH0KfQoKdm9pZCB2ZWM0X2RvdF9mcDY0KHZlYzIgYVs0XSwgdmVjMiBiWzRdLCBvdXQgdmVjMiBvdXRfdmFsKSB7CiAgdmVjMiB2WzRdOwoKICB2WzBdID0gbXVsX2ZwNjQoYVswXSwgYlswXSk7CiAgdlsxXSA9IG11bF9mcDY0KGFbMV0sIGJbMV0pOwogIHZbMl0gPSBtdWxfZnA2NChhWzJdLCBiWzJdKTsKICB2WzNdID0gbXVsX2ZwNjQoYVszXSwgYlszXSk7CgogIG91dF92YWwgPSBzdW1fZnA2NChzdW1fZnA2NCh2WzBdLCB2WzFdKSwgc3VtX2ZwNjQodlsyXSwgdlszXSkpOwp9Cgp2b2lkIG1hdDRfdmVjNF9tdWxfZnA2NCh2ZWMyIGJbMTZdLCB2ZWMyIGFbNF0sIG91dCB2ZWMyIG91dF92YWxbNF0pIHsKICB2ZWMyIHRtcFs0XTsKCiAgZm9yIChpbnQgaSA9IDA7IGkgPCA0OyBpKyspCiAgewogICAgZm9yIChpbnQgaiA9IDA7IGogPCA0OyBqKyspCiAgICB7CiAgICAgIHRtcFtqXSA9IGJbaiArIGkgKiA0XTsKICAgIH0KICAgIHZlYzRfZG90X2ZwNjQoYSwgdG1wLCBvdXRfdmFsW2ldKTsKICB9Cn0K","base64")}}}).call(this,require("buffer").Buffer)},{buffer:13}],2:[function(require,module,exports){(function(Buffer){"use strict";module.exports={project:{interface:"project",source:Buffer("Y29uc3QgZmxvYXQgVElMRV9TSVpFID0gNTEyLjA7CmNvbnN0IGZsb2F0IFBJID0gMy4xNDE1OTI2NTM2Owpjb25zdCBmbG9hdCBXT1JMRF9TQ0FMRSA9IFRJTEVfU0laRSAvIChQSSAqIDIuMCk7Cgpjb25zdCBmbG9hdCBQUk9KRUNUX0xJTkVBUiA9IDAuOwpjb25zdCBmbG9hdCBQUk9KRUNUX01FUkNBVE9SID0gMS47CmNvbnN0IGZsb2F0IFBST0pFQ1RfTUVSQ0FUT1JfT0ZGU0VUUyA9IDIuOwoKdW5pZm9ybSBmbG9hdCBwcm9qZWN0aW9uTW9kZTsKdW5pZm9ybSBmbG9hdCBwcm9qZWN0aW9uU2NhbGU7CnVuaWZvcm0gdmVjNCBwcm9qZWN0aW9uQ2VudGVyOwp1bmlmb3JtIHZlYzMgcHJvamVjdGlvblBpeGVsc1BlclVuaXQ7CnVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4Owp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeFVuY2VudGVyZWQ7CgojaWZkZWYgSU5URUxfVEFOX1dPUktBUk9VTkQKCi8vIEFsbCB0aGVzZSBmdW5jdGlvbnMgYXJlIGZvciBzdWJzdGl0dXRpbmcgdGFuKCkgZnVuY3Rpb24gZnJvbSBJbnRlbCBHUFUgb25seQpjb25zdCBmbG9hdCBUV09fUEkgPSA2LjI4MzE4NTQ4MjAyNTE0NjU7CmNvbnN0IGZsb2F0IFBJXzIgPSAxLjU3MDc5NjM3MDUwNjI4NjY7CmNvbnN0IGZsb2F0IFBJXzE2ID0gMC4xOTYzNDk1NDYzMTMyODU4OwoKY29uc3QgZmxvYXQgU0lOX1RBQkxFXzAgPSAwLjE5NTA5MDMyMzY4NjU5OTczOwpjb25zdCBmbG9hdCBTSU5fVEFCTEVfMSA9IDAuMzgyNjgzNDI2MTQxNzM4OTsKY29uc3QgZmxvYXQgU0lOX1RBQkxFXzIgPSAwLjU1NTU3MDI0NDc4OTEyMzU7CmNvbnN0IGZsb2F0IFNJTl9UQUJMRV8zID0gMC43MDcxMDY3NjkwODQ5MzA0OwoKY29uc3QgZmxvYXQgQ09TX1RBQkxFXzAgPSAwLjk4MDc4NTI1MDY2Mzc1NzM7CmNvbnN0IGZsb2F0IENPU19UQUJMRV8xID0gMC45MjM4Nzk1MDQyMDM3OTY0Owpjb25zdCBmbG9hdCBDT1NfVEFCTEVfMiA9IDAuODMxNDY5NTk1NDMyMjgxNTsKY29uc3QgZmxvYXQgQ09TX1RBQkxFXzMgPSAwLjcwNzEwNjc2OTA4NDkzMDQ7Cgpjb25zdCBmbG9hdCBJTlZFUlNFX0ZBQ1RPUklBTF8zID0gMS42NjY2NjY3MTYzMzcyMDRlLTAxOyAvLyAxLzMhCmNvbnN0IGZsb2F0IElOVkVSU0VfRkFDVE9SSUFMXzUgPSA4LjMzMzMzMzc2Nzk1MDUzNWUtMDM7IC8vIDEvNSEKY29uc3QgZmxvYXQgSU5WRVJTRV9GQUNUT1JJQUxfNyA9IDEuOTg0MTI3MDExMzgyOTUyM2UtMDQ7IC8vIDEvNyEKY29uc3QgZmxvYXQgSU5WRVJTRV9GQUNUT1JJQUxfOSA9IDIuNzU1NzMxODg0NDYyODc1MzNlLTA2OyAvLyAxLzkhCgpmbG9hdCBzaW5fdGF5bG9yX2ZwMzIoZmxvYXQgYSkgewogIGZsb2F0IHIsIHMsIHQsIHg7CgogIGlmIChhID09IDAuMCkgewogICAgcmV0dXJuIDAuMDsKICB9CgogIHggPSAtYSAqIGE7CiAgcyA9IGE7CiAgciA9IGE7CgogIHIgPSByICogeDsKICB0ID0gciAqIElOVkVSU0VfRkFDVE9SSUFMXzM7CiAgcyA9IHMgKyB0OwoKICByID0gciAqIHg7CiAgdCA9IHIgKiBJTlZFUlNFX0ZBQ1RPUklBTF81OwogIHMgPSBzICsgdDsKCiAgciA9IHIgKiB4OwogIHQgPSByICogSU5WRVJTRV9GQUNUT1JJQUxfNzsKICBzID0gcyArIHQ7CgogIHIgPSByICogeDsKICB0ID0gciAqIElOVkVSU0VfRkFDVE9SSUFMXzk7CiAgcyA9IHMgKyB0OwoKICByZXR1cm4gczsKfQoKdm9pZCBzaW5jb3NfdGF5bG9yX2ZwMzIoZmxvYXQgYSwgb3V0IGZsb2F0IHNpbl90LCBvdXQgZmxvYXQgY29zX3QpIHsKICBpZiAoYSA9PSAwLjApIHsKICAgIHNpbl90ID0gMC4wOwogICAgY29zX3QgPSAxLjA7CiAgfQogIHNpbl90ID0gc2luX3RheWxvcl9mcDMyKGEpOwogIGNvc190ID0gc3FydCgxLjAgLSBzaW5fdCAqIHNpbl90KTsKfQoKZmxvYXQgdGFuX2ZwMzIoZmxvYXQgYSkgewogICAgZmxvYXQgc2luX2E7CiAgICBmbG9hdCBjb3NfYTsKCiAgICBpZiAoYSA9PSAwLjApIHsKICAgICAgICByZXR1cm4gMC4wOwogICAgfQoKICAgIC8vIDJwaSByYW5nZSByZWR1Y3Rpb24KICAgIGZsb2F0IHogPSBmbG9vcihhIC8gVFdPX1BJKTsKICAgIGZsb2F0IHIgPSBhIC0gVFdPX1BJICogejsKCiAgICBmbG9hdCB0OwogICAgZmxvYXQgcSA9IGZsb29yKHIgLyBQSV8yICsgMC41KTsKICAgIGludCBqID0gaW50KHEpOwoKICAgIGlmIChqIDwgLTIgfHwgaiA+IDIpIHsKICAgICAgICByZXR1cm4gMC4wIC8gMC4wOwogICAgfQoKICAgIHQgPSByIC0gUElfMiAqIHE7CgogICAgcSA9IGZsb29yKHQgLyBQSV8xNiArIDAuNSk7CiAgICBpbnQgayA9IGludChxKTsKICAgIGludCBhYnNfayA9IGludChhYnMoZmxvYXQoaykpKTsKCiAgICBpZiAoYWJzX2sgPiA0KSB7CiAgICAgICAgcmV0dXJuIDAuMCAvIDAuMDsKICAgIH0gZWxzZSB7CiAgICAgICAgdCA9IHQgLSBQSV8xNiAqIHE7CiAgICB9CgogICAgZmxvYXQgdSA9IDAuMDsKICAgIGZsb2F0IHYgPSAwLjA7CgogICAgZmxvYXQgc2luX3QsIGNvc190OwogICAgZmxvYXQgcywgYzsKICAgIHNpbmNvc190YXlsb3JfZnAzMih0LCBzaW5fdCwgY29zX3QpOwoKICAgIGlmIChrID09IDApIHsKICAgICAgICBzID0gc2luX3Q7CiAgICAgICAgYyA9IGNvc190OwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDEuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8wOwogICAgICAgICAgICB2ID0gU0lOX1RBQkxFXzA7CiAgICAgICAgfSBlbHNlIGlmIChhYnMoZmxvYXQoYWJzX2spIC0gMi4wKSA8IDAuNSkgewogICAgICAgICAgICB1ID0gQ09TX1RBQkxFXzE7CiAgICAgICAgICAgIHYgPSBTSU5fVEFCTEVfMTsKICAgICAgICB9IGVsc2UgaWYgKGFicyhmbG9hdChhYnNfaykgLSAzLjApIDwgMC41KSB7CiAgICAgICAgICAgIHUgPSBDT1NfVEFCTEVfMjsKICAgICAgICAgICAgdiA9IFNJTl9UQUJMRV8yOwogICAgICAgIH0gZWxzZSBpZiAoYWJzKGZsb2F0KGFic19rKSAtIDQuMCkgPCAwLjUpIHsKICAgICAgICAgICAgdSA9IENPU19UQUJMRV8zOwogICAgICAgICAgICB2ID0gU0lOX1RBQkxFXzM7CiAgICAgICAgfQogICAgICAgIGlmIChrID4gMCkgewogICAgICAgICAgICBzID0gdSAqIHNpbl90ICsgdiAqIGNvc190OwogICAgICAgICAgICBjID0gdSAqIGNvc190IC0gdiAqIHNpbl90OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHMgPSB1ICogc2luX3QgLSB2ICogY29zX3Q7CiAgICAgICAgICAgIGMgPSB1ICogY29zX3QgKyB2ICogc2luX3Q7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChqID09IDApIHsKICAgICAgICBzaW5fYSA9IHM7CiAgICAgICAgY29zX2EgPSBjOwogICAgfSBlbHNlIGlmIChqID09IDEpIHsKICAgICAgICBzaW5fYSA9IGM7CiAgICAgICAgY29zX2EgPSAtczsKICAgIH0gZWxzZSBpZiAoaiA9PSAtMSkgewogICAgICAgIHNpbl9hID0gLWM7CiAgICAgICAgY29zX2EgPSBzOwogICAgfSBlbHNlIHsKICAgICAgICBzaW5fYSA9IC1zOwogICAgICAgIGNvc19hID0gLWM7CiAgICB9CiAgICByZXR1cm4gc2luX2EgLyBjb3NfYTsKfQojZW5kaWYKCi8vCi8vIFNjYWxpbmcgb2Zmc2V0cwovLwoKZmxvYXQgcHJvamVjdF9zY2FsZShmbG9hdCBtZXRlcnMpIHsKICByZXR1cm4gbWV0ZXJzICogcHJvamVjdGlvblBpeGVsc1BlclVuaXQueDsKfQoKdmVjMiBwcm9qZWN0X3NjYWxlKHZlYzIgbWV0ZXJzKSB7CiAgcmV0dXJuIHZlYzIoCiAgICBtZXRlcnMueCAqIHByb2plY3Rpb25QaXhlbHNQZXJVbml0LngsCiAgICBtZXRlcnMueSAqIHByb2plY3Rpb25QaXhlbHNQZXJVbml0LngKICApOwp9Cgp2ZWMzIHByb2plY3Rfc2NhbGUodmVjMyBtZXRlcnMpIHsKICByZXR1cm4gdmVjMygKICAgIG1ldGVycy54ICogcHJvamVjdGlvblBpeGVsc1BlclVuaXQueCwKICAgIG1ldGVycy55ICogcHJvamVjdGlvblBpeGVsc1BlclVuaXQueCwKICAgIG1ldGVycy56ICogcHJvamVjdGlvblBpeGVsc1BlclVuaXQueAogICk7Cn0KCnZlYzQgcHJvamVjdF9zY2FsZSh2ZWM0IG1ldGVycykgewogIHJldHVybiB2ZWM0KAogICAgbWV0ZXJzLnggKiBwcm9qZWN0aW9uUGl4ZWxzUGVyVW5pdC54LAogICAgbWV0ZXJzLnkgKiBwcm9qZWN0aW9uUGl4ZWxzUGVyVW5pdC54LAogICAgbWV0ZXJzLnogKiBwcm9qZWN0aW9uUGl4ZWxzUGVyVW5pdC54LAogICAgbWV0ZXJzLncKICApOwp9CgovLwovLyBQcm9qZWN0aW5nIHBvc2l0aW9ucwovLwoKLy8gbm9uLWxpbmVhciBwcm9qZWN0aW9uOiBsbmdsYXRzID0+IHVuaXQgdGlsZSBbMC0xLCAwLTFdCnZlYzIgcHJvamVjdF9tZXJjYXRvcl8odmVjMiBsbmdsYXQpIHsKICByZXR1cm4gdmVjMigKICAgIHJhZGlhbnMobG5nbGF0LngpICsgUEksCiNpZmRlZiBJTlRFTF9UQU5fV09SS0FST1VORAogICAgICAgIFBJIC0gbG9nKHRhbl9mcDMyKFBJICogMC4yNSArIHJhZGlhbnMobG5nbGF0LnkpICogMC41KSkKI2Vsc2UKICAgICAgICBQSSAtIGxvZyh0YW4oUEkgKiAwLjI1ICsgcmFkaWFucyhsbmdsYXQueSkgKiAwLjUpKQojZW5kaWYKICApOwp9Cgp2ZWMyIHByb2plY3RfcG9zaXRpb24odmVjMiBwb3NpdGlvbikgewogIGlmIChwcm9qZWN0aW9uTW9kZSA9PSBQUk9KRUNUX0xJTkVBUikgewogICAgcmV0dXJuIChwb3NpdGlvbiArIHZlYzIoVElMRV9TSVpFIC8gMi4wKSkgKiBwcm9qZWN0aW9uU2NhbGU7CiAgfQogIGlmIChwcm9qZWN0aW9uTW9kZSA9PSBQUk9KRUNUX01FUkNBVE9SX09GRlNFVFMpIHsKICAgIHJldHVybiBwcm9qZWN0X3NjYWxlKHBvc2l0aW9uKTsKICB9CiAgLy8gQ292ZXJzIHByb2plY3Rpb25Nb2RlID09IFBST0pFQ1RfTUVSQ0FUT1IKICByZXR1cm4gcHJvamVjdF9tZXJjYXRvcl8ocG9zaXRpb24pICogV09STERfU0NBTEUgKiBwcm9qZWN0aW9uU2NhbGU7Cn0KCnZlYzMgcHJvamVjdF9wb3NpdGlvbih2ZWMzIHBvc2l0aW9uKSB7CiAgcmV0dXJuIHZlYzMocHJvamVjdF9wb3NpdGlvbihwb3NpdGlvbi54eSksIHByb2plY3Rfc2NhbGUocG9zaXRpb24ueikgKyAuMSk7Cn0KCnZlYzQgcHJvamVjdF9wb3NpdGlvbih2ZWM0IHBvc2l0aW9uKSB7CiAgcmV0dXJuIHZlYzQocHJvamVjdF9wb3NpdGlvbihwb3NpdGlvbi54eXopLCBwb3NpdGlvbi53KTsKfQoKLy8KCnZlYzQgcHJvamVjdF90b19jbGlwc3BhY2UodmVjNCBwb3NpdGlvbikgewogIGlmIChwcm9qZWN0aW9uTW9kZSA9PSBQUk9KRUNUX01FUkNBVE9SX09GRlNFVFMpIHsKICAgIHJldHVybiBwcm9qZWN0aW9uTWF0cml4ICogdmVjNChwb3NpdGlvbi54eXosIDAuMCkgKyBwcm9qZWN0aW9uQ2VudGVyOwogIH0KICByZXR1cm4gcHJvamVjdGlvbk1hdHJpeCAqIHBvc2l0aW9uOwp9CgovLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoKZmxvYXQgc2NhbGUoZmxvYXQgcG9zaXRpb24pIHsKICByZXR1cm4gcHJvamVjdF9zY2FsZShwb3NpdGlvbik7Cn0KCnZlYzIgc2NhbGUodmVjMiBwb3NpdGlvbikgewogIHJldHVybiBwcm9qZWN0X3NjYWxlKHBvc2l0aW9uKTsKfQoKdmVjMyBzY2FsZSh2ZWMzIHBvc2l0aW9uKSB7CiAgcmV0dXJuIHByb2plY3Rfc2NhbGUocG9zaXRpb24pOwp9Cgp2ZWM0IHNjYWxlKHZlYzQgcG9zaXRpb24pIHsKICByZXR1cm4gcHJvamVjdF9zY2FsZShwb3NpdGlvbik7Cn0KCnZlYzIgcHJlcHJvamVjdCh2ZWMyIHBvc2l0aW9uKSB7CiAgcmV0dXJuIHByb2plY3RfcG9zaXRpb24ocG9zaXRpb24pOwp9Cgp2ZWMzIHByZXByb2plY3QodmVjMyBwb3NpdGlvbikgewogIHJldHVybiBwcm9qZWN0X3Bvc2l0aW9uKHBvc2l0aW9uKTsKfQoKdmVjNCBwcmVwcm9qZWN0KHZlYzQgcG9zaXRpb24pIHsKICByZXR1cm4gcHJvamVjdF9wb3NpdGlvbihwb3NpdGlvbik7Cn0KCnZlYzQgcHJvamVjdCh2ZWM0IHBvc2l0aW9uKSB7CiAgcmV0dXJuIHByb2plY3RfdG9fY2xpcHNwYWNlKHBvc2l0aW9uKTsKfQo=","base64")
}}}).call(this,require("buffer").Buffer)},{buffer:13}],3:[function(require,module,exports){(function(Buffer){"use strict";module.exports={project64:{interface:"project64",source:Buffer("Y29uc3QgdmVjMiBXT1JMRF9TQ0FMRV9GUDY0ID0gdmVjMig4MS40ODczMjc1NzU2ODM2LCAwLjAwMDAwMzI4NzM2NjgyMzIwMTQwOTcpOwoKdW5pZm9ybSB2ZWMyIHByb2plY3Rpb25TY2FsZUZQNjQ7CnVuaWZvcm0gdmVjMiBwcm9qZWN0aW9uRlA2NFsxNl07Cgp2b2lkIG1lcmNhdG9yUHJvamVjdF9mcDY0KHZlYzQgbG5nbGF0X2ZwNjQsIG91dCB2ZWMyIG91dF92YWxbMl0pIHsgLy9sb25naXR1ZGU6IGxuZ2xhdF9mcDY0Lnh5OyBsYXRpdHVkZTogbG5nbGF0X2ZwNjQuencKCiAgb3V0X3ZhbFswXSA9IHN1bV9mcDY0KHJhZGlhbnNfZnA2NChsbmdsYXRfZnA2NC54eSksIFBJX0ZQNjQpOwogIG91dF92YWxbMV0gPSBzdWJfZnA2NChQSV9GUDY0LCBsb2dfZnA2NCh0YW5fZnA2NChzdW1fZnA2NChQSV80X0ZQNjQsIHJhZGlhbnNfZnA2NChsbmdsYXRfZnA2NC56dykgLyAyLjApKSkpOwogIHJldHVybjsKfQoKdm9pZCBwcm9qZWN0X3Bvc2l0aW9uX2ZwNjQodmVjNCBwb3NpdGlvbl9mcDY0LCBvdXQgdmVjMiBvdXRfdmFsWzJdKSB7CgogIHZlYzIgcG9zX2ZwNjRbMl07CiAgbWVyY2F0b3JQcm9qZWN0X2ZwNjQocG9zaXRpb25fZnA2NCwgcG9zX2ZwNjQpOwogIHZlYzIgeF9mcDY0ID0gbXVsX2ZwNjQocG9zX2ZwNjRbMF0sIHByb2plY3Rpb25TY2FsZUZQNjQpOwogIHZlYzIgeV9mcDY0ID0gbXVsX2ZwNjQocG9zX2ZwNjRbMV0sIHByb2plY3Rpb25TY2FsZUZQNjQpOwogIG91dF92YWxbMF0gPSBtdWxfZnA2NCh4X2ZwNjQsIFdPUkxEX1NDQUxFX0ZQNjQpOwogIG91dF92YWxbMV0gPSBtdWxfZnA2NCh5X2ZwNjQsIFdPUkxEX1NDQUxFX0ZQNjQpOwoKICByZXR1cm47Cn0KCnZlYzQgcHJvamVjdF90b19jbGlwc3BhY2VfZnA2NCh2ZWMyIHZlcnRleF9wb3NfbW9kZWxzcGFjZVs0XSkgewogIHZlYzIgdmVydGV4X3Bvc19jbGlwc3BhY2VbNF07CiAgbWF0NF92ZWM0X211bF9mcDY0KHByb2plY3Rpb25GUDY0LCB2ZXJ0ZXhfcG9zX21vZGVsc3BhY2UsIHZlcnRleF9wb3NfY2xpcHNwYWNlKTsKICByZXR1cm4gdmVjNCgKICAgIHZlcnRleF9wb3NfY2xpcHNwYWNlWzBdLngsCiAgICB2ZXJ0ZXhfcG9zX2NsaXBzcGFjZVsxXS54LAogICAgdmVydGV4X3Bvc19jbGlwc3BhY2VbMl0ueCwKICAgIHZlcnRleF9wb3NfY2xpcHNwYWNlWzNdLngKICAgICk7Cn0K","base64")}}}).call(this,require("buffer").Buffer)},{buffer:13}],4:[function(require,module,exports){var util=require("util/");var pSlice=Array.prototype.slice;var hasOwn=Object.prototype.hasOwnProperty;var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=stackStartFunction.name;var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(util.isUndefined(value)){return""+value}if(util.isNumber(value)&&!isFinite(value)){return value.toString()}if(util.isFunction(value)||util.isRegExp(value)){return value.toString()}return value}function truncate(s,n){if(util.isString(s)){return s.length<n?s:s.slice(0,n)}else{return s}}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if(!util.isObject(actual)&&!util.isObject(expected)){return actual==expected}else{return objEquiv(actual,expected)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return false;if(a.prototype!==b.prototype)return false;if(util.isPrimitive(a)||util.isPrimitive(b)){return a===b}var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}var ka=objectKeys(a),kb=objectKeys(b),key,i;if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(util.isString(expected)){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}},{"util/":511}],5:[function(require,module,exports){module.exports=function _atob(str){return atob(str)}},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=autobind;function autobind(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(args.length===1){return boundClass.apply(undefined,args)}else{return boundMethod.apply(undefined,args)}}function boundClass(target){var keys=undefined;if(typeof Reflect!=="undefined"&&typeof Reflect.ownKeys==="function"){keys=Reflect.ownKeys(target.prototype)}else{keys=Object.getOwnPropertyNames(target.prototype);if(typeof Object.getOwnPropertySymbols==="function"){keys=keys.concat(Object.getOwnPropertySymbols(target.prototype))}}keys.forEach(function(key){if(key==="constructor"){return}var descriptor=Object.getOwnPropertyDescriptor(target.prototype,key);if(typeof descriptor.value==="function"){Object.defineProperty(target.prototype,key,boundMethod(target,key,descriptor))}});return target}function boundMethod(target,key,descriptor){var fn=descriptor.value;if(typeof fn!=="function"){throw new Error("@autobind decorator can only be applied to methods not: "+typeof fn)}var definingProperty=false;return{configurable:true,get:function get(){if(definingProperty||this===target.prototype||this.hasOwnProperty(key)){return fn}var boundFn=fn.bind(this);definingProperty=true;Object.defineProperty(this,key,{value:boundFn,configurable:true,writable:true});definingProperty=false;return boundFn}}}module.exports=exports["default"]},{}],7:[function(require,module,exports){(function(global){"use strict";require("core-js/shim");require("regenerator-runtime/runtime");require("core-js/fn/regexp/escape");if(global._babelPolyfill){throw new Error("only one instance of babel-polyfill is allowed")}global._babelPolyfill=true;var DEFINE_PROPERTY="defineProperty";function define(O,key,value){O[key]||Object[DEFINE_PROPERTY](O,key,{writable:true,configurable:true,value:value})}define(String.prototype,"padLeft","".padStart);define(String.prototype,"padRight","".padEnd);"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(key){[][key]&&define(Array,key,Function.call.bind([][key]))})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"core-js/fn/regexp/escape":22,"core-js/shim":315,"regenerator-runtime/runtime":499}],8:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],9:[function(require,module,exports){},{}],10:[function(require,module,exports){(function(process,Buffer){var msg=require("pako/lib/zlib/messages");var zstream=require("pako/lib/zlib/zstream");var zlib_deflate=require("pako/lib/zlib/deflate.js");var zlib_inflate=require("pako/lib/zlib/inflate.js");var constants=require("pako/lib/zlib/constants");for(var key in constants){exports[key]=constants[key]}exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;function Zlib(mode){if(mode<exports.DEFLATE||mode>exports.UNZIP)throw new TypeError("Bad argument");this.mode=mode;this.init_done=false;this.write_in_progress=false;this.pending_close=false;this.windowBits=0;this.level=0;this.memLevel=0;this.strategy=0;this.dictionary=null}Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){this.windowBits=windowBits;this.level=level;this.memLevel=memLevel;this.strategy=strategy;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP)this.windowBits+=16;if(this.mode===exports.UNZIP)this.windowBits+=32;if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW)this.windowBits=-this.windowBits;this.strm=new zstream;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:var status=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(status!==exports.Z_OK){this._error(status);return}this.write_in_progress=false;this.init_done=true};Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")};Zlib.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===exports.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")};Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck();this.write_in_progress=true;var self=this;process.nextTick(function(){self.write_in_progress=false;var res=self._write(flush,input,in_off,in_len,out,out_off,out_len);self.callback(res[0],res[1]);if(self.pending_close)self.close()});return this};function bufferSet(data,offset){for(var i=0;i<data.length;i++){this[offset+i]=data[i]}}Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck();return this._write(flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype._write=function(flush,input,in_off,in_len,out,out_off,out_len){this.write_in_progress=true;if(flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK){throw new Error("Invalid flush value")}if(input==null){input=new Buffer(0);in_len=0;in_off=0}if(out._set)out.set=out._set;else out.set=bufferSet;var strm=this.strm;strm.avail_in=in_len;strm.input=input;strm.next_in=in_off;strm.avail_out=out_len;strm.output=out;strm.next_out=out_off;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflate(strm,flush);break;case exports.UNZIP:case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:var status=zlib_inflate.inflate(strm,flush);break;default:throw new Error("Unknown mode "+this.mode)}if(status!==exports.Z_STREAM_END&&status!==exports.Z_OK){this._error(status)}this.write_in_progress=false;return[strm.avail_in,strm.avail_out]};Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=true;return}this.pending_close=false;if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else{zlib_inflate.inflateEnd(this.strm)}this.mode=exports.NONE};Zlib.prototype.reset=function(){switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:var status=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:var status=zlib_inflate.inflateReset(this.strm);break}if(status!==exports.Z_OK){this._error(status)}};Zlib.prototype._error=function(status){this.onerror(msg[status]+": "+this.strm.msg,status);this.write_in_progress=false;if(this.pending_close)this.close()};exports.Zlib=Zlib}).call(this,require("_process"),require("buffer").Buffer)},{_process:488,buffer:13,"pako/lib/zlib/constants":456,"pako/lib/zlib/deflate.js":458,"pako/lib/zlib/inflate.js":460,"pako/lib/zlib/messages":462,"pako/lib/zlib/zstream":464}],11:[function(require,module,exports){(function(process,Buffer){var Transform=require("_stream_transform");var binding=require("./binding");var util=require("util");var assert=require("assert").ok;binding.Z_MIN_WINDOWBITS=8;binding.Z_MAX_WINDOWBITS=15;binding.Z_DEFAULT_WINDOWBITS=15;binding.Z_MIN_CHUNK=64;binding.Z_MAX_CHUNK=Infinity;binding.Z_DEFAULT_CHUNK=16*1024;binding.Z_MIN_MEMLEVEL=1;binding.Z_MAX_MEMLEVEL=9;binding.Z_DEFAULT_MEMLEVEL=8;binding.Z_MIN_LEVEL=-1;binding.Z_MAX_LEVEL=9;binding.Z_DEFAULT_LEVEL=binding.Z_DEFAULT_COMPRESSION;Object.keys(binding).forEach(function(k){if(k.match(/^Z/))exports[k]=binding[k]});exports.codes={Z_OK:binding.Z_OK,Z_STREAM_END:binding.Z_STREAM_END,Z_NEED_DICT:binding.Z_NEED_DICT,Z_ERRNO:binding.Z_ERRNO,Z_STREAM_ERROR:binding.Z_STREAM_ERROR,Z_DATA_ERROR:binding.Z_DATA_ERROR,Z_MEM_ERROR:binding.Z_MEM_ERROR,Z_BUF_ERROR:binding.Z_BUF_ERROR,Z_VERSION_ERROR:binding.Z_VERSION_ERROR};Object.keys(exports.codes).forEach(function(k){exports.codes[exports.codes[k]]=k});exports.Deflate=Deflate;exports.Inflate=Inflate;exports.Gzip=Gzip;exports.Gunzip=Gunzip;exports.DeflateRaw=DeflateRaw;exports.InflateRaw=InflateRaw;exports.Unzip=Unzip;exports.createDeflate=function(o){return new Deflate(o)};exports.createInflate=function(o){return new Inflate(o)};exports.createDeflateRaw=function(o){return new DeflateRaw(o)};exports.createInflateRaw=function(o){return new InflateRaw(o)};exports.createGzip=function(o){return new Gzip(o)};exports.createGunzip=function(o){return new Gunzip(o)};exports.createUnzip=function(o){return new Unzip(o)};exports.deflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Deflate(opts),buffer,callback)};exports.deflateSync=function(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)};exports.gzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gzip(opts),buffer,callback)};exports.gzipSync=function(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)};exports.deflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new DeflateRaw(opts),buffer,callback)};exports.deflateRawSync=function(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)};exports.unzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Unzip(opts),buffer,callback)};exports.unzipSync=function(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)};exports.inflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Inflate(opts),buffer,callback)};exports.inflateSync=function(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)};exports.gunzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gunzip(opts),buffer,callback)};exports.gunzipSync=function(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)};exports.inflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new InflateRaw(opts),buffer,callback)};exports.inflateRawSync=function(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)};function zlibBuffer(engine,buffer,callback){var buffers=[];var nread=0;engine.on("error",onError);engine.on("end",onEnd);engine.end(buffer);flow();function flow(){var chunk;while(null!==(chunk=engine.read())){buffers.push(chunk);nread+=chunk.length}engine.once("readable",flow)}function onError(err){engine.removeListener("end",onEnd);engine.removeListener("readable",flow);callback(err)}function onEnd(){var buf=Buffer.concat(buffers,nread);buffers=[];callback(null,buf);engine.close()}}function zlibBufferSync(engine,buffer){if(typeof buffer==="string")buffer=new Buffer(buffer);if(!Buffer.isBuffer(buffer))throw new TypeError("Not a string or buffer");var flushFlag=binding.Z_FINISH;return engine._processChunk(buffer,flushFlag)}function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib.call(this,opts,binding.DEFLATE)}function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib.call(this,opts,binding.INFLATE)}function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib.call(this,opts,binding.GZIP)}function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib.call(this,opts,binding.GUNZIP)}function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib.call(this,opts,binding.DEFLATERAW)}function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib.call(this,opts,binding.INFLATERAW)}function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib.call(this,opts,binding.UNZIP)}function Zlib(opts,mode){this._opts=opts=opts||{};this._chunkSize=opts.chunkSize||exports.Z_DEFAULT_CHUNK;Transform.call(this,opts);if(opts.flush){if(opts.flush!==binding.Z_NO_FLUSH&&opts.flush!==binding.Z_PARTIAL_FLUSH&&opts.flush!==binding.Z_SYNC_FLUSH&&opts.flush!==binding.Z_FULL_FLUSH&&opts.flush!==binding.Z_FINISH&&opts.flush!==binding.Z_BLOCK){throw new Error("Invalid flush flag: "+opts.flush)}}this._flushFlag=opts.flush||binding.Z_NO_FLUSH;if(opts.chunkSize){if(opts.chunkSize<exports.Z_MIN_CHUNK||opts.chunkSize>exports.Z_MAX_CHUNK){throw new Error("Invalid chunk size: "+opts.chunkSize)}}if(opts.windowBits){if(opts.windowBits<exports.Z_MIN_WINDOWBITS||opts.windowBits>exports.Z_MAX_WINDOWBITS){throw new Error("Invalid windowBits: "+opts.windowBits)}}if(opts.level){if(opts.level<exports.Z_MIN_LEVEL||opts.level>exports.Z_MAX_LEVEL){throw new Error("Invalid compression level: "+opts.level)}}if(opts.memLevel){if(opts.memLevel<exports.Z_MIN_MEMLEVEL||opts.memLevel>exports.Z_MAX_MEMLEVEL){throw new Error("Invalid memLevel: "+opts.memLevel)}}if(opts.strategy){if(opts.strategy!=exports.Z_FILTERED&&opts.strategy!=exports.Z_HUFFMAN_ONLY&&opts.strategy!=exports.Z_RLE&&opts.strategy!=exports.Z_FIXED&&opts.strategy!=exports.Z_DEFAULT_STRATEGY){throw new Error("Invalid strategy: "+opts.strategy)}}if(opts.dictionary){if(!Buffer.isBuffer(opts.dictionary)){throw new Error("Invalid dictionary: it should be a Buffer instance")}}this._binding=new binding.Zlib(mode);var self=this;this._hadError=false;this._binding.onerror=function(message,errno){self._binding=null;self._hadError=true;var error=new Error(message);error.errno=errno;error.code=exports.codes[errno];self.emit("error",error)};var level=exports.Z_DEFAULT_COMPRESSION;if(typeof opts.level==="number")level=opts.level;var strategy=exports.Z_DEFAULT_STRATEGY;if(typeof opts.strategy==="number")strategy=opts.strategy;this._binding.init(opts.windowBits||exports.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||exports.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary);this._buffer=new Buffer(this._chunkSize);this._offset=0;this._closed=false;this._level=level;this._strategy=strategy;this.once("end",this.close)}util.inherits(Zlib,Transform);Zlib.prototype.params=function(level,strategy,callback){if(level<exports.Z_MIN_LEVEL||level>exports.Z_MAX_LEVEL){throw new RangeError("Invalid compression level: "+level)}if(strategy!=exports.Z_FILTERED&&strategy!=exports.Z_HUFFMAN_ONLY&&strategy!=exports.Z_RLE&&strategy!=exports.Z_FIXED&&strategy!=exports.Z_DEFAULT_STRATEGY){throw new TypeError("Invalid strategy: "+strategy)}if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding.Z_SYNC_FLUSH,function(){self._binding.params(level,strategy);if(!self._hadError){self._level=level;self._strategy=strategy;if(callback)callback()}})}else{process.nextTick(callback)}};Zlib.prototype.reset=function(){return this._binding.reset()};Zlib.prototype._flush=function(callback){this._transform(new Buffer(0),"",callback)};Zlib.prototype.flush=function(kind,callback){var ws=this._writableState;if(typeof kind==="function"||kind===void 0&&!callback){callback=kind;kind=binding.Z_FULL_FLUSH}if(ws.ended){if(callback)process.nextTick(callback)}else if(ws.ending){if(callback)this.once("end",callback)}else if(ws.needDrain){var self=this;this.once("drain",function(){self.flush(callback)})}else{this._flushFlag=kind;this.write(new Buffer(0),"",callback)}};Zlib.prototype.close=function(callback){if(callback)process.nextTick(callback);if(this._closed)return;this._closed=true;this._binding.close();var self=this;process.nextTick(function(){self.emit("close")})};Zlib.prototype._transform=function(chunk,encoding,cb){var flushFlag;var ws=this._writableState;var ending=ws.ending||ws.ended;var last=ending&&(!chunk||ws.length===chunk.length);if(!chunk===null&&!Buffer.isBuffer(chunk))return cb(new Error("invalid input"));if(last)flushFlag=binding.Z_FINISH;else{flushFlag=this._flushFlag;if(chunk.length>=ws.length){this._flushFlag=this._opts.flush||binding.Z_NO_FLUSH}}var self=this;this._processChunk(chunk,flushFlag,cb)};Zlib.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length;var availOutBefore=this._chunkSize-this._offset;var inOff=0;var self=this;var async=typeof cb==="function";if(!async){var buffers=[];var nread=0;var error;this.on("error",function(er){error=er});do{var res=this._binding.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError){throw error}var buf=Buffer.concat(buffers,nread);this.close();return buf}var req=this._binding.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);req.buffer=chunk;req.callback=callback;function callback(availInAfter,availOutAfter){if(self._hadError)return;var have=availOutBefore-availOutAfter;assert(have>=0,"have should not go down");if(have>0){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have;if(async){self.push(out)}else{buffers.push(out);nread+=out.length}}if(availOutAfter===0||self._offset>=self._chunkSize){availOutBefore=self._chunkSize;self._offset=0;self._buffer=new Buffer(self._chunkSize)}if(availOutAfter===0){inOff+=availInBefore-availInAfter;availInBefore=availInAfter;if(!async)return true;var newReq=self._binding.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);newReq.callback=callback;newReq.buffer=chunk;return}if(!async)return false;cb()}};util.inherits(Deflate,Zlib);util.inherits(Inflate,Zlib);util.inherits(Gzip,Zlib);util.inherits(Gunzip,Zlib);util.inherits(DeflateRaw,Zlib);util.inherits(InflateRaw,Zlib);util.inherits(Unzip,Zlib)}).call(this,require("_process"),require("buffer").Buffer)},{"./binding":10,_process:488,_stream_transform:497,assert:4,buffer:13,util:511}],12:[function(require,module,exports){arguments[4][9][0].apply(exports,arguments)},{dup:9}],13:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");
}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":8,ieee754:357,isarray:361}],14:[function(require,module,exports){(function(Buffer){"use strict";var Readable=require("readable-stream").Readable;var util=require("util");module.exports=ContentStream;function ContentStream(obj,options){if(!(this instanceof ContentStream)){return new ContentStream(obj,options)}Readable.call(this,options);if(obj===null||obj===undefined){obj=String(obj)}this._obj=obj}util.inherits(ContentStream,Readable);ContentStream.prototype._read=function(n){var obj=this._obj;if(typeof obj==="string"){this.push(new Buffer(obj))}else if(Buffer.isBuffer(obj)){this.push(obj)}else{this.push(new Buffer(JSON.stringify(obj)))}this.push(null)}}).call(this,require("buffer").Buffer)},{buffer:13,"readable-stream":21,util:511}],15:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],16:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:488,"core-util-is":316,inherits:358}],17:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":19,"core-util-is":316,inherits:358}],18:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){
var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:488,buffer:13,"core-util-is":316,events:322,inherits:358,isarray:15,stream:504,"string_decoder/":505}],19:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":16,"core-util-is":316,inherits:358}],20:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":16,_process:488,buffer:13,"core-util-is":316,inherits:358,stream:504}],21:[function(require,module,exports){(function(process){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"){module.exports=require("stream")}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,_process:488,stream:504}],22:[function(require,module,exports){require("../../modules/core.regexp.escape");module.exports=require("../../modules/_core").RegExp.escape},{"../../modules/_core":43,"../../modules/core.regexp.escape":139}],23:[function(require,module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},{}],24:[function(require,module,exports){var cof=require("./_cof");module.exports=function(it,msg){if(typeof it!="number"&&cof(it)!="Number")throw TypeError(msg);return+it}},{"./_cof":38}],25:[function(require,module,exports){var UNSCOPABLES=require("./_wks")("unscopables"),ArrayProto=Array.prototype;if(ArrayProto[UNSCOPABLES]==undefined)require("./_hide")(ArrayProto,UNSCOPABLES,{});module.exports=function(key){ArrayProto[UNSCOPABLES][key]=true}},{"./_hide":60,"./_wks":137}],26:[function(require,module,exports){module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||forbiddenField!==undefined&&forbiddenField in it){throw TypeError(name+": incorrect invocation!")}return it}},{}],27:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},{"./_is-object":69}],28:[function(require,module,exports){"use strict";var toObject=require("./_to-object"),toIndex=require("./_to-index"),toLength=require("./_to-length");module.exports=[].copyWithin||function copyWithin(target,start){var O=toObject(this),len=toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments.length>2?arguments[2]:undefined,count=Math.min((end===undefined?len:toIndex(end,len))-from,len-to),inc=1;if(from<to&&to<from+count){inc=-1;from+=count-1;to+=count-1}while(count-- >0){if(from in O)O[to]=O[from];else delete O[to];to+=inc;from+=inc}return O}},{"./_to-index":125,"./_to-length":128,"./_to-object":129}],29:[function(require,module,exports){"use strict";var toObject=require("./_to-object"),toIndex=require("./_to-index"),toLength=require("./_to-length");module.exports=function fill(value){var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toIndex(aLen>1?arguments[1]:undefined,length),end=aLen>2?arguments[2]:undefined,endPos=end===undefined?length:toIndex(end,length);while(endPos>index)O[index++]=value;return O}},{"./_to-index":125,"./_to-length":128,"./_to-object":129}],30:[function(require,module,exports){var forOf=require("./_for-of");module.exports=function(iter,ITERATOR){var result=[];forOf(iter,false,result.push,result,ITERATOR);return result}},{"./_for-of":57}],31:[function(require,module,exports){var toIObject=require("./_to-iobject"),toLength=require("./_to-length"),toIndex=require("./_to-index");module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this),length=toLength(O.length),index=toIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}}},{"./_to-index":125,"./_to-iobject":127,"./_to-length":128}],32:[function(require,module,exports){var ctx=require("./_ctx"),IObject=require("./_iobject"),toObject=require("./_to-object"),toLength=require("./_to-length"),asc=require("./_array-species-create");module.exports=function(TYPE,$create){var IS_MAP=TYPE==1,IS_FILTER=TYPE==2,IS_SOME=TYPE==3,IS_EVERY=TYPE==4,IS_FIND_INDEX=TYPE==6,NO_HOLES=TYPE==5||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){var O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):undefined,val,res;for(;length>index;index++)if(NO_HOLES||index in self){val=self[index];res=f(val,index,O);if(TYPE){if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return false}}return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},{"./_array-species-create":35,"./_ctx":45,"./_iobject":65,"./_to-length":128,"./_to-object":129}],33:[function(require,module,exports){var aFunction=require("./_a-function"),toObject=require("./_to-object"),IObject=require("./_iobject"),toLength=require("./_to-length");module.exports=function(that,callbackfn,aLen,memo,isRight){aFunction(callbackfn);var O=toObject(that),self=IObject(O),length=toLength(O.length),index=isRight?length-1:0,i=isRight?-1:1;if(aLen<2)for(;;){if(index in self){memo=self[index];index+=i;break}index+=i;if(isRight?index<0:length<=index){throw TypeError("Reduce of empty array with no initial value")}}for(;isRight?index>=0:length>index;index+=i)if(index in self){memo=callbackfn(memo,self[index],index,O)}return memo}},{"./_a-function":23,"./_iobject":65,"./_to-length":128,"./_to-object":129}],34:[function(require,module,exports){var isObject=require("./_is-object"),isArray=require("./_is-array"),SPECIES=require("./_wks")("species");module.exports=function(original){var C;if(isArray(original)){C=original.constructor;if(typeof C=="function"&&(C===Array||isArray(C.prototype)))C=undefined;if(isObject(C)){C=C[SPECIES];if(C===null)C=undefined}}return C===undefined?Array:C}},{"./_is-array":67,"./_is-object":69,"./_wks":137}],35:[function(require,module,exports){var speciesConstructor=require("./_array-species-constructor");module.exports=function(original,length){return new(speciesConstructor(original))(length)}},{"./_array-species-constructor":34}],36:[function(require,module,exports){"use strict";var aFunction=require("./_a-function"),isObject=require("./_is-object"),invoke=require("./_invoke"),arraySlice=[].slice,factories={};var construct=function(F,len,args){if(!(len in factories)){for(var n=[],i=0;i<len;i++)n[i]="a["+i+"]";factories[len]=Function("F,a","return new F("+n.join(",")+")")}return factories[len](F,args)};module.exports=Function.bind||function bind(that){var fn=aFunction(this),partArgs=arraySlice.call(arguments,1);var bound=function(){var args=partArgs.concat(arraySlice.call(arguments));return this instanceof bound?construct(fn,args.length,args):invoke(fn,args,that)};if(isObject(fn.prototype))bound.prototype=fn.prototype;return bound}},{"./_a-function":23,"./_invoke":64,"./_is-object":69}],37:[function(require,module,exports){var cof=require("./_cof"),TAG=require("./_wks")("toStringTag"),ARG=cof(function(){return arguments}())=="Arguments";var tryGet=function(it,key){try{return it[key]}catch(e){}};module.exports=function(it){var O,T,B;return it===undefined?"Undefined":it===null?"Null":typeof(T=tryGet(O=Object(it),TAG))=="string"?T:ARG?cof(O):(B=cof(O))=="Object"&&typeof O.callee=="function"?"Arguments":B}},{"./_cof":38,"./_wks":137}],38:[function(require,module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}},{}],39:[function(require,module,exports){"use strict";var dP=require("./_object-dp").f,create=require("./_object-create"),redefineAll=require("./_redefine-all"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),defined=require("./_defined"),forOf=require("./_for-of"),$iterDefine=require("./_iter-define"),step=require("./_iter-step"),setSpecies=require("./_set-species"),DESCRIPTORS=require("./_descriptors"),fastKey=require("./_meta").fastKey,SIZE=DESCRIPTORS?"_s":"size";var getEntry=function(that,key){var index=fastKey(key),entry;if(index!=="F")return that._i[index];for(entry=that._f;entry;entry=entry.n){if(entry.k==key)return entry}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,"_i");that._i=create(null);that._f=undefined;that._l=undefined;that[SIZE]=0;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that)});redefineAll(C.prototype,{clear:function clear(){for(var that=this,data=that._i,entry=that._f;entry;entry=entry.n){entry.r=true;if(entry.p)entry.p=entry.p.n=undefined;delete data[entry.i]}that._f=that._l=undefined;that[SIZE]=0},delete:function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that._i[entry.i];entry.r=true;if(prev)prev.n=next;if(next)next.p=prev;if(that._f==entry)that._f=next;if(that._l==entry)that._l=prev;that[SIZE]--}return!!entry},forEach:function forEach(callbackfn){anInstance(this,C,"forEach");var f=ctx(callbackfn,arguments.length>1?arguments[1]:undefined,3),entry;while(entry=entry?entry.n:this._f){f(entry.v,entry.k,this);while(entry&&entry.r)entry=entry.p}},has:function has(key){return!!getEntry(this,key)}});if(DESCRIPTORS)dP(C.prototype,"size",{get:function(){return defined(this[SIZE])}});return C},def:function(that,key,value){var entry=getEntry(that,key),prev,index;if(entry){entry.v=value}else{that._l=entry={i:index=fastKey(key,true),k:key,v:value,p:prev=that._l,n:undefined,r:false};if(!that._f)that._f=entry;if(prev)prev.n=entry;that[SIZE]++;if(index!=="F")that._i[index]=entry}return that},getEntry:getEntry,setStrong:function(C,NAME,IS_MAP){$iterDefine(C,NAME,function(iterated,kind){this._t=iterated;this._k=kind;this._l=undefined},function(){var that=this,kind=that._k,entry=that._l;while(entry&&entry.r)entry=entry.p;if(!that._t||!(that._l=entry=entry?entry.n:that._t._f)){that._t=undefined;return step(1)}if(kind=="keys")return step(0,entry.k);if(kind=="values")return step(0,entry.v);return step(0,[entry.k,entry.v])},IS_MAP?"entries":"values",!IS_MAP,true);setSpecies(NAME)}}},{"./_an-instance":26,"./_ctx":45,"./_defined":47,"./_descriptors":48,"./_for-of":57,"./_iter-define":73,"./_iter-step":75,"./_meta":82,"./_object-create":86,"./_object-dp":87,"./_redefine-all":106,"./_set-species":111}],40:[function(require,module,exports){var classof=require("./_classof"),from=require("./_array-from-iterable");module.exports=function(NAME){return function toJSON(){if(classof(this)!=NAME)throw TypeError(NAME+"#toJSON isn't generic");return from(this)}}},{"./_array-from-iterable":30,"./_classof":37}],41:[function(require,module,exports){"use strict";var redefineAll=require("./_redefine-all"),getWeak=require("./_meta").getWeak,anObject=require("./_an-object"),isObject=require("./_is-object"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),createArrayMethod=require("./_array-methods"),$has=require("./_has"),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),id=0;var uncaughtFrozenStore=function(that){return that._l||(that._l=new UncaughtFrozenStore)};var UncaughtFrozenStore=function(){this.a=[]};var findUncaughtFrozen=function(store,key){return arrayFind(store.a,function(it){return it[0]===key})};UncaughtFrozenStore.prototype={get:function(key){var entry=findUncaughtFrozen(this,key);if(entry)return entry[1]},has:function(key){return!!findUncaughtFrozen(this,key)},set:function(key,value){var entry=findUncaughtFrozen(this,key);if(entry)entry[1]=value;else this.a.push([key,value])},delete:function(key){var index=arrayFindIndex(this.a,function(it){return it[0]===key});if(~index)this.a.splice(index,1);return!!~index}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,"_i");that._i=id++;that._l=undefined;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that)});redefineAll(C.prototype,{delete:function(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this)["delete"](key);return data&&$has(data,this._i)&&delete data[this._i]},has:function has(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).has(key);return data&&$has(data,this._i)}});return C},def:function(that,key,value){var data=getWeak(anObject(key),true);if(data===true)uncaughtFrozenStore(that).set(key,value);else data[that._i]=value;return that},ufstore:uncaughtFrozenStore}},{"./_an-instance":26,"./_an-object":27,"./_array-methods":32,"./_for-of":57,"./_has":59,"./_is-object":69,"./_meta":82,"./_redefine-all":106}],42:[function(require,module,exports){"use strict";var global=require("./_global"),$export=require("./_export"),redefine=require("./_redefine"),redefineAll=require("./_redefine-all"),meta=require("./_meta"),forOf=require("./_for-of"),anInstance=require("./_an-instance"),isObject=require("./_is-object"),fails=require("./_fails"),$iterDetect=require("./_iter-detect"),setToStringTag=require("./_set-to-string-tag"),inheritIfRequired=require("./_inherit-if-required");module.exports=function(NAME,wrapper,methods,common,IS_MAP,IS_WEAK){var Base=global[NAME],C=Base,ADDER=IS_MAP?"set":"add",proto=C&&C.prototype,O={};var fixMethod=function(KEY){var fn=proto[KEY];redefine(proto,KEY,KEY=="delete"?function(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a)}:KEY=="has"?function has(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a);
}:KEY=="get"?function get(a){return IS_WEAK&&!isObject(a)?undefined:fn.call(this,a===0?0:a)}:KEY=="add"?function add(a){fn.call(this,a===0?0:a);return this}:function set(a,b){fn.call(this,a===0?0:a,b);return this})};if(typeof C!="function"||!(IS_WEAK||proto.forEach&&!fails(function(){(new C).entries().next()}))){C=common.getConstructor(wrapper,NAME,IS_MAP,ADDER);redefineAll(C.prototype,methods);meta.NEED=true}else{var instance=new C,HASNT_CHAINING=instance[ADDER](IS_WEAK?{}:-0,1)!=instance,THROWS_ON_PRIMITIVES=fails(function(){instance.has(1)}),ACCEPT_ITERABLES=$iterDetect(function(iter){new C(iter)}),BUGGY_ZERO=!IS_WEAK&&fails(function(){var $instance=new C,index=5;while(index--)$instance[ADDER](index,index);return!$instance.has(-0)});if(!ACCEPT_ITERABLES){C=wrapper(function(target,iterable){anInstance(target,C,NAME);var that=inheritIfRequired(new Base,target,C);if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that);return that});C.prototype=proto;proto.constructor=C}if(THROWS_ON_PRIMITIVES||BUGGY_ZERO){fixMethod("delete");fixMethod("has");IS_MAP&&fixMethod("get")}if(BUGGY_ZERO||HASNT_CHAINING)fixMethod(ADDER);if(IS_WEAK&&proto.clear)delete proto.clear}setToStringTag(C,NAME);O[NAME]=C;$export($export.G+$export.W+$export.F*(C!=Base),O);if(!IS_WEAK)common.setStrong(C,NAME,IS_MAP);return C}},{"./_an-instance":26,"./_export":52,"./_fails":54,"./_for-of":57,"./_global":58,"./_inherit-if-required":63,"./_is-object":69,"./_iter-detect":74,"./_meta":82,"./_redefine":107,"./_redefine-all":106,"./_set-to-string-tag":112}],43:[function(require,module,exports){var core=module.exports={version:"2.4.0"};if(typeof __e=="number")__e=core},{}],44:[function(require,module,exports){"use strict";var $defineProperty=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=function(object,index,value){if(index in object)$defineProperty.f(object,index,createDesc(0,value));else object[index]=value}},{"./_object-dp":87,"./_property-desc":105}],45:[function(require,module,exports){var aFunction=require("./_a-function");module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},{"./_a-function":23}],46:[function(require,module,exports){"use strict";var anObject=require("./_an-object"),toPrimitive=require("./_to-primitive"),NUMBER="number";module.exports=function(hint){if(hint!=="string"&&hint!==NUMBER&&hint!=="default")throw TypeError("Incorrect hint");return toPrimitive(anObject(this),hint!=NUMBER)}},{"./_an-object":27,"./_to-primitive":130}],47:[function(require,module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}},{}],48:[function(require,module,exports){module.exports=!require("./_fails")(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},{"./_fails":54}],49:[function(require,module,exports){var isObject=require("./_is-object"),document=require("./_global").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},{"./_global":58,"./_is-object":69}],50:[function(require,module,exports){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],51:[function(require,module,exports){var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie");module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it),isEnum=pIE.f,i=0,key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key)}return result}},{"./_object-gops":93,"./_object-keys":96,"./_object-pie":97}],52:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),hide=require("./_hide"),redefine=require("./_redefine"),ctx=require("./_ctx"),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={}),key,own,out,exp;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;out=(own?target:source)[key];exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(target)redefine(target,key,out,type&$export.U);if(exports[key]!=out)hide(exports,key,exp);if(IS_PROTO&&expProto[key]!=out)expProto[key]=out}};global.core=core;$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export},{"./_core":43,"./_ctx":45,"./_global":58,"./_hide":60,"./_redefine":107}],53:[function(require,module,exports){var MATCH=require("./_wks")("match");module.exports=function(KEY){var re=/./;try{"/./"[KEY](re)}catch(e){try{re[MATCH]=false;return!"/./"[KEY](re)}catch(f){}}return true}},{"./_wks":137}],54:[function(require,module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},{}],55:[function(require,module,exports){"use strict";var hide=require("./_hide"),redefine=require("./_redefine"),fails=require("./_fails"),defined=require("./_defined"),wks=require("./_wks");module.exports=function(KEY,length,exec){var SYMBOL=wks(KEY),fns=exec(defined,SYMBOL,""[KEY]),strfn=fns[0],rxfn=fns[1];if(fails(function(){var O={};O[SYMBOL]=function(){return 7};return""[KEY](O)!=7})){redefine(String.prototype,KEY,strfn);hide(RegExp.prototype,SYMBOL,length==2?function(string,arg){return rxfn.call(string,this,arg)}:function(string){return rxfn.call(string,this)})}}},{"./_defined":47,"./_fails":54,"./_hide":60,"./_redefine":107,"./_wks":137}],56:[function(require,module,exports){"use strict";var anObject=require("./_an-object");module.exports=function(){var that=anObject(this),result="";if(that.global)result+="g";if(that.ignoreCase)result+="i";if(that.multiline)result+="m";if(that.unicode)result+="u";if(that.sticky)result+="y";return result}},{"./_an-object":27}],57:[function(require,module,exports){var ctx=require("./_ctx"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),anObject=require("./_an-object"),toLength=require("./_to-length"),getIterFn=require("./core.get-iterator-method"),BREAK={},RETURN={};var exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var iterFn=ITERATOR?function(){return iterable}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0,length,step,iterator,result;if(typeof iterFn!="function")throw TypeError(iterable+" is not iterable!");if(isArrayIter(iterFn))for(length=toLength(iterable.length);length>index;index++){result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]);if(result===BREAK||result===RETURN)return result}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;){result=call(iterator,f,step.value,entries);if(result===BREAK||result===RETURN)return result}};exports.BREAK=BREAK;exports.RETURN=RETURN},{"./_an-object":27,"./_ctx":45,"./_is-array-iter":66,"./_iter-call":71,"./_to-length":128,"./core.get-iterator-method":138}],58:[function(require,module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},{}],59:[function(require,module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},{}],60:[function(require,module,exports){var dP=require("./_object-dp"),createDesc=require("./_property-desc");module.exports=require("./_descriptors")?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){object[key]=value;return object}},{"./_descriptors":48,"./_object-dp":87,"./_property-desc":105}],61:[function(require,module,exports){module.exports=require("./_global").document&&document.documentElement},{"./_global":58}],62:[function(require,module,exports){module.exports=!require("./_descriptors")&&!require("./_fails")(function(){return Object.defineProperty(require("./_dom-create")("div"),"a",{get:function(){return 7}}).a!=7})},{"./_descriptors":48,"./_dom-create":49,"./_fails":54}],63:[function(require,module,exports){var isObject=require("./_is-object"),setPrototypeOf=require("./_set-proto").set;module.exports=function(that,target,C){var P,S=target.constructor;if(S!==C&&typeof S=="function"&&(P=S.prototype)!==C.prototype&&isObject(P)&&setPrototypeOf){setPrototypeOf(that,P)}return that}},{"./_is-object":69,"./_set-proto":110}],64:[function(require,module,exports){module.exports=function(fn,args,that){var un=that===undefined;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3])}return fn.apply(that,args)}},{}],65:[function(require,module,exports){var cof=require("./_cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return cof(it)=="String"?it.split(""):Object(it)}},{"./_cof":38}],66:[function(require,module,exports){var Iterators=require("./_iterators"),ITERATOR=require("./_wks")("iterator"),ArrayProto=Array.prototype;module.exports=function(it){return it!==undefined&&(Iterators.Array===it||ArrayProto[ITERATOR]===it)}},{"./_iterators":76,"./_wks":137}],67:[function(require,module,exports){var cof=require("./_cof");module.exports=Array.isArray||function isArray(arg){return cof(arg)=="Array"}},{"./_cof":38}],68:[function(require,module,exports){var isObject=require("./_is-object"),floor=Math.floor;module.exports=function isInteger(it){return!isObject(it)&&isFinite(it)&&floor(it)===it}},{"./_is-object":69}],69:[function(require,module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},{}],70:[function(require,module,exports){var isObject=require("./_is-object"),cof=require("./_cof"),MATCH=require("./_wks")("match");module.exports=function(it){var isRegExp;return isObject(it)&&((isRegExp=it[MATCH])!==undefined?!!isRegExp:cof(it)=="RegExp")}},{"./_cof":38,"./_is-object":69,"./_wks":137}],71:[function(require,module,exports){var anObject=require("./_an-object");module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator["return"];if(ret!==undefined)anObject(ret.call(iterator));throw e}}},{"./_an-object":27}],72:[function(require,module,exports){"use strict";var create=require("./_object-create"),descriptor=require("./_property-desc"),setToStringTag=require("./_set-to-string-tag"),IteratorPrototype={};require("./_hide")(IteratorPrototype,require("./_wks")("iterator"),function(){return this});module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")}},{"./_hide":60,"./_object-create":86,"./_property-desc":105,"./_set-to-string-tag":112,"./_wks":137}],73:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),$export=require("./_export"),redefine=require("./_redefine"),hide=require("./_hide"),has=require("./_has"),Iterators=require("./_iterators"),$iterCreate=require("./_iter-create"),setToStringTag=require("./_set-to-string-tag"),getPrototypeOf=require("./_object-gpo"),ITERATOR=require("./_wks")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values";var returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind)};case VALUES:return function values(){return new Constructor(this,kind)}}return function entries(){return new Constructor(this,kind)}};var TAG=NAME+" Iterator",DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=false,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?!DEF_VALUES?$default:getMethod("entries"):undefined,$anyNative=NAME=="Array"?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&!has(IteratorPrototype,ITERATOR))hide(IteratorPrototype,ITERATOR,returnThis)}}if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this)}}if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){hide(proto,ITERATOR,$default)}Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key])}else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods)}return methods}},{"./_export":52,"./_has":59,"./_hide":60,"./_iter-create":72,"./_iterators":76,"./_library":78,"./_object-gpo":94,"./_redefine":107,"./_set-to-string-tag":112,"./_wks":137}],74:[function(require,module,exports){var ITERATOR=require("./_wks")("iterator"),SAFE_CLOSING=false;try{var riter=[7][ITERATOR]();riter["return"]=function(){SAFE_CLOSING=true};Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return false;var safe=false;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=true}};arr[ITERATOR]=function(){return iter};exec(arr)}catch(e){}return safe}},{"./_wks":137}],75:[function(require,module,exports){module.exports=function(done,value){return{value:value,done:!!done}}},{}],76:[function(require,module,exports){module.exports={}},{}],77:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject");module.exports=function(object,el){var O=toIObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}},{"./_object-keys":96,"./_to-iobject":127}],78:[function(require,module,exports){module.exports=false},{}],79:[function(require,module,exports){var $expm1=Math.expm1;module.exports=!$expm1||$expm1(10)>22025.465794806718||$expm1(10)<22025.465794806718||$expm1(-2e-17)!=-2e-17?function expm1(x){return(x=+x)==0?x:x>-1e-6&&x<1e-6?x+x*x/2:Math.exp(x)-1}:$expm1},{}],80:[function(require,module,exports){module.exports=Math.log1p||function log1p(x){return(x=+x)>-1e-8&&x<1e-8?x-x*x/2:Math.log(1+x)}},{}],81:[function(require,module,exports){module.exports=Math.sign||function sign(x){return(x=+x)==0||x!=x?x:x<0?-1:1}},{}],82:[function(require,module,exports){var META=require("./_uid")("meta"),isObject=require("./_is-object"),has=require("./_has"),setDesc=require("./_object-dp").f,id=0;var isExtensible=Object.isExtensible||function(){return true};var FREEZE=!require("./_fails")(function(){return isExtensible(Object.preventExtensions({}))});var setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})};var fastKey=function(it,create){if(!isObject(it))return typeof it=="symbol"?it:(typeof it=="string"?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it)}return it[META].w};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze}},{"./_fails":54,"./_has":59,"./_is-object":69,"./_object-dp":87,"./_uid":134}],83:[function(require,module,exports){var Map=require("./es6.map"),$export=require("./_export"),shared=require("./_shared")("metadata"),store=shared.store||(shared.store=new(require("./es6.weak-map")));var getOrCreateMetadataMap=function(target,targetKey,create){var targetMetadata=store.get(target);if(!targetMetadata){if(!create)return undefined;store.set(target,targetMetadata=new Map)}var keyMetadata=targetMetadata.get(targetKey);if(!keyMetadata){if(!create)return undefined;targetMetadata.set(targetKey,keyMetadata=new Map)}return keyMetadata};var ordinaryHasOwnMetadata=function(MetadataKey,O,P){var metadataMap=getOrCreateMetadataMap(O,P,false);return metadataMap===undefined?false:metadataMap.has(MetadataKey)};var ordinaryGetOwnMetadata=function(MetadataKey,O,P){var metadataMap=getOrCreateMetadataMap(O,P,false);return metadataMap===undefined?undefined:metadataMap.get(MetadataKey)};var ordinaryDefineOwnMetadata=function(MetadataKey,MetadataValue,O,P){getOrCreateMetadataMap(O,P,true).set(MetadataKey,MetadataValue)};var ordinaryOwnMetadataKeys=function(target,targetKey){var metadataMap=getOrCreateMetadataMap(target,targetKey,false),keys=[];if(metadataMap)metadataMap.forEach(function(_,key){keys.push(key)});return keys};var toMetaKey=function(it){return it===undefined||typeof it=="symbol"?it:String(it)};var exp=function(O){$export($export.S,"Reflect",O)};module.exports={store:store,map:getOrCreateMetadataMap,has:ordinaryHasOwnMetadata,get:ordinaryGetOwnMetadata,set:ordinaryDefineOwnMetadata,keys:ordinaryOwnMetadataKeys,key:toMetaKey,exp:exp}},{"./_export":52,"./_shared":114,"./es6.map":169,"./es6.weak-map":275}],84:[function(require,module,exports){var global=require("./_global"),macrotask=require("./_task").set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode=require("./_cof")(process)=="process";module.exports=function(){var head,last,notify;var flush=function(){var parent,fn;if(isNode&&(parent=process.domain))parent.exit();while(head){fn=head.fn;head=head.next;try{fn()}catch(e){if(head)notify();else last=undefined;throw e}}last=undefined;if(parent)parent.enter()};if(isNode){notify=function(){process.nextTick(flush)}}else if(Observer){var toggle=true,node=document.createTextNode("");new Observer(flush).observe(node,{characterData:true});notify=function(){node.data=toggle=!toggle}}else if(Promise&&Promise.resolve){var promise=Promise.resolve();notify=function(){promise.then(flush)}}else{notify=function(){macrotask.call(global,flush)}}return function(fn){var task={fn:fn,next:undefined};if(last)last.next=task;if(!head){head=task;notify()}last=task}}},{"./_cof":38,"./_global":58,"./_task":124}],85:[function(require,module,exports){"use strict";var getKeys=require("./_object-keys"),gOPS=require("./_object-gops"),pIE=require("./_object-pie"),toObject=require("./_to-object"),IObject=require("./_iobject"),$assign=Object.assign;module.exports=!$assign||require("./_fails")(function(){var A={},B={},S=Symbol(),K="abcdefghijklmnopqrst";A[S]=7;K.split("").forEach(function(k){B[k]=k});return $assign({},A)[S]!=7||Object.keys($assign({},B)).join("")!=K})?function assign(target,source){var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;while(aLen>index){var S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0,key;while(length>j)if(isEnum.call(S,key=keys[j++]))T[key]=S[key]}return T}:$assign},{"./_fails":54,"./_iobject":65,"./_object-gops":93,"./_object-keys":96,"./_object-pie":97,"./_to-object":129}],86:[function(require,module,exports){var anObject=require("./_an-object"),dPs=require("./_object-dps"),enumBugKeys=require("./_enum-bug-keys"),IE_PROTO=require("./_shared-key")("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype";var createDict=function(){var iframe=require("./_dom-create")("iframe"),i=enumBugKeys.length,lt="<",gt=">",iframeDocument;iframe.style.display="none";require("./_html").appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict()};module.exports=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE]=anObject(O);result=new Empty;Empty[PROTOTYPE]=null;result[IE_PROTO]=O}else result=createDict();return Properties===undefined?result:dPs(result,Properties)}},{"./_an-object":27,"./_dom-create":49,"./_enum-bug-keys":50,"./_html":61,"./_object-dps":88,"./_shared-key":113}],87:[function(require,module,exports){var anObject=require("./_an-object"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),toPrimitive=require("./_to-primitive"),dP=Object.defineProperty;exports.f=require("./_descriptors")?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)O[P]=Attributes.value;return O}},{"./_an-object":27,"./_descriptors":48,"./_ie8-dom-define":62,"./_to-primitive":130}],88:[function(require,module,exports){var dP=require("./_object-dp"),anObject=require("./_an-object"),getKeys=require("./_object-keys");module.exports=require("./_descriptors")?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties),length=keys.length,i=0,P;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O}},{"./_an-object":27,"./_descriptors":48,"./_object-dp":87,"./_object-keys":96}],89:[function(require,module,exports){module.exports=require("./_library")||!require("./_fails")(function(){var K=Math.random();__defineSetter__.call(null,K,function(){});delete require("./_global")[K]})},{"./_fails":54,"./_global":58,"./_library":78}],90:[function(require,module,exports){var pIE=require("./_object-pie"),createDesc=require("./_property-desc"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),has=require("./_has"),IE8_DOM_DEFINE=require("./_ie8-dom-define"),gOPD=Object.getOwnPropertyDescriptor;exports.f=require("./_descriptors")?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}},{"./_descriptors":48,"./_has":59,"./_ie8-dom-define":62,"./_object-pie":97,"./_property-desc":105,"./_to-iobject":127,"./_to-primitive":130}],91:[function(require,module,exports){var toIObject=require("./_to-iobject"),gOPN=require("./_object-gopn").f,toString={}.toString;var windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=="[object Window]"?getWindowNames(it):gOPN(toIObject(it))}},{"./_object-gopn":92,"./_to-iobject":127}],92:[function(require,module,exports){var $keys=require("./_object-keys-internal"),hiddenKeys=require("./_enum-bug-keys").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys)}},{"./_enum-bug-keys":50,"./_object-keys-internal":95}],93:[function(require,module,exports){exports.f=Object.getOwnPropertySymbols},{}],94:[function(require,module,exports){var has=require("./_has"),toObject=require("./_to-object"),IE_PROTO=require("./_shared-key")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO))return O[IE_PROTO];if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null}},{"./_has":59,"./_shared-key":113,"./_to-object":129}],95:[function(require,module,exports){var has=require("./_has"),toIObject=require("./_to-iobject"),arrayIndexOf=require("./_array-includes")(false),IE_PROTO=require("./_shared-key")("IE_PROTO");module.exports=function(object,names){var O=toIObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key)}return result}},{"./_array-includes":31,"./_has":59,"./_shared-key":113,"./_to-iobject":127}],96:[function(require,module,exports){var $keys=require("./_object-keys-internal"),enumBugKeys=require("./_enum-bug-keys");module.exports=Object.keys||function keys(O){return $keys(O,enumBugKeys)}},{"./_enum-bug-keys":50,"./_object-keys-internal":95}],97:[function(require,module,exports){exports.f={}.propertyIsEnumerable},{}],98:[function(require,module,exports){var $export=require("./_export"),core=require("./_core"),fails=require("./_fails");module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn);$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},{"./_core":43,"./_export":52,"./_fails":54}],99:[function(require,module,exports){var getKeys=require("./_object-keys"),toIObject=require("./_to-iobject"),isEnum=require("./_object-pie").f;module.exports=function(isEntries){return function(it){var O=toIObject(it),keys=getKeys(O),length=keys.length,i=0,result=[],key;while(length>i)if(isEnum.call(O,key=keys[i++])){result.push(isEntries?[key,O[key]]:O[key])}return result}}},{"./_object-keys":96,"./_object-pie":97,"./_to-iobject":127}],100:[function(require,module,exports){var gOPN=require("./_object-gopn"),gOPS=require("./_object-gops"),anObject=require("./_an-object"),Reflect=require("./_global").Reflect;module.exports=Reflect&&Reflect.ownKeys||function ownKeys(it){var keys=gOPN.f(anObject(it)),getSymbols=gOPS.f;return getSymbols?keys.concat(getSymbols(it)):keys}},{"./_an-object":27,"./_global":58,"./_object-gopn":92,"./_object-gops":93}],101:[function(require,module,exports){var $parseFloat=require("./_global").parseFloat,$trim=require("./_string-trim").trim;module.exports=1/$parseFloat(require("./_string-ws")+"-0")!==-Infinity?function parseFloat(str){var string=$trim(String(str),3),result=$parseFloat(string);return result===0&&string.charAt(0)=="-"?-0:result}:$parseFloat},{"./_global":58,"./_string-trim":122,"./_string-ws":123}],102:[function(require,module,exports){var $parseInt=require("./_global").parseInt,$trim=require("./_string-trim").trim,ws=require("./_string-ws"),hex=/^[\-+]?0[xX]/;module.exports=$parseInt(ws+"08")!==8||$parseInt(ws+"0x16")!==22?function parseInt(str,radix){var string=$trim(String(str),3);return $parseInt(string,radix>>>0||(hex.test(string)?16:10))}:$parseInt},{"./_global":58,"./_string-trim":122,"./_string-ws":123}],103:[function(require,module,exports){"use strict";var path=require("./_path"),invoke=require("./_invoke"),aFunction=require("./_a-function");module.exports=function(){var fn=aFunction(this),length=arguments.length,pargs=Array(length),i=0,_=path._,holder=false;while(length>i)if((pargs[i]=arguments[i++])===_)holder=true;return function(){var that=this,aLen=arguments.length,j=0,k=0,args;if(!holder&&!aLen)return invoke(fn,pargs,that);args=pargs.slice();if(holder)for(;length>j;j++)if(args[j]===_)args[j]=arguments[k++];while(aLen>k)args.push(arguments[k++]);return invoke(fn,args,that)}}},{"./_a-function":23,"./_invoke":64,"./_path":104}],104:[function(require,module,exports){module.exports=require("./_global")},{"./_global":58}],105:[function(require,module,exports){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}},{}],106:[function(require,module,exports){var redefine=require("./_redefine");module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target}},{"./_redefine":107}],107:[function(require,module,exports){var global=require("./_global"),hide=require("./_hide"),has=require("./_has"),SRC=require("./_uid")("src"),TO_STRING="toString",$toString=Function[TO_STRING],TPL=(""+$toString).split(TO_STRING);require("./_core").inspectSource=function(it){return $toString.call(it)};(module.exports=function(O,key,val,safe){var isFunction=typeof val=="function";if(isFunction)has(val,"name")||hide(val,"name",key);if(O[key]===val)return;if(isFunction)has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)));if(O===global){O[key]=val}else{if(!safe){delete O[key];hide(O,key,val)}else{if(O[key])O[key]=val;else hide(O,key,val)}}})(Function.prototype,TO_STRING,function toString(){return typeof this=="function"&&this[SRC]||$toString.call(this)})},{"./_core":43,"./_global":58,"./_has":59,"./_hide":60,"./_uid":134}],108:[function(require,module,exports){module.exports=function(regExp,replace){var replacer=replace===Object(replace)?function(part){return replace[part]}:replace;return function(it){return String(it).replace(regExp,replacer)}}},{}],109:[function(require,module,exports){module.exports=Object.is||function is(x,y){return x===y?x!==0||1/x===1/y:x!=x&&y!=y}},{}],110:[function(require,module,exports){var isObject=require("./_is-object"),anObject=require("./_an-object");var check=function(O,proto){anObject(O);if(!isObject(proto)&&proto!==null)throw TypeError(proto+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{set=require("./_ctx")(Function.call,require("./_object-gopd").f(Object.prototype,"__proto__").set,2);set(test,[]);buggy=!(test instanceof Array)}catch(e){buggy=true}return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O}}({},false):undefined),check:check}},{"./_an-object":27,"./_ctx":45,"./_is-object":69,"./_object-gopd":90}],111:[function(require,module,exports){"use strict";var global=require("./_global"),dP=require("./_object-dp"),DESCRIPTORS=require("./_descriptors"),SPECIES=require("./_wks")("species");module.exports=function(KEY){var C=global[KEY];if(DESCRIPTORS&&C&&!C[SPECIES])dP.f(C,SPECIES,{configurable:true,get:function(){return this}})}},{"./_descriptors":48,"./_global":58,"./_object-dp":87,"./_wks":137}],112:[function(require,module,exports){var def=require("./_object-dp").f,has=require("./_has"),TAG=require("./_wks")("toStringTag");module.exports=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG))def(it,TAG,{configurable:true,value:tag})}},{"./_has":59,"./_object-dp":87,"./_wks":137}],113:[function(require,module,exports){var shared=require("./_shared")("keys"),uid=require("./_uid");module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},{"./_shared":114,"./_uid":134}],114:[function(require,module,exports){var global=require("./_global"),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},{"./_global":58}],115:[function(require,module,exports){var anObject=require("./_an-object"),aFunction=require("./_a-function"),SPECIES=require("./_wks")("species");module.exports=function(O,D){var C=anObject(O).constructor,S;return C===undefined||(S=anObject(C)[SPECIES])==undefined?D:aFunction(S)}},{"./_a-function":23,"./_an-object":27,"./_wks":137}],116:[function(require,module,exports){var fails=require("./_fails");module.exports=function(method,arg){return!!method&&fails(function(){arg?method.call(null,function(){},1):method.call(null)})}},{"./_fails":54}],117:[function(require,module,exports){
var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function(TO_STRING){return function(that,pos){var s=String(defined(that)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}},{"./_defined":47,"./_to-integer":126}],118:[function(require,module,exports){var isRegExp=require("./_is-regexp"),defined=require("./_defined");module.exports=function(that,searchString,NAME){if(isRegExp(searchString))throw TypeError("String#"+NAME+" doesn't accept regex!");return String(defined(that))}},{"./_defined":47,"./_is-regexp":70}],119:[function(require,module,exports){var $export=require("./_export"),fails=require("./_fails"),defined=require("./_defined"),quot=/"/g;var createHTML=function(string,tag,attribute,value){var S=String(defined(string)),p1="<"+tag;if(attribute!=="")p1+=" "+attribute+'="'+String(value).replace(quot,"&quot;")+'"';return p1+">"+S+"</"+tag+">"};module.exports=function(NAME,exec){var O={};O[NAME]=exec(createHTML);$export($export.P+$export.F*fails(function(){var test=""[NAME]('"');return test!==test.toLowerCase()||test.split('"').length>3}),"String",O)}},{"./_defined":47,"./_export":52,"./_fails":54}],120:[function(require,module,exports){var toLength=require("./_to-length"),repeat=require("./_string-repeat"),defined=require("./_defined");module.exports=function(that,maxLength,fillString,left){var S=String(defined(that)),stringLength=S.length,fillStr=fillString===undefined?" ":String(fillString),intMaxLength=toLength(maxLength);if(intMaxLength<=stringLength||fillStr=="")return S;var fillLen=intMaxLength-stringLength,stringFiller=repeat.call(fillStr,Math.ceil(fillLen/fillStr.length));if(stringFiller.length>fillLen)stringFiller=stringFiller.slice(0,fillLen);return left?stringFiller+S:S+stringFiller}},{"./_defined":47,"./_string-repeat":121,"./_to-length":128}],121:[function(require,module,exports){"use strict";var toInteger=require("./_to-integer"),defined=require("./_defined");module.exports=function repeat(count){var str=String(defined(this)),res="",n=toInteger(count);if(n<0||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))if(n&1)res+=str;return res}},{"./_defined":47,"./_to-integer":126}],122:[function(require,module,exports){var $export=require("./_export"),defined=require("./_defined"),fails=require("./_fails"),spaces=require("./_string-ws"),space="["+spaces+"]",non="​",ltrim=RegExp("^"+space+space+"*"),rtrim=RegExp(space+space+"*$");var exporter=function(KEY,exec,ALIAS){var exp={};var FORCE=fails(function(){return!!spaces[KEY]()||non[KEY]()!=non});var fn=exp[KEY]=FORCE?exec(trim):spaces[KEY];if(ALIAS)exp[ALIAS]=fn;$export($export.P+$export.F*FORCE,"String",exp)};var trim=exporter.trim=function(string,TYPE){string=String(defined(string));if(TYPE&1)string=string.replace(ltrim,"");if(TYPE&2)string=string.replace(rtrim,"");return string};module.exports=exporter},{"./_defined":47,"./_export":52,"./_fails":54,"./_string-ws":123}],123:[function(require,module,exports){module.exports="\t\n\v\f\r   ᠎    "+"         　\u2028\u2029\ufeff"},{}],124:[function(require,module,exports){var ctx=require("./_ctx"),invoke=require("./_invoke"),html=require("./_html"),cel=require("./_dom-create"),global=require("./_global"),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port;var run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id];fn()}};var listener=function(event){run.call(event.data)};if(!setTask||!clearTask){setTask=function setImmediate(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(typeof fn=="function"?fn:Function(fn),args)};defer(counter);return counter};clearTask=function clearImmediate(id){delete queue[id]};if(require("./_cof")(process)=="process"){defer=function(id){process.nextTick(ctx(run,id,1))}}else if(MessageChannel){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listener;defer=ctx(port.postMessage,port,1)}else if(global.addEventListener&&typeof postMessage=="function"&&!global.importScripts){defer=function(id){global.postMessage(id+"","*")};global.addEventListener("message",listener,false)}else if(ONREADYSTATECHANGE in cel("script")){defer=function(id){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run.call(id)}}}else{defer=function(id){setTimeout(ctx(run,id,1),0)}}}module.exports={set:setTask,clear:clearTask}},{"./_cof":38,"./_ctx":45,"./_dom-create":49,"./_global":58,"./_html":61,"./_invoke":64}],125:[function(require,module,exports){var toInteger=require("./_to-integer"),max=Math.max,min=Math.min;module.exports=function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length)}},{"./_to-integer":126}],126:[function(require,module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}},{}],127:[function(require,module,exports){var IObject=require("./_iobject"),defined=require("./_defined");module.exports=function(it){return IObject(defined(it))}},{"./_defined":47,"./_iobject":65}],128:[function(require,module,exports){var toInteger=require("./_to-integer"),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}},{"./_to-integer":126}],129:[function(require,module,exports){var defined=require("./_defined");module.exports=function(it){return Object(defined(it))}},{"./_defined":47}],130:[function(require,module,exports){var isObject=require("./_is-object");module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=="function"&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":69}],131:[function(require,module,exports){"use strict";if(require("./_descriptors")){var LIBRARY=require("./_library"),global=require("./_global"),fails=require("./_fails"),$export=require("./_export"),$typed=require("./_typed"),$buffer=require("./_typed-buffer"),ctx=require("./_ctx"),anInstance=require("./_an-instance"),propertyDesc=require("./_property-desc"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),toIndex=require("./_to-index"),toPrimitive=require("./_to-primitive"),has=require("./_has"),same=require("./_same-value"),classof=require("./_classof"),isObject=require("./_is-object"),toObject=require("./_to-object"),isArrayIter=require("./_is-array-iter"),create=require("./_object-create"),getPrototypeOf=require("./_object-gpo"),gOPN=require("./_object-gopn").f,getIterFn=require("./core.get-iterator-method"),uid=require("./_uid"),wks=require("./_wks"),createArrayMethod=require("./_array-methods"),createArrayIncludes=require("./_array-includes"),speciesConstructor=require("./_species-constructor"),ArrayIterators=require("./es6.array.iterator"),Iterators=require("./_iterators"),$iterDetect=require("./_iter-detect"),setSpecies=require("./_set-species"),arrayFill=require("./_array-fill"),arrayCopyWithin=require("./_array-copy-within"),$DP=require("./_object-dp"),$GOPD=require("./_object-gopd"),dP=$DP.f,gOPD=$GOPD.f,RangeError=global.RangeError,TypeError=global.TypeError,Uint8Array=global.Uint8Array,ARRAY_BUFFER="ArrayBuffer",SHARED_BUFFER="Shared"+ARRAY_BUFFER,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",PROTOTYPE="prototype",ArrayProto=Array[PROTOTYPE],$ArrayBuffer=$buffer.ArrayBuffer,$DataView=$buffer.DataView,arrayForEach=createArrayMethod(0),arrayFilter=createArrayMethod(2),arraySome=createArrayMethod(3),arrayEvery=createArrayMethod(4),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),arrayIncludes=createArrayIncludes(true),arrayIndexOf=createArrayIncludes(false),arrayValues=ArrayIterators.values,arrayKeys=ArrayIterators.keys,arrayEntries=ArrayIterators.entries,arrayLastIndexOf=ArrayProto.lastIndexOf,arrayReduce=ArrayProto.reduce,arrayReduceRight=ArrayProto.reduceRight,arrayJoin=ArrayProto.join,arraySort=ArrayProto.sort,arraySlice=ArrayProto.slice,arrayToString=ArrayProto.toString,arrayToLocaleString=ArrayProto.toLocaleString,ITERATOR=wks("iterator"),TAG=wks("toStringTag"),TYPED_CONSTRUCTOR=uid("typed_constructor"),DEF_CONSTRUCTOR=uid("def_constructor"),ALL_CONSTRUCTORS=$typed.CONSTR,TYPED_ARRAY=$typed.TYPED,VIEW=$typed.VIEW,WRONG_LENGTH="Wrong length!";var $map=createArrayMethod(1,function(O,length){return allocate(speciesConstructor(O,O[DEF_CONSTRUCTOR]),length)});var LITTLE_ENDIAN=fails(function(){return new Uint8Array(new Uint16Array([1]).buffer)[0]===1});var FORCED_SET=!!Uint8Array&&!!Uint8Array[PROTOTYPE].set&&fails(function(){new Uint8Array(1).set({})});var strictToLength=function(it,SAME){if(it===undefined)throw TypeError(WRONG_LENGTH);var number=+it,length=toLength(it);if(SAME&&!same(number,length))throw RangeError(WRONG_LENGTH);return length};var toOffset=function(it,BYTES){var offset=toInteger(it);if(offset<0||offset%BYTES)throw RangeError("Wrong offset!");return offset};var validate=function(it){if(isObject(it)&&TYPED_ARRAY in it)return it;throw TypeError(it+" is not a typed array!")};var allocate=function(C,length){if(!(isObject(C)&&TYPED_CONSTRUCTOR in C)){throw TypeError("It is not a typed array constructor!")}return new C(length)};var speciesFromList=function(O,list){return fromList(speciesConstructor(O,O[DEF_CONSTRUCTOR]),list)};var fromList=function(C,list){var index=0,length=list.length,result=allocate(C,length);while(length>index)result[index]=list[index++];return result};var addGetter=function(it,key,internal){dP(it,key,{get:function(){return this._d[internal]}})};var $from=function from(source){var O=toObject(source),aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,iterFn=getIterFn(O),i,length,values,result,step,iterator;if(iterFn!=undefined&&!isArrayIter(iterFn)){for(iterator=iterFn.call(O),values=[],i=0;!(step=iterator.next()).done;i++){values.push(step.value)}O=values}if(mapping&&aLen>2)mapfn=ctx(mapfn,arguments[2],2);for(i=0,length=toLength(O.length),result=allocate(this,length);length>i;i++){result[i]=mapping?mapfn(O[i],i):O[i]}return result};var $of=function of(){var index=0,length=arguments.length,result=allocate(this,length);while(length>index)result[index]=arguments[index++];return result};var TO_LOCALE_BUG=!!Uint8Array&&fails(function(){arrayToLocaleString.call(new Uint8Array(1))});var $toLocaleString=function toLocaleString(){return arrayToLocaleString.apply(TO_LOCALE_BUG?arraySlice.call(validate(this)):validate(this),arguments)};var proto={copyWithin:function copyWithin(target,start){return arrayCopyWithin.call(validate(this),target,start,arguments.length>2?arguments[2]:undefined)},every:function every(callbackfn){return arrayEvery(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},fill:function fill(value){return arrayFill.apply(validate(this),arguments)},filter:function filter(callbackfn){return speciesFromList(this,arrayFilter(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined))},find:function find(predicate){return arrayFind(validate(this),predicate,arguments.length>1?arguments[1]:undefined)},findIndex:function findIndex(predicate){return arrayFindIndex(validate(this),predicate,arguments.length>1?arguments[1]:undefined)},forEach:function forEach(callbackfn){arrayForEach(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},indexOf:function indexOf(searchElement){return arrayIndexOf(validate(this),searchElement,arguments.length>1?arguments[1]:undefined)},includes:function includes(searchElement){return arrayIncludes(validate(this),searchElement,arguments.length>1?arguments[1]:undefined)},join:function join(separator){return arrayJoin.apply(validate(this),arguments)},lastIndexOf:function lastIndexOf(searchElement){return arrayLastIndexOf.apply(validate(this),arguments)},map:function map(mapfn){return $map(validate(this),mapfn,arguments.length>1?arguments[1]:undefined)},reduce:function reduce(callbackfn){return arrayReduce.apply(validate(this),arguments)},reduceRight:function reduceRight(callbackfn){return arrayReduceRight.apply(validate(this),arguments)},reverse:function reverse(){var that=this,length=validate(that).length,middle=Math.floor(length/2),index=0,value;while(index<middle){value=that[index];that[index++]=that[--length];that[length]=value}return that},some:function some(callbackfn){return arraySome(validate(this),callbackfn,arguments.length>1?arguments[1]:undefined)},sort:function sort(comparefn){return arraySort.call(validate(this),comparefn)},subarray:function subarray(begin,end){var O=validate(this),length=O.length,$begin=toIndex(begin,length);return new(speciesConstructor(O,O[DEF_CONSTRUCTOR]))(O.buffer,O.byteOffset+$begin*O.BYTES_PER_ELEMENT,toLength((end===undefined?length:toIndex(end,length))-$begin))}};var $slice=function slice(start,end){return speciesFromList(this,arraySlice.call(validate(this),start,end))};var $set=function set(arrayLike){validate(this);var offset=toOffset(arguments[1],1),length=this.length,src=toObject(arrayLike),len=toLength(src.length),index=0;if(len+offset>length)throw RangeError(WRONG_LENGTH);while(index<len)this[offset+index]=src[index++]};var $iterators={entries:function entries(){return arrayEntries.call(validate(this))},keys:function keys(){return arrayKeys.call(validate(this))},values:function values(){return arrayValues.call(validate(this))}};var isTAIndex=function(target,key){return isObject(target)&&target[TYPED_ARRAY]&&typeof key!="symbol"&&key in target&&String(+key)==String(key)};var $getDesc=function getOwnPropertyDescriptor(target,key){return isTAIndex(target,key=toPrimitive(key,true))?propertyDesc(2,target[key]):gOPD(target,key)};var $setDesc=function defineProperty(target,key,desc){if(isTAIndex(target,key=toPrimitive(key,true))&&isObject(desc)&&has(desc,"value")&&!has(desc,"get")&&!has(desc,"set")&&!desc.configurable&&(!has(desc,"writable")||desc.writable)&&(!has(desc,"enumerable")||desc.enumerable)){target[key]=desc.value;return target}else return dP(target,key,desc)};if(!ALL_CONSTRUCTORS){$GOPD.f=$getDesc;$DP.f=$setDesc}$export($export.S+$export.F*!ALL_CONSTRUCTORS,"Object",{getOwnPropertyDescriptor:$getDesc,defineProperty:$setDesc});if(fails(function(){arrayToString.call({})})){arrayToString=arrayToLocaleString=function toString(){return arrayJoin.call(this)}}var $TypedArrayPrototype$=redefineAll({},proto);redefineAll($TypedArrayPrototype$,$iterators);hide($TypedArrayPrototype$,ITERATOR,$iterators.values);redefineAll($TypedArrayPrototype$,{slice:$slice,set:$set,constructor:function(){},toString:arrayToString,toLocaleString:$toLocaleString});addGetter($TypedArrayPrototype$,"buffer","b");addGetter($TypedArrayPrototype$,"byteOffset","o");addGetter($TypedArrayPrototype$,"byteLength","l");addGetter($TypedArrayPrototype$,"length","e");dP($TypedArrayPrototype$,TAG,{get:function(){return this[TYPED_ARRAY]}});module.exports=function(KEY,BYTES,wrapper,CLAMPED){CLAMPED=!!CLAMPED;var NAME=KEY+(CLAMPED?"Clamped":"")+"Array",ISNT_UINT8=NAME!="Uint8Array",GETTER="get"+KEY,SETTER="set"+KEY,TypedArray=global[NAME],Base=TypedArray||{},TAC=TypedArray&&getPrototypeOf(TypedArray),FORCED=!TypedArray||!$typed.ABV,O={},TypedArrayPrototype=TypedArray&&TypedArray[PROTOTYPE];var getter=function(that,index){var data=that._d;return data.v[GETTER](index*BYTES+data.o,LITTLE_ENDIAN)};var setter=function(that,index,value){var data=that._d;if(CLAMPED)value=(value=Math.round(value))<0?0:value>255?255:value&255;data.v[SETTER](index*BYTES+data.o,value,LITTLE_ENDIAN)};var addElement=function(that,index){dP(that,index,{get:function(){return getter(this,index)},set:function(value){return setter(this,index,value)},enumerable:true})};if(FORCED){TypedArray=wrapper(function(that,data,$offset,$length){anInstance(that,TypedArray,NAME,"_d");var index=0,offset=0,buffer,byteLength,length,klass;if(!isObject(data)){length=strictToLength(data,true);byteLength=length*BYTES;buffer=new $ArrayBuffer(byteLength)}else if(data instanceof $ArrayBuffer||(klass=classof(data))==ARRAY_BUFFER||klass==SHARED_BUFFER){buffer=data;offset=toOffset($offset,BYTES);var $len=data.byteLength;if($length===undefined){if($len%BYTES)throw RangeError(WRONG_LENGTH);byteLength=$len-offset;if(byteLength<0)throw RangeError(WRONG_LENGTH)}else{byteLength=toLength($length)*BYTES;if(byteLength+offset>$len)throw RangeError(WRONG_LENGTH)}length=byteLength/BYTES}else if(TYPED_ARRAY in data){return fromList(TypedArray,data)}else{return $from.call(TypedArray,data)}hide(that,"_d",{b:buffer,o:offset,l:byteLength,e:length,v:new $DataView(buffer)});while(index<length)addElement(that,index++)});TypedArrayPrototype=TypedArray[PROTOTYPE]=create($TypedArrayPrototype$);hide(TypedArrayPrototype,"constructor",TypedArray)}else if(!$iterDetect(function(iter){new TypedArray(null);new TypedArray(iter)},true)){TypedArray=wrapper(function(that,data,$offset,$length){anInstance(that,TypedArray,NAME);var klass;if(!isObject(data))return new Base(strictToLength(data,ISNT_UINT8));if(data instanceof $ArrayBuffer||(klass=classof(data))==ARRAY_BUFFER||klass==SHARED_BUFFER){return $length!==undefined?new Base(data,toOffset($offset,BYTES),$length):$offset!==undefined?new Base(data,toOffset($offset,BYTES)):new Base(data)}if(TYPED_ARRAY in data)return fromList(TypedArray,data);return $from.call(TypedArray,data)});arrayForEach(TAC!==Function.prototype?gOPN(Base).concat(gOPN(TAC)):gOPN(Base),function(key){if(!(key in TypedArray))hide(TypedArray,key,Base[key])});TypedArray[PROTOTYPE]=TypedArrayPrototype;if(!LIBRARY)TypedArrayPrototype.constructor=TypedArray}var $nativeIterator=TypedArrayPrototype[ITERATOR],CORRECT_ITER_NAME=!!$nativeIterator&&($nativeIterator.name=="values"||$nativeIterator.name==undefined),$iterator=$iterators.values;hide(TypedArray,TYPED_CONSTRUCTOR,true);hide(TypedArrayPrototype,TYPED_ARRAY,NAME);hide(TypedArrayPrototype,VIEW,true);hide(TypedArrayPrototype,DEF_CONSTRUCTOR,TypedArray);if(CLAMPED?new TypedArray(1)[TAG]!=NAME:!(TAG in TypedArrayPrototype)){dP(TypedArrayPrototype,TAG,{get:function(){return NAME}})}O[NAME]=TypedArray;$export($export.G+$export.W+$export.F*(TypedArray!=Base),O);$export($export.S,NAME,{BYTES_PER_ELEMENT:BYTES,from:$from,of:$of});if(!(BYTES_PER_ELEMENT in TypedArrayPrototype))hide(TypedArrayPrototype,BYTES_PER_ELEMENT,BYTES);$export($export.P,NAME,proto);setSpecies(NAME);$export($export.P+$export.F*FORCED_SET,NAME,{set:$set});$export($export.P+$export.F*!CORRECT_ITER_NAME,NAME,$iterators);$export($export.P+$export.F*(TypedArrayPrototype.toString!=arrayToString),NAME,{toString:arrayToString});$export($export.P+$export.F*fails(function(){new TypedArray(1).slice()}),NAME,{slice:$slice});$export($export.P+$export.F*(fails(function(){return[1,2].toLocaleString()!=new TypedArray([1,2]).toLocaleString()})||!fails(function(){TypedArrayPrototype.toLocaleString.call([1,2])})),NAME,{toLocaleString:$toLocaleString});Iterators[NAME]=CORRECT_ITER_NAME?$nativeIterator:$iterator;if(!LIBRARY&&!CORRECT_ITER_NAME)hide(TypedArrayPrototype,ITERATOR,$iterator)}}else module.exports=function(){}},{"./_an-instance":26,"./_array-copy-within":28,"./_array-fill":29,"./_array-includes":31,"./_array-methods":32,"./_classof":37,"./_ctx":45,"./_descriptors":48,"./_export":52,"./_fails":54,"./_global":58,"./_has":59,"./_hide":60,"./_is-array-iter":66,"./_is-object":69,"./_iter-detect":74,"./_iterators":76,"./_library":78,"./_object-create":86,"./_object-dp":87,"./_object-gopd":90,"./_object-gopn":92,"./_object-gpo":94,"./_property-desc":105,"./_redefine-all":106,"./_same-value":109,"./_set-species":111,"./_species-constructor":115,"./_to-index":125,"./_to-integer":126,"./_to-length":128,"./_to-object":129,"./_to-primitive":130,"./_typed":133,"./_typed-buffer":132,"./_uid":134,"./_wks":137,"./core.get-iterator-method":138,"./es6.array.iterator":150}],132:[function(require,module,exports){"use strict";var global=require("./_global"),DESCRIPTORS=require("./_descriptors"),LIBRARY=require("./_library"),$typed=require("./_typed"),hide=require("./_hide"),redefineAll=require("./_redefine-all"),fails=require("./_fails"),anInstance=require("./_an-instance"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),gOPN=require("./_object-gopn").f,dP=require("./_object-dp").f,arrayFill=require("./_array-fill"),setToStringTag=require("./_set-to-string-tag"),ARRAY_BUFFER="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE="prototype",WRONG_LENGTH="Wrong length!",WRONG_INDEX="Wrong index!",$ArrayBuffer=global[ARRAY_BUFFER],$DataView=global[DATA_VIEW],Math=global.Math,RangeError=global.RangeError,Infinity=global.Infinity,BaseBuffer=$ArrayBuffer,abs=Math.abs,pow=Math.pow,floor=Math.floor,log=Math.log,LN2=Math.LN2,BUFFER="buffer",BYTE_LENGTH="byteLength",BYTE_OFFSET="byteOffset",$BUFFER=DESCRIPTORS?"_b":BUFFER,$LENGTH=DESCRIPTORS?"_l":BYTE_LENGTH,$OFFSET=DESCRIPTORS?"_o":BYTE_OFFSET;var packIEEE754=function(value,mLen,nBytes){var buffer=Array(nBytes),eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?pow(2,-24)-pow(2,-77):0,i=0,s=value<0||value===0&&1/value<0?1:0,e,m,c;value=abs(value);if(value!=value||value===Infinity){m=value!=value?1:0;e=eMax}else{e=floor(log(value)/LN2);if(value*(c=pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*pow(2,mLen);e=e+eBias}else{m=value*pow(2,eBias-1)*pow(2,mLen);e=0}}for(;mLen>=8;buffer[i++]=m&255,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[i++]=e&255,e/=256,eLen-=8);buffer[--i]|=s*128;return buffer};var unpackIEEE754=function(buffer,mLen,nBytes){var eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=eLen-7,i=nBytes-1,s=buffer[i--],e=s&127,m;s>>=7;for(;nBits>0;e=e*256+buffer[i],i--,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[i],i--,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:s?-Infinity:Infinity}else{m=m+pow(2,mLen);e=e-eBias}return(s?-1:1)*m*pow(2,e-mLen)};var unpackI32=function(bytes){return bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0]};var packI8=function(it){return[it&255]};var packI16=function(it){return[it&255,it>>8&255]};var packI32=function(it){return[it&255,it>>8&255,it>>16&255,it>>24&255]};var packF64=function(it){return packIEEE754(it,52,8)};var packF32=function(it){return packIEEE754(it,23,4)};var addGetter=function(C,key,internal){dP(C[PROTOTYPE],key,{get:function(){return this[internal]}})};var get=function(view,bytes,index,isLittleEndian){var numIndex=+index,intIndex=toInteger(numIndex);if(numIndex!=intIndex||intIndex<0||intIndex+bytes>view[$LENGTH])throw RangeError(WRONG_INDEX);var store=view[$BUFFER]._b,start=intIndex+view[$OFFSET],pack=store.slice(start,start+bytes);return isLittleEndian?pack:pack.reverse()};var set=function(view,bytes,index,conversion,value,isLittleEndian){var numIndex=+index,intIndex=toInteger(numIndex);if(numIndex!=intIndex||intIndex<0||intIndex+bytes>view[$LENGTH])throw RangeError(WRONG_INDEX);var store=view[$BUFFER]._b,start=intIndex+view[$OFFSET],pack=conversion(+value);for(var i=0;i<bytes;i++)store[start+i]=pack[isLittleEndian?i:bytes-i-1]};var validateArrayBufferArguments=function(that,length){anInstance(that,$ArrayBuffer,ARRAY_BUFFER);var numberLength=+length,byteLength=toLength(numberLength);if(numberLength!=byteLength)throw RangeError(WRONG_LENGTH);return byteLength};if(!$typed.ABV){$ArrayBuffer=function ArrayBuffer(length){var byteLength=validateArrayBufferArguments(this,length);this._b=arrayFill.call(Array(byteLength),0);this[$LENGTH]=byteLength};$DataView=function DataView(buffer,byteOffset,byteLength){anInstance(this,$DataView,DATA_VIEW);anInstance(buffer,$ArrayBuffer,DATA_VIEW);var bufferLength=buffer[$LENGTH],offset=toInteger(byteOffset);if(offset<0||offset>bufferLength)throw RangeError("Wrong offset!");byteLength=byteLength===undefined?bufferLength-offset:toLength(byteLength);if(offset+byteLength>bufferLength)throw RangeError(WRONG_LENGTH);this[$BUFFER]=buffer;this[$OFFSET]=offset;this[$LENGTH]=byteLength};if(DESCRIPTORS){addGetter($ArrayBuffer,BYTE_LENGTH,"_l");addGetter($DataView,BUFFER,"_b");addGetter($DataView,BYTE_LENGTH,"_l");addGetter($DataView,BYTE_OFFSET,"_o")}redefineAll($DataView[PROTOTYPE],{getInt8:function getInt8(byteOffset){return get(this,1,byteOffset)[0]<<24>>24},getUint8:function getUint8(byteOffset){return get(this,1,byteOffset)[0]},getInt16:function getInt16(byteOffset){var bytes=get(this,2,byteOffset,arguments[1]);return(bytes[1]<<8|bytes[0])<<16>>16},getUint16:function getUint16(byteOffset){var bytes=get(this,2,byteOffset,arguments[1]);return bytes[1]<<8|bytes[0]},getInt32:function getInt32(byteOffset){return unpackI32(get(this,4,byteOffset,arguments[1]))},getUint32:function getUint32(byteOffset){return unpackI32(get(this,4,byteOffset,arguments[1]))>>>0},getFloat32:function getFloat32(byteOffset){return unpackIEEE754(get(this,4,byteOffset,arguments[1]),23,4)},getFloat64:function getFloat64(byteOffset){return unpackIEEE754(get(this,8,byteOffset,arguments[1]),52,8)},setInt8:function setInt8(byteOffset,value){set(this,1,byteOffset,packI8,value)},setUint8:function setUint8(byteOffset,value){set(this,1,byteOffset,packI8,value)},setInt16:function setInt16(byteOffset,value){set(this,2,byteOffset,packI16,value,arguments[2])},setUint16:function setUint16(byteOffset,value){set(this,2,byteOffset,packI16,value,arguments[2])},setInt32:function setInt32(byteOffset,value){set(this,4,byteOffset,packI32,value,arguments[2])},setUint32:function setUint32(byteOffset,value){set(this,4,byteOffset,packI32,value,arguments[2])},setFloat32:function setFloat32(byteOffset,value){set(this,4,byteOffset,packF32,value,arguments[2])},setFloat64:function setFloat64(byteOffset,value){set(this,8,byteOffset,packF64,value,arguments[2])}})}else{if(!fails(function(){new $ArrayBuffer})||!fails(function(){new $ArrayBuffer(.5)})){$ArrayBuffer=function ArrayBuffer(length){return new BaseBuffer(validateArrayBufferArguments(this,length))};var ArrayBufferProto=$ArrayBuffer[PROTOTYPE]=BaseBuffer[PROTOTYPE];for(var keys=gOPN(BaseBuffer),j=0,key;keys.length>j;){if(!((key=keys[j++])in $ArrayBuffer))hide($ArrayBuffer,key,BaseBuffer[key])}if(!LIBRARY)ArrayBufferProto.constructor=$ArrayBuffer}var view=new $DataView(new $ArrayBuffer(2)),$setInt8=$DataView[PROTOTYPE].setInt8;view.setInt8(0,2147483648);view.setInt8(1,2147483649);if(view.getInt8(0)||!view.getInt8(1))redefineAll($DataView[PROTOTYPE],{setInt8:function setInt8(byteOffset,value){$setInt8.call(this,byteOffset,value<<24>>24)},setUint8:function setUint8(byteOffset,value){$setInt8.call(this,byteOffset,value<<24>>24)}},true)}setToStringTag($ArrayBuffer,ARRAY_BUFFER);setToStringTag($DataView,DATA_VIEW);hide($DataView[PROTOTYPE],$typed.VIEW,true);exports[ARRAY_BUFFER]=$ArrayBuffer;exports[DATA_VIEW]=$DataView},{"./_an-instance":26,"./_array-fill":29,"./_descriptors":48,"./_fails":54,"./_global":58,"./_hide":60,"./_library":78,"./_object-dp":87,"./_object-gopn":92,"./_redefine-all":106,"./_set-to-string-tag":112,"./_to-integer":126,"./_to-length":128,"./_typed":133}],133:[function(require,module,exports){var global=require("./_global"),hide=require("./_hide"),uid=require("./_uid"),TYPED=uid("typed_array"),VIEW=uid("view"),ABV=!!(global.ArrayBuffer&&global.DataView),CONSTR=ABV,i=0,l=9,Typed;var TypedArrayConstructors="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");while(i<l){if(Typed=global[TypedArrayConstructors[i++]]){hide(Typed.prototype,TYPED,true);hide(Typed.prototype,VIEW,true)}else CONSTR=false}module.exports={ABV:ABV,CONSTR:CONSTR,TYPED:TYPED,VIEW:VIEW}},{"./_global":58,"./_hide":60,"./_uid":134}],134:[function(require,module,exports){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(key===undefined?"":key,")_",(++id+px).toString(36))}},{}],135:[function(require,module,exports){var global=require("./_global"),core=require("./_core"),LIBRARY=require("./_library"),wksExt=require("./_wks-ext"),defineProperty=require("./_object-dp").f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});if(name.charAt(0)!="_"&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)})}},{"./_core":43,"./_global":58,"./_library":78,"./_object-dp":87,"./_wks-ext":136}],136:[function(require,module,exports){exports.f=require("./_wks")},{"./_wks":137}],137:[function(require,module,exports){var store=require("./_shared")("wks"),uid=require("./_uid"),Symbol=require("./_global").Symbol,USE_SYMBOL=typeof Symbol=="function";var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store},{"./_global":58,"./_shared":114,"./_uid":134}],138:[function(require,module,exports){var classof=require("./_classof"),ITERATOR=require("./_wks")("iterator"),Iterators=require("./_iterators");module.exports=require("./_core").getIteratorMethod=function(it){if(it!=undefined)return it[ITERATOR]||it["@@iterator"]||Iterators[classof(it)]}},{"./_classof":37,"./_core":43,"./_iterators":76,"./_wks":137}],139:[function(require,module,exports){var $export=require("./_export"),$re=require("./_replacer")(/[\\^$*+?.()|[\]{}]/g,"\\$&");$export($export.S,"RegExp",{escape:function escape(it){return $re(it)}})},{"./_export":52,"./_replacer":108}],140:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Array",{copyWithin:require("./_array-copy-within")});require("./_add-to-unscopables")("copyWithin")},{"./_add-to-unscopables":25,"./_array-copy-within":28,"./_export":52}],141:[function(require,module,exports){"use strict";var $export=require("./_export"),$every=require("./_array-methods")(4);$export($export.P+$export.F*!require("./_strict-method")([].every,true),"Array",{every:function every(callbackfn){return $every(this,callbackfn,arguments[1])}})},{"./_array-methods":32,"./_export":52,"./_strict-method":116}],142:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Array",{fill:require("./_array-fill")});require("./_add-to-unscopables")("fill")},{"./_add-to-unscopables":25,"./_array-fill":29,"./_export":52}],143:[function(require,module,exports){"use strict";var $export=require("./_export"),$filter=require("./_array-methods")(2);$export($export.P+$export.F*!require("./_strict-method")([].filter,true),"Array",{filter:function filter(callbackfn){return $filter(this,callbackfn,arguments[1])}})},{"./_array-methods":32,"./_export":52,"./_strict-method":116}],144:[function(require,module,exports){"use strict";var $export=require("./_export"),$find=require("./_array-methods")(6),KEY="findIndex",forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false});$export($export.P+$export.F*forced,"Array",{findIndex:function findIndex(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")(KEY)},{"./_add-to-unscopables":25,"./_array-methods":32,"./_export":52}],145:[function(require,module,exports){"use strict";var $export=require("./_export"),$find=require("./_array-methods")(5),KEY="find",forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false});$export($export.P+$export.F*forced,"Array",{find:function find(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")(KEY)},{"./_add-to-unscopables":25,"./_array-methods":32,
"./_export":52}],146:[function(require,module,exports){"use strict";var $export=require("./_export"),$forEach=require("./_array-methods")(0),STRICT=require("./_strict-method")([].forEach,true);$export($export.P+$export.F*!STRICT,"Array",{forEach:function forEach(callbackfn){return $forEach(this,callbackfn,arguments[1])}})},{"./_array-methods":32,"./_export":52,"./_strict-method":116}],147:[function(require,module,exports){"use strict";var ctx=require("./_ctx"),$export=require("./_export"),toObject=require("./_to-object"),call=require("./_iter-call"),isArrayIter=require("./_is-array-iter"),toLength=require("./_to-length"),createProperty=require("./_create-property"),getIterFn=require("./core.get-iterator-method");$export($export.S+$export.F*!require("./_iter-detect")(function(iter){Array.from(iter)}),"Array",{from:function from(arrayLike){var O=toObject(arrayLike),C=typeof this=="function"?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,index=0,iterFn=getIterFn(O),length,result,step,iterator;if(mapping)mapfn=ctx(mapfn,aLen>2?arguments[2]:undefined,2);if(iterFn!=undefined&&!(C==Array&&isArrayIter(iterFn))){for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++){createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],true):step.value)}}else{length=toLength(O.length);for(result=new C(length);length>index;index++){createProperty(result,index,mapping?mapfn(O[index],index):O[index])}}result.length=index;return result}})},{"./_create-property":44,"./_ctx":45,"./_export":52,"./_is-array-iter":66,"./_iter-call":71,"./_iter-detect":74,"./_to-length":128,"./_to-object":129,"./core.get-iterator-method":138}],148:[function(require,module,exports){"use strict";var $export=require("./_export"),$indexOf=require("./_array-includes")(false),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{indexOf:function indexOf(searchElement){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,searchElement,arguments[1])}})},{"./_array-includes":31,"./_export":52,"./_strict-method":116}],149:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Array",{isArray:require("./_is-array")})},{"./_export":52,"./_is-array":67}],150:[function(require,module,exports){"use strict";var addToUnscopables=require("./_add-to-unscopables"),step=require("./_iter-step"),Iterators=require("./_iterators"),toIObject=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1)}if(kind=="keys")return step(0,index);if(kind=="values")return step(0,O[index]);return step(0,[index,O[index]])},"values");Iterators.Arguments=Iterators.Array;addToUnscopables("keys");addToUnscopables("values");addToUnscopables("entries")},{"./_add-to-unscopables":25,"./_iter-define":73,"./_iter-step":75,"./_iterators":76,"./_to-iobject":127}],151:[function(require,module,exports){"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),arrayJoin=[].join;$export($export.P+$export.F*(require("./_iobject")!=Object||!require("./_strict-method")(arrayJoin)),"Array",{join:function join(separator){return arrayJoin.call(toIObject(this),separator===undefined?",":separator)}})},{"./_export":52,"./_iobject":65,"./_strict-method":116,"./_to-iobject":127}],152:[function(require,module,exports){"use strict";var $export=require("./_export"),toIObject=require("./_to-iobject"),toInteger=require("./_to-integer"),toLength=require("./_to-length"),$native=[].lastIndexOf,NEGATIVE_ZERO=!!$native&&1/[1].lastIndexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!require("./_strict-method")($native)),"Array",{lastIndexOf:function lastIndexOf(searchElement){if(NEGATIVE_ZERO)return $native.apply(this,arguments)||0;var O=toIObject(this),length=toLength(O.length),index=length-1;if(arguments.length>1)index=Math.min(index,toInteger(arguments[1]));if(index<0)index=length+index;for(;index>=0;index--)if(index in O)if(O[index]===searchElement)return index||0;return-1}})},{"./_export":52,"./_strict-method":116,"./_to-integer":126,"./_to-iobject":127,"./_to-length":128}],153:[function(require,module,exports){"use strict";var $export=require("./_export"),$map=require("./_array-methods")(1);$export($export.P+$export.F*!require("./_strict-method")([].map,true),"Array",{map:function map(callbackfn){return $map(this,callbackfn,arguments[1])}})},{"./_array-methods":32,"./_export":52,"./_strict-method":116}],154:[function(require,module,exports){"use strict";var $export=require("./_export"),createProperty=require("./_create-property");$export($export.S+$export.F*require("./_fails")(function(){function F(){}return!(Array.of.call(F)instanceof F)}),"Array",{of:function of(){var index=0,aLen=arguments.length,result=new(typeof this=="function"?this:Array)(aLen);while(aLen>index)createProperty(result,index,arguments[index++]);result.length=aLen;return result}})},{"./_create-property":44,"./_export":52,"./_fails":54}],155:[function(require,module,exports){"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduceRight,true),"Array",{reduceRight:function reduceRight(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],true)}})},{"./_array-reduce":33,"./_export":52,"./_strict-method":116}],156:[function(require,module,exports){"use strict";var $export=require("./_export"),$reduce=require("./_array-reduce");$export($export.P+$export.F*!require("./_strict-method")([].reduce,true),"Array",{reduce:function reduce(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],false)}})},{"./_array-reduce":33,"./_export":52,"./_strict-method":116}],157:[function(require,module,exports){"use strict";var $export=require("./_export"),html=require("./_html"),cof=require("./_cof"),toIndex=require("./_to-index"),toLength=require("./_to-length"),arraySlice=[].slice;$export($export.P+$export.F*require("./_fails")(function(){if(html)arraySlice.call(html)}),"Array",{slice:function slice(begin,end){var len=toLength(this.length),klass=cof(this);end=end===undefined?len:end;if(klass=="Array")return arraySlice.call(this,begin,end);var start=toIndex(begin,len),upTo=toIndex(end,len),size=toLength(upTo-start),cloned=Array(size),i=0;for(;i<size;i++)cloned[i]=klass=="String"?this.charAt(start+i):this[start+i];return cloned}})},{"./_cof":38,"./_export":52,"./_fails":54,"./_html":61,"./_to-index":125,"./_to-length":128}],158:[function(require,module,exports){"use strict";var $export=require("./_export"),$some=require("./_array-methods")(3);$export($export.P+$export.F*!require("./_strict-method")([].some,true),"Array",{some:function some(callbackfn){return $some(this,callbackfn,arguments[1])}})},{"./_array-methods":32,"./_export":52,"./_strict-method":116}],159:[function(require,module,exports){"use strict";var $export=require("./_export"),aFunction=require("./_a-function"),toObject=require("./_to-object"),fails=require("./_fails"),$sort=[].sort,test=[1,2,3];$export($export.P+$export.F*(fails(function(){test.sort(undefined)})||!fails(function(){test.sort(null)})||!require("./_strict-method")($sort)),"Array",{sort:function sort(comparefn){return comparefn===undefined?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(comparefn))}})},{"./_a-function":23,"./_export":52,"./_fails":54,"./_strict-method":116,"./_to-object":129}],160:[function(require,module,exports){require("./_set-species")("Array")},{"./_set-species":111}],161:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Date",{now:function(){return(new Date).getTime()}})},{"./_export":52}],162:[function(require,module,exports){"use strict";var $export=require("./_export"),fails=require("./_fails"),getTime=Date.prototype.getTime;var lz=function(num){return num>9?num:"0"+num};$export($export.P+$export.F*(fails(function(){return new Date(-5e13-1).toISOString()!="0385-07-25T07:06:39.999Z"})||!fails(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function toISOString(){if(!isFinite(getTime.call(this)))throw RangeError("Invalid time value");var d=this,y=d.getUTCFullYear(),m=d.getUTCMilliseconds(),s=y<0?"-":y>9999?"+":"";return s+("00000"+Math.abs(y)).slice(s?-6:-4)+"-"+lz(d.getUTCMonth()+1)+"-"+lz(d.getUTCDate())+"T"+lz(d.getUTCHours())+":"+lz(d.getUTCMinutes())+":"+lz(d.getUTCSeconds())+"."+(m>99?m:"0"+lz(m))+"Z"}})},{"./_export":52,"./_fails":54}],163:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive");$export($export.P+$export.F*require("./_fails")(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function toJSON(key){var O=toObject(this),pv=toPrimitive(O);return typeof pv=="number"&&!isFinite(pv)?null:O.toISOString()}})},{"./_export":52,"./_fails":54,"./_to-object":129,"./_to-primitive":130}],164:[function(require,module,exports){var TO_PRIMITIVE=require("./_wks")("toPrimitive"),proto=Date.prototype;if(!(TO_PRIMITIVE in proto))require("./_hide")(proto,TO_PRIMITIVE,require("./_date-to-primitive"))},{"./_date-to-primitive":46,"./_hide":60,"./_wks":137}],165:[function(require,module,exports){var DateProto=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING="toString",$toString=DateProto[TO_STRING],getTime=DateProto.getTime;if(new Date(NaN)+""!=INVALID_DATE){require("./_redefine")(DateProto,TO_STRING,function toString(){var value=getTime.call(this);return value===value?$toString.call(this):INVALID_DATE})}},{"./_redefine":107}],166:[function(require,module,exports){var $export=require("./_export");$export($export.P,"Function",{bind:require("./_bind")})},{"./_bind":36,"./_export":52}],167:[function(require,module,exports){"use strict";var isObject=require("./_is-object"),getPrototypeOf=require("./_object-gpo"),HAS_INSTANCE=require("./_wks")("hasInstance"),FunctionProto=Function.prototype;if(!(HAS_INSTANCE in FunctionProto))require("./_object-dp").f(FunctionProto,HAS_INSTANCE,{value:function(O){if(typeof this!="function"||!isObject(O))return false;if(!isObject(this.prototype))return O instanceof this;while(O=getPrototypeOf(O))if(this.prototype===O)return true;return false}})},{"./_is-object":69,"./_object-dp":87,"./_object-gpo":94,"./_wks":137}],168:[function(require,module,exports){var dP=require("./_object-dp").f,createDesc=require("./_property-desc"),has=require("./_has"),FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME="name";var isExtensible=Object.isExtensible||function(){return true};NAME in FProto||require("./_descriptors")&&dP(FProto,NAME,{configurable:true,get:function(){try{var that=this,name=(""+that).match(nameRE)[1];has(that,NAME)||!isExtensible(that)||dP(that,NAME,createDesc(5,name));return name}catch(e){return""}}})},{"./_descriptors":48,"./_has":59,"./_object-dp":87,"./_property-desc":105}],169:[function(require,module,exports){"use strict";var strong=require("./_collection-strong");module.exports=require("./_collection")("Map",function(get){return function Map(){return get(this,arguments.length>0?arguments[0]:undefined)}},{get:function get(key){var entry=strong.getEntry(this,key);return entry&&entry.v},set:function set(key,value){return strong.def(this,key===0?0:key,value)}},strong,true)},{"./_collection":42,"./_collection-strong":39}],170:[function(require,module,exports){var $export=require("./_export"),log1p=require("./_math-log1p"),sqrt=Math.sqrt,$acosh=Math.acosh;$export($export.S+$export.F*!($acosh&&Math.floor($acosh(Number.MAX_VALUE))==710&&$acosh(Infinity)==Infinity),"Math",{acosh:function acosh(x){return(x=+x)<1?NaN:x>94906265.62425156?Math.log(x)+Math.LN2:log1p(x-1+sqrt(x-1)*sqrt(x+1))}})},{"./_export":52,"./_math-log1p":80}],171:[function(require,module,exports){var $export=require("./_export"),$asinh=Math.asinh;function asinh(x){return!isFinite(x=+x)||x==0?x:x<0?-asinh(-x):Math.log(x+Math.sqrt(x*x+1))}$export($export.S+$export.F*!($asinh&&1/$asinh(0)>0),"Math",{asinh:asinh})},{"./_export":52}],172:[function(require,module,exports){var $export=require("./_export"),$atanh=Math.atanh;$export($export.S+$export.F*!($atanh&&1/$atanh(-0)<0),"Math",{atanh:function atanh(x){return(x=+x)==0?x:Math.log((1+x)/(1-x))/2}})},{"./_export":52}],173:[function(require,module,exports){var $export=require("./_export"),sign=require("./_math-sign");$export($export.S,"Math",{cbrt:function cbrt(x){return sign(x=+x)*Math.pow(Math.abs(x),1/3)}})},{"./_export":52,"./_math-sign":81}],174:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{clz32:function clz32(x){return(x>>>=0)?31-Math.floor(Math.log(x+.5)*Math.LOG2E):32}})},{"./_export":52}],175:[function(require,module,exports){var $export=require("./_export"),exp=Math.exp;$export($export.S,"Math",{cosh:function cosh(x){return(exp(x=+x)+exp(-x))/2}})},{"./_export":52}],176:[function(require,module,exports){var $export=require("./_export"),$expm1=require("./_math-expm1");$export($export.S+$export.F*($expm1!=Math.expm1),"Math",{expm1:$expm1})},{"./_export":52,"./_math-expm1":79}],177:[function(require,module,exports){var $export=require("./_export"),sign=require("./_math-sign"),pow=Math.pow,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126);var roundTiesToEven=function(n){return n+1/EPSILON-1/EPSILON};$export($export.S,"Math",{fround:function fround(x){var $abs=Math.abs(x),$sign=sign(x),a,result;if($abs<MIN32)return $sign*roundTiesToEven($abs/MIN32/EPSILON32)*MIN32*EPSILON32;a=(1+EPSILON32/EPSILON)*$abs;result=a-(a-$abs);if(result>MAX32||result!=result)return $sign*Infinity;return $sign*result}})},{"./_export":52,"./_math-sign":81}],178:[function(require,module,exports){var $export=require("./_export"),abs=Math.abs;$export($export.S,"Math",{hypot:function hypot(value1,value2){var sum=0,i=0,aLen=arguments.length,larg=0,arg,div;while(i<aLen){arg=abs(arguments[i++]);if(larg<arg){div=larg/arg;sum=sum*div*div+1;larg=arg}else if(arg>0){div=arg/larg;sum+=div*div}else sum+=arg}return larg===Infinity?Infinity:larg*Math.sqrt(sum)}})},{"./_export":52}],179:[function(require,module,exports){var $export=require("./_export"),$imul=Math.imul;$export($export.S+$export.F*require("./_fails")(function(){return $imul(4294967295,5)!=-5||$imul.length!=2}),"Math",{imul:function imul(x,y){var UINT16=65535,xn=+x,yn=+y,xl=UINT16&xn,yl=UINT16&yn;return 0|xl*yl+((UINT16&xn>>>16)*yl+xl*(UINT16&yn>>>16)<<16>>>0)}})},{"./_export":52,"./_fails":54}],180:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log10:function log10(x){return Math.log(x)/Math.LN10}})},{"./_export":52}],181:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log1p:require("./_math-log1p")})},{"./_export":52,"./_math-log1p":80}],182:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{log2:function log2(x){return Math.log(x)/Math.LN2}})},{"./_export":52}],183:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{sign:require("./_math-sign")})},{"./_export":52,"./_math-sign":81}],184:[function(require,module,exports){var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S+$export.F*require("./_fails")(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function sinh(x){return Math.abs(x=+x)<1?(expm1(x)-expm1(-x))/2:(exp(x-1)-exp(-x-1))*(Math.E/2)}})},{"./_export":52,"./_fails":54,"./_math-expm1":79}],185:[function(require,module,exports){var $export=require("./_export"),expm1=require("./_math-expm1"),exp=Math.exp;$export($export.S,"Math",{tanh:function tanh(x){var a=expm1(x=+x),b=expm1(-x);return a==Infinity?1:b==Infinity?-1:(a-b)/(exp(x)+exp(-x))}})},{"./_export":52,"./_math-expm1":79}],186:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{trunc:function trunc(it){return(it>0?Math.floor:Math.ceil)(it)}})},{"./_export":52}],187:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),cof=require("./_cof"),inheritIfRequired=require("./_inherit-if-required"),toPrimitive=require("./_to-primitive"),fails=require("./_fails"),gOPN=require("./_object-gopn").f,gOPD=require("./_object-gopd").f,dP=require("./_object-dp").f,$trim=require("./_string-trim").trim,NUMBER="Number",$Number=global[NUMBER],Base=$Number,proto=$Number.prototype,BROKEN_COF=cof(require("./_object-create")(proto))==NUMBER,TRIM="trim"in String.prototype;var toNumber=function(argument){var it=toPrimitive(argument,false);if(typeof it=="string"&&it.length>2){it=TRIM?it.trim():$trim(it,3);var first=it.charCodeAt(0),third,radix,maxCode;if(first===43||first===45){third=it.charCodeAt(2);if(third===88||third===120)return NaN}else if(first===48){switch(it.charCodeAt(1)){case 66:case 98:radix=2;maxCode=49;break;case 79:case 111:radix=8;maxCode=55;break;default:return+it}for(var digits=it.slice(2),i=0,l=digits.length,code;i<l;i++){code=digits.charCodeAt(i);if(code<48||code>maxCode)return NaN}return parseInt(digits,radix)}}return+it};if(!$Number(" 0o1")||!$Number("0b1")||$Number("+0x1")){$Number=function Number(value){var it=arguments.length<1?0:value,that=this;return that instanceof $Number&&(BROKEN_COF?fails(function(){proto.valueOf.call(that)}):cof(that)!=NUMBER)?inheritIfRequired(new Base(toNumber(it)),that,$Number):toNumber(it)};for(var keys=require("./_descriptors")?gOPN(Base):("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,"+"EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,"+"MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger").split(","),j=0,key;keys.length>j;j++){if(has(Base,key=keys[j])&&!has($Number,key)){dP($Number,key,gOPD(Base,key))}}$Number.prototype=proto;proto.constructor=$Number;require("./_redefine")(global,NUMBER,$Number)}},{"./_cof":38,"./_descriptors":48,"./_fails":54,"./_global":58,"./_has":59,"./_inherit-if-required":63,"./_object-create":86,"./_object-dp":87,"./_object-gopd":90,"./_object-gopn":92,"./_redefine":107,"./_string-trim":122,"./_to-primitive":130}],188:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{EPSILON:Math.pow(2,-52)})},{"./_export":52}],189:[function(require,module,exports){var $export=require("./_export"),_isFinite=require("./_global").isFinite;$export($export.S,"Number",{isFinite:function isFinite(it){return typeof it=="number"&&_isFinite(it)}})},{"./_export":52,"./_global":58}],190:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{isInteger:require("./_is-integer")})},{"./_export":52,"./_is-integer":68}],191:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{isNaN:function isNaN(number){return number!=number}})},{"./_export":52}],192:[function(require,module,exports){var $export=require("./_export"),isInteger=require("./_is-integer"),abs=Math.abs;$export($export.S,"Number",{isSafeInteger:function isSafeInteger(number){return isInteger(number)&&abs(number)<=9007199254740991}})},{"./_export":52,"./_is-integer":68}],193:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":52}],194:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{"./_export":52}],195:[function(require,module,exports){var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.S+$export.F*(Number.parseFloat!=$parseFloat),"Number",{parseFloat:$parseFloat})},{"./_export":52,"./_parse-float":101}],196:[function(require,module,exports){var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.S+$export.F*(Number.parseInt!=$parseInt),"Number",{parseInt:$parseInt})},{"./_export":52,"./_parse-int":102}],197:[function(require,module,exports){"use strict";var $export=require("./_export"),toInteger=require("./_to-integer"),aNumberValue=require("./_a-number-value"),repeat=require("./_string-repeat"),$toFixed=1..toFixed,floor=Math.floor,data=[0,0,0,0,0,0],ERROR="Number.toFixed: incorrect invocation!",ZERO="0";var multiply=function(n,c){var i=-1,c2=c;while(++i<6){c2+=n*data[i];data[i]=c2%1e7;c2=floor(c2/1e7)}};var divide=function(n){var i=6,c=0;while(--i>=0){c+=data[i];data[i]=floor(c/n);c=c%n*1e7}};var numToString=function(){var i=6,s="";while(--i>=0){if(s!==""||i===0||data[i]!==0){var t=String(data[i]);s=s===""?t:s+repeat.call(ZERO,7-t.length)+t}}return s};var pow=function(x,n,acc){return n===0?acc:n%2===1?pow(x,n-1,acc*x):pow(x*x,n/2,acc)};var log=function(x){var n=0,x2=x;while(x2>=4096){n+=12;x2/=4096}while(x2>=2){n+=1;x2/=2}return n};$export($export.P+$export.F*(!!$toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(0xde0b6b3a7640080).toFixed(0)!=="1000000000000000128")||!require("./_fails")(function(){$toFixed.call({})})),"Number",{toFixed:function toFixed(fractionDigits){var x=aNumberValue(this,ERROR),f=toInteger(fractionDigits),s="",m=ZERO,e,z,j,k;if(f<0||f>20)throw RangeError(ERROR);if(x!=x)return"NaN";if(x<=-1e21||x>=1e21)return String(x);if(x<0){s="-";x=-x}if(x>1e-21){e=log(x*pow(2,69,1))-69;z=e<0?x*pow(2,-e,1):x/pow(2,e,1);z*=4503599627370496;e=52-e;if(e>0){multiply(0,z);j=f;while(j>=7){multiply(1e7,0);j-=7}multiply(pow(10,j,1),0);j=e-1;while(j>=23){divide(1<<23);j-=23}divide(1<<j);multiply(1,1);divide(2);m=numToString()}else{multiply(0,z);multiply(1<<-e,0);m=numToString()+repeat.call(ZERO,f)}}if(f>0){k=m.length;m=s+(k<=f?"0."+repeat.call(ZERO,f-k)+m:m.slice(0,k-f)+"."+m.slice(k-f))}else{m=s+m}return m}})},{"./_a-number-value":24,"./_export":52,"./_fails":54,"./_string-repeat":121,"./_to-integer":126}],198:[function(require,module,exports){"use strict";var $export=require("./_export"),$fails=require("./_fails"),aNumberValue=require("./_a-number-value"),$toPrecision=1..toPrecision;$export($export.P+$export.F*($fails(function(){return $toPrecision.call(1,undefined)!=="1"})||!$fails(function(){$toPrecision.call({})})),"Number",{toPrecision:function toPrecision(precision){var that=aNumberValue(this,"Number#toPrecision: incorrect invocation!");return precision===undefined?$toPrecision.call(that):$toPrecision.call(that,precision)}})},{"./_a-number-value":24,"./_export":52,"./_fails":54}],199:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F,"Object",{assign:require("./_object-assign")})},{"./_export":52,"./_object-assign":85}],200:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{create:require("./_object-create")})},{"./_export":52,"./_object-create":86}],201:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperties:require("./_object-dps")})},{"./_descriptors":48,"./_export":52,"./_object-dps":88}],202:[function(require,module,exports){var $export=require("./_export");$export($export.S+$export.F*!require("./_descriptors"),"Object",{defineProperty:require("./_object-dp").f})},{"./_descriptors":48,"./_export":52,"./_object-dp":87}],203:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("freeze",function($freeze){return function freeze(it){return $freeze&&isObject(it)?$freeze(meta(it)):it}})},{"./_is-object":69,"./_meta":82,"./_object-sap":98}],204:[function(require,module,exports){var toIObject=require("./_to-iobject"),$getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_object-sap")("getOwnPropertyDescriptor",function(){return function getOwnPropertyDescriptor(it,key){return $getOwnPropertyDescriptor(toIObject(it),key)}})},{"./_object-gopd":90,"./_object-sap":98,"./_to-iobject":127}],205:[function(require,module,exports){require("./_object-sap")("getOwnPropertyNames",function(){return require("./_object-gopn-ext").f})},{"./_object-gopn-ext":91,"./_object-sap":98}],206:[function(require,module,exports){var toObject=require("./_to-object"),$getPrototypeOf=require("./_object-gpo");require("./_object-sap")("getPrototypeOf",function(){return function getPrototypeOf(it){return $getPrototypeOf(toObject(it))}})},{"./_object-gpo":94,"./_object-sap":98,"./_to-object":129}],207:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isExtensible",function($isExtensible){return function isExtensible(it){return isObject(it)?$isExtensible?$isExtensible(it):true:false}})},{"./_is-object":69,"./_object-sap":98}],208:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isFrozen",function($isFrozen){return function isFrozen(it){return isObject(it)?$isFrozen?$isFrozen(it):false:true}})},{"./_is-object":69,"./_object-sap":98}],209:[function(require,module,exports){var isObject=require("./_is-object");require("./_object-sap")("isSealed",function($isSealed){return function isSealed(it){return isObject(it)?$isSealed?$isSealed(it):false:true}})},{"./_is-object":69,"./_object-sap":98}],210:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{is:require("./_same-value")})},{"./_export":52,"./_same-value":109}],211:[function(require,module,exports){var toObject=require("./_to-object"),$keys=require("./_object-keys");require("./_object-sap")("keys",function(){return function keys(it){return $keys(toObject(it))}})},{"./_object-keys":96,"./_object-sap":98,"./_to-object":129}],212:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("preventExtensions",function($preventExtensions){return function preventExtensions(it){return $preventExtensions&&isObject(it)?$preventExtensions(meta(it)):it}})},{"./_is-object":69,"./_meta":82,"./_object-sap":98}],213:[function(require,module,exports){var isObject=require("./_is-object"),meta=require("./_meta").onFreeze;require("./_object-sap")("seal",function($seal){return function seal(it){return $seal&&isObject(it)?$seal(meta(it)):it}})},{"./_is-object":69,"./_meta":82,"./_object-sap":98}],214:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Object",{setPrototypeOf:require("./_set-proto").set})},{"./_export":52,"./_set-proto":110}],215:[function(require,module,exports){"use strict";var classof=require("./_classof"),test={};test[require("./_wks")("toStringTag")]="z";if(test+""!="[object z]"){require("./_redefine")(Object.prototype,"toString",function toString(){return"[object "+classof(this)+"]"},true)}},{"./_classof":37,"./_redefine":107,"./_wks":137}],216:[function(require,module,exports){var $export=require("./_export"),$parseFloat=require("./_parse-float");$export($export.G+$export.F*(parseFloat!=$parseFloat),{parseFloat:$parseFloat})},{"./_export":52,"./_parse-float":101}],217:[function(require,module,exports){var $export=require("./_export"),$parseInt=require("./_parse-int");$export($export.G+$export.F*(parseInt!=$parseInt),{parseInt:$parseInt})},{"./_export":52,"./_parse-int":102}],218:[function(require,module,exports){"use strict";var LIBRARY=require("./_library"),global=require("./_global"),ctx=require("./_ctx"),classof=require("./_classof"),$export=require("./_export"),isObject=require("./_is-object"),aFunction=require("./_a-function"),anInstance=require("./_an-instance"),forOf=require("./_for-of"),speciesConstructor=require("./_species-constructor"),task=require("./_task").set,microtask=require("./_microtask")(),PROMISE="Promise",TypeError=global.TypeError,process=global.process,$Promise=global[PROMISE],process=global.process,isNode=classof(process)=="process",empty=function(){},Internal,GenericPromiseCapability,Wrapper;var USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[require("./_wks")("species")]=function(exec){exec(empty,empty)};return(isNode||typeof PromiseRejectionEvent=="function")&&promise.then(empty)instanceof FakePromise}catch(e){}}();var sameConstructor=function(a,b){return a===b||a===$Promise&&b===Wrapper};var isThenable=function(it){var then;return isObject(it)&&typeof(then=it.then)=="function"?then:false};var newPromiseCapability=function(C){return sameConstructor($Promise,C)?new PromiseCapability(C):new GenericPromiseCapability(C)};var PromiseCapability=GenericPromiseCapability=function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==undefined||reject!==undefined)throw TypeError("Bad Promise constructor");resolve=$$resolve;reject=$$reject});this.resolve=aFunction(resolve);this.reject=aFunction(reject)};var perform=function(exec){try{exec()}catch(e){return{error:e}}};var notify=function(promise,isReject){if(promise._n)return;promise._n=true;var chain=promise._c;microtask(function(){var value=promise._v,ok=promise._s==1,i=0;var run=function(reaction){var handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain,result,then;try{if(handler){if(!ok){if(promise._h==2)onHandleUnhandled(promise);promise._h=1}if(handler===true)result=value;else{if(domain)domain.enter();result=handler(value);if(domain)domain.exit()}if(result===reaction.promise){reject(TypeError("Promise-chain cycle"))}else if(then=isThenable(result)){then.call(result,resolve,reject)}else resolve(result)}else reject(value)}catch(e){reject(e)}};while(chain.length>i)run(chain[i++]);promise._c=[];promise._n=false;if(isReject&&!promise._h)onUnhandled(promise)})};var onUnhandled=function(promise){task.call(global,function(){var value=promise._v,abrupt,handler,console;if(isUnhandled(promise)){abrupt=perform(function(){if(isNode){process.emit("unhandledRejection",value,promise)}else if(handler=global.onunhandledrejection){handler({promise:promise,reason:value})}else if((console=global.console)&&console.error){console.error("Unhandled promise rejection",value)}});promise._h=isNode||isUnhandled(promise)?2:1}promise._a=undefined;if(abrupt)throw abrupt.error})};var isUnhandled=function(promise){if(promise._h==1)return false;var chain=promise._a||promise._c,i=0,reaction;while(chain.length>i){reaction=chain[i++];if(reaction.fail||!isUnhandled(reaction.promise))return false}return true};var onHandleUnhandled=function(promise){task.call(global,function(){var handler;if(isNode){process.emit("rejectionHandled",promise)}else if(handler=global.onrejectionhandled){handler({promise:promise,reason:promise._v})}})};var $reject=function(value){var promise=this;if(promise._d)return;promise._d=true;promise=promise._w||promise;promise._v=value;promise._s=2;if(!promise._a)promise._a=promise._c.slice();notify(promise,true)};var $resolve=function(value){var promise=this,then;if(promise._d)return;promise._d=true;promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");if(then=isThenable(value)){microtask(function(){var wrapper={_w:promise,_d:false};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}})}else{promise._v=value;promise._s=1;notify(promise,false)}}catch(e){$reject.call({_w:promise,_d:false},e)}};if(!USE_NATIVE){$Promise=function Promise(executor){anInstance(this,$Promise,PROMISE,"_h");aFunction(executor);Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1))}catch(err){$reject.call(this,err)}};Internal=function Promise(executor){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false};Internal.prototype=require("./_redefine-all")($Promise.prototype,{
then:function then(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));reaction.ok=typeof onFulfilled=="function"?onFulfilled:true;reaction.fail=typeof onRejected=="function"&&onRejected;reaction.domain=isNode?process.domain:undefined;this._c.push(reaction);if(this._a)this._a.push(reaction);if(this._s)notify(this,false);return reaction.promise},catch:function(onRejected){return this.then(undefined,onRejected)}});PromiseCapability=function(){var promise=new Internal;this.promise=promise;this.resolve=ctx($resolve,promise,1);this.reject=ctx($reject,promise,1)}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise});require("./_set-to-string-tag")($Promise,PROMISE);require("./_set-species")(PROMISE);Wrapper=require("./_core")[PROMISE];$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function reject(r){var capability=newPromiseCapability(this),$$reject=capability.reject;$$reject(r);return capability.promise}});$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function resolve(x){if(x instanceof $Promise&&sameConstructor(x.constructor,this))return x;var capability=newPromiseCapability(this),$$resolve=capability.resolve;$$resolve(x);return capability.promise}});$export($export.S+$export.F*!(USE_NATIVE&&require("./_iter-detect")(function(iter){$Promise.all(iter)["catch"](empty)})),PROMISE,{all:function all(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject;var abrupt=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,false,function(promise){var $index=index++,alreadyCalled=false;values.push(undefined);remaining++;C.resolve(promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[$index]=value;--remaining||resolve(values)},reject)});--remaining||resolve(values)});if(abrupt)reject(abrupt.error);return capability.promise},race:function race(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject;var abrupt=perform(function(){forOf(iterable,false,function(promise){C.resolve(promise).then(capability.resolve,reject)})});if(abrupt)reject(abrupt.error);return capability.promise}})},{"./_a-function":23,"./_an-instance":26,"./_classof":37,"./_core":43,"./_ctx":45,"./_export":52,"./_for-of":57,"./_global":58,"./_is-object":69,"./_iter-detect":74,"./_library":78,"./_microtask":84,"./_redefine-all":106,"./_set-species":111,"./_set-to-string-tag":112,"./_species-constructor":115,"./_task":124,"./_wks":137}],219:[function(require,module,exports){var $export=require("./_export"),aFunction=require("./_a-function"),anObject=require("./_an-object"),rApply=(require("./_global").Reflect||{}).apply,fApply=Function.apply;$export($export.S+$export.F*!require("./_fails")(function(){rApply(function(){})}),"Reflect",{apply:function apply(target,thisArgument,argumentsList){var T=aFunction(target),L=anObject(argumentsList);return rApply?rApply(T,thisArgument,L):fApply.call(T,thisArgument,L)}})},{"./_a-function":23,"./_an-object":27,"./_export":52,"./_fails":54,"./_global":58}],220:[function(require,module,exports){var $export=require("./_export"),create=require("./_object-create"),aFunction=require("./_a-function"),anObject=require("./_an-object"),isObject=require("./_is-object"),fails=require("./_fails"),bind=require("./_bind"),rConstruct=(require("./_global").Reflect||{}).construct;var NEW_TARGET_BUG=fails(function(){function F(){}return!(rConstruct(function(){},[],F)instanceof F)});var ARGS_BUG=!fails(function(){rConstruct(function(){})});$export($export.S+$export.F*(NEW_TARGET_BUG||ARGS_BUG),"Reflect",{construct:function construct(Target,args){aFunction(Target);anObject(args);var newTarget=arguments.length<3?Target:aFunction(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return rConstruct(Target,args,newTarget);if(Target==newTarget){switch(args.length){case 0:return new Target;case 1:return new Target(args[0]);case 2:return new Target(args[0],args[1]);case 3:return new Target(args[0],args[1],args[2]);case 4:return new Target(args[0],args[1],args[2],args[3])}var $args=[null];$args.push.apply($args,args);return new(bind.apply(Target,$args))}var proto=newTarget.prototype,instance=create(isObject(proto)?proto:Object.prototype),result=Function.apply.call(Target,instance,args);return isObject(result)?result:instance}})},{"./_a-function":23,"./_an-object":27,"./_bind":36,"./_export":52,"./_fails":54,"./_global":58,"./_is-object":69,"./_object-create":86}],221:[function(require,module,exports){var dP=require("./_object-dp"),$export=require("./_export"),anObject=require("./_an-object"),toPrimitive=require("./_to-primitive");$export($export.S+$export.F*require("./_fails")(function(){Reflect.defineProperty(dP.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function defineProperty(target,propertyKey,attributes){anObject(target);propertyKey=toPrimitive(propertyKey,true);anObject(attributes);try{dP.f(target,propertyKey,attributes);return true}catch(e){return false}}})},{"./_an-object":27,"./_export":52,"./_fails":54,"./_object-dp":87,"./_to-primitive":130}],222:[function(require,module,exports){var $export=require("./_export"),gOPD=require("./_object-gopd").f,anObject=require("./_an-object");$export($export.S,"Reflect",{deleteProperty:function deleteProperty(target,propertyKey){var desc=gOPD(anObject(target),propertyKey);return desc&&!desc.configurable?false:delete target[propertyKey]}})},{"./_an-object":27,"./_export":52,"./_object-gopd":90}],223:[function(require,module,exports){"use strict";var $export=require("./_export"),anObject=require("./_an-object");var Enumerate=function(iterated){this._t=anObject(iterated);this._i=0;var keys=this._k=[],key;for(key in iterated)keys.push(key)};require("./_iter-create")(Enumerate,"Object",function(){var that=this,keys=that._k,key;do{if(that._i>=keys.length)return{value:undefined,done:true}}while(!((key=keys[that._i++])in that._t));return{value:key,done:false}});$export($export.S,"Reflect",{enumerate:function enumerate(target){return new Enumerate(target)}})},{"./_an-object":27,"./_export":52,"./_iter-create":72}],224:[function(require,module,exports){var gOPD=require("./_object-gopd"),$export=require("./_export"),anObject=require("./_an-object");$export($export.S,"Reflect",{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(target,propertyKey){return gOPD.f(anObject(target),propertyKey)}})},{"./_an-object":27,"./_export":52,"./_object-gopd":90}],225:[function(require,module,exports){var $export=require("./_export"),getProto=require("./_object-gpo"),anObject=require("./_an-object");$export($export.S,"Reflect",{getPrototypeOf:function getPrototypeOf(target){return getProto(anObject(target))}})},{"./_an-object":27,"./_export":52,"./_object-gpo":94}],226:[function(require,module,exports){var gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),isObject=require("./_is-object"),anObject=require("./_an-object");function get(target,propertyKey){var receiver=arguments.length<3?target:arguments[2],desc,proto;if(anObject(target)===receiver)return target[propertyKey];if(desc=gOPD.f(target,propertyKey))return has(desc,"value")?desc.value:desc.get!==undefined?desc.get.call(receiver):undefined;if(isObject(proto=getPrototypeOf(target)))return get(proto,propertyKey,receiver)}$export($export.S,"Reflect",{get:get})},{"./_an-object":27,"./_export":52,"./_has":59,"./_is-object":69,"./_object-gopd":90,"./_object-gpo":94}],227:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Reflect",{has:function has(target,propertyKey){return propertyKey in target}})},{"./_export":52}],228:[function(require,module,exports){var $export=require("./_export"),anObject=require("./_an-object"),$isExtensible=Object.isExtensible;$export($export.S,"Reflect",{isExtensible:function isExtensible(target){anObject(target);return $isExtensible?$isExtensible(target):true}})},{"./_an-object":27,"./_export":52}],229:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Reflect",{ownKeys:require("./_own-keys")})},{"./_export":52,"./_own-keys":100}],230:[function(require,module,exports){var $export=require("./_export"),anObject=require("./_an-object"),$preventExtensions=Object.preventExtensions;$export($export.S,"Reflect",{preventExtensions:function preventExtensions(target){anObject(target);try{if($preventExtensions)$preventExtensions(target);return true}catch(e){return false}}})},{"./_an-object":27,"./_export":52}],231:[function(require,module,exports){var $export=require("./_export"),setProto=require("./_set-proto");if(setProto)$export($export.S,"Reflect",{setPrototypeOf:function setPrototypeOf(target,proto){setProto.check(target,proto);try{setProto.set(target,proto);return true}catch(e){return false}}})},{"./_export":52,"./_set-proto":110}],232:[function(require,module,exports){var dP=require("./_object-dp"),gOPD=require("./_object-gopd"),getPrototypeOf=require("./_object-gpo"),has=require("./_has"),$export=require("./_export"),createDesc=require("./_property-desc"),anObject=require("./_an-object"),isObject=require("./_is-object");function set(target,propertyKey,V){var receiver=arguments.length<4?target:arguments[3],ownDesc=gOPD.f(anObject(target),propertyKey),existingDescriptor,proto;if(!ownDesc){if(isObject(proto=getPrototypeOf(target))){return set(proto,propertyKey,V,receiver)}ownDesc=createDesc(0)}if(has(ownDesc,"value")){if(ownDesc.writable===false||!isObject(receiver))return false;existingDescriptor=gOPD.f(receiver,propertyKey)||createDesc(0);existingDescriptor.value=V;dP.f(receiver,propertyKey,existingDescriptor);return true}return ownDesc.set===undefined?false:(ownDesc.set.call(receiver,V),true)}$export($export.S,"Reflect",{set:set})},{"./_an-object":27,"./_export":52,"./_has":59,"./_is-object":69,"./_object-dp":87,"./_object-gopd":90,"./_object-gpo":94,"./_property-desc":105}],233:[function(require,module,exports){var global=require("./_global"),inheritIfRequired=require("./_inherit-if-required"),dP=require("./_object-dp").f,gOPN=require("./_object-gopn").f,isRegExp=require("./_is-regexp"),$flags=require("./_flags"),$RegExp=global.RegExp,Base=$RegExp,proto=$RegExp.prototype,re1=/a/g,re2=/a/g,CORRECT_NEW=new $RegExp(re1)!==re1;if(require("./_descriptors")&&(!CORRECT_NEW||require("./_fails")(function(){re2[require("./_wks")("match")]=false;return $RegExp(re1)!=re1||$RegExp(re2)==re2||$RegExp(re1,"i")!="/a/i"}))){$RegExp=function RegExp(p,f){var tiRE=this instanceof $RegExp,piRE=isRegExp(p),fiU=f===undefined;return!tiRE&&piRE&&p.constructor===$RegExp&&fiU?p:inheritIfRequired(CORRECT_NEW?new Base(piRE&&!fiU?p.source:p,f):Base((piRE=p instanceof $RegExp)?p.source:p,piRE&&fiU?$flags.call(p):f),tiRE?this:proto,$RegExp)};var proxy=function(key){key in $RegExp||dP($RegExp,key,{configurable:true,get:function(){return Base[key]},set:function(it){Base[key]=it}})};for(var keys=gOPN(Base),i=0;keys.length>i;)proxy(keys[i++]);proto.constructor=$RegExp;$RegExp.prototype=proto;require("./_redefine")(global,"RegExp",$RegExp)}require("./_set-species")("RegExp")},{"./_descriptors":48,"./_fails":54,"./_flags":56,"./_global":58,"./_inherit-if-required":63,"./_is-regexp":70,"./_object-dp":87,"./_object-gopn":92,"./_redefine":107,"./_set-species":111,"./_wks":137}],234:[function(require,module,exports){if(require("./_descriptors")&&/./g.flags!="g")require("./_object-dp").f(RegExp.prototype,"flags",{configurable:true,get:require("./_flags")})},{"./_descriptors":48,"./_flags":56,"./_object-dp":87}],235:[function(require,module,exports){require("./_fix-re-wks")("match",1,function(defined,MATCH,$match){return[function match(regexp){"use strict";var O=defined(this),fn=regexp==undefined?undefined:regexp[MATCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[MATCH](String(O))},$match]})},{"./_fix-re-wks":55}],236:[function(require,module,exports){require("./_fix-re-wks")("replace",2,function(defined,REPLACE,$replace){return[function replace(searchValue,replaceValue){"use strict";var O=defined(this),fn=searchValue==undefined?undefined:searchValue[REPLACE];return fn!==undefined?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue)},$replace]})},{"./_fix-re-wks":55}],237:[function(require,module,exports){require("./_fix-re-wks")("search",1,function(defined,SEARCH,$search){return[function search(regexp){"use strict";var O=defined(this),fn=regexp==undefined?undefined:regexp[SEARCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[SEARCH](String(O))},$search]})},{"./_fix-re-wks":55}],238:[function(require,module,exports){require("./_fix-re-wks")("split",2,function(defined,SPLIT,$split){"use strict";var isRegExp=require("./_is-regexp"),_split=$split,$push=[].push,$SPLIT="split",LENGTH="length",LAST_INDEX="lastIndex";if("abbc"[$SPLIT](/(b)*/)[1]=="c"||"test"[$SPLIT](/(?:)/,-1)[LENGTH]!=4||"ab"[$SPLIT](/(?:ab)*/)[LENGTH]!=2||"."[$SPLIT](/(.?)(.?)/)[LENGTH]!=4||"."[$SPLIT](/()()/)[LENGTH]>1||""[$SPLIT](/.?/)[LENGTH]){var NPCG=/()??/.exec("")[1]===undefined;$split=function(separator,limit){var string=String(this);if(separator===undefined&&limit===0)return[];if(!isRegExp(separator))return _split.call(string,separator,limit);var output=[];var flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":"");var lastLastIndex=0;var splitLimit=limit===undefined?4294967295:limit>>>0;var separatorCopy=new RegExp(separator.source,flags+"g");var separator2,match,lastIndex,lastLength,i;if(!NPCG)separator2=new RegExp("^"+separatorCopy.source+"$(?!\\s)",flags);while(match=separatorCopy.exec(string)){lastIndex=match.index+match[0][LENGTH];if(lastIndex>lastLastIndex){output.push(string.slice(lastLastIndex,match.index));if(!NPCG&&match[LENGTH]>1)match[0].replace(separator2,function(){for(i=1;i<arguments[LENGTH]-2;i++)if(arguments[i]===undefined)match[i]=undefined});if(match[LENGTH]>1&&match.index<string[LENGTH])$push.apply(output,match.slice(1));lastLength=match[0][LENGTH];lastLastIndex=lastIndex;if(output[LENGTH]>=splitLimit)break}if(separatorCopy[LAST_INDEX]===match.index)separatorCopy[LAST_INDEX]++}if(lastLastIndex===string[LENGTH]){if(lastLength||!separatorCopy.test(""))output.push("")}else output.push(string.slice(lastLastIndex));return output[LENGTH]>splitLimit?output.slice(0,splitLimit):output}}else if("0"[$SPLIT](undefined,0)[LENGTH]){$split=function(separator,limit){return separator===undefined&&limit===0?[]:_split.call(this,separator,limit)}}return[function split(separator,limit){var O=defined(this),fn=separator==undefined?undefined:separator[SPLIT];return fn!==undefined?fn.call(separator,O,limit):$split.call(String(O),separator,limit)},$split]})},{"./_fix-re-wks":55,"./_is-regexp":70}],239:[function(require,module,exports){"use strict";require("./es6.regexp.flags");var anObject=require("./_an-object"),$flags=require("./_flags"),DESCRIPTORS=require("./_descriptors"),TO_STRING="toString",$toString=/./[TO_STRING];var define=function(fn){require("./_redefine")(RegExp.prototype,TO_STRING,fn,true)};if(require("./_fails")(function(){return $toString.call({source:"a",flags:"b"})!="/a/b"})){define(function toString(){var R=anObject(this);return"/".concat(R.source,"/","flags"in R?R.flags:!DESCRIPTORS&&R instanceof RegExp?$flags.call(R):undefined)})}else if($toString.name!=TO_STRING){define(function toString(){return $toString.call(this)})}},{"./_an-object":27,"./_descriptors":48,"./_fails":54,"./_flags":56,"./_redefine":107,"./es6.regexp.flags":234}],240:[function(require,module,exports){"use strict";var strong=require("./_collection-strong");module.exports=require("./_collection")("Set",function(get){return function Set(){return get(this,arguments.length>0?arguments[0]:undefined)}},{add:function add(value){return strong.def(this,value=value===0?0:value,value)}},strong)},{"./_collection":42,"./_collection-strong":39}],241:[function(require,module,exports){"use strict";require("./_string-html")("anchor",function(createHTML){return function anchor(name){return createHTML(this,"a","name",name)}})},{"./_string-html":119}],242:[function(require,module,exports){"use strict";require("./_string-html")("big",function(createHTML){return function big(){return createHTML(this,"big","","")}})},{"./_string-html":119}],243:[function(require,module,exports){"use strict";require("./_string-html")("blink",function(createHTML){return function blink(){return createHTML(this,"blink","","")}})},{"./_string-html":119}],244:[function(require,module,exports){"use strict";require("./_string-html")("bold",function(createHTML){return function bold(){return createHTML(this,"b","","")}})},{"./_string-html":119}],245:[function(require,module,exports){"use strict";var $export=require("./_export"),$at=require("./_string-at")(false);$export($export.P,"String",{codePointAt:function codePointAt(pos){return $at(this,pos)}})},{"./_export":52,"./_string-at":117}],246:[function(require,module,exports){"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),ENDS_WITH="endsWith",$endsWith=""[ENDS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(ENDS_WITH),"String",{endsWith:function endsWith(searchString){var that=context(this,searchString,ENDS_WITH),endPosition=arguments.length>1?arguments[1]:undefined,len=toLength(that.length),end=endPosition===undefined?len:Math.min(toLength(endPosition),len),search=String(searchString);return $endsWith?$endsWith.call(that,search,end):that.slice(end-search.length,end)===search}})},{"./_export":52,"./_fails-is-regexp":53,"./_string-context":118,"./_to-length":128}],247:[function(require,module,exports){"use strict";require("./_string-html")("fixed",function(createHTML){return function fixed(){return createHTML(this,"tt","","")}})},{"./_string-html":119}],248:[function(require,module,exports){"use strict";require("./_string-html")("fontcolor",function(createHTML){return function fontcolor(color){return createHTML(this,"font","color",color)}})},{"./_string-html":119}],249:[function(require,module,exports){"use strict";require("./_string-html")("fontsize",function(createHTML){return function fontsize(size){return createHTML(this,"font","size",size)}})},{"./_string-html":119}],250:[function(require,module,exports){var $export=require("./_export"),toIndex=require("./_to-index"),fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;$export($export.S+$export.F*(!!$fromCodePoint&&$fromCodePoint.length!=1),"String",{fromCodePoint:function fromCodePoint(x){var res=[],aLen=arguments.length,i=0,code;while(aLen>i){code=+arguments[i++];if(toIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(((code-=65536)>>10)+55296,code%1024+56320))}return res.join("")}})},{"./_export":52,"./_to-index":125}],251:[function(require,module,exports){"use strict";var $export=require("./_export"),context=require("./_string-context"),INCLUDES="includes";$export($export.P+$export.F*require("./_fails-is-regexp")(INCLUDES),"String",{includes:function includes(searchString){return!!~context(this,searchString,INCLUDES).indexOf(searchString,arguments.length>1?arguments[1]:undefined)}})},{"./_export":52,"./_fails-is-regexp":53,"./_string-context":118}],252:[function(require,module,exports){"use strict";require("./_string-html")("italics",function(createHTML){return function italics(){return createHTML(this,"i","","")}})},{"./_string-html":119}],253:[function(require,module,exports){"use strict";var $at=require("./_string-at")(true);require("./_iter-define")(String,"String",function(iterated){this._t=String(iterated);this._i=0},function(){var O=this._t,index=this._i,point;if(index>=O.length)return{value:undefined,done:true};point=$at(O,index);this._i+=point.length;return{value:point,done:false}})},{"./_iter-define":73,"./_string-at":117}],254:[function(require,module,exports){"use strict";require("./_string-html")("link",function(createHTML){return function link(url){return createHTML(this,"a","href",url)}})},{"./_string-html":119}],255:[function(require,module,exports){var $export=require("./_export"),toIObject=require("./_to-iobject"),toLength=require("./_to-length");$export($export.S,"String",{raw:function raw(callSite){var tpl=toIObject(callSite.raw),len=toLength(tpl.length),aLen=arguments.length,res=[],i=0;while(len>i){res.push(String(tpl[i++]));if(i<aLen)res.push(String(arguments[i]))}return res.join("")}})},{"./_export":52,"./_to-iobject":127,"./_to-length":128}],256:[function(require,module,exports){var $export=require("./_export");$export($export.P,"String",{repeat:require("./_string-repeat")})},{"./_export":52,"./_string-repeat":121}],257:[function(require,module,exports){"use strict";require("./_string-html")("small",function(createHTML){return function small(){return createHTML(this,"small","","")}})},{"./_string-html":119}],258:[function(require,module,exports){"use strict";var $export=require("./_export"),toLength=require("./_to-length"),context=require("./_string-context"),STARTS_WITH="startsWith",$startsWith=""[STARTS_WITH];$export($export.P+$export.F*require("./_fails-is-regexp")(STARTS_WITH),"String",{startsWith:function startsWith(searchString){var that=context(this,searchString,STARTS_WITH),index=toLength(Math.min(arguments.length>1?arguments[1]:undefined,that.length)),search=String(searchString);return $startsWith?$startsWith.call(that,search,index):that.slice(index,index+search.length)===search}})},{"./_export":52,"./_fails-is-regexp":53,"./_string-context":118,"./_to-length":128}],259:[function(require,module,exports){"use strict";require("./_string-html")("strike",function(createHTML){return function strike(){return createHTML(this,"strike","","")}})},{"./_string-html":119}],260:[function(require,module,exports){"use strict";require("./_string-html")("sub",function(createHTML){return function sub(){return createHTML(this,"sub","","")}})},{"./_string-html":119}],261:[function(require,module,exports){"use strict";require("./_string-html")("sup",function(createHTML){return function sup(){return createHTML(this,"sup","","")}})},{"./_string-html":119}],262:[function(require,module,exports){"use strict";require("./_string-trim")("trim",function($trim){return function trim(){return $trim(this,3)}})},{"./_string-trim":122}],263:[function(require,module,exports){"use strict";var global=require("./_global"),has=require("./_has"),DESCRIPTORS=require("./_descriptors"),$export=require("./_export"),redefine=require("./_redefine"),META=require("./_meta").KEY,$fails=require("./_fails"),shared=require("./_shared"),setToStringTag=require("./_set-to-string-tag"),uid=require("./_uid"),wks=require("./_wks"),wksExt=require("./_wks-ext"),wksDefine=require("./_wks-define"),keyOf=require("./_keyof"),enumKeys=require("./_enum-keys"),isArray=require("./_is-array"),anObject=require("./_an-object"),toIObject=require("./_to-iobject"),toPrimitive=require("./_to-primitive"),createDesc=require("./_property-desc"),_create=require("./_object-create"),gOPNExt=require("./_object-gopn-ext"),$GOPD=require("./_object-gopd"),$DP=require("./_object-dp"),$keys=require("./_object-keys"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE="prototype",HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object[PROTOTYPE],USE_NATIVE=typeof $Symbol=="function",QObject=global.QObject;var setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDesc=DESCRIPTORS&&$fails(function(){return _create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a!=7})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);if(protoDesc)delete ObjectProto[key];dP(it,key,D);if(protoDesc&&it!==ObjectProto)dP(ObjectProto,key,protoDesc)}:dP;var wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol[PROTOTYPE]);sym._k=tag;return sym};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=="symbol"?function(it){return typeof it=="symbol"}:function(it){return it instanceof $Symbol};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP(it,HIDDEN,createDesc(1,{}));it[HIDDEN][key]=true}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=_create(D,{enumerable:createDesc(0,false)})}return setSymbolDesc(it,key,D)}return dP(it,key,D)};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P)),i=0,l=keys.length,key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it};var $create=function create(it,P){return P===undefined?_create(it):$defineProperties(_create(it),P)};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN(toIObject(it)),result=[],i=0,key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key)}return result};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0,key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto,key):true))result.push(AllSymbols[key])}return result};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,createDesc(1,value))};if(DESCRIPTORS&&setter)setSymbolDesc(ObjectProto,tag,{configurable:true,set:$set});return wrap(tag)};redefine($Symbol[PROTOTYPE],"toString",function toString(){return this._k});$GOPD.f=$getOwnPropertyDescriptor;$DP.f=$defineProperty;require("./_object-gopn").f=gOPNExt.f=$getOwnPropertyNames;require("./_object-pie").f=$propertyIsEnumerable;require("./_object-gops").f=$getOwnPropertySymbols;if(DESCRIPTORS&&!require("./_library")){redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,true)}wksExt.f=function(name){return wrap(wks(name))}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),i=0;symbols.length>i;)wks(symbols[i++]);for(var symbols=$keys(wks.store),i=0;symbols.length>i;)wksDefine(symbols[i++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(key){if(isSymbol(key))return keyOf(SymbolRegistry,key);throw TypeError(key+" is not a symbol!")},useSetter:function(){setter=true},useSimple:function(){setter=false}});$export($export.S+$export.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return _stringify([S])!="[null]"||_stringify({a:S})!="{}"||_stringify(Object(S))!="{}"})),"JSON",{stringify:function stringify(it){if(it===undefined||isSymbol(it))return;var args=[it],i=1,replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);replacer=args[1];if(typeof replacer=="function")$replacer=replacer;if($replacer||!isArray(replacer))replacer=function(key,value){if($replacer)value=$replacer.call(this,key,value);if(!isSymbol(value))return value};args[1]=replacer;return _stringify.apply($JSON,args)}});$Symbol[PROTOTYPE][TO_PRIMITIVE]||require("./_hide")($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf);setToStringTag($Symbol,"Symbol");setToStringTag(Math,"Math",true);setToStringTag(global.JSON,"JSON",true)},{"./_an-object":27,"./_descriptors":48,"./_enum-keys":51,"./_export":52,"./_fails":54,"./_global":58,"./_has":59,"./_hide":60,"./_is-array":67,"./_keyof":77,"./_library":78,"./_meta":82,"./_object-create":86,"./_object-dp":87,"./_object-gopd":90,"./_object-gopn":92,"./_object-gopn-ext":91,"./_object-gops":93,"./_object-keys":96,"./_object-pie":97,"./_property-desc":105,"./_redefine":107,"./_set-to-string-tag":112,"./_shared":114,"./_to-iobject":127,"./_to-primitive":130,"./_uid":134,"./_wks":137,"./_wks-define":135,"./_wks-ext":136}],264:[function(require,module,exports){"use strict";var $export=require("./_export"),$typed=require("./_typed"),buffer=require("./_typed-buffer"),anObject=require("./_an-object"),toIndex=require("./_to-index"),toLength=require("./_to-length"),isObject=require("./_is-object"),ArrayBuffer=require("./_global").ArrayBuffer,speciesConstructor=require("./_species-constructor"),$ArrayBuffer=buffer.ArrayBuffer,$DataView=buffer.DataView,$isView=$typed.ABV&&ArrayBuffer.isView,$slice=$ArrayBuffer.prototype.slice,VIEW=$typed.VIEW,ARRAY_BUFFER="ArrayBuffer";$export($export.G+$export.W+$export.F*(ArrayBuffer!==$ArrayBuffer),{ArrayBuffer:$ArrayBuffer});$export($export.S+$export.F*!$typed.CONSTR,ARRAY_BUFFER,{isView:function isView(it){return $isView&&$isView(it)||isObject(it)&&VIEW in it}});$export($export.P+$export.U+$export.F*require("./_fails")(function(){return!new $ArrayBuffer(2).slice(1,undefined).byteLength}),ARRAY_BUFFER,{slice:function slice(start,end){if($slice!==undefined&&end===undefined)return $slice.call(anObject(this),start);var len=anObject(this).byteLength,first=toIndex(start,len),final=toIndex(end===undefined?len:end,len),result=new(speciesConstructor(this,$ArrayBuffer))(toLength(final-first)),viewS=new $DataView(this),viewT=new $DataView(result),index=0;while(first<final){viewT.setUint8(index++,viewS.getUint8(first++))}return result}});require("./_set-species")(ARRAY_BUFFER)},{"./_an-object":27,"./_export":52,"./_fails":54,"./_global":58,"./_is-object":69,"./_set-species":111,"./_species-constructor":115,"./_to-index":125,"./_to-length":128,"./_typed":133,"./_typed-buffer":132}],265:[function(require,module,exports){var $export=require("./_export");$export($export.G+$export.W+$export.F*!require("./_typed").ABV,{DataView:require("./_typed-buffer").DataView})},{"./_export":52,"./_typed":133,"./_typed-buffer":132}],266:[function(require,module,exports){require("./_typed-array")("Float32",4,function(init){return function Float32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],267:[function(require,module,exports){require("./_typed-array")("Float64",8,function(init){return function Float64Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],268:[function(require,module,exports){require("./_typed-array")("Int16",2,function(init){return function Int16Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],269:[function(require,module,exports){require("./_typed-array")("Int32",4,function(init){return function Int32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131
}],270:[function(require,module,exports){require("./_typed-array")("Int8",1,function(init){return function Int8Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],271:[function(require,module,exports){require("./_typed-array")("Uint16",2,function(init){return function Uint16Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],272:[function(require,module,exports){require("./_typed-array")("Uint32",4,function(init){return function Uint32Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],273:[function(require,module,exports){require("./_typed-array")("Uint8",1,function(init){return function Uint8Array(data,byteOffset,length){return init(this,data,byteOffset,length)}})},{"./_typed-array":131}],274:[function(require,module,exports){require("./_typed-array")("Uint8",1,function(init){return function Uint8ClampedArray(data,byteOffset,length){return init(this,data,byteOffset,length)}},true)},{"./_typed-array":131}],275:[function(require,module,exports){"use strict";var each=require("./_array-methods")(0),redefine=require("./_redefine"),meta=require("./_meta"),assign=require("./_object-assign"),weak=require("./_collection-weak"),isObject=require("./_is-object"),getWeak=meta.getWeak,isExtensible=Object.isExtensible,uncaughtFrozenStore=weak.ufstore,tmp={},InternalMap;var wrapper=function(get){return function WeakMap(){return get(this,arguments.length>0?arguments[0]:undefined)}};var methods={get:function get(key){if(isObject(key)){var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).get(key);return data?data[this._i]:undefined}},set:function set(key,value){return weak.def(this,key,value)}};var $WeakMap=module.exports=require("./_collection")("WeakMap",wrapper,methods,weak,true,true);if((new $WeakMap).set((Object.freeze||Object)(tmp),7).get(tmp)!=7){InternalMap=weak.getConstructor(wrapper);assign(InternalMap.prototype,methods);meta.NEED=true;each(["delete","has","get","set"],function(key){var proto=$WeakMap.prototype,method=proto[key];redefine(proto,key,function(a,b){if(isObject(a)&&!isExtensible(a)){if(!this._f)this._f=new InternalMap;var result=this._f[key](a,b);return key=="set"?this:result}return method.call(this,a,b)})})}},{"./_array-methods":32,"./_collection":42,"./_collection-weak":41,"./_is-object":69,"./_meta":82,"./_object-assign":85,"./_redefine":107}],276:[function(require,module,exports){"use strict";var weak=require("./_collection-weak");require("./_collection")("WeakSet",function(get){return function WeakSet(){return get(this,arguments.length>0?arguments[0]:undefined)}},{add:function add(value){return weak.def(this,value,true)}},weak,false,true)},{"./_collection":42,"./_collection-weak":41}],277:[function(require,module,exports){"use strict";var $export=require("./_export"),$includes=require("./_array-includes")(true);$export($export.P,"Array",{includes:function includes(el){return $includes(this,el,arguments.length>1?arguments[1]:undefined)}});require("./_add-to-unscopables")("includes")},{"./_add-to-unscopables":25,"./_array-includes":31,"./_export":52}],278:[function(require,module,exports){var $export=require("./_export"),microtask=require("./_microtask")(),process=require("./_global").process,isNode=require("./_cof")(process)=="process";$export($export.G,{asap:function asap(fn){var domain=isNode&&process.domain;microtask(domain?domain.bind(fn):fn)}})},{"./_cof":38,"./_export":52,"./_global":58,"./_microtask":84}],279:[function(require,module,exports){var $export=require("./_export"),cof=require("./_cof");$export($export.S,"Error",{isError:function isError(it){return cof(it)==="Error"}})},{"./_cof":38,"./_export":52}],280:[function(require,module,exports){var $export=require("./_export");$export($export.P+$export.R,"Map",{toJSON:require("./_collection-to-json")("Map")})},{"./_collection-to-json":40,"./_export":52}],281:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{iaddh:function iaddh(x0,x1,y0,y1){var $x0=x0>>>0,$x1=x1>>>0,$y0=y0>>>0;return $x1+(y1>>>0)+(($x0&$y0|($x0|$y0)&~($x0+$y0>>>0))>>>31)|0}})},{"./_export":52}],282:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{imulh:function imulh(u,v){var UINT16=65535,$u=+u,$v=+v,u0=$u&UINT16,v0=$v&UINT16,u1=$u>>16,v1=$v>>16,t=(u1*v0>>>0)+(u0*v0>>>16);return u1*v1+(t>>16)+((u0*v1>>>0)+(t&UINT16)>>16)}})},{"./_export":52}],283:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{isubh:function isubh(x0,x1,y0,y1){var $x0=x0>>>0,$x1=x1>>>0,$y0=y0>>>0;return $x1-(y1>>>0)-((~$x0&$y0|~($x0^$y0)&$x0-$y0>>>0)>>>31)|0}})},{"./_export":52}],284:[function(require,module,exports){var $export=require("./_export");$export($export.S,"Math",{umulh:function umulh(u,v){var UINT16=65535,$u=+u,$v=+v,u0=$u&UINT16,v0=$v&UINT16,u1=$u>>>16,v1=$v>>>16,t=(u1*v0>>>0)+(u0*v0>>>16);return u1*v1+(t>>>16)+((u0*v1>>>0)+(t&UINT16)>>>16)}})},{"./_export":52}],285:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),aFunction=require("./_a-function"),$defineProperty=require("./_object-dp");require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__defineGetter__:function __defineGetter__(P,getter){$defineProperty.f(toObject(this),P,{get:aFunction(getter),enumerable:true,configurable:true})}})},{"./_a-function":23,"./_descriptors":48,"./_export":52,"./_object-dp":87,"./_object-forced-pam":89,"./_to-object":129}],286:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),aFunction=require("./_a-function"),$defineProperty=require("./_object-dp");require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__defineSetter__:function __defineSetter__(P,setter){$defineProperty.f(toObject(this),P,{set:aFunction(setter),enumerable:true,configurable:true})}})},{"./_a-function":23,"./_descriptors":48,"./_export":52,"./_object-dp":87,"./_object-forced-pam":89,"./_to-object":129}],287:[function(require,module,exports){var $export=require("./_export"),$entries=require("./_object-to-array")(true);$export($export.S,"Object",{entries:function entries(it){return $entries(it)}})},{"./_export":52,"./_object-to-array":99}],288:[function(require,module,exports){var $export=require("./_export"),ownKeys=require("./_own-keys"),toIObject=require("./_to-iobject"),gOPD=require("./_object-gopd"),createProperty=require("./_create-property");$export($export.S,"Object",{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var O=toIObject(object),getDesc=gOPD.f,keys=ownKeys(O),result={},i=0,key;while(keys.length>i)createProperty(result,key=keys[i++],getDesc(O,key));return result}})},{"./_create-property":44,"./_export":52,"./_object-gopd":90,"./_own-keys":100,"./_to-iobject":127}],289:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive"),getPrototypeOf=require("./_object-gpo"),getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__lookupGetter__:function __lookupGetter__(P){var O=toObject(this),K=toPrimitive(P,true),D;do{if(D=getOwnPropertyDescriptor(O,K))return D.get}while(O=getPrototypeOf(O))}})},{"./_descriptors":48,"./_export":52,"./_object-forced-pam":89,"./_object-gopd":90,"./_object-gpo":94,"./_to-object":129,"./_to-primitive":130}],290:[function(require,module,exports){"use strict";var $export=require("./_export"),toObject=require("./_to-object"),toPrimitive=require("./_to-primitive"),getPrototypeOf=require("./_object-gpo"),getOwnPropertyDescriptor=require("./_object-gopd").f;require("./_descriptors")&&$export($export.P+require("./_object-forced-pam"),"Object",{__lookupSetter__:function __lookupSetter__(P){var O=toObject(this),K=toPrimitive(P,true),D;do{if(D=getOwnPropertyDescriptor(O,K))return D.set}while(O=getPrototypeOf(O))}})},{"./_descriptors":48,"./_export":52,"./_object-forced-pam":89,"./_object-gopd":90,"./_object-gpo":94,"./_to-object":129,"./_to-primitive":130}],291:[function(require,module,exports){var $export=require("./_export"),$values=require("./_object-to-array")(false);$export($export.S,"Object",{values:function values(it){return $values(it)}})},{"./_export":52,"./_object-to-array":99}],292:[function(require,module,exports){"use strict";var $export=require("./_export"),global=require("./_global"),core=require("./_core"),microtask=require("./_microtask")(),OBSERVABLE=require("./_wks")("observable"),aFunction=require("./_a-function"),anObject=require("./_an-object"),anInstance=require("./_an-instance"),redefineAll=require("./_redefine-all"),hide=require("./_hide"),forOf=require("./_for-of"),RETURN=forOf.RETURN;var getMethod=function(fn){return fn==null?undefined:aFunction(fn)};var cleanupSubscription=function(subscription){var cleanup=subscription._c;if(cleanup){subscription._c=undefined;cleanup()}};var subscriptionClosed=function(subscription){return subscription._o===undefined};var closeSubscription=function(subscription){if(!subscriptionClosed(subscription)){subscription._o=undefined;cleanupSubscription(subscription)}};var Subscription=function(observer,subscriber){anObject(observer);this._c=undefined;this._o=observer;observer=new SubscriptionObserver(this);try{var cleanup=subscriber(observer),subscription=cleanup;if(cleanup!=null){if(typeof cleanup.unsubscribe==="function")cleanup=function(){subscription.unsubscribe()};else aFunction(cleanup);this._c=cleanup}}catch(e){observer.error(e);return}if(subscriptionClosed(this))cleanupSubscription(this)};Subscription.prototype=redefineAll({},{unsubscribe:function unsubscribe(){closeSubscription(this)}});var SubscriptionObserver=function(subscription){this._s=subscription};SubscriptionObserver.prototype=redefineAll({},{next:function next(value){var subscription=this._s;if(!subscriptionClosed(subscription)){var observer=subscription._o;try{var m=getMethod(observer.next);if(m)return m.call(observer,value)}catch(e){try{closeSubscription(subscription)}finally{throw e}}}},error:function error(value){var subscription=this._s;if(subscriptionClosed(subscription))throw value;var observer=subscription._o;subscription._o=undefined;try{var m=getMethod(observer.error);if(!m)throw value;value=m.call(observer,value)}catch(e){try{cleanupSubscription(subscription)}finally{throw e}}cleanupSubscription(subscription);return value},complete:function complete(value){var subscription=this._s;if(!subscriptionClosed(subscription)){var observer=subscription._o;subscription._o=undefined;try{var m=getMethod(observer.complete);value=m?m.call(observer,value):undefined}catch(e){try{cleanupSubscription(subscription)}finally{throw e}}cleanupSubscription(subscription);return value}}});var $Observable=function Observable(subscriber){anInstance(this,$Observable,"Observable","_f")._f=aFunction(subscriber)};redefineAll($Observable.prototype,{subscribe:function subscribe(observer){return new Subscription(observer,this._f)},forEach:function forEach(fn){var that=this;return new(core.Promise||global.Promise)(function(resolve,reject){aFunction(fn);var subscription=that.subscribe({next:function(value){try{return fn(value)}catch(e){reject(e);subscription.unsubscribe()}},error:reject,complete:resolve})})}});redefineAll($Observable,{from:function from(x){var C=typeof this==="function"?this:$Observable;var method=getMethod(anObject(x)[OBSERVABLE]);if(method){var observable=anObject(method.call(x));return observable.constructor===C?observable:new C(function(observer){return observable.subscribe(observer)})}return new C(function(observer){var done=false;microtask(function(){if(!done){try{if(forOf(x,false,function(it){observer.next(it);if(done)return RETURN})===RETURN)return}catch(e){if(done)throw e;observer.error(e);return}observer.complete()}});return function(){done=true}})},of:function of(){for(var i=0,l=arguments.length,items=Array(l);i<l;)items[i]=arguments[i++];return new(typeof this==="function"?this:$Observable)(function(observer){var done=false;microtask(function(){if(!done){for(var i=0;i<items.length;++i){observer.next(items[i]);if(done)return}observer.complete()}});return function(){done=true}})}});hide($Observable.prototype,OBSERVABLE,function(){return this});$export($export.G,{Observable:$Observable});require("./_set-species")("Observable")},{"./_a-function":23,"./_an-instance":26,"./_an-object":27,"./_core":43,"./_export":52,"./_for-of":57,"./_global":58,"./_hide":60,"./_microtask":84,"./_redefine-all":106,"./_set-species":111,"./_wks":137}],293:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),toMetaKey=metadata.key,ordinaryDefineOwnMetadata=metadata.set;metadata.exp({defineMetadata:function defineMetadata(metadataKey,metadataValue,target,targetKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,anObject(target),toMetaKey(targetKey))}})},{"./_an-object":27,"./_metadata":83}],294:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),toMetaKey=metadata.key,getOrCreateMetadataMap=metadata.map,store=metadata.store;metadata.exp({deleteMetadata:function deleteMetadata(metadataKey,target){var targetKey=arguments.length<3?undefined:toMetaKey(arguments[2]),metadataMap=getOrCreateMetadataMap(anObject(target),targetKey,false);if(metadataMap===undefined||!metadataMap["delete"](metadataKey))return false;if(metadataMap.size)return true;var targetMetadata=store.get(target);targetMetadata["delete"](targetKey);return!!targetMetadata.size||store["delete"](target)}})},{"./_an-object":27,"./_metadata":83}],295:[function(require,module,exports){var Set=require("./es6.set"),from=require("./_array-from-iterable"),metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryOwnMetadataKeys=metadata.keys,toMetaKey=metadata.key;var ordinaryMetadataKeys=function(O,P){var oKeys=ordinaryOwnMetadataKeys(O,P),parent=getPrototypeOf(O);if(parent===null)return oKeys;var pKeys=ordinaryMetadataKeys(parent,P);return pKeys.length?oKeys.length?from(new Set(oKeys.concat(pKeys))):pKeys:oKeys};metadata.exp({getMetadataKeys:function getMetadataKeys(target){return ordinaryMetadataKeys(anObject(target),arguments.length<2?undefined:toMetaKey(arguments[1]))}})},{"./_an-object":27,"./_array-from-iterable":30,"./_metadata":83,"./_object-gpo":94,"./es6.set":240}],296:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryHasOwnMetadata=metadata.has,ordinaryGetOwnMetadata=metadata.get,toMetaKey=metadata.key;var ordinaryGetMetadata=function(MetadataKey,O,P){var hasOwn=ordinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return ordinaryGetOwnMetadata(MetadataKey,O,P);var parent=getPrototypeOf(O);return parent!==null?ordinaryGetMetadata(MetadataKey,parent,P):undefined};metadata.exp({getMetadata:function getMetadata(metadataKey,target){return ordinaryGetMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":27,"./_metadata":83,"./_object-gpo":94}],297:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryOwnMetadataKeys=metadata.keys,toMetaKey=metadata.key;metadata.exp({getOwnMetadataKeys:function getOwnMetadataKeys(target){return ordinaryOwnMetadataKeys(anObject(target),arguments.length<2?undefined:toMetaKey(arguments[1]))}})},{"./_an-object":27,"./_metadata":83}],298:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryGetOwnMetadata=metadata.get,toMetaKey=metadata.key;metadata.exp({getOwnMetadata:function getOwnMetadata(metadataKey,target){return ordinaryGetOwnMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":27,"./_metadata":83}],299:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),getPrototypeOf=require("./_object-gpo"),ordinaryHasOwnMetadata=metadata.has,toMetaKey=metadata.key;var ordinaryHasMetadata=function(MetadataKey,O,P){var hasOwn=ordinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return true;var parent=getPrototypeOf(O);return parent!==null?ordinaryHasMetadata(MetadataKey,parent,P):false};metadata.exp({hasMetadata:function hasMetadata(metadataKey,target){return ordinaryHasMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":27,"./_metadata":83,"./_object-gpo":94}],300:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),ordinaryHasOwnMetadata=metadata.has,toMetaKey=metadata.key;metadata.exp({hasOwnMetadata:function hasOwnMetadata(metadataKey,target){return ordinaryHasOwnMetadata(metadataKey,anObject(target),arguments.length<3?undefined:toMetaKey(arguments[2]))}})},{"./_an-object":27,"./_metadata":83}],301:[function(require,module,exports){var metadata=require("./_metadata"),anObject=require("./_an-object"),aFunction=require("./_a-function"),toMetaKey=metadata.key,ordinaryDefineOwnMetadata=metadata.set;metadata.exp({metadata:function metadata(metadataKey,metadataValue){return function decorator(target,targetKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,(targetKey!==undefined?anObject:aFunction)(target),toMetaKey(targetKey))}}})},{"./_a-function":23,"./_an-object":27,"./_metadata":83}],302:[function(require,module,exports){var $export=require("./_export");$export($export.P+$export.R,"Set",{toJSON:require("./_collection-to-json")("Set")})},{"./_collection-to-json":40,"./_export":52}],303:[function(require,module,exports){"use strict";var $export=require("./_export"),$at=require("./_string-at")(true);$export($export.P,"String",{at:function at(pos){return $at(this,pos)}})},{"./_export":52,"./_string-at":117}],304:[function(require,module,exports){"use strict";var $export=require("./_export"),defined=require("./_defined"),toLength=require("./_to-length"),isRegExp=require("./_is-regexp"),getFlags=require("./_flags"),RegExpProto=RegExp.prototype;var $RegExpStringIterator=function(regexp,string){this._r=regexp;this._s=string};require("./_iter-create")($RegExpStringIterator,"RegExp String",function next(){var match=this._r.exec(this._s);return{value:match,done:match===null}});$export($export.P,"String",{matchAll:function matchAll(regexp){defined(this);if(!isRegExp(regexp))throw TypeError(regexp+" is not a regexp!");var S=String(this),flags="flags"in RegExpProto?String(regexp.flags):getFlags.call(regexp),rx=new RegExp(regexp.source,~flags.indexOf("g")?flags:"g"+flags);rx.lastIndex=toLength(regexp.lastIndex);return new $RegExpStringIterator(rx,S)}})},{"./_defined":47,"./_export":52,"./_flags":56,"./_is-regexp":70,"./_iter-create":72,"./_to-length":128}],305:[function(require,module,exports){"use strict";var $export=require("./_export"),$pad=require("./_string-pad");$export($export.P,"String",{padEnd:function padEnd(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,false)}})},{"./_export":52,"./_string-pad":120}],306:[function(require,module,exports){"use strict";var $export=require("./_export"),$pad=require("./_string-pad");$export($export.P,"String",{padStart:function padStart(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,true)}})},{"./_export":52,"./_string-pad":120}],307:[function(require,module,exports){"use strict";require("./_string-trim")("trimLeft",function($trim){return function trimLeft(){return $trim(this,1)}},"trimStart")},{"./_string-trim":122}],308:[function(require,module,exports){"use strict";require("./_string-trim")("trimRight",function($trim){return function trimRight(){return $trim(this,2)}},"trimEnd")},{"./_string-trim":122}],309:[function(require,module,exports){require("./_wks-define")("asyncIterator")},{"./_wks-define":135}],310:[function(require,module,exports){require("./_wks-define")("observable")},{"./_wks-define":135}],311:[function(require,module,exports){var $export=require("./_export");$export($export.S,"System",{global:require("./_global")})},{"./_export":52,"./_global":58}],312:[function(require,module,exports){var $iterators=require("./es6.array.iterator"),redefine=require("./_redefine"),global=require("./_global"),hide=require("./_hide"),Iterators=require("./_iterators"),wks=require("./_wks"),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array;for(var collections=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var NAME=collections[i],Collection=global[NAME],proto=Collection&&Collection.prototype,key;if(proto){if(!proto[ITERATOR])hide(proto,ITERATOR,ArrayValues);if(!proto[TO_STRING_TAG])hide(proto,TO_STRING_TAG,NAME);Iterators[NAME]=ArrayValues;for(key in $iterators)if(!proto[key])redefine(proto,key,$iterators[key],true)}}},{"./_global":58,"./_hide":60,"./_iterators":76,"./_redefine":107,"./_wks":137,"./es6.array.iterator":150}],313:[function(require,module,exports){var $export=require("./_export"),$task=require("./_task");$export($export.G+$export.B,{setImmediate:$task.set,clearImmediate:$task.clear})},{"./_export":52,"./_task":124}],314:[function(require,module,exports){var global=require("./_global"),$export=require("./_export"),invoke=require("./_invoke"),partial=require("./_partial"),navigator=global.navigator,MSIE=!!navigator&&/MSIE .\./.test(navigator.userAgent);var wrap=function(set){return MSIE?function(fn,time){return set(invoke(partial,[].slice.call(arguments,2),typeof fn=="function"?fn:Function(fn)),time)}:set};$export($export.G+$export.B+$export.F*MSIE,{setTimeout:wrap(global.setTimeout),setInterval:wrap(global.setInterval)})},{"./_export":52,"./_global":58,"./_invoke":64,"./_partial":103}],315:[function(require,module,exports){require("./modules/es6.symbol");require("./modules/es6.object.create");require("./modules/es6.object.define-property");require("./modules/es6.object.define-properties");require("./modules/es6.object.get-own-property-descriptor");require("./modules/es6.object.get-prototype-of");require("./modules/es6.object.keys");require("./modules/es6.object.get-own-property-names");require("./modules/es6.object.freeze");require("./modules/es6.object.seal");require("./modules/es6.object.prevent-extensions");require("./modules/es6.object.is-frozen");require("./modules/es6.object.is-sealed");require("./modules/es6.object.is-extensible");require("./modules/es6.object.assign");require("./modules/es6.object.is");require("./modules/es6.object.set-prototype-of");require("./modules/es6.object.to-string");require("./modules/es6.function.bind");require("./modules/es6.function.name");require("./modules/es6.function.has-instance");require("./modules/es6.parse-int");require("./modules/es6.parse-float");require("./modules/es6.number.constructor");require("./modules/es6.number.to-fixed");require("./modules/es6.number.to-precision");require("./modules/es6.number.epsilon");require("./modules/es6.number.is-finite");require("./modules/es6.number.is-integer");require("./modules/es6.number.is-nan");require("./modules/es6.number.is-safe-integer");require("./modules/es6.number.max-safe-integer");require("./modules/es6.number.min-safe-integer");require("./modules/es6.number.parse-float");require("./modules/es6.number.parse-int");require("./modules/es6.math.acosh");require("./modules/es6.math.asinh");require("./modules/es6.math.atanh");require("./modules/es6.math.cbrt");require("./modules/es6.math.clz32");require("./modules/es6.math.cosh");require("./modules/es6.math.expm1");require("./modules/es6.math.fround");require("./modules/es6.math.hypot");require("./modules/es6.math.imul");require("./modules/es6.math.log10");require("./modules/es6.math.log1p");require("./modules/es6.math.log2");require("./modules/es6.math.sign");require("./modules/es6.math.sinh");require("./modules/es6.math.tanh");require("./modules/es6.math.trunc");require("./modules/es6.string.from-code-point");require("./modules/es6.string.raw");require("./modules/es6.string.trim");require("./modules/es6.string.iterator");require("./modules/es6.string.code-point-at");require("./modules/es6.string.ends-with");require("./modules/es6.string.includes");require("./modules/es6.string.repeat");require("./modules/es6.string.starts-with");require("./modules/es6.string.anchor");require("./modules/es6.string.big");require("./modules/es6.string.blink");require("./modules/es6.string.bold");require("./modules/es6.string.fixed");require("./modules/es6.string.fontcolor");require("./modules/es6.string.fontsize");require("./modules/es6.string.italics");require("./modules/es6.string.link");require("./modules/es6.string.small");require("./modules/es6.string.strike");require("./modules/es6.string.sub");require("./modules/es6.string.sup");require("./modules/es6.date.now");require("./modules/es6.date.to-json");require("./modules/es6.date.to-iso-string");require("./modules/es6.date.to-string");require("./modules/es6.date.to-primitive");require("./modules/es6.array.is-array");require("./modules/es6.array.from");require("./modules/es6.array.of");require("./modules/es6.array.join");require("./modules/es6.array.slice");require("./modules/es6.array.sort");require("./modules/es6.array.for-each");require("./modules/es6.array.map");require("./modules/es6.array.filter");require("./modules/es6.array.some");require("./modules/es6.array.every");require("./modules/es6.array.reduce");require("./modules/es6.array.reduce-right");require("./modules/es6.array.index-of");require("./modules/es6.array.last-index-of");require("./modules/es6.array.copy-within");require("./modules/es6.array.fill");require("./modules/es6.array.find");require("./modules/es6.array.find-index");require("./modules/es6.array.species");require("./modules/es6.array.iterator");require("./modules/es6.regexp.constructor");require("./modules/es6.regexp.to-string");require("./modules/es6.regexp.flags");require("./modules/es6.regexp.match");require("./modules/es6.regexp.replace");require("./modules/es6.regexp.search");require("./modules/es6.regexp.split");require("./modules/es6.promise");require("./modules/es6.map");require("./modules/es6.set");require("./modules/es6.weak-map");require("./modules/es6.weak-set");require("./modules/es6.typed.array-buffer");require("./modules/es6.typed.data-view");require("./modules/es6.typed.int8-array");require("./modules/es6.typed.uint8-array");require("./modules/es6.typed.uint8-clamped-array");require("./modules/es6.typed.int16-array");require("./modules/es6.typed.uint16-array");require("./modules/es6.typed.int32-array");require("./modules/es6.typed.uint32-array");require("./modules/es6.typed.float32-array");require("./modules/es6.typed.float64-array");require("./modules/es6.reflect.apply");require("./modules/es6.reflect.construct");require("./modules/es6.reflect.define-property");require("./modules/es6.reflect.delete-property");require("./modules/es6.reflect.enumerate");require("./modules/es6.reflect.get");require("./modules/es6.reflect.get-own-property-descriptor");require("./modules/es6.reflect.get-prototype-of");require("./modules/es6.reflect.has");require("./modules/es6.reflect.is-extensible");require("./modules/es6.reflect.own-keys");require("./modules/es6.reflect.prevent-extensions");require("./modules/es6.reflect.set");require("./modules/es6.reflect.set-prototype-of");require("./modules/es7.array.includes");require("./modules/es7.string.at");require("./modules/es7.string.pad-start");require("./modules/es7.string.pad-end");require("./modules/es7.string.trim-left");require("./modules/es7.string.trim-right");require("./modules/es7.string.match-all");require("./modules/es7.symbol.async-iterator");require("./modules/es7.symbol.observable");require("./modules/es7.object.get-own-property-descriptors");require("./modules/es7.object.values");require("./modules/es7.object.entries");require("./modules/es7.object.define-getter");require("./modules/es7.object.define-setter");require("./modules/es7.object.lookup-getter");require("./modules/es7.object.lookup-setter");require("./modules/es7.map.to-json");require("./modules/es7.set.to-json");require("./modules/es7.system.global");require("./modules/es7.error.is-error");require("./modules/es7.math.iaddh");require("./modules/es7.math.isubh");require("./modules/es7.math.imulh");require("./modules/es7.math.umulh");require("./modules/es7.reflect.define-metadata");require("./modules/es7.reflect.delete-metadata");require("./modules/es7.reflect.get-metadata");require("./modules/es7.reflect.get-metadata-keys");require("./modules/es7.reflect.get-own-metadata");require("./modules/es7.reflect.get-own-metadata-keys");require("./modules/es7.reflect.has-metadata");require("./modules/es7.reflect.has-own-metadata");require("./modules/es7.reflect.metadata");require("./modules/es7.asap");require("./modules/es7.observable");require("./modules/web.timers");require("./modules/web.immediate");require("./modules/web.dom.iterable");module.exports=require("./modules/_core")},{"./modules/_core":43,"./modules/es6.array.copy-within":140,"./modules/es6.array.every":141,"./modules/es6.array.fill":142,"./modules/es6.array.filter":143,"./modules/es6.array.find":145,"./modules/es6.array.find-index":144,"./modules/es6.array.for-each":146,"./modules/es6.array.from":147,"./modules/es6.array.index-of":148,"./modules/es6.array.is-array":149,"./modules/es6.array.iterator":150,"./modules/es6.array.join":151,"./modules/es6.array.last-index-of":152,"./modules/es6.array.map":153,"./modules/es6.array.of":154,"./modules/es6.array.reduce":156,"./modules/es6.array.reduce-right":155,"./modules/es6.array.slice":157,"./modules/es6.array.some":158,"./modules/es6.array.sort":159,"./modules/es6.array.species":160,"./modules/es6.date.now":161,"./modules/es6.date.to-iso-string":162,"./modules/es6.date.to-json":163,"./modules/es6.date.to-primitive":164,"./modules/es6.date.to-string":165,"./modules/es6.function.bind":166,"./modules/es6.function.has-instance":167,"./modules/es6.function.name":168,"./modules/es6.map":169,"./modules/es6.math.acosh":170,"./modules/es6.math.asinh":171,"./modules/es6.math.atanh":172,"./modules/es6.math.cbrt":173,"./modules/es6.math.clz32":174,"./modules/es6.math.cosh":175,"./modules/es6.math.expm1":176,"./modules/es6.math.fround":177,"./modules/es6.math.hypot":178,"./modules/es6.math.imul":179,"./modules/es6.math.log10":180,"./modules/es6.math.log1p":181,"./modules/es6.math.log2":182,"./modules/es6.math.sign":183,"./modules/es6.math.sinh":184,"./modules/es6.math.tanh":185,"./modules/es6.math.trunc":186,"./modules/es6.number.constructor":187,"./modules/es6.number.epsilon":188,"./modules/es6.number.is-finite":189,"./modules/es6.number.is-integer":190,"./modules/es6.number.is-nan":191,"./modules/es6.number.is-safe-integer":192,"./modules/es6.number.max-safe-integer":193,"./modules/es6.number.min-safe-integer":194,"./modules/es6.number.parse-float":195,"./modules/es6.number.parse-int":196,"./modules/es6.number.to-fixed":197,"./modules/es6.number.to-precision":198,"./modules/es6.object.assign":199,"./modules/es6.object.create":200,"./modules/es6.object.define-properties":201,"./modules/es6.object.define-property":202,"./modules/es6.object.freeze":203,"./modules/es6.object.get-own-property-descriptor":204,"./modules/es6.object.get-own-property-names":205,"./modules/es6.object.get-prototype-of":206,"./modules/es6.object.is":210,"./modules/es6.object.is-extensible":207,"./modules/es6.object.is-frozen":208,"./modules/es6.object.is-sealed":209,"./modules/es6.object.keys":211,"./modules/es6.object.prevent-extensions":212,"./modules/es6.object.seal":213,"./modules/es6.object.set-prototype-of":214,"./modules/es6.object.to-string":215,"./modules/es6.parse-float":216,
"./modules/es6.parse-int":217,"./modules/es6.promise":218,"./modules/es6.reflect.apply":219,"./modules/es6.reflect.construct":220,"./modules/es6.reflect.define-property":221,"./modules/es6.reflect.delete-property":222,"./modules/es6.reflect.enumerate":223,"./modules/es6.reflect.get":226,"./modules/es6.reflect.get-own-property-descriptor":224,"./modules/es6.reflect.get-prototype-of":225,"./modules/es6.reflect.has":227,"./modules/es6.reflect.is-extensible":228,"./modules/es6.reflect.own-keys":229,"./modules/es6.reflect.prevent-extensions":230,"./modules/es6.reflect.set":232,"./modules/es6.reflect.set-prototype-of":231,"./modules/es6.regexp.constructor":233,"./modules/es6.regexp.flags":234,"./modules/es6.regexp.match":235,"./modules/es6.regexp.replace":236,"./modules/es6.regexp.search":237,"./modules/es6.regexp.split":238,"./modules/es6.regexp.to-string":239,"./modules/es6.set":240,"./modules/es6.string.anchor":241,"./modules/es6.string.big":242,"./modules/es6.string.blink":243,"./modules/es6.string.bold":244,"./modules/es6.string.code-point-at":245,"./modules/es6.string.ends-with":246,"./modules/es6.string.fixed":247,"./modules/es6.string.fontcolor":248,"./modules/es6.string.fontsize":249,"./modules/es6.string.from-code-point":250,"./modules/es6.string.includes":251,"./modules/es6.string.italics":252,"./modules/es6.string.iterator":253,"./modules/es6.string.link":254,"./modules/es6.string.raw":255,"./modules/es6.string.repeat":256,"./modules/es6.string.small":257,"./modules/es6.string.starts-with":258,"./modules/es6.string.strike":259,"./modules/es6.string.sub":260,"./modules/es6.string.sup":261,"./modules/es6.string.trim":262,"./modules/es6.symbol":263,"./modules/es6.typed.array-buffer":264,"./modules/es6.typed.data-view":265,"./modules/es6.typed.float32-array":266,"./modules/es6.typed.float64-array":267,"./modules/es6.typed.int16-array":268,"./modules/es6.typed.int32-array":269,"./modules/es6.typed.int8-array":270,"./modules/es6.typed.uint16-array":271,"./modules/es6.typed.uint32-array":272,"./modules/es6.typed.uint8-array":273,"./modules/es6.typed.uint8-clamped-array":274,"./modules/es6.weak-map":275,"./modules/es6.weak-set":276,"./modules/es7.array.includes":277,"./modules/es7.asap":278,"./modules/es7.error.is-error":279,"./modules/es7.map.to-json":280,"./modules/es7.math.iaddh":281,"./modules/es7.math.imulh":282,"./modules/es7.math.isubh":283,"./modules/es7.math.umulh":284,"./modules/es7.object.define-getter":285,"./modules/es7.object.define-setter":286,"./modules/es7.object.entries":287,"./modules/es7.object.get-own-property-descriptors":288,"./modules/es7.object.lookup-getter":289,"./modules/es7.object.lookup-setter":290,"./modules/es7.object.values":291,"./modules/es7.observable":292,"./modules/es7.reflect.define-metadata":293,"./modules/es7.reflect.delete-metadata":294,"./modules/es7.reflect.get-metadata":296,"./modules/es7.reflect.get-metadata-keys":295,"./modules/es7.reflect.get-own-metadata":298,"./modules/es7.reflect.get-own-metadata-keys":297,"./modules/es7.reflect.has-metadata":299,"./modules/es7.reflect.has-own-metadata":300,"./modules/es7.reflect.metadata":301,"./modules/es7.set.to-json":302,"./modules/es7.string.at":303,"./modules/es7.string.match-all":304,"./modules/es7.string.pad-end":305,"./modules/es7.string.pad-start":306,"./modules/es7.string.trim-left":307,"./modules/es7.string.trim-right":308,"./modules/es7.symbol.async-iterator":309,"./modules/es7.symbol.observable":310,"./modules/es7.system.global":311,"./modules/web.dom.iterable":312,"./modules/web.immediate":313,"./modules/web.timers":314}],316:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":360}],317:[function(require,module,exports){"use strict";var createThunk=require("./lib/thunk.js");function Procedure(){this.argTypes=[];this.shimArgs=[];this.arrayArgs=[];this.arrayBlockIndices=[];this.scalarArgs=[];this.offsetArgs=[];this.offsetArgIndex=[];this.indexArgs=[];this.shapeArgs=[];this.funcName="";this.pre=null;this.body=null;this.post=null;this.debug=false}function compileCwise(user_args){var proc=new Procedure;proc.pre=user_args.pre;proc.body=user_args.body;proc.post=user_args.post;var proc_args=user_args.args.slice(0);proc.argTypes=proc_args;for(var i=0;i<proc_args.length;++i){var arg_type=proc_args[i];if(arg_type==="array"||typeof arg_type==="object"&&arg_type.blockIndices){proc.argTypes[i]="array";proc.arrayArgs.push(i);proc.arrayBlockIndices.push(arg_type.blockIndices?arg_type.blockIndices:0);proc.shimArgs.push("array"+i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array args")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array args")}}else if(arg_type==="scalar"){proc.scalarArgs.push(i);proc.shimArgs.push("scalar"+i)}else if(arg_type==="index"){proc.indexArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array index")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array index")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array index")}}else if(arg_type==="shape"){proc.shapeArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].lvalue){throw new Error("cwise: pre() block may not write to array shape")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array shape")}if(i<proc.post.args.length&&proc.post.args[i].lvalue){throw new Error("cwise: post() block may not write to array shape")}}else if(typeof arg_type==="object"&&arg_type.offset){proc.argTypes[i]="offset";proc.offsetArgs.push({array:arg_type.array,offset:arg_type.offset});proc.offsetArgIndex.push(i)}else{throw new Error("cwise: Unknown argument type "+proc_args[i])}}if(proc.arrayArgs.length<=0){throw new Error("cwise: No array arguments specified")}if(proc.pre.args.length>proc_args.length){throw new Error("cwise: Too many arguments in pre() block")}if(proc.body.args.length>proc_args.length){throw new Error("cwise: Too many arguments in body() block")}if(proc.post.args.length>proc_args.length){throw new Error("cwise: Too many arguments in post() block")}proc.debug=!!user_args.printCode||!!user_args.debug;proc.funcName=user_args.funcName||"cwise";proc.blockSize=user_args.blockSize||64;return createThunk(proc)}module.exports=compileCwise},{"./lib/thunk.js":319}],318:[function(require,module,exports){"use strict";var uniq=require("uniq");function innerFill(order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,has_index=proc.indexArgs.length>0,code=[],vars=[],idx=0,pidx=0,i,j;for(i=0;i<dimension;++i){vars.push(["i",i,"=0"].join(""))}for(j=0;j<nargs;++j){for(i=0;i<dimension;++i){pidx=idx;idx=order[i];if(i===0){vars.push(["d",j,"s",i,"=t",j,"p",idx].join(""))}else{vars.push(["d",j,"s",i,"=(t",j,"p",idx,"-s",pidx,"*t",j,"p",pidx,")"].join(""))}}}code.push("var "+vars.join(","));for(i=dimension-1;i>=0;--i){idx=order[i];code.push(["for(i",i,"=0;i",i,"<s",idx,";++i",i,"){"].join(""))}code.push(body);for(i=0;i<dimension;++i){pidx=idx;idx=order[i];for(j=0;j<nargs;++j){code.push(["p",j,"+=d",j,"s",i].join(""))}if(has_index){if(i>0){code.push(["index[",pidx,"]-=s",pidx].join(""))}code.push(["++index[",idx,"]"].join(""))}code.push("}")}return code.join("\n")}function outerFill(matched,order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,blockSize=proc.blockSize,has_index=proc.indexArgs.length>0,code=[];for(var i=0;i<nargs;++i){code.push(["var offset",i,"=p",i].join(""))}for(var i=matched;i<dimension;++i){code.push(["for(var j"+i+"=SS[",order[i],"]|0;j",i,">0;){"].join(""));code.push(["if(j",i,"<",blockSize,"){"].join(""));code.push(["s",order[i],"=j",i].join(""));code.push(["j",i,"=0"].join(""));code.push(["}else{s",order[i],"=",blockSize].join(""));code.push(["j",i,"-=",blockSize,"}"].join(""));if(has_index){code.push(["index[",order[i],"]=j",i].join(""))}}for(var i=0;i<nargs;++i){var indexStr=["offset"+i];for(var j=matched;j<dimension;++j){indexStr.push(["j",j,"*t",i,"p",order[j]].join(""))}code.push(["p",i,"=(",indexStr.join("+"),")"].join(""))}code.push(innerFill(order,proc,body));for(var i=matched;i<dimension;++i){code.push("}")}return code.join("\n")}function countMatches(orders){var matched=0,dimension=orders[0].length;while(matched<dimension){for(var j=1;j<orders.length;++j){if(orders[j][matched]!==orders[0][matched]){return matched}}++matched}return matched}function processBlock(block,proc,dtypes){var code=block.body;var pre=[];var post=[];for(var i=0;i<block.args.length;++i){var carg=block.args[i];if(carg.count<=0){continue}var re=new RegExp(carg.name,"g");var ptrStr="";var arrNum=proc.arrayArgs.indexOf(i);switch(proc.argTypes[i]){case"offset":var offArgIndex=proc.offsetArgIndex.indexOf(i);var offArg=proc.offsetArgs[offArgIndex];arrNum=offArg.array;ptrStr="+q"+offArgIndex;case"array":ptrStr="p"+arrNum+ptrStr;var localStr="l"+i;var arrStr="a"+arrNum;if(proc.arrayBlockIndices[arrNum]===0){if(carg.count===1){if(dtypes[arrNum]==="generic"){if(carg.lvalue){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}else{code=code.replace(re,[arrStr,".get(",ptrStr,")"].join(""))}}else{code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}}else if(dtypes[arrNum]==="generic"){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}}else{pre.push(["var ",localStr,"=",arrStr,"[",ptrStr,"]"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,"[",ptrStr,"]=",localStr].join(""))}}}else{var reStrArr=[carg.name],ptrStrArr=[ptrStr];for(var j=0;j<Math.abs(proc.arrayBlockIndices[arrNum]);j++){reStrArr.push("\\s*\\[([^\\]]+)\\]");ptrStrArr.push("$"+(j+1)+"*t"+arrNum+"b"+j)}re=new RegExp(reStrArr.join(""),"g");ptrStr=ptrStrArr.join("+");if(dtypes[arrNum]==="generic"){throw new Error("cwise: Generic arrays not supported in combination with blocks!")}else{code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}}break;case"scalar":code=code.replace(re,"Y"+proc.scalarArgs.indexOf(i));break;case"index":code=code.replace(re,"index");break;case"shape":code=code.replace(re,"shape");break}}return[pre.join("\n"),code,post.join("\n")].join("\n").trim()}function typeSummary(dtypes){var summary=new Array(dtypes.length);var allEqual=true;for(var i=0;i<dtypes.length;++i){var t=dtypes[i];var digits=t.match(/\d+/);if(!digits){digits=""}else{digits=digits[0]}if(t.charAt(0)===0){summary[i]="u"+t.charAt(1)+digits}else{summary[i]=t.charAt(0)+digits}if(i>0){allEqual=allEqual&&summary[i]===summary[i-1]}}if(allEqual){return summary[0]}return summary.join("")}function generateCWiseOp(proc,typesig){var dimension=typesig[1].length-Math.abs(proc.arrayBlockIndices[0])|0;var orders=new Array(proc.arrayArgs.length);var dtypes=new Array(proc.arrayArgs.length);for(var i=0;i<proc.arrayArgs.length;++i){dtypes[i]=typesig[2*i];orders[i]=typesig[2*i+1]}var blockBegin=[],blockEnd=[];var loopBegin=[],loopEnd=[];var loopOrders=[];for(var i=0;i<proc.arrayArgs.length;++i){if(proc.arrayBlockIndices[i]<0){loopBegin.push(0);loopEnd.push(dimension);blockBegin.push(dimension);blockEnd.push(dimension+proc.arrayBlockIndices[i])}else{loopBegin.push(proc.arrayBlockIndices[i]);loopEnd.push(proc.arrayBlockIndices[i]+dimension);blockBegin.push(0);blockEnd.push(proc.arrayBlockIndices[i])}var newOrder=[];for(var j=0;j<orders[i].length;j++){if(loopBegin[i]<=orders[i][j]&&orders[i][j]<loopEnd[i]){newOrder.push(orders[i][j]-loopBegin[i])}}loopOrders.push(newOrder)}var arglist=["SS"];var code=["'use strict'"];var vars=[];for(var j=0;j<dimension;++j){vars.push(["s",j,"=SS[",j,"]"].join(""))}for(var i=0;i<proc.arrayArgs.length;++i){arglist.push("a"+i);arglist.push("t"+i);arglist.push("p"+i);for(var j=0;j<dimension;++j){vars.push(["t",i,"p",j,"=t",i,"[",loopBegin[i]+j,"]"].join(""))}for(var j=0;j<Math.abs(proc.arrayBlockIndices[i]);++j){vars.push(["t",i,"b",j,"=t",i,"[",blockBegin[i]+j,"]"].join(""))}}for(var i=0;i<proc.scalarArgs.length;++i){arglist.push("Y"+i)}if(proc.shapeArgs.length>0){vars.push("shape=SS.slice(0)")}if(proc.indexArgs.length>0){var zeros=new Array(dimension);for(var i=0;i<dimension;++i){zeros[i]="0"}vars.push(["index=[",zeros.join(","),"]"].join(""))}for(var i=0;i<proc.offsetArgs.length;++i){var off_arg=proc.offsetArgs[i];var init_string=[];for(var j=0;j<off_arg.offset.length;++j){if(off_arg.offset[j]===0){continue}else if(off_arg.offset[j]===1){init_string.push(["t",off_arg.array,"p",j].join(""))}else{init_string.push([off_arg.offset[j],"*t",off_arg.array,"p",j].join(""))}}if(init_string.length===0){vars.push("q"+i+"=0")}else{vars.push(["q",i,"=",init_string.join("+")].join(""))}}var thisVars=uniq([].concat(proc.pre.thisVars).concat(proc.body.thisVars).concat(proc.post.thisVars));vars=vars.concat(thisVars);code.push("var "+vars.join(","));for(var i=0;i<proc.arrayArgs.length;++i){code.push("p"+i+"|=0")}if(proc.pre.body.length>3){code.push(processBlock(proc.pre,proc,dtypes))}var body=processBlock(proc.body,proc,dtypes);var matched=countMatches(loopOrders);if(matched<dimension){code.push(outerFill(matched,loopOrders[0],proc,body))}else{code.push(innerFill(loopOrders[0],proc,body))}if(proc.post.body.length>3){code.push(processBlock(proc.post,proc,dtypes))}if(proc.debug){console.log("-----Generated cwise routine for ",typesig,":\n"+code.join("\n")+"\n----------")}var loopName=[proc.funcName||"unnamed","_cwise_loop_",orders[0].join("s"),"m",matched,typeSummary(dtypes)].join("");var f=new Function(["function ",loopName,"(",arglist.join(","),"){",code.join("\n"),"} return ",loopName].join(""));return f()}module.exports=generateCWiseOp},{uniq:507}],319:[function(require,module,exports){"use strict";var compile=require("./compile.js");function createThunk(proc){var code=["'use strict'","var CACHED={}"];var vars=[];var thunkName=proc.funcName+"_cwise_thunk";code.push(["return function ",thunkName,"(",proc.shimArgs.join(","),"){"].join(""));var typesig=[];var string_typesig=[];var proc_args=[["array",proc.arrayArgs[0],".shape.slice(",Math.max(0,proc.arrayBlockIndices[0]),proc.arrayBlockIndices[0]<0?","+proc.arrayBlockIndices[0]+")":")"].join("")];var shapeLengthConditions=[],shapeConditions=[];for(var i=0;i<proc.arrayArgs.length;++i){var j=proc.arrayArgs[i];vars.push(["t",j,"=array",j,".dtype,","r",j,"=array",j,".order"].join(""));typesig.push("t"+j);typesig.push("r"+j);string_typesig.push("t"+j);string_typesig.push("r"+j+".join()");proc_args.push("array"+j+".data");proc_args.push("array"+j+".stride");proc_args.push("array"+j+".offset|0");if(i>0){shapeLengthConditions.push("array"+proc.arrayArgs[0]+".shape.length===array"+j+".shape.length+"+(Math.abs(proc.arrayBlockIndices[0])-Math.abs(proc.arrayBlockIndices[i])));shapeConditions.push("array"+proc.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[0])+"]===array"+j+".shape[shapeIndex+"+Math.max(0,proc.arrayBlockIndices[i])+"]")}}if(proc.arrayArgs.length>1){code.push("if (!("+shapeLengthConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')");code.push("for(var shapeIndex=array"+proc.arrayArgs[0]+".shape.length-"+Math.abs(proc.arrayBlockIndices[0])+"; shapeIndex-->0;) {");code.push("if (!("+shapeConditions.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')");code.push("}")}for(var i=0;i<proc.scalarArgs.length;++i){proc_args.push("scalar"+proc.scalarArgs[i])}vars.push(["type=[",string_typesig.join(","),"].join()"].join(""));vars.push("proc=CACHED[type]");code.push("var "+vars.join(","));code.push(["if(!proc){","CACHED[type]=proc=compile([",typesig.join(","),"])}","return proc(",proc_args.join(","),")}"].join(""));if(proc.debug){console.log("-----Generated thunk:\n"+code.join("\n")+"\n----------")}var thunk=new Function("compile",code.join("\n"));return thunk(compile.bind(undefined,proc))}module.exports=createThunk},{"./compile.js":318}],320:[function(require,module,exports){(function(Buffer){module.exports=dataUriToBuffer;function dataUriToBuffer(uri){if(!/^data\:/i.test(uri)){throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")')}uri=uri.replace(/\r?\n/g,"");var firstComma=uri.indexOf(",");if(-1===firstComma||firstComma<=4)throw new TypeError("malformed data: URI");var meta=uri.substring(5,firstComma).split(";");var base64=false;var charset="US-ASCII";for(var i=0;i<meta.length;i++){if("base64"==meta[i]){base64=true}else if(0==meta[i].indexOf("charset=")){charset=meta[i].substring(8)}}var data=unescape(uri.substring(firstComma+1));var encoding=base64?"base64":"ascii";var buffer=new Buffer(data,encoding);buffer.type=meta[0]||"text/plain";buffer.charset=charset;return buffer}}).call(this,require("buffer").Buffer)},{buffer:13}],321:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],322:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){
return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],323:[function(require,module,exports){var saveAs=saveAs||function(view){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,click=function(node){var event=new MouseEvent("click");node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,arbitrary_revoke_timeout=500,revoke=function(file){var revoker=function(){if(typeof file==="string"){get_URL().revokeObjectURL(file)}else{file.remove()}};if(view.chrome){revoker()}else{setTimeout(revoker,arbitrary_revoke_timeout)}},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}}},auto_bom=function(blob){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)){return new Blob(["\ufeff",blob],{type:blob.type})}return blob},FileSaver=function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(blob_changed||!object_url){object_url=get_URL().createObjectURL(blob)}if(target_view){target_view.location.href=object_url}else{var new_tab=view.open(object_url,"_blank");if(new_tab==undefined&&typeof safari!=="undefined"){view.location.href=object_url}}filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments)}}},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download"}if(can_use_save_link){object_url=get_URL().createObjectURL(blob);save_link.href=object_url;save_link.download=name;setTimeout(function(){click(save_link);dispatch_all();revoke(object_url);filesaver.readyState=filesaver.DONE});return}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true}if(webkit_req_fs&&name!=="download"){name+=".download"}if(type===force_saveable_type||webkit_req_fs){target_view=view}if(!req_fs){fs_error();return}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);revoke(file)};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error()}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE};filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:false},abortable(function(file){file.remove();save()}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save()}else{fs_error()}}))}),fs_error)}),fs_error)},FS_proto=FileSaver.prototype,saveAs=function(blob,name,no_auto_bom){return new FileSaver(blob,name,no_auto_bom)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}return navigator.msSaveOrOpenBlob(blob,name||"download")}}FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort")};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;return saveAs}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return saveAs})}},{}],324:[function(require,module,exports){module.exports=normalize;var types={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function normalize(gj){if(!gj||!gj.type)return null;var type=types[gj.type];if(!type)return null;if(type==="geometry"){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:gj}]}}else if(type==="feature"){return{type:"FeatureCollection",features:[gj]}}else if(type==="featurecollection"){return gj}}},{}],325:[function(require,module,exports){(function(Buffer,process){"use strict";var path=require("path");var ndarray=require("ndarray");var GifReader=require("omggif").GifReader;var pack=require("ndarray-pack");var through=require("through");var parseDataURI=require("data-uri-to-buffer");function defaultImage(url,cb){var img=new Image;img.crossOrigin="Anonymous";img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var context=canvas.getContext("2d");context.drawImage(img,0,0);var pixels=context.getImageData(0,0,img.width,img.height);cb(null,ndarray(new Uint8Array(pixels.data),[img.width,img.height,4],[4,4*img.width,1],0))};img.onerror=function(err){cb(err)};img.src=url}function handleGif(data,cb){var reader;try{reader=new GifReader(data)}catch(err){cb(err);return}if(reader.numFrames()>0){var nshape=[reader.numFrames(),reader.height,reader.width,4];var ndata=new Uint8Array(nshape[0]*nshape[1]*nshape[2]*nshape[3]);var result=ndarray(ndata,nshape);try{for(var i=0;i<reader.numFrames();++i){reader.decodeAndBlitFrameRGBA(i,ndata.subarray(result.index(i,0,0,0),result.index(i+1,0,0,0)))}}catch(err){cb(err);return}cb(null,result.transpose(0,2,1))}else{var nshape=[reader.height,reader.width,4];var ndata=new Uint8Array(nshape[0]*nshape[1]*nshape[2]);var result=ndarray(ndata,nshape);try{reader.decodeAndBlitFrameRGBA(0,ndata)}catch(err){cb(err);return}cb(null,result.transpose(1,0))}}function httpGif(url,cb){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("application/binary")}xhr.onerror=function(err){cb(err)};xhr.onload=function(){if(xhr.readyState!==4){return}var data=new Uint8Array(xhr.response);handleGif(data,cb);return};xhr.send()}function copyBuffer(buffer){if(buffer[0]===undefined){var n=buffer.length;var result=new Uint8Array(n);for(var i=0;i<n;++i){result[i]=buffer.get(i)}return result}else{return new Uint8Array(buffer)}}function dataGif(url,cb){process.nextTick(function(){try{var buffer=parseDataURI(url);if(buffer){handleGif(copyBuffer(buffer),cb)}else{cb(new Error("Error parsing data URI"))}}catch(err){cb(err)}})}module.exports=function getPixels(url,type,cb){if(!cb){cb=type;type=""}var ext=path.extname(url);switch(type||ext.toUpperCase()){case".GIF":httpGif(url,cb);break;default:if(Buffer.isBuffer(url)){url="data:"+type+";base64,"+url.toString("base64")}if(url.indexOf("data:image/gif;")===0){dataGif(url,cb)}else{defaultImage(url,cb)}}}}).call(this,{isBuffer:require("../is-buffer/index.js")},require("_process"))},{"../is-buffer/index.js":360,_process:488,"data-uri-to-buffer":320,ndarray:452,"ndarray-pack":450,omggif:453,path:465,through:506}],326:[function(require,module,exports){(function(Buffer){var assert=require("assert");var EventEmitter=require("events").EventEmitter;var ReadableStream=require("readable-stream");var util=require("util");var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteCapacitor(options){ReadableStream.call(this,options);this.okayToPush=true;this.resetData()}util.inherits(ByteCapacitor,ReadableStream);ByteCapacitor.prototype._read=function(){this.okayToPush=true};ByteCapacitor.prototype.resetData=function(){this.data=[]};ByteCapacitor.prototype.flushData=function(){if(!this.okayToPush){var err=new Error("GIF memory limit exceeded. Please `read` from GIF before writing additional frames/information.");return this.emit("error",err)}var buff=new Buffer(this.data);this.resetData();this.okayToPush=this.push(buff)};ByteCapacitor.prototype.writeByte=function(val){this.data.push(val)};ByteCapacitor.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++){this.writeByte(string.charCodeAt(i))}};ByteCapacitor.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++){this.writeByte(array[i])}};function GIFEncoder(width,height,options){options=options||{};var hwm=options.highWaterMark;ByteCapacitor.call(this,{highWaterMark:hwm||hwm===0?hwm:64*1024});this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.usedEntry=[];this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;var that=this;function flushData(){that.flushData()}this.on("writeHeader#stop",flushData);this.on("frame#stop",flushData);this.on("finish#stop",function finishGif(){flushData();that.push(null)})}util.inherits(GIFEncoder,ByteCapacitor);GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.analyzeImage=function(imageData){this.setImagePixels(this.removeAlphaChannel(imageData));this.analyzePixels()};GIFEncoder.prototype.writeImageInfo=function(){if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame)this.writePalette();this.firstFrame=false};GIFEncoder.prototype.outputImage=function(){this.writePixels()};GIFEncoder.prototype.addFrame=function(imageData){this.emit("frame#start");this.analyzeImage(imageData);this.writeImageInfo();this.outputImage();this.emit("frame#stop")};GIFEncoder.prototype.finish=function(){this.emit("finish#start");this.writeByte(59);this.emit("finish#stop")};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.writeHeader=function(){this.emit("writeHeader#start");this.writeUTFBytes("GIF89a");this.emit("writeHeader#stop")};GIFEncoder.prototype.analyzePixels=function(){var len=this.pixels.length;var nPix=len/3;this.indexedPixels=new Uint8Array(nPix);var imgq=new NeuQuant(this.pixels,this.sample);imgq.buildColormap();this.colorTab=imgq.getColormap();var k=0;for(var j=0;j<nPix;j++){var index=imgq.lookupRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent)}};GIFEncoder.prototype.findClosest=function(c){if(this.colorTab===null)return-1;var r=(c&16711680)>>16;var g=(c&65280)>>8;var b=c&255;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0;i<len;){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i]&255);var d=dr*dr+dg*dg+db*db;var index=i/3;if(this.usedEntry[index]&&d<dmin){dmin=d;minpos=index}i++}return minpos};GIFEncoder.prototype.removeAlphaChannel=function(data){var w=this.width;var h=this.height;var pixels=new Uint8Array(w*h*3);var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){var b=i*w*4+j*4;pixels[count++]=data[b];pixels[count++]=data[b+1];pixels[count++]=data[b+2]}}return pixels};GIFEncoder.prototype.setImagePixels=function(pixels){this.pixels=pixels};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.writeByte(33);this.writeByte(249);this.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=dispose&7}disp<<=2;this.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.writeByte(this.transIndex);this.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame){this.writeByte(0)}else{this.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.writeByte(128|112|0|this.palSize);this.writeByte(0);this.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.writeByte(33);this.writeByte(255);this.writeByte(11);this.writeUTFBytes("NETSCAPE2.0");this.writeByte(3);this.writeByte(1);this.writeShort(this.repeat);this.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.writeByte(pValue&255);this.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this)};GIFEncoder.prototype.stream=function(){return this};GIFEncoder.ByteCapacitor=ByteCapacitor;module.exports=GIFEncoder}).call(this,require("buffer").Buffer)},{"./LZWEncoder.js":327,"./TypedNeuQuant.js":328,assert:4,buffer:13,events:322,"readable-stream":335,util:511}],327:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var remaining;var curPixel;var n_bits;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],328:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],329:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{dup:15}],330:[function(require,module,exports){arguments[4][16][0].apply(exports,arguments)},{"./_stream_readable":332,"./_stream_writable":334,_process:488,"core-util-is":316,dup:16,inherits:358}],331:[function(require,module,exports){arguments[4][17][0].apply(exports,arguments)},{"./_stream_transform":333,"core-util-is":316,dup:17,inherits:358}],332:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(util.isString(chunk)&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(util.isNullOrUndefined(chunk)){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(isNaN(n)||util.isNull(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(!util.isNumber(n)||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(util.isNull(ret)){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(!util.isNull(ret))this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;
if(!state.reading){var self=this;process.nextTick(function(){debug("readable nexttick read 0");self.read(0)})}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;if(!state.reading){debug("resume read 0");this.read(0)}resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process.nextTick(function(){resume_(stream,state)})}}function resume_(stream,state){state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(!chunk||!state.objectMode&&!chunk.length)return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(util.isFunction(stream[i])&&util.isUndefined(this[i])){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":330,_process:488,buffer:13,"core-util-is":316,events:322,inherits:358,isarray:329,stream:504,"string_decoder/":505,util:9}],333:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(!util.isNullOrUndefined(data))stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("prefinish",function(){if(util.isFunction(this._flush))this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(!util.isNull(ts.writechunk)&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":330,"core-util-is":316,inherits:358}],334:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(util.isFunction(encoding)){cb=encoding;encoding=null}if(util.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(!util.isFunction(cb))cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(this,state)}};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&util.isString(chunk)){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(util.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,false,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){state.pendingcb--;cb(er)});else{state.pendingcb--;cb(er)}stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.buffer.length){clearBuffer(stream,state)}if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;if(stream._writev&&state.buffer.length>1){var cbs=[];for(var c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++;doWrite(stream,state,true,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}});state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);if(state.writing){c++;break}}if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(util.isFunction(chunk)){cb=chunk;chunk=null;encoding=null}else if(util.isFunction(encoding)){cb=encoding;encoding=null}if(!util.isNullOrUndefined(chunk))this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else prefinish(stream,state)}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":330,_process:488,buffer:13,"core-util-is":316,inherits:358,stream:504}],335:[function(require,module,exports){(function(process){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=require("stream");exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"){module.exports=require("stream")}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":330,"./lib/_stream_passthrough.js":331,"./lib/_stream_readable.js":332,"./lib/_stream_transform.js":333,"./lib/_stream_writable.js":334,_process:488,stream:504}],336:[function(require,module,exports){module.exports={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0}},{}],337:[function(require,module,exports){exports.glMatrix=require("./gl-matrix/common.js");exports.mat2=require("./gl-matrix/mat2.js");exports.mat2d=require("./gl-matrix/mat2d.js");exports.mat3=require("./gl-matrix/mat3.js");exports.mat4=require("./gl-matrix/mat4.js");exports.quat=require("./gl-matrix/quat.js");exports.vec2=require("./gl-matrix/vec2.js");exports.vec3=require("./gl-matrix/vec3.js");exports.vec4=require("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":338,"./gl-matrix/mat2.js":339,"./gl-matrix/mat2d.js":340,"./gl-matrix/mat3.js":341,"./gl-matrix/mat4.js":342,"./gl-matrix/quat.js":343,"./gl-matrix/vec2.js":344,"./gl-matrix/vec3.js":345,"./gl-matrix/vec4.js":346}],338:[function(require,module,exports){var glMatrix={};glMatrix.EPSILON=1e-6;glMatrix.ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;glMatrix.RANDOM=Math.random;glMatrix.ENABLE_SIMD=false;glMatrix.SIMD_AVAILABLE=glMatrix.ARRAY_TYPE===Float32Array&&"SIMD"in this;glMatrix.USE_SIMD=glMatrix.ENABLE_SIMD&&glMatrix.SIMD_AVAILABLE;glMatrix.setMatrixArrayType=function(type){glMatrix.ARRAY_TYPE=type};var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};glMatrix.equals=function(a,b){return Math.abs(a-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};module.exports=glMatrix},{}],339:[function(require,module,exports){var glMatrix=require("./common.js");var mat2={};mat2.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.fromValues=function(m00,m01,m10,m11){var out=new glMatrix.ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.set=function(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out};mat2.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out};mat2.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mat2.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mat2.LDU=function(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]};mat2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};mat2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};mat2.sub=mat2.subtract;mat2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};mat2.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};mat2.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};mat2.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};module.exports=mat2},{"./common.js":338}],340:[function(require,module,exports){var glMatrix=require("./common.js");var mat2d={};mat2d.create=function(){var out=new glMatrix.ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.fromValues=function(a,b,c,d,tx,ty){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.set=function(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out};mat2d.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out};mat2d.translate=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out};mat2d.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out};mat2d.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out};mat2d.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};mat2d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};mat2d.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out};mat2d.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out};mat2d.sub=mat2d.subtract;mat2d.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;return out};mat2d.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out};mat2d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};mat2d.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))};module.exports=mat2d},{"./common.js":338}],341:[function(require,module,exports){var glMatrix=require("./common.js");var mat3={};mat3.create=function(){var out=new glMatrix.ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromValues=function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new glMatrix.ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.set=function(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out};mat3.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromScaling=function(out,v){
out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};mat3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out};mat3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];return out};mat3.sub=mat3.subtract;mat3.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out};mat3.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out};mat3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};mat3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=a[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))};module.exports=mat3},{"./common.js":338}],342:[function(require,module,exports){var glMatrix=require("./common.js");var mat4={scalar:{},SIMD:{}};mat4.create=function(){var out=new glMatrix.ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.fromValues=function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new glMatrix.ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.set=function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.scalar.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.SIMD.transpose=function(out,a){var a0,a1,a2,a3,tmp01,tmp23,out0,out1,out2,out3;a0=SIMD.Float32x4.load(a,0);a1=SIMD.Float32x4.load(a,4);a2=SIMD.Float32x4.load(a,8);a3=SIMD.Float32x4.load(a,12);tmp01=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);tmp23=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);out0=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out1=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,0,out0);SIMD.Float32x4.store(out,4,out1);tmp01=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);tmp23=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);out2=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out3=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,8,out2);SIMD.Float32x4.store(out,12,out3);return out};mat4.transpose=glMatrix.USE_SIMD?mat4.SIMD.transpose:mat4.scalar.transpose;mat4.scalar.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.SIMD.invert=function(out,a){var row0,row1,row2,row3,tmp1,minor0,minor1,minor2,minor3,det,a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);det=SIMD.Float32x4.mul(row0,minor0);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,2,3,0,1),det);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,1,0,3,2),det);tmp1=SIMD.Float32x4.reciprocalApproximation(det);det=SIMD.Float32x4.sub(SIMD.Float32x4.add(tmp1,tmp1),SIMD.Float32x4.mul(det,SIMD.Float32x4.mul(tmp1,tmp1)));det=SIMD.Float32x4.swizzle(det,0,0,0,0);if(!det){return null}SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(det,minor0));SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(det,minor1));SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(det,minor2));SIMD.Float32x4.store(out,12,SIMD.Float32x4.mul(det,minor3));return out};mat4.invert=glMatrix.USE_SIMD?mat4.SIMD.invert:mat4.scalar.invert;mat4.scalar.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out};mat4.SIMD.adjoint=function(out,a){var a0,a1,a2,a3;var row0,row1,row2,row3;var tmp1;var minor0,minor1,minor2,minor3;var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);SIMD.Float32x4.store(out,0,minor0);SIMD.Float32x4.store(out,4,minor1);SIMD.Float32x4.store(out,8,minor2);SIMD.Float32x4.store(out,12,minor3);return out};mat4.adjoint=glMatrix.USE_SIMD?mat4.SIMD.adjoint:mat4.scalar.adjoint;mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.SIMD.multiply=function(out,a,b){var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);var b0=SIMD.Float32x4.load(b,0);var out0=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,3,3,3,3),a3))));SIMD.Float32x4.store(out,0,out0);var b1=SIMD.Float32x4.load(b,4);var out1=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,3,3,3,3),a3))));SIMD.Float32x4.store(out,4,out1);var b2=SIMD.Float32x4.load(b,8);var out2=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,3,3,3,3),a3))));SIMD.Float32x4.store(out,8,out2);var b3=SIMD.Float32x4.load(b,12);var out3=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,3,3,3,3),a3))));SIMD.Float32x4.store(out,12,out3);return out};mat4.scalar.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.multiply=glMatrix.USE_SIMD?mat4.SIMD.multiply:mat4.scalar.multiply;mat4.mul=mat4.multiply;mat4.scalar.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.SIMD.translate=function(out,a,v){var a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12),vec=SIMD.Float32x4(v[0],v[1],v[2],0);if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11]}a0=SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0));a1=SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1));a2=SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2));var t0=SIMD.Float32x4.add(a0,SIMD.Float32x4.add(a1,SIMD.Float32x4.add(a2,a3)));SIMD.Float32x4.store(out,12,t0);return out};mat4.translate=glMatrix.USE_SIMD?mat4.SIMD.translate:mat4.scalar.translate;mat4.scalar.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.SIMD.scale=function(out,a,v){var a0,a1,a2;var vec=SIMD.Float32x4(v[0],v[1],v[2],0);a0=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0)));a1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1)));a2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2)));out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.scale=glMatrix.USE_SIMD?mat4.SIMD.scale:mat4.scalar.scale;mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.scalar.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.SIMD.rotateX=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_1=SIMD.Float32x4.load(a,4);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_2,c),SIMD.Float32x4.mul(a_1,s)));return out};mat4.rotateX=glMatrix.USE_SIMD?mat4.SIMD.rotateX:mat4.scalar.rotateX;mat4.scalar.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.SIMD.rotateY=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,s),SIMD.Float32x4.mul(a_2,c)));return out};mat4.rotateY=glMatrix.USE_SIMD?mat4.SIMD.rotateY:mat4.scalar.rotateY;mat4.scalar.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.SIMD.rotateZ=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_1,s)));SIMD.Float32x4.store(out,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_0,s)));return out};mat4.rotateZ=glMatrix.USE_SIMD?mat4.SIMD.rotateZ:mat4.scalar.rotateZ;mat4.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotation=function(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromXRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromYRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromZRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.getTranslation=function(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out};mat4.getRotation=function(out,mat){var trace=mat[0]+mat[5]+mat[10];var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=.25*S;out[0]=(mat[6]-mat[9])/S;out[1]=(mat[8]-mat[2])/S;out[2]=(mat[1]-mat[4])/S}else if(mat[0]>mat[5]&mat[0]>mat[10]){S=Math.sqrt(1+mat[0]-mat[5]-mat[10])*2;out[3]=(mat[6]-mat[9])/S;out[0]=.25*S;out[1]=(mat[1]+mat[4])/S;out[2]=(mat[8]+mat[2])/S}else if(mat[5]>mat[10]){S=Math.sqrt(1+mat[5]-mat[0]-mat[10])*2;out[3]=(mat[8]-mat[2])/S;out[0]=(mat[1]+mat[4])/S;out[1]=.25*S;out[2]=(mat[6]+mat[9])/S}else{S=Math.sqrt(1+mat[10]-mat[0]-mat[5])*2;out[3]=(mat[1]-mat[4])/S;out[0]=(mat[8]+mat[2])/S;out[1]=(mat[6]+mat[9])/S;out[2]=.25*S}return out};mat4.fromRotationTranslationScale=function(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromRotationTranslationScaleOrigin=function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0]+ox-(out[0]*ox+out[4]*oy+out[8]*oz);out[13]=v[1]+oy-(out[1]*ox+out[5]*oy+out[9]*oz);out[14]=v[2]+oz-(out[2]*ox+out[6]*oy+out[10]*oz);out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out};mat4.perspectiveFromFieldOfView=function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<glMatrix.EPSILON&&Math.abs(eyey-centery)<glMatrix.EPSILON&&Math.abs(eyez-centerz)<glMatrix.EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")";
};mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};mat4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out};mat4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out};mat4.sub=mat4.subtract;mat4.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out};mat4.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out};mat4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};mat4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=glMatrix.EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=glMatrix.EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=glMatrix.EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=glMatrix.EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=glMatrix.EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=glMatrix.EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=glMatrix.EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))};module.exports=mat4},{"./common.js":338}],343:[function(require,module,exports){var glMatrix=require("./common.js");var mat3=require("./mat3.js");var vec3=require("./vec3.js");var vec4=require("./vec4.js");var quat={};quat.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<1e-6)vec3.cross(tmpvec3,yUnitVec3,a);vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}();quat.setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}}();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.getAxisAngle=function(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s!=0){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0}return rad};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.sqlerp=function(){var temp1=quat.create();var temp2=quat.create();return function(out,a,b,c,d,t){quat.slerp(temp1,a,d,t);quat.slerp(temp2,b,c,t);quat.slerp(out,temp1,temp2,2*t*(1-t));return out}}();quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out};quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};quat.exactEquals=vec4.exactEquals;quat.equals=vec4.equals;module.exports=quat},{"./common.js":338,"./mat3.js":341,"./vec3.js":345,"./vec4.js":346}],344:[function(require,module,exports){var glMatrix=require("./common.js");var vec2={};vec2.create=function(){var out=new glMatrix.ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new glMatrix.ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out};vec2.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out};vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};vec2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};vec2.equals=function(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))};module.exports=vec2},{"./common.js":338}],345:[function(require,module,exports){var glMatrix=require("./common.js");var vec3={};vec3.create=function(){var out=new glMatrix.ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new glMatrix.ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out};vec3.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out};vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.hermite=function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.bezier=function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;var z=glMatrix.RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.rotateX=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateY=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateZ=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();vec3.angle=function(a,b){var tempA=vec3.fromValues(a[0],a[1],a[2]);var tempB=vec3.fromValues(b[0],b[1],b[2]);vec3.normalize(tempA,tempA);vec3.normalize(tempB,tempB);var cosine=vec3.dot(tempA,tempB);if(cosine>1){return 0}else{return Math.acos(cosine)}};vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};vec3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};vec3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))};module.exports=vec3},{"./common.js":338}],346:[function(require,module,exports){var glMatrix=require("./common.js");var vec4={};vec4.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new glMatrix.ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out};vec4.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out};vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);out[3]=Math.round(a[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.random=function(out,scale){scale=scale||1;out[0]=glMatrix.RANDOM();out[1]=glMatrix.RANDOM();out[2]=glMatrix.RANDOM();out[3]=glMatrix.RANDOM();vec4.normalize(out,out);vec4.scale(out,out,scale);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out};vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};vec4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};vec4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};module.exports=vec4},{"./common.js":338}],347:[function(require,module,exports){(function(global){if(typeof window!=="undefined"){module.exports=window}else if(typeof global!=="undefined"){module.exports=global}else if(typeof self!=="undefined"){module.exports=self}else{module.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],348:[function(require,module,exports){var tokenize=require("glsl-tokenizer");var atob=require("atob-lite");module.exports=getName;function getName(src){var tokens=Array.isArray(src)?src:tokenize(src);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token.type!=="preprocessor")continue;var match=token.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(!match)continue;if(!match[2])continue;var b64=match[1];var name=match[2];return(b64?atob(name):name).trim()}}},{"atob-lite":5,"glsl-tokenizer":355}],349:[function(require,module,exports){module.exports=tokenize;var literals100=require("./lib/literals"),operators=require("./lib/operators"),builtins100=require("./lib/builtins"),literals300es=require("./lib/literals-300es"),builtins300es=require("./lib/builtins-300es");var NORMAL=999,TOKEN=9999,BLOCK_COMMENT=0,LINE_COMMENT=1,PREPROCESSOR=2,OPERATOR=3,INTEGER=4,FLOAT=5,IDENT=6,BUILTIN=7,KEYWORD=8,WHITESPACE=9,EOF=10,HEX=11;var map=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function tokenize(opt){var i=0,total=0,mode=NORMAL,c,last,content=[],tokens=[],token_idx=0,token_offs=0,line=1,col=0,start=0,isnum=false,isoperator=false,input="",len;opt=opt||{};var allBuiltins=builtins100;var allLiterals=literals100;if(opt.version==="300 es"){allBuiltins=builtins300es;allLiterals=literals300es}return function(data){tokens=[];if(data!==null)return write(data.replace?data.replace(/\r\n/g,"\n"):data);return end()};function token(data){if(data.length){tokens.push({type:map[mode],data:data,position:start,line:line,column:col})}}function write(chunk){i=0;input+=chunk;len=input.length;var last;while(c=input[i],i<len){last=i;switch(mode){case BLOCK_COMMENT:i=block_comment();break;case LINE_COMMENT:i=line_comment();break;case PREPROCESSOR:i=preprocessor();break;case OPERATOR:i=operator();break;case INTEGER:i=integer();break;case HEX:i=hex();break;case FLOAT:i=decimal();break;case TOKEN:i=readtoken();break;case WHITESPACE:i=whitespace();break;case NORMAL:i=normal();break}if(last!==i){switch(input[last]){case"\n":col=0;++line;break;default:++col;break}}}total+=i;input=input.slice(i);return tokens}function end(chunk){if(content.length){token(content.join(""))}mode=EOF;token("(eof)");return tokens}function normal(){content=content.length?[]:content;if(last==="/"&&c==="*"){start=total+i-1;mode=BLOCK_COMMENT;last=c;return i+1}if(last==="/"&&c==="/"){start=total+i-1;mode=LINE_COMMENT;last=c;return i+1}if(c==="#"){mode=PREPROCESSOR;start=total+i;return i}if(/\s/.test(c)){mode=WHITESPACE;start=total+i;return i}isnum=/\d/.test(c);isoperator=/[^\w_]/.test(c);start=total+i;mode=isnum?INTEGER:isoperator?OPERATOR:TOKEN;return i}function whitespace(){if(/[^\s]/g.test(c)){token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}function preprocessor(){if((c==="\r"||c==="\n")&&last!=="\\"){token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}function line_comment(){return preprocessor()}function block_comment(){if(c==="/"&&last==="*"){content.push(c);token(content.join(""));mode=NORMAL;return i+1}content.push(c);last=c;return i+1}function operator(){if(last==="."&&/\d/.test(c)){mode=FLOAT;return i}if(last==="/"&&c==="*"){mode=BLOCK_COMMENT;return i}if(last==="/"&&c==="/"){mode=LINE_COMMENT;return i}if(c==="."&&content.length){while(determine_operator(content));mode=FLOAT;return i}if(c===";"||c===")"||c==="("){if(content.length)while(determine_operator(content));token(c);mode=NORMAL;return i+1}var is_composite_operator=content.length===2&&c!=="=";if(/[\w_\d\s]/.test(c)||is_composite_operator){while(determine_operator(content));mode=NORMAL;return i}content.push(c);last=c;return i+1}function determine_operator(buf){var j=0,idx,res;do{idx=operators.indexOf(buf.slice(0,buf.length+j).join(""));res=operators[idx];if(idx===-1){if(j--+buf.length>0)continue;res=buf.slice(0,1).join("")}token(res);start+=res.length;content=content.slice(res.length);return content.length}while(1)}function hex(){if(/[^a-fA-F0-9]/.test(c)){token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}function integer(){if(c==="."){content.push(c);mode=FLOAT;last=c;return i+1}if(/[eE]/.test(c)){content.push(c);mode=FLOAT;last=c;return i+1}if(c==="x"&&content.length===1&&content[0]==="0"){mode=HEX;content.push(c);last=c;return i+1}if(/[^\d]/.test(c)){token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}function decimal(){if(c==="f"){content.push(c);last=c;i+=1}if(/[eE]/.test(c)){content.push(c);last=c;return i+1}if(c==="-"&&/[eE]/.test(last)){content.push(c);last=c;return i+1}if(/[^\d]/.test(c)){token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}function readtoken(){if(/[^\d\w_]/.test(c)){var contentstr=content.join("");if(allLiterals.indexOf(contentstr)>-1){mode=KEYWORD}else if(allBuiltins.indexOf(contentstr)>-1){mode=BUILTIN}else{mode=IDENT}token(content.join(""));mode=NORMAL;return i}content.push(c);last=c;return i+1}}},{"./lib/builtins":351,"./lib/builtins-300es":350,"./lib/literals":353,"./lib/literals-300es":352,"./lib/operators":354}],350:[function(require,module,exports){var v100=require("./builtins");v100=v100.slice().filter(function(b){return!/^(gl\_|texture)/.test(b)});module.exports=v100.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},{"./builtins":351}],351:[function(require,module,exports){module.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"];
},{}],352:[function(require,module,exports){var v100=require("./literals");module.exports=v100.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},{"./literals":353}],353:[function(require,module,exports){module.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],354:[function(require,module,exports){module.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],355:[function(require,module,exports){var tokenize=require("./index");module.exports=tokenizeString;function tokenizeString(str,opt){var generator=tokenize(opt);var tokens=[];tokens=tokens.concat(generator(str));tokens=tokens.concat(generator(null));return tokens}},{"./index":349}],356:[function(require,module,exports){module.exports=function(){throw new Error("It appears that you're using glslify in browserify without "+"its transform applied. Make sure that you've set up glslify as a source transform: "+"https://github.com/substack/node-browserify#browserifytransform")}},{}],357:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],358:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],359:[function(require,module,exports){"use strict";function iota(n){var result=new Array(n);for(var i=0;i<n;++i){result[i]=i}return result}module.exports=iota},{}],360:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],361:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],362:[function(require,module,exports){var isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");function isObjectLike(value){return!!value&&typeof value=="object"}var MAX_SAFE_INTEGER=9007199254740991;function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);var index=-1,length=array.length;while(++index<length){var value=array[index];if(isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))){if(isDeep){baseFlatten(value,isDeep,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}module.exports=baseFlatten},{"lodash.isarguments":364,"lodash.isarray":365}],363:[function(require,module,exports){var baseFlatten=require("lodash._baseflatten");function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true):[]}module.exports=flattenDeep},{"lodash._baseflatten":362}],364:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=isArguments},{}],365:[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],366:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Queue=[];var Fx=function(){function Fx(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Fx);this.opt=(0,_utils.merge)({delay:0,duration:1e3,transition:function transition(x){return x},onCompute:_utils.noop,onComplete:_utils.noop},options)}_createClass(Fx,[{key:"start",value:function start(options){this.opt=(0,_utils.merge)(this.opt,options||{});this.time=Date.now();this.animating=true;Queue.push(this)}},{key:"step",value:function step(){if(!this.animating){return}var currentTime=Date.now(),time=this.time,opt=this.opt,delay=opt.delay,duration=opt.duration,delta=0;if(currentTime<time+delay){opt.onCompute.call(this,delta);return}if(currentTime<time+delay+duration){delta=opt.transition((currentTime-time-delay)/duration);opt.onCompute.call(this,delta)}else{this.animating=false;opt.onCompute.call(this,1);opt.onComplete.call(this)}}}],[{key:"compute",value:function compute(from,to,delta){return from+(to-from)*delta}}]);return Fx}();exports.default=Fx;Fx.Queue=Queue;Fx.Transition={linear:function linear(p){return p}};var Trans=Fx.Transition;Fx.prototype.time=null;function makeTrans(transition,params){params=(0,_utils.splat)(params);return Object.assign(transition,{easeIn:function easeIn(pos){return transition(pos,params)},easeOut:function easeOut(pos){return 1-transition(1-pos,params)},easeInOut:function easeInOut(pos){return pos<=.5?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2}})}var transitions={Pow:function Pow(p,x){return Math.pow(p,x[0]||6)},Expo:function Expo(p){return Math.pow(2,8*(p-1))},Circ:function Circ(p){return 1-Math.sin(Math.acos(p))},Sine:function Sine(p){return 1-Math.sin((1-p)*Math.PI/2)},Back:function Back(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function Bounce(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=b*b-Math.pow((11-6*a-11*p)/4,2);break}}return value},Elastic:function Elastic(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3)}};for(var t in transitions){Trans[t]=makeTrans(transitions[t])}["Quad","Cubic","Quart","Quint"].forEach(function(elem,i){Trans[elem]=makeTrans(function(p){return Math.pow(p,[i+2])})});var global;try{global=window}catch(e){global=null}var checkFxQueue=function checkFxQueue(){var oldQueue=Queue;Queue=[];if(oldQueue.length){for(var i=0,l=oldQueue.length,fx;i<l;i++){fx=oldQueue[i];fx.step();if(fx.animating){Queue.push(fx)}}Fx.Queue=Queue}};if(global){var found=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(impl){if(impl in global){Fx.animationTime=function(){return global[impl]};found=true}});if(!found){Fx.animationTime=Date.now}found=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(impl){if(impl in global){Fx.requestAnimationFrame=function(callback){global[impl](function(){checkFxQueue();callback()})};found=true}});if(!found){Fx.requestAnimationFrame=function(callback){setTimeout(function(){checkFxQueue();callback()},1e3/60)}}}},{"../utils":417}],367:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.cancelAnimationFrame=exports.requestAnimationFrame=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _utils=require("../utils");var _webglChecks=require("../webgl/webgl-checks");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var requestAnimationFrame=exports.requestAnimationFrame=function requestAnimationFrame(callback){return _utils.isBrowser?window.requestAnimationFrame(callback):setTimeout(callback,1e3/60)};var cancelAnimationFrame=exports.cancelAnimationFrame=function cancelAnimationFrame(timerId){return _utils.isBrowser?window.cancelAnimationFrame(timerId):clearTimeout(timerId)};var AnimationFrame=(_class=function(){function AnimationFrame(){var _this=this;var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$gl=_ref.gl;var gl=_ref$gl===undefined?null:_ref$gl;var _ref$canvas=_ref.canvas;var canvas=_ref$canvas===undefined?null:_ref$canvas;var _ref$width=_ref.width;var width=_ref$width===undefined?null:_ref$width;var _ref$height=_ref.height;var height=_ref$height===undefined?null:_ref$height;var _ref$autoResizeViewpo=_ref.autoResizeViewport;var autoResizeViewport=_ref$autoResizeViewpo===undefined?true:_ref$autoResizeViewpo;var _ref$autoResizeCanvas=_ref.autoResizeCanvas;var autoResizeCanvas=_ref$autoResizeCanvas===undefined?true:_ref$autoResizeCanvas;var _ref$autoResizeDrawin=_ref.autoResizeDrawingBuffer;var autoResizeDrawingBuffer=_ref$autoResizeDrawin===undefined?true:_ref$autoResizeDrawin;var _ref$useDevicePixelRa=_ref.useDevicePixelRatio;var useDevicePixelRatio=_ref$useDevicePixelRa===undefined?true:_ref$useDevicePixelRa;var glOpts=_objectWithoutProperties(_ref,["gl","canvas","width","height","autoResizeViewport","autoResizeCanvas","autoResizeDrawingBuffer","useDevicePixelRatio"]);_classCallCheck(this,AnimationFrame);this.update({autoResizeViewport:autoResizeViewport,autoResizeCanvas:autoResizeCanvas,autoResizeDrawingBuffer:autoResizeDrawingBuffer,useDevicePixelRatio:useDevicePixelRatio});this.width=width;this.height=height;this._startPromise=_utils.pageLoadPromise.then(function(page){_this.gl=gl;return page})}_createClass(AnimationFrame,[{key:"update",value:function update(_ref2){var _ref2$autoResizeDrawi=_ref2.autoResizeDrawingBuffer;var autoResizeDrawingBuffer=_ref2$autoResizeDrawi===undefined?true:_ref2$autoResizeDrawi;var _ref2$autoResizeCanva=_ref2.autoResizeCanvas;var autoResizeCanvas=_ref2$autoResizeCanva===undefined?true:_ref2$autoResizeCanva;var _ref2$autoResizeViewp=_ref2.autoResizeViewport;var autoResizeViewport=_ref2$autoResizeViewp===undefined?true:_ref2$autoResizeViewp;var _ref2$useDevicePixelR=_ref2.useDevicePixelRatio;var useDevicePixelRatio=_ref2$useDevicePixelR===undefined?true:_ref2$useDevicePixelR;this.autoResizeViewport=autoResizeViewport;this.autoResizeCanvas=autoResizeCanvas;this.autoResizeDrawingBuffer=autoResizeDrawingBuffer;this.useDevicePixelRatio=useDevicePixelRatio;return this}},{key:"context",value:function context(onCreateContext){var _this2=this;if(this.gl){throw new Error("AnimationFrame.context - context already provided")}this._startPromise=this._startPromise.then(function(){_this2.gl=onCreateContext();if(!(0,_webglChecks.isWebGLContext)(_this2.gl)){throw new Error("AnimationFrame.context - illegal context returned")}});return this}},{key:"init",value:function init(onInit){var _this3=this;this._startPromise=this._startPromise.then(function(){if(!_this3.gl){throw new Error("AnimationFrame.context - no context provided")}_this3._initializeContext();return onInit(_this3._context)||{}});return this}},{key:"setupFrame",value:function setupFrame(onSetupFrame){this._onSetupFrame=onSetupFrame;return this}},{key:"frame",value:function frame(onRenderFrame){this._onRenderFrame=onRenderFrame;this._restartFrame();return this}},{key:"start",value:function start(){var _this4=this;this._startPromise.then(function(){if(!_this4._animationFrameId){_this4._animationFrameId=requestAnimationFrame(_this4._frame)}});return this}},{key:"stop",value:function stop(){if(this._animationFrameId){cancelAnimationFrame(this._animationFrameId);this._animationFrameId=null}return this}},{key:"resizeCanvas",value:function resizeCanvas(width,height){this._resizeCanvas(width,height);return this}},{key:"_initializeContext",value:function _initializeContext(){this._context={gl:this.gl,canvas:this.gl.canvas,stop:this.stop,tick:0,tock:0};this._updateContext()}},{key:"_updateContext",value:function _updateContext(){var canvas=this._context.canvas;this._context.width=canvas.width;this._context.height=canvas.height;this._context.aspect=canvas.width/canvas.height}},{key:"_restartFrame",value:function _restartFrame(){var _this5=this;this.stop();this._startPromise.then(function(){var appContext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_this5._initializeContext();if((typeof appContext==="undefined"?"undefined":_typeof(appContext))==="object"&&appContext!==null){_this5._context=_extends({},appContext,_this5._context)}_this5.start()})}},{key:"_frame",value:function _frame(){var canvas=this._context.canvas;if(this._onSetupFrame){this._onSetupFrame(this._context)}else{this._resizeCanvasDrawingBuffer(canvas);if(this.autoResizeViewport){this.gl.viewport(0,0,canvas.width,canvas.height)}}this._updateContext();this._onRenderFrame(this._context);this._context.tick++;this._animationFrameId=requestAnimationFrame(this._frame)}},{key:"_resizeCanvas",value:function _resizeCanvas(width,height){var canvas=this._context.canvas;if(canvas){if(this.autoResizeDrawingBuffer){var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var displayWidth=Math.floor(width*cssToDevicePixels);var displayHeight=Math.floor(height*cssToDevicePixels);if(canvas.width!==displayWidth||canvas.height!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight}}canvas.style.width=width+"px";canvas.style.height=height+"px"}return this}},{key:"_resizeCanvasDrawingBuffer",value:function _resizeCanvasDrawingBuffer(){if(this.autoResizeDrawingBuffer){var canvas=this._context.canvas;var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var oldWidth=window.innerWidth;var oldHeight=window.innerHeight;var displayWidth=Math.floor(oldWidth*cssToDevicePixels);var displayHeight=Math.floor(oldHeight*cssToDevicePixels);if(oldWidth!==displayWidth||oldHeight!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight;canvas.style.width=oldWidth;canvas.style.height=oldHeight}}}},{key:"_resizeDrawingBuffer",value:function _resizeDrawingBuffer(width,height){var canvas=this._context.canvas;if(canvas){canvas.width=width;canvas.height=height;this.autoResizeDrawingBuffer=false}return this}}]);return AnimationFrame}(),_applyDecoratedDescriptor(_class.prototype,"context",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"context"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"init",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"init"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"setupFrame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"setupFrame"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"frame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"frame"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"start",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"start"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"stop",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"stop"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_frame",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"_frame"),_class.prototype),_class);exports.default=AnimationFrame},{"../utils":417,"../webgl/webgl-checks":438,"autobind-decorator":6}],368:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OrthoCamera=exports.PerspectiveCamera=exports.Camera=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deprecated=require("../deprecated");var _utils=require("../utils");function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Camera=exports.Camera=function(){function Camera(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Camera);opts=(0,_utils.merge)({fov:45,near:.1,far:500,aspect:1,position:new _deprecated.Vec3(0,0,0),target:new _deprecated.Vec3(0,0,-1),up:new _deprecated.Vec3(0,1,0)},opts);this.fov=opts.fov;this.near=opts.near;this.far=opts.far;this.aspect=opts.aspect;this.position=opts.position;this.target=opts.target;this.up=opts.up;this.view=new _deprecated.Mat4;this.uniforms={};this.projection=new _deprecated.Mat4;Object.seal(this);this.update()}_createClass(Camera,[{key:"project",value:function project(){return null}},{key:"unproject",value:function unproject(){return null}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"_updateUniforms",value:function _updateUniforms(){var viewProjection=this.view.mulMat4(this.projection);var viewProjectionInverse=viewProjection.invert();this.uniforms={cameraPosition:this.position,projectionMatrix:this.projection,viewMatrix:this.view,viewProjectionMatrix:viewProjection,viewInverseMatrix:this.view.invert(),viewProjectionInverseMatrix:viewProjectionInverse}}}]);return Camera}();var PerspectiveCamera=exports.PerspectiveCamera=function(_Camera){_inherits(PerspectiveCamera,_Camera);function PerspectiveCamera(){_classCallCheck(this,PerspectiveCamera);return _possibleConstructorReturn(this,(PerspectiveCamera.__proto__||Object.getPrototypeOf(PerspectiveCamera)).apply(this,arguments))}_createClass(PerspectiveCamera,[{key:"update",value:function update(){this.projection=(new _deprecated.Mat4).perspective(this.fov,this.aspect,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return PerspectiveCamera}(Camera);var OrthoCamera=exports.OrthoCamera=function(){function OrthoCamera(){_classCallCheck(this,OrthoCamera)}_createClass(OrthoCamera,[{key:"update",value:function update(){var ymax=this.near*Math.tan(this.fov*Math.PI/360);var ymin=-ymax;var xmin=ymin*this.aspect;var xmax=ymax*this.aspect;this.projection=(new _deprecated.Mat4).ortho(xmin,xmax,ymin,ymax,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return OrthoCamera}()},{"../deprecated":376,"../utils":417}],369:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MAX_TEXTURES=exports.MAX_TEXTURES=10;var MAX_POINT_LIGHTS=exports.MAX_POINT_LIGHTS=4;var PICKING_RES=exports.PICKING_RES=4},{}],370:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Keys=exports.EventsProxy=exports.stop=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.get=get;exports.getWheel=getWheel;exports.getKey=getKey;exports.isRightClick=isRightClick;exports.getPos=getPos;exports.addEvents=addEvents;var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,delete:46};function toO3D(n){return n!==true?n:false}function _getPos(elem){var bbox=elem.getBoundingClientRect();return{x:bbox.left,y:bbox.top,bbox:bbox}}function get(e,win){win=win||window;return e||win.event}function getWheel(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3}function getKey(e){var code=e.which||e.keyCode;var key=keyOf(code);var fKey=code-111;if(fKey>0&&fKey<13){key="f"+fKey}key=key||String.fromCharCode(code).toLowerCase();return{code:code,key:key,shift:e.shiftKey,control:e.ctrlKey,alt:e.altKey,meta:e.metaKey}}function isRightClick(e){return e.which===3||e.button===2}function getPos(e,win){win=win||window;e=e||win.event;var doc=win.document;doc=doc.documentElement||doc.body;if(e.touches&&e.touches.length){var touchesPos=[];var l=e.touches.length;var evt=void 0;for(var i=0;i<l;++i){evt=e.touches[i];touchesPos.push({x:evt.pageX||evt.clientX+doc.scrollLeft,y:evt.pageY||evt.clientY+doc.scrollTop})}return touchesPos}var page={x:e.pageX||e.clientX+doc.scrollLeft,y:e.pageY||e.clientY+doc.scrollTop};return[page]}function _stop(e){if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}exports.stop=_stop;var EventsProxy=exports.EventsProxy=function(){function EventsProxy(domElem,opt){_classCallCheck(this,EventsProxy);this.scene=opt.scene;this.domElem=domElem;this.pos=_getPos(domElem);this.opt=this.callbacks=opt;this.size={width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight};this.attachEvents()}_createClass(EventsProxy,[{key:"attachEvents",value:function attachEvents(){var _this=this;var domElem=this.domElem;var opt=this.opt;if(opt.disableContextMenu){domElem.oncontextmenu=function(){return false}}if(opt.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)});var type="";if(!document.getBoxObjectFor&&window.mozInnerScreenX===null){type="mousewheel"}else{type="DOMMouseScroll"}domElem.addEventListener(type,function(e,win){_this["mousewheel"](_this.eventInfo("mousewheel",e,win))},false)}if(opt.enableTouch){["touchstart","touchmove","touchend"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}if(opt.enableKeyboard){["keydown","keyup"].forEach(function(action){document.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}}},{key:"eventInfo",value:function eventInfo(type,e,win){var domElem=this.domElem;var scene=this.scene;var opt=this.opt;var size=this.getSize();var relative=opt.relative;var centerOrigin=opt.centerOrigin;var pos=opt.cachePosition&&this.pos||_getPos(domElem);var ge=get(e,win);var epos=getPos(e,win);var origPos={x:epos[0].x,y:epos[0].y};var evt={};var x=void 0;var y=void 0;for(var i=0,l=epos.length;i<l;++i){x=epos[i].x;y=epos[i].y;if(relative){x-=pos.x;y-=pos.y;if(centerOrigin){x-=size.width/2;y-=size.height/2;y*=-1}}epos[i].x=x;epos[i].y=y}switch(type){case"mousewheel":evt.wheel=getWheel(ge);
break;case"keydown":case"keyup":Object.assign(evt,getKey(ge));break;case"mouseup":evt.isRightClick=isRightClick(ge);break;default:break}var cacheTarget=void 0;Object.assign(evt,{x:epos[0].x,y:epos[0].y,posArray:epos,cache:false,stop:function stop(){_stop(ge)},getTarget:function getTarget(){if(cacheTarget){return cacheTarget}return cacheTarget=opt.picking&&scene.pick(origPos.x-pos.x,origPos.y-pos.y)||true}});evt.event=ge;return evt}},{key:"getSize",value:function getSize(){if(this.cacheSize){return this.size}var domElem=this.domElem;return{width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight}}},{key:"mouseup",value:function mouseup(e){if(!this.moved){if(e.isRightClick){this.callbacks.onRightClick(e,this.hovered)}else{this.callbacks.onClick(e,toO3D(this.pressed))}}if(this.pressed){if(this.moved){this.callbacks.onDragEnd(e,toO3D(this.pressed))}else{this.callbacks.onDragCancel(e,toO3D(this.pressed))}this.pressed=this.moved=false}}},{key:"mouseout",value:function mouseout(e){var rt=e.relatedTarget;var domElem=this.domElem;while(rt&&rt.parentNode){if(domElem===rt.parentNode){return}rt=rt.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=false}}},{key:"mouseover",value:function mouseover(e){}},{key:"mousemove",value:function mousemove(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,toO3D(this.pressed));return}if(this.hovered){var target=toO3D(e.getTarget());if(!target||target.hash!==this.hash){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=target;this.hash=target;if(target){this.hash=target.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else{this.callbacks.onMouseMove(e,this.hovered)}}else{this.hovered=toO3D(e.getTarget());this.hash=this.hovered;if(this.hovered){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}}if(!this.opt.picking){this.callbacks.onMouseMove(e)}}},{key:"mousewheel",value:function mousewheel(e){this.callbacks.onMouseWheel(e)}},{key:"mousedown",value:function mousedown(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,toO3D(this.pressed))}},{key:"touchstart",value:function touchstart(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,toO3D(this.touched))}},{key:"touchmove",value:function touchmove(e){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(e,toO3D(this.touched))}}},{key:"touchend",value:function touchend(e){if(this.touched){if(this.touchMoved){this.callbacks.onTouchEnd(e,toO3D(this.touched))}else{e.x=isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,toO3D(this.touched));this.callbacks.onTouchCancel(e,toO3D(this.touched))}this.touched=this.touchMoved=false}}},{key:"keydown",value:function keydown(e){this.callbacks.onKeyDown(e)}},{key:"keyup",value:function keyup(e){this.callbacks.onKeyUp(e)}}]);return EventsProxy}();Object.assign(EventsProxy.prototype,{hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,moved:false});function addEvents(domElement){var opt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};opt=_extends({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,enableTouch:true,enableMouse:true,enableKeyboard:true,onClick:_utils.noop,onRightClick:_utils.noop,onDragStart:_utils.noop,onDragMove:_utils.noop,onDragEnd:_utils.noop,onDragCancel:_utils.noop,onTouchStart:_utils.noop,onTouchMove:_utils.noop,onTouchEnd:_utils.noop,onTouchCancel:_utils.noop,onTap:_utils.noop,onMouseMove:_utils.noop,onMouseEnter:_utils.noop,onMouseLeave:_utils.noop,onMouseWheel:_utils.noop,onKeyDown:_utils.noop,onKeyUp:_utils.noop},opt);var bind=opt.bind;if(bind){for(var name in opt){if(name.match(/^on[a-zA-Z0-9]+$/)){(function(fname,fn){opt[fname]=function f(){fn.apply(bind,Array.prototype.slice.call(arguments))}})(name,opt[name])}}}return new EventsProxy(domElement,opt)}var Keys=exports.Keys=KEYS;function keyOf(code){var keyMap=Keys;for(var name in keyMap){if(keyMap[name]===code){return name}}return null}},{"../utils":417}],371:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ILLEGAL_ARG="Geometry: Illegal argument";var Geometry=function(){function Geometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var id=_ref.id;var _ref$drawMode=_ref.drawMode;var drawMode=_ref$drawMode===undefined?"TRIANGLES":_ref$drawMode;var _ref$vertexCount=_ref.vertexCount;var vertexCount=_ref$vertexCount===undefined?undefined:_ref$vertexCount;var attributes=_ref.attributes;var attrs=_objectWithoutProperties(_ref,["id","drawMode","vertexCount","attributes"]);_classCallCheck(this,Geometry);(0,_assert2.default)(drawMode,ILLEGAL_ARG);this.id=id||(0,_utils.uid)(this.constructor.name);this.drawMode=drawMode;this.vertexCount=vertexCount;this.attributes={};this.needsRedraw=true;this.userData={};Object.seal(this);if(attributes){this.setAttributes(attributes)}else{this.setAttributes(attrs)}}_createClass(Geometry,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2$clearRedrawFlag=_ref2.clearRedrawFlags;var clearRedrawFlags=_ref2$clearRedrawFlag===undefined?false:_ref2$clearRedrawFlag;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount}},{key:"getVertexCount",value:function getVertexCount(){if(this.vertexCount!==undefined){return this.vertexCount}else if(this.attributes.indices){return this.attributes.indices.value.length}else if(this.attributes.vertices){return this.attributes.vertices.value.length/3}else if(this.attributes.positions){return this.attributes.positions.value.length/3}return false}},{key:"hasAttribute",value:function hasAttribute(attributeName){return Boolean(this.attributes[attributeName])}},{key:"getAttribute",value:function getAttribute(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getArray",value:function getArray(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(attributes){for(var attributeName in attributes){var attribute=attributes[attributeName];attribute=ArrayBuffer.isView(attribute)?{value:attribute}:attribute;(0,_assert2.default)(ArrayBuffer.isView(attribute.value),this._print(attributeName)+": must be a typed array or an object"+"with value as typed array");this._autoDetectAttribute(attributeName,attribute);this.attributes[attributeName]=_extends({},attribute,{instanced:attribute.instanced||0})}this.setNeedsRedraw();return this}},{key:"_autoDetectAttribute",value:function _autoDetectAttribute(attributeName,attribute){var category=void 0;switch(attributeName){case"indices":category=category||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":category="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":category="vectors";break}switch(category){case"vectors":attribute.size=attribute.size||3;break;case"uvs":attribute.size=attribute.size||2;break;case"indices":attribute.size=attribute.size||1;attribute.isIndexed=attribute.isIndexed||true;(0,_assert2.default)(attribute.value instanceof Uint16Array||attribute.value instanceof Uint32Array,'attribute array for "indices" must be of integer type');break}(0,_assert2.default)(attribute.size,"attribute "+attributeName+" needs size")}},{key:"_print",value:function _print(attributeName){return"Geometry "+this.id+" attribute "+attributeName}}]);return Geometry}();exports.default=Geometry},{"../utils":417,assert:4}],372:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _geometry=require("./geometry");Object.defineProperty(exports,"Geometry",{enumerable:true,get:function get(){return _interopRequireDefault(_geometry).default}});var _model=require("./model");Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _interopRequireDefault(_model).default}});var _animationFrame=require("./animation-frame");Object.defineProperty(exports,"AnimationFrame",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.keys(_animationFrame).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _animationFrame[key]}})});var _camera=require("./camera");Object.keys(_camera).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _camera[key]}})});var _event=require("./event");Object.keys(_event).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _event[key]}})});Object.defineProperty(exports,"FrameAnimator",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.defineProperty(exports,"Renderer",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.defineProperty(exports,"Animation",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./animation-frame":367,"./camera":368,"./event":370,"./geometry":371,"./model":373}],373:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.Material=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl");var _object3d=require("../scenegraph/object-3d");var _object3d2=_interopRequireDefault(_object3d);var _utils=require("../utils");var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MSG_INSTANCED_PARAM_DEPRECATED='Warning: Model constructor: parameter "instanced" renamed to "isInstanced".\nThis will become a hard error in a future version of luma.gl.';var MSG_TEXTURES_PARAM_REMOVED='Model: parameter "textures" removed. Use uniforms to set textures';var Material=exports.Material=function Material(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$shininess=_ref.shininess;var shininess=_ref$shininess===undefined?0:_ref$shininess;var _ref$reflection=_ref.reflection;var reflection=_ref$reflection===undefined?0:_ref$reflection;var _ref$refraction=_ref.refraction;var refraction=_ref$refraction===undefined?0:_ref$refraction;_classCallCheck(this,Material);this.shininess=shininess;this.reflection=reflection;this.refraction=refraction};var Model=function(_Object3D){_inherits(Model,_Object3D);function Model(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Model);opts=gl instanceof _webgl.WebGLRenderingContext?_extends({},opts,{gl:gl}):gl;var _this=_possibleConstructorReturn(this,(Model.__proto__||Object.getPrototypeOf(Model)).call(this,opts));_this.init(opts);return _this}_createClass(Model,[{key:"init",value:function init(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var program=_ref2.program;var _ref2$gl=_ref2.gl;var gl=_ref2$gl===undefined?null:_ref2$gl;var _ref2$vs=_ref2.vs;var vs=_ref2$vs===undefined?null:_ref2$vs;var _ref2$fs=_ref2.fs;var fs=_ref2$fs===undefined?null:_ref2$fs;var geometry=_ref2.geometry;var _ref2$material=_ref2.material;var material=_ref2$material===undefined?null:_ref2$material;var textures=_ref2.textures;var _ref2$isInstanced=_ref2.isInstanced;var isInstanced=_ref2$isInstanced===undefined?false:_ref2$isInstanced;var _ref2$instanceCount=_ref2.instanceCount;var instanceCount=_ref2$instanceCount===undefined?0:_ref2$instanceCount;var _ref2$vertexCount=_ref2.vertexCount;var vertexCount=_ref2$vertexCount===undefined?undefined:_ref2$vertexCount;var _ref2$pickable=_ref2.pickable;var pickable=_ref2$pickable===undefined?true:_ref2$pickable;var _ref2$pick=_ref2.pick;var pick=_ref2$pick===undefined?null:_ref2$pick;var _ref2$uniforms=_ref2.uniforms;var uniforms=_ref2$uniforms===undefined?{}:_ref2$uniforms;var _ref2$attributes=_ref2.attributes;var attributes=_ref2$attributes===undefined?{}:_ref2$attributes;var _ref2$render=_ref2.render;var render=_ref2$render===undefined?null:_ref2$render;var _ref2$onBeforeRender=_ref2.onBeforeRender;var onBeforeRender=_ref2$onBeforeRender===undefined?function(){}:_ref2$onBeforeRender;var _ref2$onAfterRender=_ref2.onAfterRender;var onAfterRender=_ref2$onAfterRender===undefined?function(){}:_ref2$onAfterRender;var opts=_objectWithoutProperties(_ref2,["program","gl","vs","fs","geometry","material","textures","isInstanced","instanceCount","vertexCount","pickable","pick","uniforms","attributes","render","onBeforeRender","onAfterRender"]);(0,_assert2.default)(geometry instanceof _geometry2.default,"Model needs a geometry");this.program=program||new _webgl.Program(gl,{vs:vs,fs:fs});(0,_assert2.default)(this.program instanceof _webgl.Program,"Model needs a program");if(opts.instanced){console.warn(MSG_INSTANCED_PARAM_DEPRECATED);isInstanced=isInstanced||opts.instanced}if(textures){throw new Error(MSG_TEXTURES_PARAM_REMOVED)}this.buffers={};this.userData={};this.drawParams={};this.dynamic=false;this.needsRedraw=true;this.material=material;this.setGeometry(geometry);this.attributes={};this.setAttributes(attributes);this.uniforms={};this.setUniforms(_extends({},this.program.defaultUniforms,uniforms));this.isInstanced=isInstanced;this.instanceCount=instanceCount;this.vertexCount=vertexCount;this.pickable=Boolean(pickable);this.pick=pick||function(){return false};this.onBeforeRender=onBeforeRender;this.onAfterRender=onAfterRender}},{key:"destroy",value:function destroy(){}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref3$clearRedrawFlag=_ref3.clearRedrawFlags;var clearRedrawFlags=_ref3$clearRedrawFlag===undefined?false:_ref3$clearRedrawFlag;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;redraw=redraw||this.geometry.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"setInstanceCount",value:function setInstanceCount(instanceCount){(0,_assert2.default)(instanceCount!==undefined);this.instanceCount=instanceCount;return this}},{key:"getInstanceCount",value:function getInstanceCount(){return this.instanceCount}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount;return this}},{key:"getVertexCount",value:function getVertexCount(){return this.vertexCount===undefined?this.geometry.getVertexCount():this.vertexCount}},{key:"isPickable",value:function isPickable(){return this.pickable}},{key:"setPickable",value:function setPickable(){var pickable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.pickable=Boolean(pickable);return this}},{key:"getProgram",value:function getProgram(){return this.program}},{key:"getGeometry",value:function getGeometry(){return this.geometry}},{key:"setGeometry",value:function setGeometry(geometry){this.geometry=geometry;this._createBuffersFromAttributeDescriptors(this.geometry.getAttributes());this.setNeedsRedraw();return this}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(){var attributes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Object.assign(this.attributes,attributes);this._createBuffersFromAttributeDescriptors(attributes);this.setNeedsRedraw();return this}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"setUniforms",value:function setUniforms(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};(0,_webgl.checkUniformValues)(uniforms,this.id);Object.assign(this.uniforms,uniforms);this.setNeedsRedraw();return this}},{key:"draw",value:function draw(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref4$uniforms=_ref4.uniforms;var uniforms=_ref4$uniforms===undefined?{}:_ref4$uniforms;var _ref4$attributes=_ref4.attributes;var attributes=_ref4$attributes===undefined?{}:_ref4$attributes;var _ref4$settings=_ref4.settings;var settings=_ref4$settings===undefined?{}:_ref4$settings;return this.render(uniforms)}},{key:"addViewUniforms",value:function addViewUniforms(uniforms){var camera=uniforms.camera;var viewMatrix=uniforms.viewMatrix;var modelMatrix=uniforms.modelMatrix;var otherUniforms=_objectWithoutProperties(uniforms,["camera","viewMatrix","modelMatrix"]);var cameraUniforms=camera?camera.getUniforms():{};var viewUniforms=viewMatrix?this.getCoordinateUniforms(viewMatrix,modelMatrix):{};return _extends({},cameraUniforms,viewUniforms,otherUniforms)}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var resolvedUniforms=this.addViewUniforms(uniforms);this.setUniforms(resolvedUniforms);_utils.log.log(2,">>> RENDERING MODEL "+this.id,this);this.setProgramState();this._logAttributesAndUniforms(3,resolvedUniforms);this.onBeforeRender();var drawParams=this.drawParams;if(drawParams.isInstanced&&!this.isInstanced){_utils.log.warn(0,"Found instanced attributes on non-instanced model")}var isIndexed=drawParams.isIndexed;var indexType=drawParams.indexType;var geometry=this.geometry;var isInstanced=this.isInstanced;var instanceCount=this.instanceCount;(0,_webgl.draw)(this.program.gl,{drawMode:geometry.drawMode,vertexCount:this.getVertexCount(),isIndexed:isIndexed,indexType:indexType,isInstanced:isInstanced,instanceCount:instanceCount});this.onAfterRender();this.unsetProgramState();this.setNeedsRedraw(false);_utils.log.log(2,"<<< RENDERING MODEL "+this.id+" - complete");return this}},{key:"setProgramState",value:function setProgramState(){var program=this.program;program.use();this.drawParams={};program.setBuffers(this.buffers,{drawParams:this.drawParams});program.setUniforms(this.uniforms);return this}},{key:"unsetProgramState",value:function unsetProgramState(){this.program.unsetBuffers();return this}},{key:"_createBuffersFromAttributeDescriptors",value:function _createBuffersFromAttributeDescriptors(attributes){var gl=this.program.gl;for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute instanceof _webgl.Buffer){this.buffers[attributeName]=attribute}else{this.buffers[attributeName]=this.buffers[attributeName]||new _webgl.Buffer(gl);var buffer=this.buffers[attributeName];buffer.setData(_extends({},attribute,{data:attribute.value,target:attribute.isIndexed?_webgl.GL.ELEMENT_ARRAY_BUFFER:_webgl.GL.ARRAY_BUFFER}))}}return this}},{key:"_logAttributesAndUniforms",value:function _logAttributesAndUniforms(){var priority=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;var uniforms=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(_utils.log.priority>=priority){var attributeTable=this._getAttributesTable({header:"Attributes "+this.id,program:this.program,attributes:_extends({},this.geometry.attributes,this.attributes)});_utils.log.table(priority,attributeTable);var _getUniformsTable=(0,_webgl.getUniformsTable)({header:"Uniforms "+this.id,program:this.program,uniforms:_extends({},this.uniforms,uniforms)});var table=_getUniformsTable.table;var unusedTable=_getUniformsTable.unusedTable;var unusedCount=_getUniformsTable.unusedCount;_utils.log.table(priority,table);_utils.log.log(priority,(unusedCount||"No")+" unused uniforms ",unusedTable)}}},{key:"_getAttributesTable",value:function _getAttributesTable(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var attributes=_ref5.attributes;var _ref5$header=_ref5.header;var header=_ref5$header===undefined?"Attributes":_ref5$header;var instanced=_ref5.instanced;var program=_ref5.program;(0,_assert2.default)(program);var attributeLocations=program._attributeLocations;var table=_defineProperty({},header,{});for(var attributeName in attributeLocations){var attribute=attributes[attributeName];var location=attributeLocations[attributeName];table[attributeName]=this._getAttributeEntry(attribute,location)}for(var _attributeName in attributes){var _attribute=attributes[_attributeName];if(!table[_attributeName]){table[_attributeName]=this._getAttributeEntry(_attribute,null)}}return table}},{key:"_getAttributeEntry",value:function _getAttributeEntry(attribute,location){var round=function round(num){return Math.round(num*10)/10};var type="NOT PROVIDED";var instanced=0;var size="N/A";var verts="N/A";var bytes="N/A";var value="N/A";if(attribute&&location===null){location=attribute.isIndexed?"ELEMENT_ARRAY_BUFFER":"NOT USED"}if(attribute instanceof _webgl.Buffer){var buffer=attribute;type=buffer.layout.type;instanced=buffer.layout.instanced;size=buffer.layout.size;verts=round(buffer.data.length/buffer.layout.size);bytes=buffer.data.length*buffer.data.BYTES_PER_ELEMENT}else if(attribute){type=attribute.value.constructor.name;instanced=attribute.instanced;size=attribute.size;verts=round(attribute.value.length/attribute.size);bytes=attribute.value.length*attribute.value.BYTES_PER_ELEMENT;value=attribute.value}type=String(type).replace("Array","");var isInteger=type.indexOf("nt")!==-1;location=""+location+(instanced?" [instanced]":"");return{Location:location,"Type Size x Verts = Bytes":type+" "+size+" x "+verts+" = "+bytes,Value:(0,_utils.formatValue)(value,{size:size,isInteger:isInteger})}}},{key:"setTextures",value:function setTextures(){var textures=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];throw new Error("model.setTextures replaced: setUniforms({sampler2D: new Texture2D})")}},{key:"hash",get:function get(){return this.id+" "+this.$pickingIndex}}]);return Model}(_object3d2.default);exports.default=Model},{"../scenegraph/object-3d":412,"../utils":417,"../webgl":427,"./geometry":371,assert:4}],374:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var AttributeManager=function(){function AttributeManager(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$id=_ref.id;var id=_ref$id===undefined?"attribute-manager":_ref$id;var otherProps=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,AttributeManager);this.id=id;this.attributes={};this.allocedInstances=-1;this.needsRedraw=true;this.userData={};this.onUpdateStart=noop;this.onUpdateEnd=noop;this.onLog=this._defaultLog;Object.seal(this)}_createClass(AttributeManager,[{key:"add",value:function add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"invalidate",value:function invalidate(attributeName){var attributes=this.attributes;var attribute=attributes[attributeName];(0,_assert2.default)(attribute);attribute.needsUpdate=true;this.onLog(1,"invalidated attribute "+attributeName+" for "+this.id)}},{key:"invalidateAll",value:function invalidateAll(){var attributes=this.attributes;for(var attributeName in attributes){this.invalidate(attributeName)}}},{key:"update",value:function update(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var data=_ref2.data;var numInstances=_ref2.numInstances;var _ref2$buffers=_ref2.buffers;var buffers=_ref2$buffers===undefined?{}:_ref2$buffers;var _ref2$props=_ref2.props;var props=_ref2$props===undefined?{}:_ref2$props;var _ref2$context=_ref2.context;var context=_ref2$context===undefined?{}:_ref2$context;var opts=_objectWithoutProperties(_ref2,["data","numInstances","buffers","props","context"]);this._checkExternalBuffers(buffers,opts);this._setExternalBuffers(buffers);if(this._analyzeBuffers({numInstances:numInstances})){this.onUpdateStart(this.id);this._updateBuffers({numInstances:numInstances,data:data,props:props,context:context});this.onUpdateEnd(this.id)}}},{key:"setLogFunctions",value:function setLogFunctions(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var onLog=_ref3.onLog;var onUpdateStart=_ref3.onUpdateStart;var onUpdateEnd=_ref3.onUpdateEnd;this.onLog=onLog!==undefined?onLog:this.onLog;this.onUpdateStart=onUpdateStart!==undefined?onUpdateStart:this.onUpdateStart;this.onUpdateEnd=onUpdateEnd!==undefined?onUpdateEnd:this.onUpdateEnd}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"getChangedAttributes",value:function getChangedAttributes(_ref4){var _ref4$clearChangedFla=_ref4.clearChangedFlags;var clearChangedFlags=_ref4$clearChangedFla===undefined?false:_ref4$clearChangedFla;var attributes=this.attributes;var changedAttributes={};for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.changed){attribute.changed=attribute.changed&&!clearChangedFlags;changedAttributes[attributeName]=attribute}}return changedAttributes}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref5$clearRedrawFlag=_ref5.clearRedrawFlags;var clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;var redraw=this.needsRedraw;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=true;return this}},{key:"addDynamic",value:function addDynamic(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"addInstanced",value:function addInstanced(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters,{instanced:1})}},{key:"_defaultLog",value:function _defaultLog(level,message){_utils.log.log(level,message)}},{key:"_add",value:function _add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _extraProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var newAttributes={};for(var attributeName in attributes){if(attributeName in updaters){attributes[attributeName]=_extends({},attributes[attributeName],updaters[attributeName])}var attribute=attributes[attributeName];this._validate(attributeName,attribute);var attributeData=_extends({target:undefined,isIndexed:false,userData:{}},attribute,{isExternalBuffer:false,needsAlloc:false,needsUpdate:false,changed:false,size:attribute.size,value:attribute.value||null},_extraProps);Object.seal(attributeData);this.attributes[attributeName]=attributeData;
}Object.assign(this.attributes,newAttributes)}},{key:"_validate",value:function _validate(attributeName,attribute){(0,_assert2.default)(typeof attribute.size==="number","Attribute definition for "+attributeName+" missing size");(0,_assert2.default)(typeof attribute.update==="function"||attribute.noAlloc,"Attribute updater for "+attributeName+" missing update method")}},{key:"_checkExternalBuffers",value:function _checkExternalBuffers(){var bufferMap=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributes=this.attributes;for(var attributeName in bufferMap){var attribute=attributes[attributeName];if(!attribute&&!opts.ignoreUnknownAttributes){throw new Error("Unknown attribute prop "+attributeName)}}}},{key:"_setExternalBuffers",value:function _setExternalBuffers(bufferMap){var attributes=this.attributes;var numInstances=this.numInstances;for(var attributeName in attributes){var attribute=attributes[attributeName];var buffer=bufferMap[attributeName];attribute.isExternalBuffer=false;if(buffer){if(!(buffer instanceof Float32Array)){throw new Error("Attribute properties must be of type Float32Array")}if(attribute.auto&&buffer.length<=numInstances*attribute.size){throw new Error("Attribute prop array must match length and size")}attribute.isExternalBuffer=true;attribute.needsUpdate=false;if(attribute.value!==buffer){attribute.value=buffer;attribute.changed=true;this.needsRedraw=true}}}}},{key:"_analyzeBuffers",value:function _analyzeBuffers(_ref6){var numInstances=_ref6.numInstances;var attributes=this.attributes;(0,_assert2.default)(numInstances!==undefined);var needsUpdate=false;for(var attributeName in attributes){var attribute=attributes[attributeName];if(!attribute.isExternalBuffer){var needsAlloc=attribute.value===null||attribute.value.length/attribute.size<numInstances;if(needsAlloc&&attribute.update){attribute.needsAlloc=true;needsUpdate=true}if(attribute.needsUpdate){needsUpdate=true}}}return needsUpdate}},{key:"_updateBuffers",value:function _updateBuffers(_ref7){var numInstances=_ref7.numInstances;var data=_ref7.data;var props=_ref7.props;var context=_ref7.context;var attributes=this.attributes;var allocCount=Math.max(numInstances,1);for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.needsAlloc){var ArrayType=attribute.type||Float32Array;attribute.value=new ArrayType(attribute.size*allocCount);this.onLog(2,this.id+":"+attributeName+" allocated "+allocCount);attribute.needsAlloc=false;attribute.needsUpdate=true}if(attribute.needsUpdate){var update=attribute.update;if(update){this.onLog(2,this.id+":"+attributeName+" updating "+numInstances);update.call(context,attribute,{data:data,props:props,numInstances:numInstances})}else{this.onLog(2,this.id+":"+attributeName+" missing update function")}attribute.needsUpdate=false;attribute.changed=true;this.needsRedraw=true}}this.allocedInstances=allocCount}}]);return AttributeManager}();exports.default=AttributeManager},{"../utils":417,assert:4}],375:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl/webgl");var _webglChecks=require("../webgl/webgl-checks");var _framebuffer=require("../webgl/framebuffer");var _framebuffer2=_interopRequireDefault(_framebuffer);var _renderbuffer=require("../webgl/renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _texture2d=require("../webgl/texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FramebufferObject=function(){function FramebufferObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref$width=_ref.width;var width=_ref$width===undefined?1:_ref$width;var _ref$height=_ref.height;var height=_ref$height===undefined?1:_ref$height;var _ref$depth=_ref.depth;var depth=_ref$depth===undefined?true:_ref$depth;var _ref$minFilter=_ref.minFilter;var minFilter=_ref$minFilter===undefined?_webgl.GL.NEAREST:_ref$minFilter;var _ref$magFilter=_ref.magFilter;var magFilter=_ref$magFilter===undefined?_webgl.GL.NEAREST:_ref$magFilter;var _ref$format=_ref.format;var format=_ref$format===undefined?_webgl.GL.RGBA:_ref$format;var _ref$type=_ref.type;var type=_ref$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref$type;_classCallCheck(this,FramebufferObject);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.depth=depth;this.minFilter=minFilter;this.magFilter=magFilter;this.format=format;this.type=type;this.resize(width,height)}_createClass(FramebufferObject,[{key:"delete",value:function _delete(){}},{key:"resize",value:function resize(width,height){(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}var gl=this.gl;var fb=new _framebuffer2.default(gl);var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:this.type,format:this.format});fb.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;if(this.depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});fb.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}fb.checkStatus();this.width=width;this.height=height;if(this.fb){this.fb.delete()}this.fb=fb}},{key:"bind",value:function bind(){this.fb.bind()}},{key:"unbind",value:function unbind(){this.fb.unbind()}}]);return FramebufferObject}();exports.default=FramebufferObject},{"../webgl/framebuffer":425,"../webgl/renderbuffer":429,"../webgl/texture-2d":431,"../webgl/webgl":442,"../webgl/webgl-checks":438,assert:4}],376:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _attributeManager=require("./attribute-manager");Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _interopRequireDefault(_attributeManager).default}});var _fbo=require("./fbo");Object.defineProperty(exports,"FramebufferObject",{enumerable:true,get:function get(){return _interopRequireDefault(_fbo).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./attribute-manager":374,"./fbo":375,"./math":377}],377:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _extendableBuiltin5(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _extendableBuiltin3(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var sqrt=Math.sqrt;var sin=Math.sin;var cos=Math.cos;var tan=Math.tan;var pi=Math.PI;var slice=Array.prototype.slice;var Vec3=exports.Vec3=function(_extendableBuiltin2){_inherits(Vec3,_extendableBuiltin2);function Vec3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vec3);var _this=_possibleConstructorReturn(this,(Vec3.__proto__||Object.getPrototypeOf(Vec3)).call(this,3));_this[0]=x;_this[1]=y;_this[2]=z;return _this}_createClass(Vec3,[{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=value}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=value}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=value}}],[{key:"create",value:function create(){return new Vec3(3)}}]);return Vec3}(_extendableBuiltin(Array));var generics={setVec3:function setVec3(dest,vec){dest[0]=vec[0];dest[1]=vec[1];dest[2]=vec[2];return dest},set:function set(dest,x,y,z){dest[0]=x;dest[1]=y;dest[2]=z;return dest},add:function add(dest,vec){return new Vec3(dest[0]+vec[0],dest[1]+vec[1],dest[2]+vec[2])},$add:function $add(dest,vec){dest[0]+=vec[0];dest[1]+=vec[1];dest[2]+=vec[2];return dest},add2:function add2(dest,a,b){dest[0]=a[0]+b[0];dest[1]=a[1]+b[1];dest[2]=a[2]+b[2];return dest},sub:function sub(dest,vec){return new Vec3(dest[0]-vec[0],dest[1]-vec[1],dest[2]-vec[2])},$sub:function $sub(dest,vec){dest[0]-=vec[0];dest[1]-=vec[1];dest[2]-=vec[2];return dest},sub2:function sub2(dest,a,b){dest[0]=a[0]-b[0];dest[1]=a[1]-b[1];dest[2]=a[2]-b[2];return dest},scale:function scale(dest,s){return new Vec3(dest[0]*s,dest[1]*s,dest[2]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;return dest},neg:function neg(dest){return new Vec3(-dest[0],-dest[1],-dest[2])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest},unit:function unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.scale(dest,1/len)}return Vec3.clone(dest)},$unit:function $unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.$scale(dest,1/len)}return dest},cross:function cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];return new Vec3(dy*vz-dz*vy,dz*vx-dx*vz,dx*vy-dy*vx)},$cross:function $cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];dest[0]=dy*vz-dz*vy;dest[1]=dz*vx-dx*vz;dest[2]=dx*vy-dy*vx;return dest},distTo:function distTo(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return sqrt(dx*dx+dy*dy+dz*dz)},distToSq:function distToSq(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return dx*dx+dy*dy+dz*dz},norm:function norm(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return sqrt(dx*dx+dy*dy+dz*dz)},normSq:function normSq(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return dx*dx+dy*dy+dz*dz},dot:function dot(dest,vec){return dest[0]*vec[0]+dest[1]*vec[1]+dest[2]*vec[2]},clone:function clone(dest){if(dest instanceof Vec3){return new Vec3(dest[0],dest[1],dest[2])}return Vec3.setVec3(new Float32Array(3),dest)},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];return ans}};var proto=Vec3.prototype;for(var method in generics){Vec3[method]=generics[method];proto[method]=function _(m){return function(){var args=slice.call(arguments);args.unshift(this);return Vec3[m].apply(Vec3,args)}}(method)}var Mat4=exports.Mat4=function(_extendableBuiltin4){_inherits(Mat4,_extendableBuiltin4);function Mat4(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){_classCallCheck(this,Mat4);var _this2=_possibleConstructorReturn(this,(Mat4.__proto__||Object.getPrototypeOf(Mat4)).call(this,16));_this2.length=16;if(typeof n11==="number"){_this2.set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44)}else{_this2.id()}_this2.typedContainer=new Float32Array(16);return _this2}_createClass(Mat4,[{key:"copy",value:function copy(src){for(var i=0;i<16;++i){this[i]=src[i]}return this}},{key:"n11",get:function get(){return this[0]},set:function set(val){this[0]=val}},{key:"n12",get:function get(){return this[4]},set:function set(val){this[4]=val}},{key:"n13",get:function get(){return this[8]},set:function set(val){this[8]=val}},{key:"n14",get:function get(){return this[12]},set:function set(val){this[12]=val}},{key:"n21",get:function get(){return this[1]},set:function set(val){this[1]=val}},{key:"n22",get:function get(){return this[5]},set:function set(val){this[5]=val}},{key:"n23",get:function get(){return this[9]},set:function set(val){this[9]=val}},{key:"n24",get:function get(){return this[13]},set:function set(val){this[13]=val}},{key:"n31",get:function get(){return this[2]},set:function set(val){this[2]=val}},{key:"n32",get:function get(){return this[6]},set:function set(val){this[6]=val}},{key:"n33",get:function get(){return this[10]},set:function set(val){this[10]=val}},{key:"n34",get:function get(){return this[14]},set:function set(val){this[14]=val}},{key:"n41",get:function get(){return this[3]},set:function set(val){this[3]=val}},{key:"n42",get:function get(){return this[7]},set:function set(val){this[7]=val}},{key:"n43",get:function get(){return this[11]},set:function set(val){this[11]=val}},{key:"n44",get:function get(){return this[15]},set:function set(val){this[15]=val}}],[{key:"create",value:function create(){return new Array(16)}}]);return Mat4}(_extendableBuiltin3(Array));generics={id:function id(dest){dest[0]=1;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=1;dest[6]=0;dest[7]=0;dest[8]=0;dest[9]=0;dest[10]=1;dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest},clone:function clone(dest){if(dest instanceof Mat4){return new Mat4(dest[0],dest[4],dest[8],dest[12],dest[1],dest[5],dest[9],dest[13],dest[2],dest[6],dest[10],dest[14],dest[3],dest[7],dest[11],dest[15])}return new typedArray(dest)},set:function set(dest,n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){dest[0]=n11;dest[4]=n12;dest[8]=n13;dest[12]=n14;dest[1]=n21;dest[5]=n22;dest[9]=n23;dest[13]=n24;dest[2]=n31;dest[6]=n32;dest[10]=n33;dest[14]=n34;dest[3]=n41;dest[7]=n42;dest[11]=n43;dest[15]=n44;return dest},mulVec3:function mulVec3(dest,vec){var ans=Vec3.clone(vec);return Mat4.$mulVec3(dest,ans)},$mulVec3:function $mulVec3(dest,vec){var vx=vec[0],vy=vec[1],vz=vec[2],d=1/(dest[3]*vx+dest[7]*vy+dest[11]*vz+dest[15]);vec[0]=(dest[0]*vx+dest[4]*vy+dest[8]*vz+dest[12])*d;vec[1]=(dest[1]*vx+dest[5]*vy+dest[9]*vz+dest[13])*d;vec[2]=(dest[2]*vx+dest[6]*vy+dest[10]*vz+dest[14])*d;return vec},mulMat42:function mulMat42(dest,a,b){var a11=a[0],a12=a[1],a13=a[2],a14=a[3],a21=a[4],a22=a[5],a23=a[6],a24=a[7],a31=a[8],a32=a[9],a33=a[10],a34=a[11],a41=a[12],a42=a[13],a43=a[14],a44=a[15],b11=b[0],b12=b[1],b13=b[2],b14=b[3],b21=b[4],b22=b[5],b23=b[6],b24=b[7],b31=b[8],b32=b[9],b33=b[10],b34=b[11],b41=b[12],b42=b[13],b43=b[14],b44=b[15];dest[0]=b11*a11+b12*a21+b13*a31+b14*a41;dest[1]=b11*a12+b12*a22+b13*a32+b14*a42;dest[2]=b11*a13+b12*a23+b13*a33+b14*a43;dest[3]=b11*a14+b12*a24+b13*a34+b14*a44;dest[4]=b21*a11+b22*a21+b23*a31+b24*a41;dest[5]=b21*a12+b22*a22+b23*a32+b24*a42;dest[6]=b21*a13+b22*a23+b23*a33+b24*a43;dest[7]=b21*a14+b22*a24+b23*a34+b24*a44;dest[8]=b31*a11+b32*a21+b33*a31+b34*a41;dest[9]=b31*a12+b32*a22+b33*a32+b34*a42;dest[10]=b31*a13+b32*a23+b33*a33+b34*a43;dest[11]=b31*a14+b32*a24+b33*a34+b34*a44;dest[12]=b41*a11+b42*a21+b43*a31+b44*a41;dest[13]=b41*a12+b42*a22+b43*a32+b44*a42;dest[14]=b41*a13+b42*a23+b43*a33+b44*a43;dest[15]=b41*a14+b42*a24+b43*a34+b44*a44;return dest},mulMat4:function mulMat4(a,b){var m=Mat4.clone(a);return Mat4.mulMat42(m,a,b)},$mulMat4:function $mulMat4(a,b){return Mat4.mulMat42(a,a,b)},add:function add(dest,m){var copy=Mat4.clone(dest);return Mat4.$add(copy,m)},$add:function $add(dest,m){dest[0]+=m[0];dest[1]+=m[1];dest[2]+=m[2];dest[3]+=m[3];dest[4]+=m[4];dest[5]+=m[5];dest[6]+=m[6];dest[7]+=m[7];dest[8]+=m[8];dest[9]+=m[9];dest[10]+=m[10];dest[11]+=m[11];dest[12]+=m[12];dest[13]+=m[13];dest[14]+=m[14];dest[15]+=m[15];return dest},transpose:function transpose(dest){var m=Mat4.clone(dest);return Mat4.$transpose(m)},$transpose:function $transpose(dest){var n4=dest[4],n8=dest[8],n12=dest[12],n1=dest[1],n9=dest[9],n13=dest[13],n2=dest[2],n6=dest[6],n14=dest[14],n3=dest[3],n7=dest[7],n11=dest[11];dest[1]=n4;dest[2]=n8;dest[3]=n12;dest[4]=n1;dest[6]=n9;dest[7]=n13;dest[8]=n2;dest[9]=n6;dest[11]=n14;dest[12]=n3;dest[13]=n7;dest[14]=n11;return dest},rotateAxis:function rotateAxis(dest,theta,vec){var m=Mat4.clone(dest);return Mat4.$rotateAxis(m,theta,vec)},$rotateAxis:function $rotateAxis(dest,theta,vec){var s=sin(theta),c=cos(theta),nc=1-c,vx=vec[0],vy=vec[1],vz=vec[2],m11=vx*vx*nc+c,m12=vx*vy*nc+vz*s,m13=vx*vz*nc-vy*s,m21=vy*vx*nc-vz*s,m22=vy*vy*nc+c,m23=vy*vz*nc+vx*s,m31=vx*vz*nc+vy*s,m32=vy*vz*nc-vx*s,m33=vz*vz*nc+c,d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],d41=dest[12],d42=dest[13],d43=dest[14],d44=dest[15];dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},rotateXYZ:function rotateXYZ(dest,rx,ry,rz){var ans=Mat4.clone(dest);return Mat4.$rotateXYZ(ans,rx,ry,rz)},$rotateXYZ:function $rotateXYZ(dest,rx,ry,rz){var d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],crx=cos(rx),cry=cos(ry),crz=cos(rz),srx=sin(rx),sry=sin(ry),srz=sin(rz),m11=cry*crz,m21=-crx*srz+srx*sry*crz,m31=srx*srz+crx*sry*crz,m12=cry*srz,m22=crx*crz+srx*sry*srz,m32=-srx*crz+crx*sry*srz,m13=-sry,m23=srx*cry,m33=crx*cry;dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},translate:function translate(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$translate(m,x,y,z)},$translate:function $translate(dest,x,y,z){dest[12]=dest[0]*x+dest[4]*y+dest[8]*z+dest[12];dest[13]=dest[1]*x+dest[5]*y+dest[9]*z+dest[13];dest[14]=dest[2]*x+dest[6]*y+dest[10]*z+dest[14];dest[15]=dest[3]*x+dest[7]*y+dest[11]*z+dest[15];return dest},scale:function scale(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$scale(m,x,y,z)},$scale:function $scale(dest,x,y,z){dest[0]*=x;dest[1]*=x;dest[2]*=x;dest[3]*=x;dest[4]*=y;dest[5]*=y;dest[6]*=y;dest[7]*=y;dest[8]*=z;dest[9]*=z;dest[10]*=z;dest[11]*=z;return dest},invert:function invert(dest){var m=Mat4.clone(dest);return Mat4.$invert(m)},$invert:function $invert(dest){var x0=dest[0],x1=dest[1],x2=dest[2],x3=dest[3],x4=dest[4],x5=dest[5],x6=dest[6],x7=dest[7],x8=dest[8],x9=dest[9],x10=dest[10],x11=dest[11],x12=dest[12],x13=dest[13],x14=dest[14],x15=dest[15];var a0=x0*x5-x1*x4,a1=x0*x6-x2*x4,a2=x0*x7-x3*x4,a3=x1*x6-x2*x5,a4=x1*x7-x3*x5,a5=x2*x7-x3*x6,b0=x8*x13-x9*x12,b1=x8*x14-x10*x12,b2=x8*x15-x11*x12,b3=x9*x14-x10*x13,b4=x9*x15-x11*x13,b5=x10*x15-x11*x14;var invdet=1/(a0*b5-a1*b4+a2*b3+a3*b2-a4*b1+a5*b0);dest[0]=(+x5*b5-x6*b4+x7*b3)*invdet;dest[1]=(-x1*b5+x2*b4-x3*b3)*invdet;dest[2]=(+x13*a5-x14*a4+x15*a3)*invdet;dest[3]=(-x9*a5+x10*a4-x11*a3)*invdet;dest[4]=(-x4*b5+x6*b2-x7*b1)*invdet;dest[5]=(+x0*b5-x2*b2+x3*b1)*invdet;dest[6]=(-x12*a5+x14*a2-x15*a1)*invdet;dest[7]=(+x8*a5-x10*a2+x11*a1)*invdet;dest[8]=(+x4*b4-x5*b2+x7*b0)*invdet;dest[9]=(-x0*b4+x1*b2-x3*b0)*invdet;dest[10]=(+x12*a4-x13*a2+x15*a0)*invdet;dest[11]=(-x8*a4+x9*a2-x11*a0)*invdet;dest[12]=(-x4*b3+x5*b1-x6*b0)*invdet;dest[13]=(+x0*b3-x1*b1+x2*b0)*invdet;dest[14]=(-x12*a3+x13*a1-x14*a0)*invdet;dest[15]=(+x8*a3-x9*a1+x10*a0)*invdet;return dest},lookAt:function lookAt(dest,eye,center,up){var z=Vec3.sub(eye,center);z.$unit();var x=Vec3.cross(up,z);x.$unit();var y=Vec3.cross(z,x);y.$unit();return Mat4.set(dest,x[0],x[1],x[2],-x.dot(eye),y[0],y[1],y[2],-y.dot(eye),z[0],z[1],z[2],-z.dot(eye),0,0,0,1)},frustum:function frustum(dest,left,right,bottom,top,near,far){var rl=right-left,tb=top-bottom,fn=far-near;dest[0]=near*2/rl;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=near*2/tb;dest[6]=0;dest[7]=0;dest[8]=(right+left)/rl;dest[9]=(top+bottom)/tb;dest[10]=-(far+near)/fn;dest[11]=-1;dest[12]=0;dest[13]=0;dest[14]=-(far*near*2)/fn;dest[15]=0;return dest},perspective:function perspective(dest,fov,aspect,near,far){var ymax=near*tan(fov*pi/360),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return Mat4.frustum(dest,xmin,xmax,ymin,ymax,near,far)},ortho:function ortho(dest,left,right,top,bottom,near,far){var te=this.elements,w=right-left,h=top-bottom,p=far-near,x=(right+left)/w,y=(top+bottom)/h,z=(far+near)/p;dest[0]=2/w;dest[4]=0;dest[8]=0;dest[12]=-x;dest[1]=0;dest[5]=2/h;dest[9]=0;dest[13]=-y;dest[2]=0;dest[6]=0;dest[10]=-2/p;dest[14]=-z;dest[3]=0;dest[7]=0;dest[11]=0;dest[15]=1;return dest},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];ans[3]=dest[3];ans[4]=dest[4];ans[5]=dest[5];ans[6]=dest[6];ans[7]=dest[7];ans[8]=dest[8];ans[9]=dest[9];ans[10]=dest[10];ans[11]=dest[11];ans[12]=dest[12];ans[13]=dest[13];ans[14]=dest[14];ans[15]=dest[15];return ans}};proto=Mat4.prototype;for(method in generics){Mat4[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Mat4[m].apply(Mat4,args)}}(method)}var Quat=exports.Quat=function(_extendableBuiltin6){_inherits(Quat,_extendableBuiltin6);function Quat(x,y,z,w){_classCallCheck(this,Quat);var _this3=_possibleConstructorReturn(this,(Quat.__proto__||Object.getPrototypeOf(Quat)).call(this,4));_this3[0]=x||0;_this3[1]=y||0;_this3[2]=z||0;_this3[3]=w||0;_this3.typedContainer=new Float32Array(4);return _this3}_createClass(Quat,null,[{key:"create",value:function create(){return new Array(4)}},{key:"fromVec3",value:function fromVec3(v,r){return new Quat(v[0],v[1],v[2],r||0)}},{key:"fromMat4",value:function fromMat4(m){var u;var v;var w;if(m[0]>m[5]&&m[0]>m[10]){u=0;v=1;w=2}else if(m[5]>m[0]&&m[5]>m[10]){u=1;v=2;w=0}else{u=2;v=0;w=1}var r=sqrt(1+m[u*5]-m[v*5]-m[w*5]);var q=new Quat;q[u]=.5*r;q[v]=.5*(m["n"+v+""+u]+m["n"+u+""+v])/r;q[w]=.5*(m["n"+u+""+w]+m["n"+w+""+u])/r;q[3]=.5*(m["n"+v+""+w]-m["n"+w+""+v])/r;return q}},{key:"fromXRotation",value:function fromXRotation(angle){return new Quat(sin(angle/2),0,0,cos(angle/2))}},{key:"fromYRotation",value:function fromYRotation(angle){return new Quat(0,sin(angle/2),0,cos(angle/2))}},{key:"fromZRotation",value:function fromZRotation(angle){return new Quat(0,0,sin(angle/2),cos(angle/2))}},{key:"fromAxisRotation",value:function fromAxisRotation(vec,angle){var x=vec[0],y=vec[1],z=vec[2],d=1/sqrt(x*x+y*y+z*z),s=sin(angle/2),c=cos(angle/2);return new Quat(s*x*d,s*y*d,s*z*d,c)}}]);return Quat}(_extendableBuiltin5(Array));generics={setQuat:function setQuat(dest,q){dest[0]=q[0];dest[1]=q[1];dest[2]=q[2];dest[3]=q[3];return dest},set:function set(dest,x,y,z,w){dest[0]=x||0;dest[1]=y||0;dest[2]=z||0;dest[3]=w||0;return dest},clone:function clone(dest){if(dest instanceof Quat){return new Quat(dest[0],dest[1],dest[2],dest[3])}return Quat.setQuat(new typedArray(4),dest)},neg:function neg(dest){return new Quat(-dest[0],-dest[1],-dest[2],-dest[3])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];dest[3]=-dest[3];return dest},add:function add(dest,q){return new Quat(dest[0]+q[0],dest[1]+q[1],dest[2]+q[2],dest[3]+q[3])},$add:function $add(dest,q){dest[0]+=q[0];dest[1]+=q[1];dest[2]+=q[2];dest[3]+=q[3];return dest},sub:function sub(dest,q){return new Quat(dest[0]-q[0],dest[1]-q[1],dest[2]-q[2],dest[3]-q[3])},$sub:function $sub(dest,q){dest[0]-=q[0];dest[1]-=q[1];dest[2]-=q[2];dest[3]-=q[3];return dest},scale:function scale(dest,s){return new Quat(dest[0]*s,dest[1]*s,dest[2]*s,dest[3]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;dest[3]*=s;return dest},mulQuat:function mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];return new Quat(aW*bX+aX*bW+aY*bZ-aZ*bY,aW*bY+aY*bW+aZ*bX-aX*bZ,aW*bZ+aZ*bW+aX*bY-aY*bX,aW*bW-aX*bX-aY*bY-aZ*bZ)},$mulQuat:function $mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];dest[0]=aW*bX+aX*bW+aY*bZ-aZ*bY;dest[1]=aW*bY+aY*bW+aZ*bX-aX*bZ;dest[2]=aW*bZ+aZ*bW+aX*bY-aY*bX;dest[3]=aW*bW-aX*bX-aY*bY-aZ*bZ;return dest},divQuat:function divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);return new Quat((aX*bW-aW*bX-aY*bZ+aZ*bY)*d,(aX*bZ-aW*bY+aY*bW-aZ*bX)*d,(aY*bX+aZ*bW-aW*bZ-aX*bY)*d,(aW*bW+aX*bX+aY*bY+aZ*bZ)*d)},$divQuat:function $divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);dest[0]=(aX*bW-aW*bX-aY*bZ+aZ*bY)*d;dest[1]=(aX*bZ-aW*bY+aY*bW-aZ*bX)*d;dest[2]=(aY*bX+aZ*bW-aW*bZ-aX*bY)*d;dest[3]=(aW*bW+aX*bX+aY*bY+aZ*bZ)*d;return dest},invert:function invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);return new Quat(-q0*d,-q1*d,-q2*d,q3*d)},$invert:function $invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);dest[0]=-q0*d;dest[1]=-q1*d;dest[2]=-q2*d;dest[3]=q3*d;return dest},norm:function norm(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return sqrt(a*a+b*b+c*c+d*d)},normSq:function normSq(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return a*a+b*b+c*c+d*d},unit:function unit(dest){return Quat.scale(dest,1/Quat.norm(dest))},$unit:function $unit(dest){return Quat.$scale(dest,1/Quat.norm(dest))},conjugate:function conjugate(dest){return new Quat(-dest[0],-dest[1],-dest[2],dest[3])},$conjugate:function $conjugate(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest}};proto=Quat.prototype={};for(method in generics){Quat[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Quat[m].apply(Quat,args)}}(method)}Vec3.fromQuat=function(q){return new Vec3(q[0],q[1],q[2])};Mat4.fromQuat=function(q){var a=q[3],b=q[0],c=q[1],d=q[2];return new Mat4(a*a+b*b-c*c-d*d,2*b*c-2*a*d,2*b*d+2*a*c,0,2*b*c+2*a*d,a*a-b*b+c*c-d*d,2*c*d-2*a*b,0,2*b*d-2*a*c,2*c*d+2*a*b,a*a-b*b-c*c+d*d,0,0,0,0,1)}},{}],378:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.ConeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _truncatedCone=require("./truncated-cone");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ConeGeometry=exports.ConeGeometry=function(_TruncatedConeGeometr){_inherits(ConeGeometry,_TruncatedConeGeometr);function ConeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$radius=_ref.radius;var radius=_ref$radius===undefined?1:_ref$radius;var _ref$cap=_ref.cap;var cap=_ref$cap===undefined?true:_ref$cap;var opts=_objectWithoutProperties(_ref,["radius","cap"]);_classCallCheck(this,ConeGeometry);return _possibleConstructorReturn(this,(ConeGeometry.__proto__||Object.getPrototypeOf(ConeGeometry)).call(this,_extends({},opts,{topRadius:0,topCap:Boolean(cap),bottomCap:Boolean(cap),bottomRadius:radius})))}return ConeGeometry}(_truncatedCone.TruncatedConeGeometry);var Cone=function(_Model){_inherits(Cone,_Model);function Cone(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Cone);return _possibleConstructorReturn(this,(Cone.__proto__||Object.getPrototypeOf(Cone)).call(this,_extends({geometry:new ConeGeometry(opts)},opts)))}return Cone}(_model2.default);exports.default=Cone;
},{"../core/model":373,"./truncated-cone":385}],379:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.CubeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CUBE_INDICES=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];var CUBE_POSITIONS=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];var CUBE_NORMALS=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];var CUBE_TEX_COORDS=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1];var CubeGeometry=exports.CubeGeometry=function(_Geometry){_inherits(CubeGeometry,_Geometry);function CubeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$id=_ref.id;var id=_ref$id===undefined?(0,_utils.uid)("cube-geometry"):_ref$id;var opts=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,CubeGeometry);return _possibleConstructorReturn(this,(CubeGeometry.__proto__||Object.getPrototypeOf(CubeGeometry)).call(this,_extends({},opts,{id:id,attributes:{indices:new Uint16Array(CUBE_INDICES),positions:new Float32Array(CUBE_POSITIONS),normals:new Float32Array(CUBE_NORMALS),texCoords:new Float32Array(CUBE_TEX_COORDS)}})))}return CubeGeometry}(_geometry2.default);var Cube=function(_Model){_inherits(Cube,_Model);function Cube(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2$id=_ref2.id;var id=_ref2$id===undefined?(0,_utils.uid)("cube"):_ref2$id;var opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Cube);return _possibleConstructorReturn(this,(Cube.__proto__||Object.getPrototypeOf(Cube)).call(this,_extends({},opts,{id:id,geometry:new CubeGeometry(opts)})))}return Cube}(_model2.default);exports.default=Cube},{"../core/geometry":371,"../core/model":373,"../utils":417}],380:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.CylinderGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _truncatedCone=require("./truncated-cone");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CylinderGeometry=exports.CylinderGeometry=function(_TruncatedConeGeometr){_inherits(CylinderGeometry,_TruncatedConeGeometr);function CylinderGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$radius=_ref.radius;var radius=_ref$radius===undefined?1:_ref$radius;var opts=_objectWithoutProperties(_ref,["radius"]);_classCallCheck(this,CylinderGeometry);return _possibleConstructorReturn(this,(CylinderGeometry.__proto__||Object.getPrototypeOf(CylinderGeometry)).call(this,_extends({},opts,{bottomRadius:radius,topRadius:radius})))}return CylinderGeometry}(_truncatedCone.TruncatedConeGeometry);var Cylinder=function(_Model){_inherits(Cylinder,_Model);function Cylinder(opts){_classCallCheck(this,Cylinder);return _possibleConstructorReturn(this,(Cylinder.__proto__||Object.getPrototypeOf(Cylinder)).call(this,_extends({},opts,{geometry:new CylinderGeometry(opts)})))}return Cylinder}(_model2.default);exports.default=Cylinder},{"../core/model":373,"./truncated-cone":385}],381:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.IcoSphereGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _math=require("../math");var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function noop(){}var ICO_POSITIONS=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0];var ICO_INDICES=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];var IcoSphereGeometry=exports.IcoSphereGeometry=function(_Geometry){_inherits(IcoSphereGeometry,_Geometry);function IcoSphereGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$iterations=_ref.iterations;var iterations=_ref$iterations===undefined?0:_ref$iterations;var _ref$onAddVertex=_ref.onAddVertex;var onAddVertex=_ref$onAddVertex===undefined?noop:_ref$onAddVertex;var opts=_objectWithoutProperties(_ref,["iterations","onAddVertex"]);_classCallCheck(this,IcoSphereGeometry);var PI=Math.PI;var PI2=PI*2;var positions=[].concat(ICO_POSITIONS);var indices=[].concat(ICO_INDICES);positions.push();indices.push();var getMiddlePoint=function(){var pointMemo={};return function(i1,i2){i1*=3;i2*=3;var mini=i1<i2?i1:i2;var maxi=i1>i2?i1:i2;var key=mini+"|"+maxi;if(key in pointMemo){return pointMemo[key]}var x1=positions[i1];var y1=positions[i1+1];var z1=positions[i1+2];var x2=positions[i2];var y2=positions[i2+1];var z2=positions[i2+2];var xm=(x1+x2)/2;var ym=(y1+y2)/2;var zm=(z1+z2)/2;var len=Math.sqrt(xm*xm+ym*ym+zm*zm);xm/=len;ym/=len;zm/=len;positions.push(xm,ym,zm);return pointMemo[key]=positions.length/3-1}}();for(var i=0;i<iterations;i++){var indices2=[];for(var j=0;j<indices.length;j+=3){var a=getMiddlePoint(indices[j+0],indices[j+1]);var b=getMiddlePoint(indices[j+1],indices[j+2]);var c=getMiddlePoint(indices[j+2],indices[j+0]);indices2.push(c,indices[j+0],a,a,indices[j+1],b,b,indices[j+2],c,a,b,c)}indices=indices2}var normals=new Array(indices.length*3);var texCoords=new Array(indices.length*2);var l=indices.length;for(var _i=l-3;_i>=0;_i-=3){var i1=indices[_i+0];var i2=indices[_i+1];var i3=indices[_i+2];var in1=i1*3;var in2=i2*3;var in3=i3*3;var iu1=i1*2;var iu2=i2*2;var iu3=i3*2;var x1=positions[in1+0];var y1=positions[in1+1];var z1=positions[in1+2];var theta1=Math.acos(z1/Math.sqrt(x1*x1+y1*y1+z1*z1));var phi1=Math.atan2(y1,x1)+PI;var v1=theta1/PI;var u1=1-phi1/PI2;var x2=positions[in2+0];var y2=positions[in2+1];var z2=positions[in2+2];var theta2=Math.acos(z2/Math.sqrt(x2*x2+y2*y2+z2*z2));var phi2=Math.atan2(y2,x2)+PI;var v2=theta2/PI;var u2=1-phi2/PI2;var x3=positions[in3+0];var y3=positions[in3+1];var z3=positions[in3+2];var theta3=Math.acos(z3/Math.sqrt(x3*x3+y3*y3+z3*z3));var phi3=Math.atan2(y3,x3)+PI;var v3=theta3/PI;var u3=1-phi3/PI2;var vec1=[x3-x2,y3-y2,z3-z2];var vec2=[x1-x2,y1-y2,z1-z2];var normal=_math.Vector3.cross(vec1,vec2).normalize();var newIndex=void 0;if((u1===0||u2===0||u3===0)&&(u1===0||u1>.5)&&(u2===0||u2>.5)&&(u3===0||u3>.5)){positions.push(positions[in1+0],positions[in1+1],positions[in1+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v1;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in2+0],positions[in2+1],positions[in2+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v2;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in3+0],positions[in3+1],positions[in3+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v3;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z}normals[in1+0]=normals[in2+0]=normals[in3+0]=normal.x;normals[in1+1]=normals[in2+1]=normals[in3+1]=normal.y;normals[in1+2]=normals[in2+2]=normals[in3+2]=normal.z;texCoords[iu1+0]=u1;texCoords[iu1+1]=v1;texCoords[iu2+0]=u2;texCoords[iu2+1]=v2;texCoords[iu3+0]=u3;texCoords[iu3+1]=v3}return _possibleConstructorReturn(this,(IcoSphereGeometry.__proto__||Object.getPrototypeOf(IcoSphereGeometry)).call(this,_extends({},opts,{attributes:{positions:new Float32Array(positions),normals:new Float32Array(normals),texCoords:new Float32Array(texCoords),indices:new Uint16Array(indices)}})))}return IcoSphereGeometry}(_geometry2.default);var IcoSphere=function(_Model){_inherits(IcoSphere,_Model);function IcoSphere(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,IcoSphere);return _possibleConstructorReturn(this,(IcoSphere.__proto__||Object.getPrototypeOf(IcoSphere)).call(this,_extends({},opts,{geometry:new IcoSphereGeometry(opts)})))}return IcoSphere}(_model2.default);exports.default=IcoSphere},{"../core/geometry":371,"../core/model":373,"../math":399}],382:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _cone=require("./cone");Object.defineProperty(exports,"Cone",{enumerable:true,get:function get(){return _interopRequireDefault(_cone).default}});Object.defineProperty(exports,"ConeGeometry",{enumerable:true,get:function get(){return _cone.ConeGeometry}});var _cube=require("./cube");Object.defineProperty(exports,"Cube",{enumerable:true,get:function get(){return _interopRequireDefault(_cube).default}});Object.defineProperty(exports,"CubeGeometry",{enumerable:true,get:function get(){return _cube.CubeGeometry}});var _cylinder=require("./cylinder");Object.defineProperty(exports,"Cylinder",{enumerable:true,get:function get(){return _interopRequireDefault(_cylinder).default}});Object.defineProperty(exports,"CylinderGeometry",{enumerable:true,get:function get(){return _cylinder.CylinderGeometry}});var _icoSphere=require("./ico-sphere");Object.defineProperty(exports,"IcoSphere",{enumerable:true,get:function get(){return _interopRequireDefault(_icoSphere).default}});Object.defineProperty(exports,"IcoSphereGeometry",{enumerable:true,get:function get(){return _icoSphere.IcoSphereGeometry}});var _plane=require("./plane");Object.defineProperty(exports,"Plane",{enumerable:true,get:function get(){return _interopRequireDefault(_plane).default}});Object.defineProperty(exports,"PlaneGeometry",{enumerable:true,get:function get(){return _plane.PlaneGeometry}});var _sphere=require("./sphere");Object.defineProperty(exports,"Sphere",{enumerable:true,get:function get(){return _interopRequireDefault(_sphere).default}});Object.defineProperty(exports,"SphereGeometry",{enumerable:true,get:function get(){return _sphere.SphereGeometry}});Object.defineProperty(exports,"TruncatedCone",{enumerable:true,get:function get(){return _interopRequireDefault(_cone).default}});Object.defineProperty(exports,"TruncatedConeGeometry",{enumerable:true,get:function get(){return _cone.TruncatedConeGeometry}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./cone":378,"./cube":379,"./cylinder":380,"./ico-sphere":381,"./plane":383,"./sphere":384}],383:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.PlaneGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PlaneGeometry=exports.PlaneGeometry=function(_Geometry){_inherits(PlaneGeometry,_Geometry);function PlaneGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$type=_ref.type;var type=_ref$type===undefined?"x,y":_ref$type;var _ref$offset=_ref.offset;var offset=_ref$offset===undefined?0:_ref$offset;var _ref$flipCull=_ref.flipCull;var flipCull=_ref$flipCull===undefined?false:_ref$flipCull;var _ref$unpack=_ref.unpack;var unpack=_ref$unpack===undefined?false:_ref$unpack;var _ref$id=_ref.id;var id=_ref$id===undefined?(0,_utils.uid)("plane-geometry"):_ref$id;var opts=_objectWithoutProperties(_ref,["type","offset","flipCull","unpack","id"]);_classCallCheck(this,PlaneGeometry);var coords=type.split(",");var c1len=opts[coords[0]+"len"];var c2len=opts[coords[1]+"len"];var subdivisions1=opts["n"+coords[0]]||1;var subdivisions2=opts["n"+coords[1]]||1;var numVertices=(subdivisions1+1)*(subdivisions2+1);var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);if(flipCull){c1len=-c1len}var i2=0;var i3=0;for(var z=0;z<=subdivisions2;z++){for(var x=0;x<=subdivisions1;x++){var u=x/subdivisions1;var v=z/subdivisions2;texCoords[i2+0]=flipCull?1-u:u;texCoords[i2+1]=v;switch(type){case"x,y":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=c2len*v-c2len*.5;positions[i3+2]=offset;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=flipCull?1:-1;break;case"x,z":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=offset;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=0;normals[i3+1]=flipCull?1:-1;normals[i3+2]=0;break;case"y,z":positions[i3+0]=offset;positions[i3+1]=c1len*u-c1len*.5;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=flipCull?1:-1;normals[i3+1]=0;normals[i3+2]=0;break;default:break}i2+=2;i3+=3}}var numVertsAcross=subdivisions1+1;var indices=new Uint16Array(subdivisions1*subdivisions2*6);for(var _z=0;_z<subdivisions2;_z++){for(var _x2=0;_x2<subdivisions1;_x2++){var index=(_z*subdivisions1+_x2)*6;indices[index+0]=(_z+0)*numVertsAcross+_x2;indices[index+1]=(_z+1)*numVertsAcross+_x2;indices[index+2]=(_z+0)*numVertsAcross+_x2+1;indices[index+3]=(_z+1)*numVertsAcross+_x2;indices[index+4]=(_z+1)*numVertsAcross+_x2+1;indices[index+5]=(_z+0)*numVertsAcross+_x2+1}}if(unpack){var positions2=new Float32Array(indices.length*3);var normals2=new Float32Array(indices.length*3);var texCoords2=new Float32Array(indices.length*2);for(var _x3=0;_x3<indices.length;++_x3){var _index=indices[_x3];positions2[_x3*3+0]=positions[_index*3+0];positions2[_x3*3+1]=positions[_index*3+1];positions2[_x3*3+2]=positions[_index*3+2];normals2[_x3*3+0]=normals[_index*3+0];normals2[_x3*3+1]=normals[_index*3+1];normals2[_x3*3+2]=normals[_index*3+2];texCoords2[_x3*2+0]=texCoords[_index*2+0];texCoords2[_x3*2+1]=texCoords[_index*2+1]}positions=positions2;normals=normals2;texCoords=texCoords2;indices=undefined}return _possibleConstructorReturn(this,(PlaneGeometry.__proto__||Object.getPrototypeOf(PlaneGeometry)).call(this,_extends({},opts,{id:id,attributes:_extends({positions:positions,normals:normals,texCoords:texCoords},indices?{indices:indices}:{})})))}return PlaneGeometry}(_geometry2.default);var Plane=function(_Model){_inherits(Plane,_Model);function Plane(_ref2){var _ref2$id=_ref2.id;var id=_ref2$id===undefined?(0,_utils.uid)("plane"):_ref2$id;var opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Plane);return _possibleConstructorReturn(this,(Plane.__proto__||Object.getPrototypeOf(Plane)).call(this,_extends({},opts,{id:id,geometry:new PlaneGeometry(opts)})))}return Plane}(_model2.default);exports.default=Plane},{"../core/geometry":371,"../core/model":373,"../utils":417}],384:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.SphereGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SphereGeometry=exports.SphereGeometry=function(_Geometry){_inherits(SphereGeometry,_Geometry);function SphereGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$nlat=_ref.nlat;var nlat=_ref$nlat===undefined?10:_ref$nlat;var _ref$nlong=_ref.nlong;var nlong=_ref$nlong===undefined?10:_ref$nlong;var _ref$radius=_ref.radius;var radius=_ref$radius===undefined?1:_ref$radius;var _ref$id=_ref.id;var id=_ref$id===undefined?(0,_utils.uid)("sphere-geometry"):_ref$id;var opts=_objectWithoutProperties(_ref,["nlat","nlong","radius","id"]);_classCallCheck(this,SphereGeometry);var startLat=0;var endLat=Math.PI;var latRange=endLat-startLat;var startLong=0;var endLong=2*Math.PI;var longRange=endLong-startLong;var numVertices=(nlat+1)*(nlong+1);if(typeof radius==="number"){(function(){var value=radius;radius=function radius(n1,n2,n3,u,v){return value}})()}var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nlat*nlong*6);for(var y=0;y<=nlat;y++){for(var x=0;x<=nlong;x++){var u=x/nlong;var v=y/nlat;var index=x+y*(nlong+1);var i2=index*2;var i3=index*3;var theta=longRange*u;var phi=latRange*v;var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);var sinPhi=Math.sin(phi);var cosPhi=Math.cos(phi);var ux=cosTheta*sinPhi;var uy=cosPhi;var uz=sinTheta*sinPhi;var r=radius(ux,uy,uz,u,v);positions[i3+0]=r*ux;positions[i3+1]=r*uy;positions[i3+2]=r*uz;normals[i3+0]=ux;normals[i3+1]=uy;normals[i3+2]=uz;texCoords[i2+0]=u;texCoords[i2+1]=v}}var numVertsAround=nlat+1;for(var _x2=0;_x2<nlat;_x2++){for(var _y=0;_y<nlong;_y++){var _index=(_x2*nlong+_y)*6;indices[_index+0]=_y*numVertsAround+_x2;indices[_index+1]=_y*numVertsAround+_x2+1;indices[_index+2]=(_y+1)*numVertsAround+_x2;indices[_index+3]=(_y+1)*numVertsAround+_x2;indices[_index+4]=_y*numVertsAround+_x2+1;indices[_index+5]=(_y+1)*numVertsAround+_x2+1}}return _possibleConstructorReturn(this,(SphereGeometry.__proto__||Object.getPrototypeOf(SphereGeometry)).call(this,_extends({},opts,{id:id,attributes:{positions:positions,indices:indices,normals:normals,texCoords:texCoords}})))}return SphereGeometry}(_geometry2.default);var Sphere=function(_Model){_inherits(Sphere,_Model);function Sphere(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2$id=_ref2.id;var id=_ref2$id===undefined?(0,_utils.uid)("sphere"):_ref2$id;var opts=_objectWithoutProperties(_ref2,["id"]);_classCallCheck(this,Sphere);return _possibleConstructorReturn(this,(Sphere.__proto__||Object.getPrototypeOf(Sphere)).call(this,_extends({},opts,{id:id,geometry:new SphereGeometry(opts)})))}return Sphere}(_model2.default);exports.default=Sphere},{"../core/geometry":371,"../core/model":373,"../utils":417}],385:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.TruncatedConeGeometry=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _geometry=require("../core/geometry");var _geometry2=_interopRequireDefault(_geometry);var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TruncatedConeGeometry=exports.TruncatedConeGeometry=function(_Geometry){_inherits(TruncatedConeGeometry,_Geometry);function TruncatedConeGeometry(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$bottomRadius=_ref.bottomRadius;var bottomRadius=_ref$bottomRadius===undefined?0:_ref$bottomRadius;var _ref$topRadius=_ref.topRadius;var topRadius=_ref$topRadius===undefined?0:_ref$topRadius;var _ref$height=_ref.height;var height=_ref$height===undefined?1:_ref$height;var _ref$nradial=_ref.nradial;var nradial=_ref$nradial===undefined?10:_ref$nradial;var _ref$nvertical=_ref.nvertical;var nvertical=_ref$nvertical===undefined?10:_ref$nvertical;var _ref$topCap=_ref.topCap;var topCap=_ref$topCap===undefined?false:_ref$topCap;var _ref$bottomCap=_ref.bottomCap;var bottomCap=_ref$bottomCap===undefined?false:_ref$bottomCap;var opts=_objectWithoutProperties(_ref,["bottomRadius","topRadius","height","nradial","nvertical","topCap","bottomCap"]);_classCallCheck(this,TruncatedConeGeometry);var extra=(topCap?2:0)+(bottomCap?2:0);var numVertices=(nradial+1)*(nvertical+1+extra);var slant=Math.atan2(bottomRadius-topRadius,height);var msin=Math.sin;var mcos=Math.cos;var mpi=Math.PI;var cosSlant=mcos(slant);var sinSlant=msin(slant);var start=topCap?-2:0;var end=nvertical+(bottomCap?2:0);var vertsAroundEdge=nradial+1;var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nradial*(nvertical+extra)*6);var i3=0;var i2=0;for(var i=start;i<=end;i++){var v=i/nvertical;var y=height*v;var ringRadius=void 0;if(i<0){y=0;v=1;ringRadius=bottomRadius}else if(i>nvertical){y=height;v=1;ringRadius=topRadius}else{ringRadius=bottomRadius+(topRadius-bottomRadius)*(i/nvertical)}if(i===-2||i===nvertical+2){ringRadius=0;v=0}y-=height/2;for(var j=0;j<vertsAroundEdge;j++){var sin=msin(j*mpi*2/nradial);var cos=mcos(j*mpi*2/nradial);positions[i3+0]=sin*ringRadius;positions[i3+1]=y;positions[i3+2]=cos*ringRadius;normals[i3+0]=i<0||i>nvertical?0:sin*cosSlant;normals[i3+1]=i<0?-1:i>nvertical?1:sinSlant;normals[i3+2]=i<0||i>nvertical?0:cos*cosSlant;texCoords[i2+0]=j/nradial;texCoords[i2+1]=v;i2+=2;i3+=3}}for(var _i=0;_i<nvertical+extra;_i++){for(var _j=0;_j<nradial;_j++){var index=(_i*nradial+_j)*6;indices[index+0]=vertsAroundEdge*(_i+0)+0+_j;indices[index+1]=vertsAroundEdge*(_i+0)+1+_j;indices[index+2]=vertsAroundEdge*(_i+1)+1+_j;indices[index+3]=vertsAroundEdge*(_i+0)+0+_j;indices[index+4]=vertsAroundEdge*(_i+1)+1+_j;indices[index+5]=vertsAroundEdge*(_i+1)+0+_j}}return _possibleConstructorReturn(this,(TruncatedConeGeometry.__proto__||Object.getPrototypeOf(TruncatedConeGeometry)).call(this,_extends({},opts,{attributes:{positions:positions,normals:normals,texCoords:texCoords,indices:indices}})))}return TruncatedConeGeometry}(_geometry2.default);var TruncatedCone=function(_Model){_inherits(TruncatedCone,_Model);function TruncatedCone(opts){_classCallCheck(this,TruncatedCone);return _possibleConstructorReturn(this,(TruncatedCone.__proto__||Object.getPrototypeOf(TruncatedCone)).call(this,_extends({},opts,{geometry:new TruncatedConeGeometry(opts)})))}return TruncatedCone}(_model2.default);exports.default=TruncatedCone},{"../core/geometry":371,"../core/model":373}],386:[function(require,module,exports){(function(global){"use strict";var _isBrowser=require("./utils/is-browser");var _isBrowser2=_interopRequireDefault(_isBrowser);var _package=require("../package.json");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _global=_isBrowser2.default?window:global;var luma={VERSION:_package.version,globals:{headlessGL:null,headlessTypes:null,modules:{},nodeIO:{}},global:_global};if(_global.luma&&_global.luma.VERSION!==luma.VERSION){var versions=_global.luma.VERSION+" vs "+luma.VERSION;throw new Error("luma.gl - multiple versions detected: "+versions)}_global.luma=luma;module.exports=luma}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":446,"./utils/is-browser":418}],387:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _withoutIo=require("./without-io");Object.keys(_withoutIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _withoutIo[key]}})});var _io=require("./io");Object.keys(_io).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _io[key]}})});var _globals=require("./globals");var _globals2=_interopRequireDefault(_globals);var io=_interopRequireWildcard(_io);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.assign(_globals2.default,io)},{"./globals":386,"./io":392,"./without-io":445}],388:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.writeFile=writeFile;exports.readFile=readFile;var _utils=require("../../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var savedNavigatorExists="navigator"in global;var savedNavigator=global.navigator;if(!_utils.isBrowser){global.navigator={userAgent:"MSIE 9."}}var saveAs=require("filesaver.js");if(!_utils.isBrowser){if(savedNavigatorExists){global.navigator=savedNavigator}else{delete global.navigator}}var window=require("global/window");var File=window.File;
var Blob=window.Blob;function writeFile(file,data,options){var callback=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(){};if(callback===undefined&&typeof options==="function"){options=undefined;callback=options}if(typeof data==="string"){data=new Blob(data)}return new Promise(function(resolve,reject){var result=void 0;try{result=saveAs(data,file,options)}catch(error){reject(error);return callback(error,null)}resolve();return callback(null,result)})}function readFile(file){return new Promise(function(resolve,reject){try{(function(){(0,_assert2.default)(File,"window.File not defined. Must run under browser.");(0,_assert2.default)(file instanceof File,"parameter must be a File object");var reader=new window.FileReader;reader.onerror=function(e){return reject(new Error(getFileErrorMessage(e)))};reader.onabort=function(){return reject(new Error("Read operation was aborted."))};reader.onload=function(){return resolve(reader.result)};reader.readAsText(file)})()}catch(error){reject(error)}})}function getFileErrorMessage(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return"File not found.";case e.target.error.NOT_READABLE_ERR:return"File not readable.";case e.target.error.ABORT_ERR:return"Read operation was aborted.";case e.target.error.SECURITY_ERR:return"File is in a locked state.";case e.target.error.ENCODING_ERR:return'File is too long to encode in "data://" URL.';default:return"Read error."}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../utils":417,assert:4,"filesaver.js":323,"global/window":347}],389:[function(require,module,exports){(function(process,Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.compressImage=compressImage;exports.loadImage=loadImage;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _through=require("through");var _through2=_interopRequireDefault(_through);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compressImage(image,type){if(image instanceof HTMLCanvasElement){var _canvas=image;return _canvas.toDataURL(type)}(0,_assert2.default)(image instanceof Image,"getImageData accepts image or canvas");var canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;canvas.getContext("2d").drawImage(image,0,0);var data=canvas.toDataURL(type||"png").replace(/^data:image\/(png|jpg);base64,/,"");var result=(0,_through2.default)();process.nextTick(function(){return result.end(new Buffer(data,"base64"))});return result}function loadImage(url){return new Promise(function(resolve,reject){try{(function(){var image=new Image;image.onload=function(){return resolve(image)};image.onerror=function(){return reject(new Error("Could not load image "+url+"."))};image.src=url})()}catch(error){reject(error)}})}}).call(this,require("_process"),require("buffer").Buffer)},{_process:488,assert:4,buffer:13,through:506}],390:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.loadFile=loadFile;function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var XHR_STATES={UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETED:4};var XHR=function(){function XHR(_ref){var url=_ref.url;var _ref$path=_ref.path;var path=_ref$path===undefined?null:_ref$path;var _ref$method=_ref.method;var method=_ref$method===undefined?"GET":_ref$method;var _ref$async=_ref.async;var async=_ref$async===undefined?true:_ref$async;var _ref$noCache=_ref.noCache;var noCache=_ref$noCache===undefined?false:_ref$noCache;var _ref$sendAsBinary=_ref.sendAsBinary;var sendAsBinary=_ref$sendAsBinary===undefined?false:_ref$sendAsBinary;var _ref$responseType=_ref.responseType;var responseType=_ref$responseType===undefined?false:_ref$responseType;var _ref$onProgress=_ref.onProgress;var onProgress=_ref$onProgress===undefined?noop:_ref$onProgress;var _ref$onSuccess=_ref.onSuccess;var onSuccess=_ref$onSuccess===undefined?noop:_ref$onSuccess;var _ref$onError=_ref.onError;var onError=_ref$onError===undefined?noop:_ref$onError;var _ref$onAbort=_ref.onAbort;var onAbort=_ref$onAbort===undefined?noop:_ref$onAbort;var _ref$onComplete=_ref.onComplete;var onComplete=_ref$onComplete===undefined?noop:_ref$onComplete;var opt=_objectWithoutProperties(_ref,["url","path","method","async","noCache","sendAsBinary","responseType","onProgress","onSuccess","onError","onAbort","onComplete"]);_classCallCheck(this,XHR);this.url=path?path.join(path,url):url;this.method=method;this.async=async;this.noCache=noCache;this.sendAsBinary=sendAsBinary;this.responseType=responseType;this.req=new XMLHttpRequest;this.req.onload=function(e){return onComplete(e)};this.req.onerror=function(e){return onError(e)};this.req.onabort=function(e){return onAbort(e)};this.req.onprogress=function(e){if(e.lengthComputable){onProgress(e,Math.round(e.loaded/e.total*100))}else{onProgress(e,-1)}}}_createClass(XHR,[{key:"setRequestHeader",value:function setRequestHeader(header,value){this.req.setRequestHeader(header,value);return this}},{key:"sendAsync",value:function sendAsync(){var _this=this;var body=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.body||null;return new Promise(function(resolve,reject){try{(function(){var req=_this.req;var method=_this.method;var async=_this.async;var noCache=_this.noCache;var sendAsBinary=_this.sendAsBinary;var responseType=_this.responseType;var url=noCache?_this.url+(_this.url.indexOf("?")>=0?"&":"?")+Date.now():_this.url;req.open(method,url,async);if(responseType){req.responseType=responseType}if(async){req.onreadystatechange=function(e){if(req.readyState===XHR_STATES.COMPLETED){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}}}if(sendAsBinary){req.sendAsBinary(body)}else{req.send(body)}if(!async){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}})()}catch(error){reject(error)}})}}]);return XHR}();function loadFile(opts){var xhr=new XHR(opts);return xhr.sendAsync()}},{}],391:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.browserFs=exports.loadFile=undefined;var _browserRequest=require("./browser-request");Object.defineProperty(exports,"loadFile",{enumerable:true,get:function get(){return _browserRequest.loadFile}});var _browserImageIo=require("./browser-image-io");Object.keys(_browserImageIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _browserImageIo[key]}})});var _browserFs=require("./browser-fs");var browserFs=_interopRequireWildcard(_browserFs);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.browserFs=browserFs},{"./browser-fs":388,"./browser-image-io":389,"./browser-request":390}],392:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _platform=require("./platform");Object.keys(_platform).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _platform[key]}})});var _loadFiles=require("./load-files");Object.keys(_loadFiles).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _loadFiles[key]}})})},{"./load-files":393,"./platform":396}],393:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.loadFiles=loadFiles;exports.loadImages=loadImages;exports.loadTextures=loadTextures;exports.loadProgram=loadProgram;exports.loadModel=loadModel;exports.parseModel=parseModel;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _platform=require("./platform");var _webgl=require("../webgl");var _core=require("../core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function noop(){}function loadFiles(_ref){var urls=_ref.urls;var _ref$onProgress=_ref.onProgress;var onProgress=_ref$onProgress===undefined?noop:_ref$onProgress;var opts=_objectWithoutProperties(_ref,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_platform.loadFile)(_extends({url:url},opts));promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadImages(_ref2){var urls=_ref2.urls;var _ref2$onProgress=_ref2.onProgress;var onProgress=_ref2$onProgress===undefined?noop:_ref2$onProgress;var opts=_objectWithoutProperties(_ref2,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_platform.loadImage)(url);promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadTextures(gl,_ref3){var urls=_ref3.urls;var _ref3$onProgress=_ref3.onProgress;var onProgress=_ref3$onProgress===undefined?noop:_ref3$onProgress;var opts=_objectWithoutProperties(_ref3,["urls","onProgress"]);(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadTextures: {urls} must be array of strings");return loadImages(_extends({urls:urls,onProgress:onProgress},opts)).then(function(images){return images.map(function(img,i){var params=Array.isArray(opts.parameters)?opts.parameters[i]:opts.parameters;params=params===undefined?{}:params;return new _webgl.Texture2D(gl,_extends({id:urls[i]},params,{data:img}))})})}function loadProgram(gl,_ref4){var vs=_ref4.vs;var fs=_ref4.fs;var _ref4$onProgress=_ref4.onProgress;var onProgress=_ref4$onProgress===undefined?noop:_ref4$onProgress;var opts=_objectWithoutProperties(_ref4,["vs","fs","onProgress"]);return loadFiles(_extends({urls:[vs,fs],onProgress:onProgress},opts)).then(function(_ref5){var _ref6=_slicedToArray(_ref5,2);var vsText=_ref6[0];var fsText=_ref6[1];return new _webgl.Program(gl,_extends({vs:vsText,fs:fsText},opts))})}function loadModel(gl,_ref7){var url=_ref7.url;var _ref7$onProgress=_ref7.onProgress;var onProgress=_ref7$onProgress===undefined?noop:_ref7$onProgress;var opts=_objectWithoutProperties(_ref7,["url","onProgress"]);return loadFiles(_extends({urls:[url],onProgress:onProgress},opts)).then(function(_ref8){var _ref9=_slicedToArray(_ref8,1);var file=_ref9[0];return parseModel(gl,_extends({file:file},opts))})}function parseModel(gl,_ref10){var file=_ref10.file;var _ref10$program=_ref10.program;var program=_ref10$program===undefined?new _webgl.Program(gl):_ref10$program;var opts=_objectWithoutProperties(_ref10,["file","program"]);var json=typeof file==="string"?parseJSON(file):file;var attributes={};var modelOptions={};for(var key in json){var value=json[key];if(Array.isArray(value)){attributes[key]=key==="indices"?new Uint16Array(value):new Float32Array(value)}else{modelOptions[key]=value}}return new _core.Model(_extends({program:program,geometry:new _core.Geometry({attributes:attributes})},modelOptions,opts))}function parseJSON(file){try{return JSON.parse(file)}catch(error){throw new Error("Failed to parse JSON: "+error)}}},{"../core":372,"../webgl":427,"./platform":396,assert:4}],394:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.compressImage=compressImage;exports.loadImage=loadImage;var _getPixels=require("get-pixels");var _getPixels2=_interopRequireDefault(_getPixels);var _savePixels=require("save-pixels");var _savePixels2=_interopRequireDefault(_savePixels);var _ndarray=require("ndarray");var _ndarray2=_interopRequireDefault(_ndarray);var _fs=require("fs");var _utils=require("../../utils");var _globals=require("../../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compressImage(image){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"png";return(0,_savePixels2.default)((0,_ndarray2.default)(image.data,[image.width,image.height,4],[4,image.width*4,1],0),type.replace("image/",""))}var getPixelsAsync=(0,_utils.promisify)(_getPixels2.default);function loadImage(url){return getPixelsAsync(url)}_globals2.default.globals.modules.getPixels=_getPixels2.default;_globals2.default.globals.modules.savePixels=_savePixels2.default;_globals2.default.globals.modules.ndarray=_ndarray2.default;_globals2.default.globals.nodeIO={readFile:_fs.readFile,writeFile:_fs.writeFile,compressImage:compressImage,loadImage:loadImage}},{"../../globals":386,"../../utils":417,fs:12,"get-pixels":325,ndarray:452,"save-pixels":503}],395:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _headlessIo=require("./headless-io");Object.keys(_headlessIo).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _headlessIo[key]}})})},{"./headless-io":394}],396:[function(require,module,exports){"use strict";var _utils=require("../utils");module.exports=_utils.isBrowser?require("./browser"):require("./node")},{"../utils":417,"./browser":391,"./node":395}],397:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glMatrix=undefined;exports.configure=configure;exports.formatValue=formatValue;exports.isArray=isArray;exports.clone=clone;exports.radians=radians;exports.degrees=degrees;exports.sin=sin;exports.cos=cos;exports.tan=tan;exports.asin=asin;exports.acos=acos;exports.atan=atan;exports.clamp=clamp;exports.equals=equals;var _glMatrix=require("gl-matrix");_glMatrix.glMatrix.debug=true;_glMatrix.glMatrix.printRowMajor=true;exports.glMatrix=_glMatrix.glMatrix;function configure(options){if("epsilon"in options){_glMatrix.glMatrix.EPSILON=options.epsilon}if("debug"in options){_glMatrix.glMatrix.debug=options.debug}}function formatValue(value){var precision=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_glMatrix.glMatrix.precision||4;return parseFloat(value.toPrecision(precision))}function isArray(value){return Array.isArray(value)||ArrayBuffer.isView(value)&&value.length}function clone(array){return array.clone?array.clone():new Array(array)}function map(value,func){if(isArray(value)){var result=clone(value);for(var i=0;i<result.length;++i){result[i]=func(result[i],i,result)}return result}return func(value)}function radians(degrees){return map(degrees,function(degrees){return degrees/180*Math.PI})}function degrees(radians){return map(radians,function(radians){return radians*180/Math.PI})}function sin(radians){return map(radians,function(angle){return Math.sin(angle)})}function cos(radians){return map(radians,function(angle){return Math.cos(angle)})}function tan(radians){return map(radians,function(angle){return Math.tan(angle)})}function asin(radians){return map(radians,function(angle){return Math.asin(angle)})}function acos(radians){return map(radians,function(angle){return Math.acos(angle)})}function atan(radians){return map(radians,function(angle){return Math.atan(angle)})}function clamp(value,min,max){return Math.max(min,Math.min(max,value))}function equals(a,b){return Math.abs(a-b)<=_glMatrix.glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}},{"gl-matrix":337}],398:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _matrix=require("./matrix4");var _quaternion=require("./quaternion");var _vector=require("./vector3");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ERR_UNKNOWN_ORDER="Unknown Euler angle order";var ALMOST_ONE=.99999;function validateOrder(value){return value>=0&&value<6}function checkOrder(value){if(value<0&&value>=6){throw new Error(ERR_UNKNOWN_ORDER)}return value}var Euler=function(_MathArray){_inherits(Euler,_MathArray);_createClass(Euler,[{key:"ELEMENTS",get:function get(){return 4}}],[{key:"rotationOrder",value:function rotationOrder(order){return Euler.RotationOrders[order]}},{key:"ZYX",get:function get(){return 0}},{key:"YXZ",get:function get(){return 1}},{key:"XZY",get:function get(){return 2}},{key:"ZXY",get:function get(){return 3}},{key:"YZX",get:function get(){return 4}},{key:"XYZ",get:function get(){return 5}},{key:"RollPitchYaw",get:function get(){return 0}},{key:"DefaultOrder",get:function get(){return Euler.ZYX}},{key:"RotationOrders",get:function get(){return["ZYX","YXZ","XZY","ZXY","YZX","XYZ"]}}]);function Euler(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Euler.DefaultOrder;_classCallCheck(this,Euler);var _this=_possibleConstructorReturn(this,(Euler.__proto__||Object.getPrototypeOf(Euler)).call(this));if(arguments.length>0&&Array.isArray(arguments[0])){_this.fromVector3.apply(_this,arguments)}else{_this.set(x,y,z,order)}return _this}_createClass(Euler,[{key:"copy",value:function copy(array){for(var i=0;i<3;++i){this[i]=array[i]}this[3]=Number.isFinite(array[3])||this.order;this.check();return this}},{key:"set",value:function set(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments[3];this[0]=x;this[1]=y;this[2]=z;this[3]=Number.isFinite(order)?order:this[3];this.check();return this}},{key:"validate",value:function validate(){return validateOrder(this[3])&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2])}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];return array}},{key:"toArray4",value:function toArray4(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];array[offset+3]=this[3];return array}},{key:"toVector3",value:function toVector3(optionalResult){if(optionalResult){return optionalResult.set(this[0],this[1],this[2])}return new _vector.Vector3(this[0],this[1],this[2])}},{key:"fromVector3",value:function fromVector3(v,order){return this.set(v[0],v[1],v[2],Number.isFinite(order)?order:this[3])}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this[0]=array[0+offset];this[1]=array[1+offset];this[2]=array[2+offset];if(array[3]!==undefined){this[3]=array[3]}this.check();return this}},{key:"fromRollPitchYaw",value:function fromRollPitchYaw(roll,pitch,yaw){return this.set(roll,pitch,yaw,Euler.ZYX)}},{key:"fromQuaternion",value:function fromQuaternion(q,order){this._fromRotationMatrix(_matrix.Matrix4.fromQuaternion(q),order);this.check();return this}},{key:"fromRotationMatrix",value:function fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;this._fromRotationMatrix(m,order);this.check();return this}},{key:"getRotationMatrix",value:function getRotationMatrix(){var m=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new _matrix.Matrix4;this._getRotationMatrix(m);return m}},{key:"getQuaternion",value:function getQuaternion(){var q=new _quaternion.Quaternion;switch(this[4]){case Euler.XYZ:return q.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case Euler.YXZ:return q.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case Euler.ZXY:return q.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case Euler.ZYX:return q.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case Euler.YZX:return q.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case Euler.XZY:return q.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(ERR_UNKNOWN_ORDER)}}},{key:"_fromRotationMatrix",value:function _fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this[3];switch(order){case Euler.XYZ:this[1]=Math.asin((0,_common.clamp)(m13,-1,1));if(Math.abs(m13)<ALMOST_ONE){this[0]=Math.atan2(-m23,m33);this[2]=Math.atan2(-m12,m11)}else{this[0]=Math.atan2(m32,m22);this[2]=0}break;case Euler.YXZ:this[0]=Math.asin(-(0,_common.clamp)(m23,-1,1));if(Math.abs(m23)<ALMOST_ONE){this[1]=Math.atan2(m13,m33);this[2]=Math.atan2(m21,m22)}else{this[1]=Math.atan2(-m31,m11);this[2]=0}break;case Euler.ZXY:this[0]=Math.asin((0,_common.clamp)(m32,-1,1));if(Math.abs(m32)<ALMOST_ONE){this[1]=Math.atan2(-m31,m33);this[2]=Math.atan2(-m12,m22)}else{this[1]=0;this[2]=Math.atan2(m21,m11)}break;case Euler.ZYX:this[1]=Math.asin(-(0,_common.clamp)(m31,-1,1));if(Math.abs(m31)<ALMOST_ONE){this[0]=Math.atan2(m32,m33);this[2]=Math.atan2(m21,m11)}else{this[0]=0;this[2]=Math.atan2(-m12,m22)}break;case Euler.YZX:this[2]=Math.asin((0,_common.clamp)(m21,-1,1));if(Math.abs(m21)<ALMOST_ONE){this[0]=Math.atan2(-m23,m22);this[1]=Math.atan2(-m31,m11)}else{this[0]=0;this[1]=Math.atan2(m13,m33)}break;case Euler.XZY:this[2]=Math.asin(-(0,_common.clamp)(m12,-1,1));if(Math.abs(m12)<ALMOST_ONE){this[0]=Math.atan2(m32,m22);this[1]=Math.atan2(m13,m11)}else{this[0]=Math.atan2(-m23,m33);this[1]=0}break;default:throw new Error(ERR_UNKNOWN_ORDER)}this[3]=order;return this}},{key:"_getRotationMatrix",value:function _getRotationMatrix(){var te=new _matrix.Matrix4;var x=this.x,y=this.y,z=this.z;var a=Math.cos(x);var c=Math.cos(y);var e=Math.cos(z);var b=Math.sin(x);var d=Math.sin(y);var f=Math.sin(z);switch(this[3]){case Euler.XYZ:{var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c;break}case Euler.YXZ:{var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c;break}case Euler.ZXY:{var _ce=c*e,_cf=c*f,_de=d*e,_df=d*f;te[0]=_ce-_df*b;te[4]=-a*f;te[8]=_de+_cf*b;te[1]=_cf+_de*b;te[5]=a*e;te[9]=_df-_ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c;break}case Euler.ZYX:{var _ae=a*e,_af=a*f,_be=b*e,_bf=b*f;te[0]=c*e;te[4]=_be*d-_af;te[8]=_ae*d+_bf;te[1]=c*f;te[5]=_bf*d+_ae;te[9]=_af*d-_be;te[2]=-d;te[6]=b*c;te[10]=a*c;break}case Euler.YZX:{var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f;break}case Euler.XZY:{var _ac=a*c,_ad=a*d,_bc=b*c,_bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=_ac*f+_bd;te[5]=a*e;te[9]=_ad*f-_bc;te[2]=_bc*f-_ad;te[6]=b*e;te[10]=_bd*f+_ac;break}default:throw new Error(ERR_UNKNOWN_ORDER)}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"alpha",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"beta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"gamma",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"phi",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"theta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"psi",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"order",get:function get(){return this[3]},set:function set(value){return this[3]=checkOrder(value)}}]);return Euler}(_mathArray2.default);exports.default=Euler},{"./common":397,"./math-array":400,"./matrix4":401,"./quaternion":402,"./vector3":406}],399:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _common=require("./common");Object.keys(_common).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _common[key]}})});var _vector=require("./vector2");Object.defineProperty(exports,"Vector2",{enumerable:true,get:function get(){return _interopRequireDefault(_vector).default}});var _vector2=require("./vector3");Object.defineProperty(exports,"Vector3",{enumerable:true,get:function get(){return _interopRequireDefault(_vector2).default}});var _vector3=require("./vector4");Object.defineProperty(exports,"Vector4",{enumerable:true,get:function get(){return _interopRequireDefault(_vector3).default}});var _matrix=require("./matrix4");Object.defineProperty(exports,"Matrix4",{enumerable:true,get:function get(){return _interopRequireDefault(_matrix).default}});var _quaternion=require("./quaternion");Object.defineProperty(exports,"Quaternion",{enumerable:true,get:function get(){return _interopRequireDefault(_quaternion).default}});var _euler=require("./euler");Object.defineProperty(exports,"Euler",{enumerable:true,get:function get(){return _interopRequireDefault(_euler).default}});exports.tapeEquals=tapeEquals;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function tapeEquals(t,a,b,msg,extra){t._assert(a.equals(b),{message:msg||"should be equal",operator:"equal",actual:a,expected:b,extra:extra})}},{"./common":397,"./euler":398,"./matrix4":401,"./quaternion":402,"./vector2":405,"./vector3":406,"./vector4":407}],400:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _common=require("./common");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var MathArray=function(_extendableBuiltin2){_inherits(MathArray,_extendableBuiltin2);function MathArray(){_classCallCheck(this,MathArray);return _possibleConstructorReturn(this,(MathArray.__proto__||Object.getPrototypeOf(MathArray)).apply(this,arguments));
}_createClass(MathArray,[{key:"clone",value:function clone(){var Subclass=this.constructor;var clone=(new Subclass).copy(this);clone.check();return clone}},{key:"copy",value:function copy(array){for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i]}this.check();return this}},{key:"set",value:function set(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<this.ELEMENTS;++i){this[i]=args[i]||0}this.check();return this}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i+offset]}this.check();return this}},{key:"toString",value:function toString(){var string="";for(var i=0;i<this.ELEMENTS;++i){string+=(i>0?", ":"")+(0,_common.formatValue)(this[i])}return this.constructor.name+"("+string+")"}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){array[offset+i]=this[i]}return array}},{key:"toFloat32Array",value:function toFloat32Array(){return new Float32Array(this)}},{key:"equals",value:function equals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(!(0,_common.equals)(this[i],array[i])){return false}}return true}},{key:"exactEquals",value:function exactEquals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(this[i]!==array[i]){return false}}return true}},{key:"validate",value:function validate(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;var valid=array.length===this.ELEMENTS;for(var i=0;i<this.ELEMENTS;++i){valid=valid&&Number.isFinite(array[i])}return valid}},{key:"check",value:function check(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;if(_common.glMatrix.debug&&!this.validate(array)){throw new Error("Invalid "+this.constructor.name)}}}]);return MathArray}(_extendableBuiltin(Array));exports.default=MathArray},{"./common":397}],401:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _vector=require("./vector2");var _vector2=_interopRequireDefault(_vector);var _vector3=require("./vector3");var _vector4=_interopRequireDefault(_vector3);var _vector5=require("./vector4");var _vector6=_interopRequireDefault(_vector5);var _decorators=require("./utils/decorators");var _glMatrix=require("gl-matrix");var _validators=require("./utils/validators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Matrix4=(_class=function(_MathArray){_inherits(Matrix4,_MathArray);function Matrix4(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Matrix4);var _this=_possibleConstructorReturn(this,(Matrix4.__proto__||Object.getPrototypeOf(Matrix4)).call(this));if(Array.isArray(args[0])&&arguments.length===1){_this.copy(args[0])}else{_this.identity()}return _this}_createClass(Matrix4,[{key:"setRowMajor",value:function setRowMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m10=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m20=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m30=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m01=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m21=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m31=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m02=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m12=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m32=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m03=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m13=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m23=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"setColumnMajor",value:function setColumnMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m01=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m02=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m03=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m10=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m12=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m13=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m20=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m21=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m23=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m30=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m31=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m32=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"equals",value:function equals(a){return _glMatrix.mat4.equals(this,a)}},{key:"exactEquals",value:function exactEquals(a){return _glMatrix.mat4.exactEquals(this,a)}},{key:"toString",value:function toString(){if(_common.glMatrix.printRowMajor){_glMatrix.mat4.str(this)}else{_glMatrix.mat4.str(this)}}},{key:"determinant",value:function determinant(){return _glMatrix.mat4.determinant(this)}},{key:"getRotation",value:function getRotation(){}},{key:"identity",value:function identity(){_glMatrix.mat4.identity(this);this.check();return this}},{key:"frustum",value:function frustum(_ref){var left=_ref.left;var right=_ref.right;var bottom=_ref.bottom;var top=_ref.top;var near=_ref.near;var far=_ref.far;_glMatrix.mat4.frustum(this,left,right,bottom,top,near,far);this.check();return this}},{key:"lookAt",value:function lookAt(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var eye=_ref2.eye;var _ref2$center=_ref2.center;var center=_ref2$center===undefined?[0,0,0]:_ref2$center;var _ref2$up=_ref2.up;var up=_ref2$up===undefined?[0,1,0]:_ref2$up;_glMatrix.mat4.lookAt(this,eye,center,up);this.check();return this}},{key:"ortho",value:function ortho(_ref3){var left=_ref3.left;var right=_ref3.right;var bottom=_ref3.bottom;var top=_ref3.top;var _ref3$near=_ref3.near;var near=_ref3$near===undefined?.1:_ref3$near;var _ref3$far=_ref3.far;var far=_ref3$far===undefined?500:_ref3$far;_glMatrix.mat4.ortho(this,left,right,bottom,top,near,far);this.check();return this}},{key:"perspective",value:function perspective(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref4$fov=_ref4.fov;var fov=_ref4$fov===undefined?45*Math.PI/180:_ref4$fov;var _ref4$aspect=_ref4.aspect;var aspect=_ref4$aspect===undefined?1:_ref4$aspect;var _ref4$near=_ref4.near;var near=_ref4$near===undefined?.1:_ref4$near;var _ref4$far=_ref4.far;var far=_ref4$far===undefined?500:_ref4$far;if(fov>Math.PI*2){throw Error("radians")}_glMatrix.mat4.perspective(this,fov,aspect,near,far);this.check();return this}},{key:"perspectiveFromFieldOfView",value:function perspectiveFromFieldOfView(out,fov,near,far){_glMatrix.mat4.perspectiveFromFieldOfView(out,fov,near,far);this.check();return this}},{key:"fromQuaternion",value:function fromQuaternion(q){_glMatrix.mat4.fromQuat(this,q);this.check();return this}},{key:"fromQuat",value:function fromQuat(q){_glMatrix.mat4.fromQuat(this,q);this.check();return this}},{key:"fromRotation",value:function fromRotation(rad,axis){_glMatrix.mat4.fromRotation(this,rad,axis);this.check();return this}},{key:"fromRotationTranslation",value:function fromRotationTranslation(q,v){_glMatrix.mat4.fromRotationTranslation(this,q,v);this.check();return this}},{key:"fromRotationTranslationScale",value:function fromRotationTranslationScale(q,v,s){_glMatrix.mat4.fromRotationTranslationScale(this,q,v,s);this.check();return this}},{key:"fromRotationTranslationScaleOrigin",value:function fromRotationTranslationScaleOrigin(q,v,s,o){_glMatrix.mat4.fromRotationTranslationScaleOrigin(this,q,v,s,o);this.check();return this}},{key:"fromScaling",value:function fromScaling(v){_glMatrix.mat4.fromScaling(this,v);this.check();return this}},{key:"fromTranslation",value:function fromTranslation(v){_glMatrix.mat4.fromTranslation(this,v);this.check();return this}},{key:"fromXRotation",value:function fromXRotation(rad){_glMatrix.mat4.fromXRotation(this,rad);this.check();return this}},{key:"fromYRotation",value:function fromYRotation(rad){_glMatrix.mat4.fromYRotation(this,rad);this.check();return this}},{key:"fromZRotation",value:function fromZRotation(rad){_glMatrix.mat4.fromZRotation(this,rad);this.check();return this}},{key:"transpose",value:function transpose(){_glMatrix.mat4.transpose(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.mat4.invert(this,this);this.check();return this}},{key:"adjoint",value:function adjoint(){_glMatrix.mat4.adjoint(this,this);this.check();return this}},{key:"add",value:function add(a,b){_glMatrix.mat4.add(this,this,a);this.check();return this}},{key:"multiplyLeft",value:function multiplyLeft(a){_glMatrix.mat4.multiply(this,a,this);this.check();return this}},{key:"multiplyRight",value:function multiplyRight(a){_glMatrix.mat4.multiply(this,this,a);this.check();return this}},{key:"rotateX",value:function rotateX(radians){_glMatrix.mat4.rotateX(this,this,radians);this.check();return this}},{key:"rotateY",value:function rotateY(radians){_glMatrix.mat4.rotateY(this,this,radians);this.check();return this}},{key:"rotateZ",value:function rotateZ(radians){_glMatrix.mat4.rotateZ(this,this,radians);this.check();return this}},{key:"rotateXYZ",value:function rotateXYZ(_ref5){var _ref6=_slicedToArray(_ref5,3);var rx=_ref6[0];var ry=_ref6[1];var rz=_ref6[2];var d11=this[0];var d12=this[1];var d13=this[2];var d14=this[3];var d21=this[4];var d22=this[5];var d23=this[6];var d24=this[7];var d31=this[8];var d32=this[9];var d33=this[10];var d34=this[11];var crx=Math.cos(rx);var cry=Math.cos(ry);var crz=Math.cos(rz);var srx=Math.sin(rx);var sry=Math.sin(ry);var srz=Math.sin(rz);var m11=cry*crz;var m21=-crx*srz+srx*sry*crz;var m31=srx*srz+crx*sry*crz;var m12=cry*srz;var m22=crx*crz+srx*sry*srz;var m32=-srx*crz+crx*sry*srz;var m13=-sry;var m23=srx*cry;var m33=crx*cry;this[0]=d11*m11+d21*m12+d31*m13;this[1]=d12*m11+d22*m12+d32*m13;this[2]=d13*m11+d23*m12+d33*m13;this[3]=d14*m11+d24*m12+d34*m13;this[4]=d11*m21+d21*m22+d31*m23;this[5]=d12*m21+d22*m22+d32*m23;this[6]=d13*m21+d23*m22+d33*m23;this[7]=d14*m21+d24*m22+d34*m23;this[8]=d11*m31+d21*m32+d31*m33;this[9]=d12*m31+d22*m32+d32*m33;this[10]=d13*m31+d23*m32+d33*m33;this[11]=d14*m31+d24*m32+d34*m33;this.check();return this}},{key:"scale",value:function scale(vec){_glMatrix.mat4.scale(this,this,vec);this.check();return this}},{key:"translate",value:function translate(vec){_glMatrix.mat4.translate(this,this,vec);this.check();return this}},{key:"transformVector2",value:function transformVector2(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector2.default;_glMatrix.vec2.transformMat4(out,vector,this);(0,_validators.checkVector2)(out);return out}},{key:"transformVector3",value:function transformVector3(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector4.default;_glMatrix.vec3.transformMat4(out,vector,this);(0,_validators.checkVector3)(out);return out}},{key:"transformVector4",value:function transformVector4(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector6.default;_glMatrix.vec4.transformMat4(out,vector,this);(0,_validators.checkVector4)(out);return out}},{key:"transformVector",value:function transformVector(vector){switch(vector.length){case 2:return this.transformVector2(vector);case 3:return this.transformVector3(vector);case 4:return this.transformVector4(vector);default:throw new Error("Illegal vector")}}},{key:"ELEMENTS",get:function get(){return 16}},{key:"m00",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"m01",get:function get(){return this[4]},set:function set(value){return this[4]=(0,_common.checkNumber)(value)}},{key:"m02",get:function get(){return this[8]},set:function set(value){return this[8]=(0,_common.checkNumber)(value)}},{key:"m03",get:function get(){return this[12]},set:function set(value){return this[12]=(0,_common.checkNumber)(value)}},{key:"m10",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"m11",get:function get(){return this[5]},set:function set(value){return this[5]=(0,_common.checkNumber)(value)}},{key:"m12",get:function get(){return this[9]},set:function set(value){return this[9]=(0,_common.checkNumber)(value)}},{key:"m13",get:function get(){return this[13]},set:function set(value){return this[13]=(0,_common.checkNumber)(value)}},{key:"m20",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"m21",get:function get(){return this[6]},set:function set(value){return this[6]=(0,_common.checkNumber)(value)}},{key:"m22",get:function get(){return this[10]},set:function set(value){return this[10]=(0,_common.checkNumber)(value)}},{key:"m23",get:function get(){return this[14]},set:function set(value){return this[14]=(0,_common.checkNumber)(value)}},{key:"m30",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}},{key:"m31",get:function get(){return this[7]},set:function set(value){return this[7]=(0,_common.checkNumber)(value)}},{key:"m32",get:function get(){return this[11]},set:function set(value){return this[11]=(0,_common.checkNumber)(value)}},{key:"m33",get:function get(){return this[15]},set:function set(value){return this[15]=(0,_common.checkNumber)(value)}}]);return Matrix4}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"toString",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"toString"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"determinant",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"determinant"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"lookAt",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"lookAt"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"ortho",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"ortho"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"perspective",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"perspective"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"perspectiveFromFieldOfView",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"perspectiveFromFieldOfView"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"transpose",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"transpose"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"invert",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"invert"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"adjoint",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"adjoint"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiplyLeft",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiplyLeft"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiplyRight",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiplyRight"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"scale",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"scale"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"translate",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"translate"),_class.prototype),_class);exports.default=Matrix4},{"./common":397,"./math-array":400,"./utils/decorators":403,"./utils/validators":404,"./vector2":405,"./vector3":406,"./vector4":407,"gl-matrix":337}],402:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Quaternion=(_class=function(_MathArray){_inherits(Quaternion,_MathArray);function Quaternion(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Quaternion);var _this=_possibleConstructorReturn(this,(Quaternion.__proto__||Object.getPrototypeOf(Quaternion)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Quaternion,[{key:"fromMatrix3",value:function fromMatrix3(m){_glMatrix.quat.fromMat3(this,m);this.check();return this}},{key:"fromValues",value:function fromValues(x,y,z,w){return this.set(x,y,z,w)}},{key:"identity",value:function identity(){_glMatrix.quat.identity(this);this.check();return this}},{key:"equals",value:function equals(quaternion){return _glMatrix.quat.equals(this,quaternion)}},{key:"exactEquals",value:function exactEquals(quaternion){return _glMatrix.quat.exactEquals(this,quaternion)}},{key:"length",value:function length(){return _glMatrix.quat.length(this)}},{key:"squaredLength",value:function squaredLength(a){return _glMatrix.quat.squaredLength(this)}},{key:"dot",value:function dot(a,b){if(b!==undefined){throw new Error("Quaternion.dot only takes one argument")}return _glMatrix.quat.dot(this,a)}},{key:"getAxisAngle",value:function getAxisAngle(){var axis=[];var angle=_glMatrix.quat.getAxisAngle(axis,this);return{axis:axis,angle:angle}}},{key:"rotationTo",value:function rotationTo(vectorA,vectorB){_glMatrix.quat.rotationTo(this,vectorA,vectorB);this.check();return this}},{key:"add",value:function add(a,b){if(b!==undefined){throw new Error("Quaternion.add only takes one argument")}_glMatrix.quat.add(this,a);this.check();return this}},{key:"calculateW",value:function calculateW(){_glMatrix.quat.calculateW(this,this);this.check();return this}},{key:"conjugate",value:function conjugate(){_glMatrix.quat.conjugate(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.quat.invert(this,this);this.check();return this}},{key:"lerp",value:function lerp(a,b,t){_glMatrix.quat.lerp(this,a,b,t);this.check();return this}},{key:"multiply",value:function multiply(a,b){if(b!==undefined){throw new Error("Quaternion.multiply only takes one argument")}_glMatrix.quat.multiply(this,this,b);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.quat.normalize(this,this);this.check();return this}},{key:"rotateX",value:function rotateX(rad){_glMatrix.quat.rotateX(this,this,rad);this.check();return this}},{key:"rotateY",value:function rotateY(rad){_glMatrix.quat.rotateY(this,this,rad);this.check();return this}},{key:"rotateZ",value:function rotateZ(rad){_glMatrix.quat.rotateZ(this,this,rad);this.check();return this}},{key:"scale",value:function scale(b){_glMatrix.quat.scale(this,this,b);this.check();return this}},{key:"set",value:function set(i,j,k,l){_glMatrix.quat.set(this,i,j,k,l);this.check();return this}},{key:"setAxisAngle",value:function setAxisAngle(axis,rad){_glMatrix.quat.setAxisAngle(this,axis,rad);this.check();return this}},{key:"slerp",value:function slerp(a,b,t){_glMatrix.quat.slerp(this,a,b,t);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Quaternion}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_class);exports.default=Quaternion},{"./common":397,"./math-array":400,"./utils/decorators":403,"gl-matrix":337}],403:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.unary=unary;exports.staticMethod=staticMethod;exports.binary=binary;exports.spread=spread;function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function isDescriptor(descriptor){if(!descriptor||!descriptor.hasOwnProperty){return false}var keys=["value","initializer","get","set"];for(var i=0,l=keys.length;i<l;i++){if(descriptor.hasOwnProperty(keys[i])){return true}}return false}function decorate(entryArgs,handleDescriptor){if(isDescriptor(entryArgs[entryArgs.length-1])){return handleDescriptor.apply(undefined,_toConsumableArray(entryArgs).concat([[]]))}return function _decorate(){return handleDescriptor.apply(undefined,Array.prototype.slice.call(arguments).concat([entryArgs]))}}function unary(){for(var _len=arguments.length,decoratorArgs=Array(_len),_key=0;_key<_len;_key++){decoratorArgs[_key]=arguments[_key]}return decorate(decoratorArgs,function(target,methodKey,descriptor,_ref){var _ref2=_toArray(_ref);var Class=target.constructor;Class[methodKey]=function(){var _ref3;return(_ref3=new Class)[methodKey].apply(_ref3,arguments)};return _extends({},descriptor,{value:function unaryWrapper(){return descriptor.value.apply(this,arguments)}})})}function staticMethod(){for(var _len2=arguments.length,decoratorArgs=Array(_len2),_key2=0;_key2<_len2;_key2++){decoratorArgs[_key2]=arguments[_key2]}return decorate(decoratorArgs,function(target,methodKey,descriptor,_ref4){var _ref5=_toArray(_ref4);var Class=target.constructor;Class[methodKey]=function(){var _ref6;return(_ref6=new Class)[methodKey].apply(_ref6,arguments)};return _extends({},descriptor,{value:function staticMethodWrapper(){return descriptor.value.apply(this,arguments)}})})}function binary(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}return decorate(args,function(target,methodKey,descriptor,_ref7){var _ref8=_toArray(_ref7);var Class=target.constructor;Class[methodKey]=function(a,b){return(new Class).copy(a)[methodKey](b)};return _extends({},descriptor,{value:function binaryWrapper(){return descriptor.value.apply(this,arguments)}})})}function spread(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}return decorate(args,function(target,methodKey,descriptor,_ref9){var _ref10=_toArray(_ref9);var Class=target.constructor;Class[methodKey]=function(a){for(var _len5=arguments.length,rest=Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){rest[_key5-1]=arguments[_key5]}return rest.reduce(function(acc,elt){return acc[methodKey](elt)},(new Class).copy(a))};return _extends({},descriptor,{value:function spreadWrapper(){return descriptor.value.apply(this,arguments)}})})}},{}],404:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkArguments=checkArguments;exports.validateVector2=validateVector2;exports.checkVector2=checkVector2;exports.validateVector3=validateVector3;exports.checkVector3=checkVector3;exports.validateVector4=validateVector4;exports.checkVector4=checkVector4;exports.validateQuaternion=validateQuaternion;exports.checkQuaternion=checkQuaternion;exports.validateMatrix2=validateMatrix2;exports.checkMatrix2=checkMatrix2;exports.validateMatrix2d=validateMatrix2d;exports.checkMatrix2d=checkMatrix2d;exports.validateMatrix3=validateMatrix3;exports.checkMatrix3=checkMatrix3;exports.validateMatrix4=validateMatrix4;exports.checkMatrix4=checkMatrix4;var _glMatrix=require("gl-matrix");function checkArguments(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<args.length;++i){if(args[i]===undefined){throw new Error("Invalid math argument")}}}function validateVector2(v){return v.length===2&&Number.isFinite(v[0])&&Number.isFinite(v[1])}function checkVector2(v){if(_glMatrix.glMatrix.debug&&!validateVector2(v)){throw new Error("Invalid Vector2")}}function validateVector3(v){return v.length===3&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])}function checkVector3(v){if(_glMatrix.glMatrix.debug&&!validateVector3(v)){throw new Error("Invalid Vector3")}}function validateVector4(v){return v.length===4&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])&&Number.isFinite(v[3])}function checkVector4(v){if(_glMatrix.glMatrix.debug&&!validateVector4(v)){
throw new Error("Invalid Vector4")}}function validateQuaternion(q){return q.length===4&&Number.isFinite(q[0])&&Number.isFinite(q[1])&&Number.isFinite(q[2])&&Number.isFinite(q[3])}function checkQuaternion(q){if(_glMatrix.glMatrix.debug&&!validateQuaternion(q)){throw new Error("Invalid Quaternion")}}function validateMatrix2(m){return m.length===4&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])}function checkMatrix2(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2(m)){throw new Error("Invalid Matrix2")}}function validateMatrix2d(m){return m.length===6&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])}function checkMatrix2d(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2d(m)){throw new Error("Invalid Matrix2d")}}function validateMatrix3(m){return m.length===9&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])}function checkMatrix3(m){if(_glMatrix.glMatrix.debug&&!validateMatrix3(m)){throw new Error("Invalid Matrix3")}}function validateMatrix4(m){return m.length===16&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])&&Number.isFinite(m[9])&&Number.isFinite(m[10])&&Number.isFinite(m[11])&&Number.isFinite(m[12])&&Number.isFinite(m[13])&&Number.isFinite(m[14])&&Number.isFinite(m[15])}function checkMatrix4(m){if(_glMatrix.glMatrix.debug&&!validateMatrix4(m)){throw new Error("Invalid Matrix4")}}},{"gl-matrix":337}],405:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector2=(_class=function(_MathArray){_inherits(Vector2,_MathArray);function Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);var _this=_possibleConstructorReturn(this,(Vector2.__proto__||Object.getPrototypeOf(Vector2)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y)}return _this}_createClass(Vector2,[{key:"set",value:function set(x,y){_glMatrix.vec2.set(this,x,y);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec2.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec2.exactEquals(this,vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec2.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"ELEMENTS",get:function get(){return 2}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}}]);return Vector2}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.staticMethod],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_class);exports.default=Vector2},{"./common":397,"./math-array":400,"./utils/decorators":403,"gl-matrix":337}],406:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector3=(_class=function(_MathArray){_inherits(Vector3,_MathArray);function Vector3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vector3);var _this=_possibleConstructorReturn(this,(Vector3.__proto__||Object.getPrototypeOf(Vector3)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z)}return _this}_createClass(Vector3,[{key:"set",value:function set(x,y,z){_glMatrix.vec3.set(this,x,y,z);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec3.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec3.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec3.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec3.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec3.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec3.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec3.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec3.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec3.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec3.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec3.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec3.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec3.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec3.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec3.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec3.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec3.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec3.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(vector){_glMatrix.vec3.dot(this,this,vector);this.check();return this}},{key:"cross",value:function cross(vector){_glMatrix.vec3.cross(this,this,vector);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec3.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec3.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec3.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec3.cross(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec3.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec3.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec3.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 3}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}}]);return Vector3}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"distance",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"distance"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dist",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dist"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"angle",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"angle"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"subtract",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"subtract"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"divide",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"divide"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"ceil",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"ceil"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"floor",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"floor"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"min",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"min"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"max",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"max"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"scale",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"scale"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"negate",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"negate"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"inverse",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"inverse"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dot",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dot"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"cross",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"cross"),_class.prototype),_class);exports.default=Vector3},{"./common":397,"./math-array":400,"./utils/decorators":403,"gl-matrix":337}],407:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");var _decorators=require("./utils/decorators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var Vector4=(_class=function(_MathArray){_inherits(Vector4,_MathArray);function Vector4(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Vector4);var _this=_possibleConstructorReturn(this,(Vector4.__proto__||Object.getPrototypeOf(Vector4)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Vector4,[{key:"set",value:function set(x,y,z,w){_glMatrix.vec4.set(this,x,y,z,w);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec4.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec4.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec4.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec4.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec4.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec4.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec4.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec4.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec4.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec4.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec4.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec4.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec4.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec4.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec4.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec4.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec4.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec4.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(scale){_glMatrix.vec4.dot(this,this,scale);this.check();return this}},{key:"cross",value:function cross(scale){_glMatrix.vec4.cross(this,this,scale);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec4.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec4.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec4.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec4.random(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec4.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec4.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec4.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Vector4}(_mathArray2.default),_applyDecoratedDescriptor(_class.prototype,"equals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"equals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"exactEquals",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"exactEquals"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"distance",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"distance"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dist",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dist"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"angle",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"angle"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"add",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"add"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"subtract",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"subtract"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"multiply",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"multiply"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"divide",[_decorators.spread],Object.getOwnPropertyDescriptor(_class.prototype,"divide"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"negate",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"negate"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"inverse",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"inverse"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"normalize",[_decorators.unary],Object.getOwnPropertyDescriptor(_class.prototype,"normalize"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"dot",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"dot"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"cross",[_decorators.binary],Object.getOwnPropertyDescriptor(_class.prototype,"cross"),_class.prototype),_class);exports.default=Vector4},{"./common":397,"./math-array":400,"./utils/decorators":403,"gl-matrix":337}],408:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _core=require("../core");var _webgl=require("../webgl");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CLIPSPACE_QUAD_VERTEX_SHADER="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n";var POSITIONS=[-1,-1,1,-1,-1,1,1,1];var TEX_COORDS=POSITIONS.map(function(coord){return coord===-1?0:coord});var ClipSpaceQuad=function(_Model){_inherits(ClipSpaceQuad,_Model);function ClipSpaceQuad(_ref){var gl=_ref.gl;var opts=_objectWithoutProperties(_ref,["gl"]);_classCallCheck(this,ClipSpaceQuad);var _this=_possibleConstructorReturn(this,(ClipSpaceQuad.__proto__||Object.getPrototypeOf(ClipSpaceQuad)).call(this,_extends({gl:gl},opts,{vs:CLIPSPACE_QUAD_VERTEX_SHADER,geometry:new _core.Geometry({drawMode:_webgl.GL.TRIANGLE_STRIP,attributes:{aClipSpacePosition:{value:new Float32Array(POSITIONS),size:2},aTexCoord:{value:new Float32Array(TEX_COORDS),size:2},aCoordinate:{value:new Float32Array(TEX_COORDS),size:2}}})})));_this.setVertexCount(4);return _this}return ClipSpaceQuad}(_core.Model);exports.default=ClipSpaceQuad},{"../core":372,"../webgl":427}],409:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _clipSpaceQuad=require("./clip-space-quad");Object.defineProperty(exports,"ClipSpaceQuad",{enumerable:true,get:function get(){return _interopRequireDefault(_clipSpaceQuad).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./clip-space-quad":408}],410:[function(require,module,exports){"use strict";
Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _object3d=require("./object-3d");var _object3d2=_interopRequireDefault(_object3d);var _deprecated=require("../deprecated");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Group=function(_Object3D){_inherits(Group,_Object3D);function Group(_ref){var _ref$children=_ref.children;var children=_ref$children===undefined?[]:_ref$children;var opts=_objectWithoutProperties(_ref,["children"]);_classCallCheck(this,Group);children.every(function(child){return(0,_assert2.default)(child instanceof _object3d2.default)});var _this=_possibleConstructorReturn(this,(Group.__proto__||Object.getPrototypeOf(Group)).call(this,opts));_this.children=children;return _this}_createClass(Group,[{key:"add",value:function add(){for(var _len=arguments.length,children=Array(_len),_key=0;_key<_len;_key++){children[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;if(Array.isArray(child)){this.add.apply(this,_toConsumableArray(child))}else{this.children.push(child)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"remove",value:function remove(child){var children=this.children;var indexOf=children.indexOf(child);if(indexOf>-1){children.splice(indexOf,1)}return this}},{key:"removeAll",value:function removeAll(){this.children=[];return this}},{key:"traverse",value:regeneratorRuntime.mark(function traverse(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2$viewMatrix=_ref2.viewMatrix;var viewMatrix=_ref2$viewMatrix===undefined?new _deprecated.Mat4:_ref2$viewMatrix;var _iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,child,matrix,worldMatrix;return regeneratorRuntime.wrap(function traverse$(_context){while(1){switch(_context.prev=_context.next){case 0:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=3;_iterator2=this.children[Symbol.iterator]();case 5:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){_context.next=19;break}child=_step2.value;matrix=child.matrix;worldMatrix=viewMatrix.mulMat4(matrix);if(!(child instanceof Group)){_context.next=13;break}return _context.delegateYield(child.traverse({matrix:matrix,worldMatrix:worldMatrix}),"t0",11);case 11:_context.next=16;break;case 13:if(child.program){child.program.use();child.program.setUniforms({worldMatrix:worldMatrix})}_context.next=16;return child;case 16:_iteratorNormalCompletion2=true;_context.next=5;break;case 19:_context.next=25;break;case 21:_context.prev=21;_context.t1=_context["catch"](3);_didIteratorError2=true;_iteratorError2=_context.t1;case 25:_context.prev=25;_context.prev=26;if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}case 28:_context.prev=28;if(!_didIteratorError2){_context.next=31;break}throw _iteratorError2;case 31:return _context.finish(28);case 32:return _context.finish(25);case 33:case"end":return _context.stop()}}},traverse,this,[[3,21,25,33],[26,,28,32]])})},{key:"traverseReverse",value:regeneratorRuntime.mark(function traverseReverse(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref3$viewMatrix=_ref3.viewMatrix;var viewMatrix=_ref3$viewMatrix===undefined?new _deprecated.Mat4:_ref3$viewMatrix;var i,child,matrix,worldMatrix;return regeneratorRuntime.wrap(function traverseReverse$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:i=this.children.length-1;case 1:if(!(i>=0)){_context2.next=15;break}child=this.children[i];matrix=child.matrix;worldMatrix=viewMatrix.mulMat4(matrix);if(!(child instanceof Group)){_context2.next=9;break}return _context2.delegateYield(child.traverseReverse({matrix:matrix,worldMatrix:worldMatrix}),"t0",7);case 7:_context2.next=12;break;case 9:if(child.program){child.program.use();child.program.setUniforms({worldMatrix:worldMatrix})}_context2.next=12;return child;case 12:--i;_context2.next=1;break;case 15:case"end":return _context2.stop()}}},traverseReverse,this)})}]);return Group}(_object3d2.default);exports.default=Group},{"../deprecated":376,"./object-3d":412,assert:4}],411:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _object3d=require("./object-3d");Object.defineProperty(exports,"Object3D",{enumerable:true,get:function get(){return _interopRequireDefault(_object3d).default}});var _group=require("./group");Object.defineProperty(exports,"Group",{enumerable:true,get:function get(){return _interopRequireDefault(_group).default}});var _scene=require("./scene");Object.defineProperty(exports,"Scene",{enumerable:true,get:function get(){return _interopRequireDefault(_scene).default}});var _pick=require("./pick");Object.keys(_pick).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _pick[key]}})});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./group":410,"./object-3d":412,"./pick":413,"./scene":414}],412:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deprecated=require("../deprecated");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Object3D=function(){function Object3D(_ref){var id=_ref.id;var _ref$display=_ref.display;var display=_ref$display===undefined?true:_ref$display;_classCallCheck(this,Object3D);this.position=new _deprecated.Vec3;this.rotation=new _deprecated.Vec3;this.scale=new _deprecated.Vec3(1,1,1);this.matrix=new _deprecated.Mat4;this.id=id||(0,_utils.uid)(this.constructor.name);this.display=true;this.userData={}}_createClass(Object3D,[{key:"setPosition",value:function setPosition(position){(0,_assert2.default)(position.length===3,"setPosition requires vector argument");this.position=position;return this}},{key:"setRotation",value:function setRotation(rotation){(0,_assert2.default)(rotation.length===3,"setRotation requires vector argument");this.rotation=rotation;return this}},{key:"setScale",value:function setScale(scale){(0,_assert2.default)(scale.length===3,"setScale requires vector argument");this.scale=scale;return this}},{key:"setMatrixComponents",value:function setMatrixComponents(_ref2){var position=_ref2.position;var rotation=_ref2.rotation;var scale=_ref2.scale;var _ref2$update=_ref2.update;var update=_ref2$update===undefined?true:_ref2$update;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}if(update){this.updateMatrix()}return this}},{key:"updateMatrix",value:function updateMatrix(){var pos=this.position;var rot=this.rotation;var scale=this.scale;this.matrix.id();this.matrix.$translate(pos[0],pos[1],pos[2]);this.matrix.$rotateXYZ(rot[0],rot[1],rot[2]);this.matrix.$scale(scale[0],scale[1],scale[2]);return this}},{key:"update",value:function update(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var position=_ref3.position;var rotation=_ref3.rotation;var scale=_ref3.scale;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}this.updateMatrix();return this}},{key:"getCoordinateUniforms",value:function getCoordinateUniforms(viewMatrix,modelMatrix){(0,_assert2.default)(viewMatrix);modelMatrix=modelMatrix||this.matrix;var worldMatrix=(new _deprecated.Mat4).copy(viewMatrix).mulMat4(modelMatrix);var worldInverse=worldMatrix.invert();var worldInverseTranspose=worldInverse.transpose();return{viewMatrix:viewMatrix,modelMatrix:modelMatrix,objectMatrix:modelMatrix,worldMatrix:worldMatrix,worldInverseMatrix:worldInverse,worldInverseTransposeMatrix:worldInverseTranspose}}},{key:"transform",value:function transform(){if(!this.parent){this.endPosition.setVec3(this.position);this.endRotation.setVec3(this.rotation);this.endScale.setVec3(this.scale)}else{var parent=this.parent;this.endPosition.setVec3(this.position.add(parent.endPosition));this.endRotation.setVec3(this.rotation.add(parent.endRotation));this.endScale.setVec3(this.scale.add(parent.endScale))}var ch=this.children;for(var i=0;i<ch.length;++i){ch[i].transform()}return this}}]);return Object3D}();exports.default=Object3D},{"../deprecated":376,"../utils":417,assert:4}],413:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pickModels=pickModels;var _webgl=require("../webgl");var _webglChecks=require("../webgl/webgl-checks");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ILLEGAL_ARG="Illegal argument to pick";function pickModels(gl,_ref){var group=_ref.group;var uniforms=_ref.uniforms;var x=_ref.x;var y=_ref.y;var _ref$pickingFBO=_ref.pickingFBO;var pickingFBO=_ref$pickingFBO===undefined?null:_ref$pickingFBO;var _ref$pickingProgram=_ref.pickingProgram;var pickingProgram=_ref$pickingProgram===undefined?null:_ref$pickingProgram;var _ref$pickingColors=_ref.pickingColors;var pickingColors=_ref$pickingColors===undefined?null:_ref$pickingColors;(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(group instanceof _group2.default,ILLEGAL_ARG);var dpr=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*dpr;var deviceY=gl.canvas.height-y*dpr;pickingFBO=pickingFBO||new _webgl.Framebuffer(gl,{width:gl.canvas.width,height:gl.canvas.height});return(0,_webgl.glContextWithState)(gl,{frameBuffer:pickingFBO,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=group.traverseReverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;if(model.isPickable()){gl.clear(_webgl.GL.COLOR_BUFFER_BIT|_webgl.GL.DEPTH_BUFFER_BIT);model.setUniforms({renderPickingBuffer:1,enablePicking:true});model.render(uniforms);model.setUniforms({renderPickingBuffer:false,enablePicking:false});var color=new Uint8Array(4);gl.readPixels(deviceX,deviceY,1,1,gl.RGBA,gl.UNSIGNED_BYTE,color);var isPicked=color[0]!==0||color[1]!==0||color[2]!==0||color[3]!==0;if(isPicked){return{model:model,color:color,x:x,y:y,deviceX:deviceX,deviceY:deviceY}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null})}},{"../webgl":427,"../webgl/webgl-checks":438,"./group":410,assert:4}],414:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _config=require("../core/config");var config=_interopRequireWildcard(_config);var _math=require("../math");var _utils=require("../utils");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _pick=require("./pick");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var INVALID_ARGUMENT="LumaGL.Scene invalid argument";var DEFAULT_SCENE_OPTS={lights:{enable:false,ambient:{r:.2,g:.2,b:.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false},clearColor:true,clearDepth:true,backgroundColor:{r:0,g:0,b:0,a:1},backgroundDepth:1};var Scene=function(_Group){_inherits(Scene,_Group);function Scene(gl,opts){_classCallCheck(this,Scene);(0,_assert2.default)(gl,INVALID_ARGUMENT);opts=(0,_utils.merge)(DEFAULT_SCENE_OPTS,opts);var _this=_possibleConstructorReturn(this,(Scene.__proto__||Object.getPrototypeOf(Scene)).call(this,opts));_this.gl=gl;_this.config=opts;_this.needsRedraw=false;Object.seal(_this);return _this}_createClass(Scene,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$clearRedrawFlags=_ref.clearRedrawFlags;var clearRedrawFlags=_ref$clearRedrawFlags===undefined?false:_ref$clearRedrawFlags;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.traverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;redraw=redraw||model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return redraw}},{key:"clear",value:function clear(){var gl=this.gl;if(this.config.clearColor){var bg=this.config.backgroundColor;gl.clearColor(bg.r,bg.g,bg.b,bg.a)}if(this.config.clearDepth){gl.clearDepth(this.config.backgroundDepth)}if(this.config.clearColor&&this.config.clearDepth){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}else if(this.config.clearColor){gl.clear(gl.COLOR_BUFFER_BIT)}else if(this.config.clearDepth){gl.clear(gl.DEPTH_BUFFER_BIT)}return this}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.clear();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.traverse()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var model=_step2.value;if(model.display){this.renderObject({model:model,uniforms:uniforms})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return this}},{key:"renderObject",value:function renderObject(_ref2){var model=_ref2.model;var uniforms=_ref2.uniforms;model.render(_extends({},this.getSceneUniforms(),uniforms));return this}},{key:"pickModels",value:function pickModels(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var x=_ref3.x;var y=_ref3.y;var _ref3$uniforms=_ref3.uniforms;var uniforms=_ref3$uniforms===undefined?{}:_ref3$uniforms;var opts=_objectWithoutProperties(_ref3,["x","y","uniforms"]);return(0,_pick.pickModels)(this.gl,_extends({group:this,x:x,y:y,uniforms:_extends({},uniforms)},opts))}},{key:"getSceneUniforms",value:function getSceneUniforms(){var _config$lights=this.config.lights;var enable=_config$lights.enable;var ambient=_config$lights.ambient;var directional=_config$lights.directional;var points=_config$lights.points;return _extends({},this.getEffectsUniforms(),{enableLights:enable},enable&&ambient?this.getAmbientUniforms(ambient):{},enable&&directional?this.getDirectionalUniforms(directional):{},enable&&points?this.getPointUniforms(points):{})}},{key:"getAmbientUniforms",value:function getAmbientUniforms(ambient){return{ambientColor:[ambient.r,ambient.g,ambient.b]}}},{key:"getDirectionalUniforms",value:function getDirectionalUniforms(directional){var color=directional.color;var direction=directional.direction;var dir=new _math.Vector3(direction.x,direction.y,direction.z).normalize().scale(-1,-1,-1);return{directionalColor:[color.r,color.g,color.b],lightingDirection:[dir.x,dir.y,dir.z]}}},{key:"getPointUniforms",value:function getPointUniforms(points){points=points instanceof Array?points:[points];var numberPoints=points.length;var uniforms={numberPoints:numberPoints};var pointLocations=[];var pointColors=[];var enableSpecular=[];var pointSpecularColors=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=points[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var position=point.position;var color=point.color;var diffuse=point.diffuse;var specular=point.specular;var pointColor=color||diffuse;pointLocations.push(position.x,position.y,position.z);pointColors.push(pointColor.r,pointColor.g,pointColor.b);enableSpecular.push(Number(Boolean(specular)));if(specular){pointSpecularColors.push(specular.r,specular.g,specular.b)}else{pointSpecularColors.push(0,0,0)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}if(pointLocations.length){Object.assign(uniforms,{pointLocation:pointLocations,pointColor:pointColors,enableSpecular:enableSpecular,pointSpecularColor:pointSpecularColors})}return uniforms}},{key:"getEffectsUniforms",value:function getEffectsUniforms(){var fog=this.config.effects.fog;if(fog){var _fog$color=fog.color;var color=_fog$color===undefined?{r:.5,g:.5,b:.5}:_fog$color;return{hasFog:true,fogNear:fog.near,fogFar:fog.far,fogColor:[color.r,color.g,color.b]}}return{hasFog:false}}}]);return Scene}(_group2.default);exports.default=Scene;Scene.MAX_TEXTURES=config.MAX_TEXTURES;Scene.MAX_POINT_LIGHTS=config.MAX_POINT_LIGHTS;Scene.PICKING_RES=config.PICKING_RES},{"../core/config":369,"../math":399,"../utils":417,"./group":410,"./pick":413,assert:4}],415:[function(require,module,exports){"use strict";var glslify=require("glslify");var vs="#define GLSLIFY 1\n#define SHADER_NAME luma-default-vertex\n\n#define LIGHT_MAX 4\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec4 pickingColors;\nattribute vec2 texCoords;\n\n// camera and object matrices\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\n\n// objectMatrix * viewMatrix = worldMatrix\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\n\n// lighting configuration\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\n// point lights configuration\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\n\n// reflection / refraction configuration\nuniform bool useReflection;\n\n// varyings\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\n\nvoid main(void) {\n  vec4 mvPosition = worldMatrix * vec4(positions, 1.0);\n  vec4 transformedNormal = worldInverseTransposeMatrix * vec4(normals, 1.0);\n\n  // lighting code\n  if(!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 plightDirection;\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n    float directionalLightWeighting =\n      max(dot(transformedNormal.xyz, lightingDirection), 0.0);\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        plightDirection = normalize(\n          (viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\n         pointWeight += max(\n          dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n       } else {\n         break;\n       }\n     }\n\n    lightWeighting = ambientColor +\n      (directionalColor * directionalLightWeighting) + pointWeight;\n  }\n\n  // refraction / reflection code\n  if (useReflection) {\n    vReflection =\n      (viewInverseMatrix[3] - (worldMatrix * vec4(positions, 1.0))).xyz;\n  } else {\n    vReflection = vec3(1.0, 1.0, 1.0);\n  }\n\n  // pass results to varyings\n  vColor = colors;\n  vPickingColor = pickingColors;\n  vTexCoord = texCoords;\n  vNormal = transformedNormal;\n  gl_Position = projectionMatrix * worldMatrix * vec4(positions, 1.0);\n}\n";var fs="#define SHADER_NAME luma-default-fragment\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\n// varyings\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\n\n// texture configs\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\n\n// picking configs\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\n\n// reflection / refraction configs\nuniform float reflection;\nuniform float refraction;\n\n// fog configuration\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvoid main(){\n  // set color from texture\n  if (!hasTexture1) {\n    gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n  } else {\n    gl_FragColor =\n      vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb *\n      lightWeighting, 1.0);\n  }\n\n  // has cube texture then apply reflection\n  // if (hasTextureCube1) {\n  //   vec3 nReflection = normalize(vReflection);\n  //   vec3 reflectionValue;\n  //   if (refraction > 0.0) {\n  //    reflectionValue = refract(nReflection, vNormal.xyz, refraction);\n  //   } else {\n  //    reflectionValue = -reflect(nReflection, vNormal.xyz);\n  //   }\n\n  //   // TODO(nico): check whether this is right.\n  //   vec4 cubeColor = textureCube(samplerCube1,\n  //       vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\n  //   gl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n  // }\n\n  // set picking\n  if (enablePicking) {\n    if (hasPickingColors) {\n      gl_FragColor = vPickingColor;\n    } else {\n      gl_FragColor = vec4(pickColor, 1.0);\n    }\n  }\n\n  // handle fog\n  // if (hasFog) {\n  //   float depth = gl_FragCoord.z / gl_FragCoord.w;\n  //   float fogFactor = smoothstep(fogNear, fogFar, depth);\n  //   gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n  // }\n}\n";var defaultUniforms=require("../../shaderlib/default-uniforms");module.exports={DEFAULT:{vs:vs,fs:fs,defaultUniforms:defaultUniforms}}},{"../../shaderlib/default-uniforms":447,glslify:356}],416:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pageLoadPromise=exports.isPageLoaded=undefined;var _isBrowser=require("./is-browser");var _isBrowser2=_interopRequireDefault(_isBrowser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isPageLoaded=exports.isPageLoaded=false;var pageLoadPromise=exports.pageLoadPromise=_isBrowser2.default?new Promise(function(resolve,reject){window.onload=function(){exports.isPageLoaded=isPageLoaded=true;resolve(document)}}):Promise.resolve({})},{"./is-browser":418}],417:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _isBrowser=require("./is-browser");Object.keys(_isBrowser).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _isBrowser[key]}})});var _browserUtils=require("./browser-utils");Object.keys(_browserUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _browserUtils[key]}})});var _promiseUtils=require("./promise-utils");Object.keys(_promiseUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _promiseUtils[key]}})});var _utils=require("./utils");Object.keys(_utils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _utils[key]}})});var _log=require("./log");Object.keys(_log).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _log[key]}})});Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./browser-utils":416,"./is-browser":418,"./log":419,"./promise-utils":420,"./utils":421}],418:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var isNode=exports.isNode=(typeof process==="undefined"?"undefined":_typeof(process))==="object"&&String(process)==="[object process]"&&!process.browser;var isBrowser=exports.isBrowser=!isNode;exports.default=isBrowser}).call(this,require("_process"))},{_process:488}],419:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatValue=formatValue;var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _log={priority:0,table:function table(priority,_table){if(priority<=_log.priority&&_table){console.table(_table)}},log:function log(priority){if(priority<=_log.priority){var _console;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}(_console=console).debug.apply(_console,args)}},info:function info(priority){if(priority<=_log.priority){var _console2;for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}(_console2=console).log.apply(_console2,args)}},warn:function warn(priority){if(priority<=_log.priority){var _console3;for(var _len3=arguments.length,args=Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}(_console3=console).warn.apply(_console3,args)}}};function formatArrayValue(v,opts){var _opts$maxElts=opts.maxElts;var maxElts=_opts$maxElts===undefined?16:_opts$maxElts;var _opts$size=opts.size;var size=_opts$size===undefined?1:_opts$size;var string="[";for(var i=0;i<v.length&&i<maxElts;++i){if(i>0){string+=","+(i%size===0?" ":"")}string+=formatValue(v[i],opts)}var terminator=v.length>maxElts?"...":"]";return""+string+terminator}function formatValue(v){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _opts$isInteger=opts.isInteger;var isInteger=_opts$isInteger===undefined?false:_opts$isInteger;if(Array.isArray(v)||ArrayBuffer.isView(v)){return formatArrayValue(v,opts)}if(!Number.isFinite(v)){return String(v)}if(isInteger){return v.toFixed(0)}if(Math.abs(v)>100&&Math.abs(v)<1e4){return v.toFixed(0)}var string=v.toPrecision(2);var decimal=string.indexOf(".0");return decimal===string.length-2?string.slice(0,-1):string;
}_globals2.default.log=_log;exports.default=_log},{"../globals":386}],420:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promisify=promisify;function promisify(func){return function promisifiedFunction(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new Promise(function(resolve,reject){function callback(error,data){try{if(error){reject(error)}else{resolve(data)}}catch(e){reject(e)}}func.apply(undefined,args.concat([callback]))})}}},{}],421:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.splat=splat;exports.noop=noop;exports.uid=uid;exports.merge=merge;function splat(a){return a?Array.isArray(a)?a:[a]:[]}function noop(){}var uidCounters={};function uid(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"id";uidCounters[id]=uidCounters[id]||1;var count=uidCounters[id]++;return id+"-"+count}function merge(objects){var mix={};for(var i=0,l=arguments.length;i<l;i++){var object=arguments[i];if(!object||object.constructor.name!=="Object"){continue}for(var key in object){var op=object[key];var mp=mix[key];if(mp&&op.constructor.name==="Object"&&mp.constructor.name==="Object"){mix[key]=merge(mp,op)}else{mix[key]=detach(op)}}}return mix}function detach(elem){var t=elem.constructor.name;var ans=void 0;if(t==="Object"){ans={};for(var p in elem){ans[p]=detach(elem[p])}}else if(t==="Array"){ans=[];for(var i=0,l=elem.length;i<l;i++){ans[i]=detach(elem[i])}}else{ans=elem}return ans}},{}],422:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.BufferLayout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BufferLayout=exports.BufferLayout=function BufferLayout(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var type=_ref.type;var _ref$size=_ref.size;var size=_ref$size===undefined?1:_ref$size;var _ref$offset=_ref.offset;var offset=_ref$offset===undefined?0:_ref$offset;var _ref$stride=_ref.stride;var stride=_ref$stride===undefined?0:_ref$stride;var _ref$normalized=_ref.normalized;var normalized=_ref$normalized===undefined?false:_ref$normalized;var _ref$integer=_ref.integer;var integer=_ref$integer===undefined?false:_ref$integer;var _ref$instanced=_ref.instanced;var instanced=_ref$instanced===undefined?0:_ref$instanced;_classCallCheck(this,BufferLayout);this.type=type;this.size=size;this.offset=offset;this.stride=stride;this.normalized=normalized;this.integer=integer;this.instanced=instanced};var Buffer=function(){_createClass(Buffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Buffer?object:new Buffer(gl).setData({handle:object.handle||object})}}]);function Buffer(){var gl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var id=_ref2.id;var handle=_ref2.handle;_classCallCheck(this,Buffer);(0,_webglChecks.assertWebGLContext)(gl);handle=handle||gl.createBuffer();if(!(handle instanceof _webgl.WebGLBuffer)){throw new Error("Failed to create WebGLBuffer")}this.gl=gl;this.handle=handle;this.id=id;this.bytes=undefined;this.data=null;this.target=_webgl.GL.ARRAY_BUFFER;this.layout=null;this.userData={};Object.seal(this)}_createClass(Buffer,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteBuffer(this.handle);this.handle=null}return this}},{key:"setData",value:function setData(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var data=_ref3.data;var bytes=_ref3.bytes;var _ref3$target=_ref3.target;var target=_ref3$target===undefined?_webgl.GL.ARRAY_BUFFER:_ref3$target;var _ref3$usage=_ref3.usage;var usage=_ref3$usage===undefined?_webgl.GL.STATIC_DRAW:_ref3$usage;var layout=_ref3.layout;var type=_ref3.type;var _ref3$size=_ref3.size;var size=_ref3$size===undefined?1:_ref3$size;var _ref3$offset=_ref3.offset;var offset=_ref3$offset===undefined?0:_ref3$offset;var _ref3$stride=_ref3.stride;var stride=_ref3$stride===undefined?0:_ref3$stride;var _ref3$normalized=_ref3.normalized;var normalized=_ref3$normalized===undefined?false:_ref3$normalized;var _ref3$integer=_ref3.integer;var integer=_ref3$integer===undefined?false:_ref3$integer;var _ref3$instanced=_ref3.instanced;var instanced=_ref3$instanced===undefined?0:_ref3$instanced;var gl=this.gl;(0,_assert2.default)(data||bytes>=0,"Buffer.setData needs data or bytes");type=type||(0,_webgl.glTypeFromArray)(data);if(data){(0,_webglChecks.assertArrayTypeMatch)(data,type,"in Buffer.setData")}this.bytes=bytes;this.data=data;this.target=target;this.layout=layout||new BufferLayout({type:type,size:size,offset:offset,stride:stride,normalized:normalized,integer:integer,instanced:instanced});this.bind({target:target});gl.bufferData(target,data||bytes,usage);this.unbind({target:target});return this}},{key:"subData",value:function subData(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var data=_ref4.data;var _ref4$offset=_ref4.offset;var offset=_ref4$offset===undefined?0:_ref4$offset;var gl=this.gl;(0,_assert2.default)(data,"Buffer.updateData needs data");this.bind({target:_webgl.GL.ARRAY_BUFFER});gl.bufferSubData(_webgl.GL.ARRAY_BUFFER,offset,data);this.unbind({target:_webgl.GL.ARRAY_BUFFER});return this}},{key:"bind",value:function bind(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref5$target=_ref5.target;var target=_ref5$target===undefined?this.target:_ref5$target;this.gl.bindBuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref6$target=_ref6.target;var target=_ref6$target===undefined?this.target:_ref6$target;return this}},{key:"bindBase",value:function bindBase(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref7$target=_ref7.target;var target=_ref7$target===undefined?this.target:_ref7$target;var index=_ref7.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,this.handle);return this}},{key:"unbindBase",value:function unbindBase(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref8$target=_ref8.target;var target=_ref8$target===undefined?this.target:_ref8$target;var index=_ref8.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}},{key:"bindRange",value:function bindRange(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref9$target=_ref9.target;var target=_ref9$target===undefined?this.target:_ref9$target;var index=_ref9.index;var _ref9$offset=_ref9.offset;var offset=_ref9$offset===undefined?0:_ref9$offset;var size=_ref9.size;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferRange(target,index,this.handle,offset,size);return this}},{key:"unbindRange",value:function unbindRange(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref10$target=_ref10.target;var target=_ref10$target===undefined?this.target:_ref10$target;var index=_ref10.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}}]);return Buffer}();exports.default=Buffer},{"./webgl":442,"./webgl-checks":438,assert:4}],423:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createGLContext=createGLContext;exports.getGLExtension=getGLExtension;exports.poll=poll;exports.glContextWithState=glContextWithState;exports.glGetDebugInfo=glGetDebugInfo;exports.getExtension=getExtension;var _webglDebug=require("webgl-debug");var _webglDebug2=_interopRequireDefault(_webglDebug);var _webglTypes=require("./webgl-types");var _webglChecks=require("./webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);var _utils=require("../utils");var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}var GL_UNMASKED_VENDOR_WEBGL=37445;var GL_UNMASKED_RENDERER_WEBGL=37446;var ERR_WEBGL_MISSING_BROWSER="WebGL API is missing. Check your if your browser supports WebGL or\ninstall a recent version of a major browser.";var ERR_WEBGL_MISSING_NODE="WebGL API is missing. To run luma.gl under Node.js, please \"npm install gl\"\nand import 'luma.gl/headless' before importing 'luma.gl'.";var ERR_HEADLESSGL_NOT_AVAILABLE="Cannot create headless WebGL context, headlessGL not available";var ERR_HEADLESSGL_FAILED="headlessGL failed to create headless WebGL context";var STARTUP_MESSAGE="Assign luma.log.priority in console to control logging: 0: none, 1: minimal, 2: verbose, 3: attribute/uniforms, 4: gl logs\nluma.log.break[], set to gl funcs, luma.log.profile[] set to model names";function createGLContext(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var canvas=_ref.canvas;var _ref$width=_ref.width;var width=_ref$width===undefined?800:_ref$width;var _ref$height=_ref.height;var height=_ref$height===undefined?600:_ref$height;var _ref$webgl=_ref.webgl2;var webgl2=_ref$webgl===undefined?false:_ref$webgl;var _ref$debug=_ref.debug;var debug=_ref$debug===undefined?true:_ref$debug;var opts=_objectWithoutProperties(_ref,["canvas","width","height","webgl2","debug"]);var gl=void 0;if(!_utils.isBrowser){gl=_createHeadlessContext(width,height,opts)}else{if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_BROWSER)}canvas=canvas;if(typeof canvas==="string"){if(!_utils.isPageLoaded){throw new Error("createGLContext called on canvas '"+canvas+"' before page was loaded")}canvas=document.getElementById(canvas)}if(!canvas){canvas=_createCanvas()}canvas.addEventListener("webglcontextcreationerror",function(e){_utils.log.log(0,e.statusMessage||"Unknown error")},false);if(webgl2){gl=canvas.getContext("webgl2",opts);gl=gl||canvas.getContext("experimental-webgl2",opts)}gl=gl||canvas.getContext("webgl",opts);gl=gl||canvas.getContext("experimental-webgl",opts);(0,_assert2.default)(gl,"Failed to create WebGLRenderingContext")}if(_utils.isBrowser&&debug){var debugGL=_webglDebug2.default.makeDebugContext(gl,throwOnError,validateArgsAndLog);var WebGLDebugContext=function WebGLDebugContext(){_classCallCheck(this,WebGLDebugContext)};Object.assign(WebGLDebugContext.prototype,debugGL);gl=debugGL;gl.debug=true;_utils.log.priority=_utils.log.priority<1?1:_utils.log.priority;logInfo(gl);_utils.log.log(0,STARTUP_MESSAGE)}return gl}function _createCanvas(){var canvas=document.createElement("canvas");canvas.id="lumagl-canvas";canvas.style.width="100%";canvas.style.height="100%";_utils.pageLoadPromise.then(function(document){var body=document.body;body.insertBefore(canvas,body.firstChild)});return canvas}function _createHeadlessContext(width,height,opts){if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_NODE)}if(!_globals2.default.globals.headlessGL){throw new Error(ERR_HEADLESSGL_NOT_AVAILABLE)}var gl=_globals2.default.globals.headlessGL(width,height,opts);if(!gl){throw new Error(ERR_HEADLESSGL_FAILED)}return gl}function getGLExtension(gl,extensionName){var ERROR="Illegal arg to getExtension";(0,_assert2.default)(gl instanceof _webglTypes.WebGLRenderingContext,ERROR);(0,_assert2.default)(typeof extensionName==="string",ERROR);var extension=gl.getExtension(extensionName);(0,_assert2.default)(extension,extensionName+" not supported!");return extension}function poll(gl){(0,_webglChecks.assertWebGLContext)(gl);_queryManager2.default.poll(gl)}function glContextWithState(gl,_ref2,func){var scissorTest=_ref2.scissorTest;var framebuffer=_ref2.framebuffer;var scissorTestWasEnabled=void 0;if(scissorTest){scissorTestWasEnabled=gl.isEnabled(gl.SCISSOR_TEST);var x=scissorTest.x;var y=scissorTest.y;var w=scissorTest.w;var h=scissorTest.h;gl.enable(gl.SCISSOR_TEST);gl.scissor(x,y,w,h)}if(framebuffer){framebuffer.bind()}var value=void 0;try{value=func(gl)}finally{if(!scissorTestWasEnabled){gl.disable(gl.SCISSOR_TEST)}if(framebuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,null)}}return value}function glGetDebugInfo(gl){var info=gl.getExtension("WEBGL_debug_renderer_info");return{vendor:info?gl.getParameter(GL_UNMASKED_VENDOR_WEBGL):"unknown",renderer:info?gl.getParameter(GL_UNMASKED_RENDERER_WEBGL):"unknown"}}function logInfo(gl){var webGL=(0,_webglChecks.isWebGL2Context)(gl)?"WebGL2":"WebGL1";var info=glGetDebugInfo(gl);var driver=info?"using driver: "+info.vendor+" "+info.renderer:"";var debug=gl.debug?"debug":"";_utils.log.log(0,"luma.gl "+_globals2.default.VERSION+": "+webGL+" "+debug+" context "+driver,gl)}function getFunctionString(functionName,functionArgs){var args=_webglDebug2.default.glFunctionArgsToString(functionName,functionArgs);args=""+args.slice(0,100)+(args.length>100?"...":"");return"gl."+functionName+"("+args+")"}function throwOnError(err,functionName,args){var errorMessage=_webglDebug2.default.glEnumToString(err);var functionArgs=_webglDebug2.default.glFunctionArgsToString(functionName,args);throw new Error(errorMessage+" was caused by call to: "+("gl."+functionName+"("+functionArgs+")"))}function validateArgsAndLog(functionName,functionArgs){var functionString=void 0;if(_utils.log.priority>=4){functionString=getFunctionString(functionName,functionArgs);_utils.log.info(4,""+functionString)}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=functionArgs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var arg=_step.value;if(arg===undefined){functionString=functionString||getFunctionString(functionName,functionArgs);throw new Error("Undefined argument: "+functionString)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(_utils.log.break){functionString=functionString||getFunctionString(functionName,functionArgs);var isBreakpoint=_utils.log.break&&_utils.log.break.every(function(breakString){return functionString.indexOf(breakString)!==-1});if(isBreakpoint){debugger}}}function getExtension(gl,extensionName){_utils.log.warn(0,"luma.gl: getExtension is deprecated");return getGLExtension(gl,extensionName)}},{"../globals":386,"../utils":417,"./helpers/query-manager":426,"./webgl-checks":438,"./webgl-types":441,assert:4,"webgl-debug":514}],424:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.draw=draw;var _context=require("./context");var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function draw(gl,_ref){var _ref$drawMode=_ref.drawMode;var drawMode=_ref$drawMode===undefined?_webgl.GL.TRIANGLES:_ref$drawMode;var vertexCount=_ref.vertexCount;var _ref$offset=_ref.offset;var offset=_ref$offset===undefined?0:_ref$offset;var _ref$isIndexed=_ref.isIndexed;var isIndexed=_ref$isIndexed===undefined?false:_ref$isIndexed;var _ref$indexType=_ref.indexType;var indexType=_ref$indexType===undefined?_webgl.GL.UNSIGNED_SHORT:_ref$indexType;var _ref$isInstanced=_ref.isInstanced;var isInstanced=_ref$isInstanced===undefined?false:_ref$isInstanced;var _ref$instanceCount=_ref.instanceCount;var instanceCount=_ref$instanceCount===undefined?0:_ref$instanceCount;(0,_webglChecks.assertWebGLContext)(gl);drawMode=(0,_webgl.glGet)(drawMode);indexType=(0,_webgl.glGet)(indexType);(0,_webglChecks.assertDrawMode)(drawMode,"in draw");if(isIndexed){(0,_webglChecks.assertIndexType)(indexType,"in draw")}if(isInstanced){var extension=gl.getExtension("ANGLE_instanced_arrays");if(isIndexed){extension.drawElementsInstancedANGLE(drawMode,vertexCount,indexType,offset,instanceCount)}else{extension.drawArraysInstancedANGLE(drawMode,offset,vertexCount,instanceCount)}}else if(isIndexed){gl.drawElements(drawMode,vertexCount,indexType,offset)}else{gl.drawArrays(drawMode,offset,vertexCount)}}},{"./context":423,"./webgl":442,"./webgl-checks":438,assert:4}],425:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture2d=require("./texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _renderbuffer=require("./renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function glFormatToComponents(format){switch(format){case _webgl.GL.ALPHA:return 1;case _webgl.GL.RGB:return 3;case _webgl.GL.RGBA:return 4;default:throw new Error("Unknown format")}}var Framebuffer=function(){_createClass(Framebuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Framebuffer?object:new Framebuffer(gl,{handle:object.handle||object})}}]);function Framebuffer(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var id=_ref.id;var params=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,Framebuffer);(0,_webglChecks.assertWebGLContext)(gl);var handle=gl.createFramebuffer();if(!handle){throw new Error("Failed to create WebGL Framebuffer")}this.gl=gl;this.id=(0,_utils.uid)(id);this.handle=handle;this.colorBuffer=null;this.depthBuffer=null;this.stencilBuffer=null;this.texture=null;this.userData={};this.width=0;this.height=0;Object.seal(this);this.resize(params)}_createClass(Framebuffer,[{key:"delete",value:function _delete(){var gl=this.gl;gl.deleteFramebuffer(this.handle)}},{key:"resize",value:function resize(_ref2){var width=_ref2.width;var height=_ref2.height;this.update({width:width,height:height})}},{key:"update",value:function update(_ref3){var _ref3$width=_ref3.width;var width=_ref3$width===undefined?1:_ref3$width;var _ref3$height=_ref3.height;var height=_ref3$height===undefined?1:_ref3$height;var _ref3$depth=_ref3.depth;var depth=_ref3$depth===undefined?true:_ref3$depth;var _ref3$minFilter=_ref3.minFilter;var minFilter=_ref3$minFilter===undefined?_webgl.GL.NEAREST:_ref3$minFilter;var _ref3$magFilter=_ref3.magFilter;var magFilter=_ref3$magFilter===undefined?_webgl.GL.NEAREST:_ref3$magFilter;var _ref3$format=_ref3.format;var format=_ref3$format===undefined?_webgl.GL.RGBA:_ref3$format;var _ref3$type=_ref3.type;var type=_ref3$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref3$type;(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}_utils.log.log(1,"Resizing framebuffer "+this.id+" to "+width+"x"+height);var gl=this.gl;var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:type,format:format});this.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;this.texture=colorBuffer;if(this.depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});this.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}this.checkStatus();this.width=width;this.height=height}},{key:"bind",value:function bind(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref4$target=_ref4.target;var target=_ref4$target===undefined?_webgl.GL.FRAMEBUFFER:_ref4$target;var gl=this.gl;gl.bindFramebuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref5$target=_ref5.target;var target=_ref5$target===undefined?_webgl.GL.FRAMEBUFFER:_ref5$target;var gl=this.gl;gl.bindFramebuffer(target,null);return this}},{key:"readPixels",value:function readPixels(_ref6){var _ref6$x=_ref6.x;var x=_ref6$x===undefined?0:_ref6$x;var _ref6$y=_ref6.y;var y=_ref6$y===undefined?0:_ref6$y;var width=_ref6.width;var height=_ref6.height;var _ref6$format=_ref6.format;var format=_ref6$format===undefined?_webgl.GL.RGBA:_ref6$format;var type=_ref6.type;var _ref6$pixelArray=_ref6.pixelArray;var pixelArray=_ref6$pixelArray===undefined?null:_ref6$pixelArray;var gl=this.gl;if(!pixelArray){type=type||_webgl.GL.UNSIGNED_BYTE;var ArrayType=(0,_webgl.glTypeToArray)(type);var components=glFormatToComponents(format);pixelArray=pixelArray||new ArrayType(width*height*components)}type=type||(0,_webgl.glTypeFromArray)(pixelArray);this.bind();gl.readPixels(x,y,width,height,format,type,pixelArray);this.unbind();return pixelArray}},{key:"attachTexture",value:function attachTexture(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref7$texture=_ref7.texture;var texture=_ref7$texture===undefined?null:_ref7$texture;var _ref7$target=_ref7.target;var target=_ref7$target===undefined?_webgl.GL.FRAMEBUFFER:_ref7$target;var _ref7$attachment=_ref7.attachment;var attachment=_ref7$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref7$attachment;var _ref7$textureTarget=_ref7.textureTarget;var textureTarget=_ref7$textureTarget===undefined?_webgl.GL.TEXTURE_2D:_ref7$textureTarget;var _ref7$mipmapLevel=_ref7.mipmapLevel;var mipmapLevel=_ref7$mipmapLevel===undefined?0:_ref7$mipmapLevel;var gl=this.gl;texture=texture&&_texture2d2.default.makeFrom(gl,texture);this.bind({target:target});gl.framebufferTexture2D(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(textureTarget),texture.handle,mipmapLevel);this.unbind();return this}},{key:"attachRenderbuffer",value:function attachRenderbuffer(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref8$renderbuffer=_ref8.renderbuffer;var renderbuffer=_ref8$renderbuffer===undefined?null:_ref8$renderbuffer;var _ref8$attachment=_ref8.attachment;var attachment=_ref8$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref8$attachment;var _ref8$target=_ref8.target;var target=_ref8$target===undefined?_webgl.GL.FRAMEBUFFER:_ref8$target;var _ref8$renderbufferTar=_ref8.renderbufferTarget;var renderbufferTarget=_ref8$renderbufferTar===undefined?_webgl.GL.RENDERBUFFER:_ref8$renderbufferTar;var gl=this.gl;renderbuffer=renderbuffer&&_renderbuffer2.default.makeFrom(gl,renderbuffer);this.bind({target:target});gl.framebufferRenderbuffer(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(renderbufferTarget),renderbuffer.handle);this.unbind({target:target});return this}},{key:"checkStatus",value:function checkStatus(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref9$target=_ref9.target;var target=_ref9$target===undefined?_webgl.GL.FRAMEBUFFER:_ref9$target;var gl=this.gl;this.bind({target:target});var status=gl.checkFramebufferStatus(target);this.unbind({target:target});if(status!==gl.FRAMEBUFFER_COMPLETE){throw new Error(this._getFrameBufferStatus(status))}return this}},{key:"blit",value:function blit(_ref10){var srcX0=_ref10.srcX0;var srcY0=_ref10.srcY0;var srcX1=_ref10.srcX1;var srcY1=_ref10.srcY1;var dstX0=_ref10.dstX0;var dstY0=_ref10.dstY0;var dstX1=_ref10.dstX1;var dstY1=_ref10.dstY1;var mask=_ref10.mask;var _ref10$filter=_ref10.filter;var filter=_ref10$filter===undefined?_webgl.GL.NEAREST:_ref10$filter;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.blitFramebuffer(srcX0,srcY0,srcX1,srcY1,dstX0,dstY0,dstX1,dstY1,mask,filter);return this}},{key:"textureLayer",value:function textureLayer(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref11$target=_ref11.target;var target=_ref11$target===undefined?_webgl.GL.FRAMEBUFFER:_ref11$target;var attachment=_ref11.attachment;var texture=_ref11.texture;var level=_ref11.level;var layer=_ref11.layer;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.framebufferTextureLayer(target,attachment,texture,level,layer);return this}},{key:"invalidate",value:function invalidate(_ref12){var _ref12$target=_ref12.target;var target=_ref12$target===undefined?_webgl.GL.FRAMEBUFFER:_ref12$target;var _ref12$attachments=_ref12.attachments;var attachments=_ref12$attachments===undefined?[]:_ref12$attachments;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.invalidateFramebuffer(target,attachments);return this}},{key:"invalidateSub",value:function invalidateSub(_ref13){var _ref13$target=_ref13.target;var target=_ref13$target===undefined?_webgl.GL.FRAMEBUFFER:_ref13$target;var _ref13$attachments=_ref13.attachments;var attachments=_ref13$attachments===undefined?[]:_ref13$attachments;var _ref13$x=_ref13.x;var x=_ref13$x===undefined?0:_ref13$x;var _ref13$y=_ref13.y;var y=_ref13$y===undefined?0:_ref13$y;var width=_ref13.width;var height=_ref13.height;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.invalidateFramebuffer(target,attachments,x,y,width,height);return this}},{key:"readBuffer",value:function readBuffer(_ref14){var src=_ref14.src;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);gl.readBuffer(src);return this}},{key:"alphaSize",value:function alphaSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE)}},{key:"blueSize",value:function blueSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE)}},{key:"colorEncoding",value:function colorEncoding(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING)}},{key:"componentType",value:function componentType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE)}},{key:"depthSize",value:function depthSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE)}},{key:"greenSize",value:function greenSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE)}},{key:"objectName",value:function objectName(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME)}},{key:"objectType",value:function objectType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)}},{key:"redSize",value:function redSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE)}},{key:"stencilSize",value:function stencilSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE)}},{key:"cubeMapFace",value:function cubeMapFace(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE)}},{key:"layer",value:function layer(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER)}},{key:"level",value:function level(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}},{key:"getParameters",value:function getParameters(){return{redSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE),greenSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE),blueSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE),alphaSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE),depthSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE),stencilSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE),colorEncoding:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING),componentType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE),objectName:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),objectType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE),cubeMapFace:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE),layer:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER),level:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}}},{key:"getAttachmentParameter",value:function getAttachmentParameter(){var _ref15=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var pname=_ref15.pname;var target=_ref15.target;var attachment=_ref15.attachment;var gl=this.gl;(0,_webglChecks.assertWebGL2)(gl);var value=gl.getFramebufferAttachmentParameter(target,attachment,pname);return value}},{key:"_getFrameBufferStatus",value:function _getFrameBufferStatus(status){var error=void 0;switch(status){case _webgl.GL.FRAMEBUFFER_COMPLETE:error="Success. Framebuffer is correctly set up";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:error="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:error="There is no attachment.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:error="Height and width of the attachment are not the same.";break;case _webgl.GL.FRAMEBUFFER_UNSUPPORTED:error="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:error="The values of GL.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.";break;default:error="Framebuffer error "+status;break}return error}}]);return Framebuffer}();exports.default=Framebuffer},{"../utils":417,
"./renderbuffer":429,"./texture-2d":431,"./webgl":442,"./webgl-checks":438,assert:4}],426:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_DELETED="Query was deleted before result was available";var ERR_CANCEL="Query was canceled before result was available";var noop=function noop(x){return x};var QueryManager=function(){function QueryManager(){_classCallCheck(this,QueryManager);this.pendingQueries=new Set;this.invalidQueryType=null;this.invalidErrorMessage="";this.checkInvalid=function(){return false}}_createClass(QueryManager,[{key:"poll",value:function poll(gl){this.cancelInvalidQueries(gl);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pendingQueries.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var query=_step.value;var resultAvailable=query.isResultAvailable();if(resultAvailable){var result=query.getResult();this.resolveQuery(query,result)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"setInvalidator",value:function setInvalidator(_ref){var queryType=_ref.queryType;var errorMessage=_ref.errorMessage;var checkInvalid=_ref.checkInvalid;this.invalidQueryType=queryType;this.invalidErrorMessage=errorMessage;this.checkInvalid=checkInvalid}},{key:"beginQuery",value:function beginQuery(query){var onComplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var onError=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noop;this.cancelInvalidQueries(query.gl);this.cancelQuery(query);var resolvers={};query.promise=new Promise(function(resolve,reject){resolvers.resolve=resolve;resolvers.reject=reject});Object.assign(query.promise,resolvers);this.pendingQueries.add(query);return query.promise.then(onComplete).catch(onError)}},{key:"resolveQuery",value:function resolveQuery(query,result){this.pendingQueries.delete(query);query.promise.resolve(result)}},{key:"rejectQuery",value:function rejectQuery(query,errorMessage){this.pendingQueries.delete(query);if(query.promise){query.promise.reject(new Error(errorMessage))}}},{key:"deleteQuery",value:function deleteQuery(query){return this.rejectQuery(query,ERR_DELETED)}},{key:"cancelQuery",value:function cancelQuery(query){return this.rejectQuery(query,ERR_CANCEL)}},{key:"invalidateQuery",value:function invalidateQuery(query){if(query instanceof this.invalidQueryType){this.rejectQuery(query,this.invalidErrorMessage)}}},{key:"cancelInvalidQueries",value:function cancelInvalidQueries(gl){if(this.checkInvalid(gl)){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.pendingQueries.values()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var query=_step2.value;this.invalidateQuery(query)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}}]);return QueryManager}();exports.default=new QueryManager},{}],427:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimerQuery=exports.VertexAttributes=exports.TextureCube=exports.Texture2D=exports.Renderbuffer=exports.Framebuffer=exports.Program=exports.Shader=exports.Buffer=undefined;var _webgl=require("./webgl");Object.keys(_webgl).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl[key]}})});var _buffer=require("./buffer");Object.defineProperty(exports,"Buffer",{enumerable:true,get:function get(){return _interopRequireDefault(_buffer).default}});var _shader=require("./shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_shader).default}});var _program=require("./program");Object.defineProperty(exports,"Program",{enumerable:true,get:function get(){return _interopRequireDefault(_program).default}});var _framebuffer=require("./framebuffer");Object.defineProperty(exports,"Framebuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_framebuffer).default}});var _renderbuffer=require("./renderbuffer");Object.defineProperty(exports,"Renderbuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_renderbuffer).default}});var _texture2d=require("./texture-2d");Object.defineProperty(exports,"Texture2D",{enumerable:true,get:function get(){return _interopRequireDefault(_texture2d).default}});var _textureCube=require("./texture-cube");Object.defineProperty(exports,"TextureCube",{enumerable:true,get:function get(){return _interopRequireDefault(_textureCube).default}});var _timerQuery=require("./timer-query");Object.defineProperty(exports,"TimerQuery",{enumerable:true,get:function get(){return _interopRequireDefault(_timerQuery).default}});var _context=require("./context");Object.keys(_context).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _context[key]}})});var _draw=require("./draw");Object.keys(_draw).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _draw[key]}})});var _uniforms=require("./uniforms");Object.keys(_uniforms).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _uniforms[key]}})});var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.VertexAttributes=VertexAttributes},{"./buffer":422,"./context":423,"./draw":424,"./framebuffer":425,"./program":428,"./renderbuffer":429,"./shader":430,"./texture-2d":431,"./texture-cube":432,"./timer-query":434,"./uniforms":435,"./vertex-attributes":436,"./webgl":442}],428:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.getUniformDescriptors=getUniformDescriptors;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);var _buffer2=require("./buffer");var _buffer3=_interopRequireDefault(_buffer2);var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _uniforms=require("./uniforms");var _shader=require("./shader");var _shaderlib=require("../../shaderlib");var _shaderlib2=_interopRequireDefault(_shaderlib);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Program=function(){_createClass(Program,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Program?object:new Program(gl).setData({handle:object.handle||object})}}]);function Program(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var id=_ref.id;var _ref$vs=_ref.vs;var vs=_ref$vs===undefined?_shaderlib2.default.DEFAULT.vs:_ref$vs;var _ref$fs=_ref.fs;var fs=_ref$fs===undefined?_shaderlib2.default.DEFAULT.fs:_ref$fs;var defaultUniforms=_ref.defaultUniforms;var handle=_ref.handle;_classCallCheck(this,Program);(0,_webglChecks.assertWebGLContext)(gl);if(vs===_shaderlib2.default.DEFAULT.vs||fs===_shaderlib2.default.DEFAULT.fs&&defaultUniforms===undefined){defaultUniforms=_shaderlib2.default.DEFAULT.defaultUniforms}this.vs=new _shader.VertexShader(gl,vs);this.fs=new _shader.FragmentShader(gl,fs);var programName=this.vs.getName()||this.fs.getName();programName=programName?programName+"-program":"program";this.id=id||(0,_utils.uid)(programName);this.gl=gl;this.defaultUniforms=defaultUniforms;this.handle=handle;if(!this.handle){this.handle=gl.createProgram();this._compileAndLink(vs,fs)}if(!this.handle){throw new Error("Failed to create program")}this._attributeLocations=this._getAttributeLocations();this._attributeCount=this.getAttributeCount();this._warn=[];this._filledLocations={};this._uniformSetters=this._getUniformSetters();this._uniformCount=this.getUniformCount();this._textureIndexCounter=0;this.userData={};Object.seal(this)}_createClass(Program,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteProgram(this.handle)}this.handle=null;return this}},{key:"use",value:function use(){var gl=this.gl;gl.useProgram(this.handle);return this}},{key:"clearBuffers",value:function clearBuffers(){this._filledLocations={};return this}},{key:"_print",value:function _print(bufferName){return"Program "+this.id+": Attribute "+bufferName}},{key:"setBuffers",value:function setBuffers(buffers){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref2$clear=_ref2.clear;var clear=_ref2$clear===undefined?true:_ref2$clear;var _ref2$check=_ref2.check;var check=_ref2$check===undefined?true:_ref2$check;var _ref2$drawParams=_ref2.drawParams;var drawParams=_ref2$drawParams===undefined?{}:_ref2$drawParams;var gl=this.gl;if(Array.isArray(buffers)){throw new Error("Program.setBuffers expects map of buffers")}if(clear){this.clearBuffers()}drawParams.isInstanced=false;drawParams.isIndexed=false;drawParams.indexType=null;var _sortBuffersByLocatio=this._sortBuffersByLocation(buffers);var locations=_sortBuffersByLocatio.locations;var elements=_sortBuffersByLocatio.elements;for(var location=0;location<locations.length;++location){var bufferName=locations[location];var buffer=buffers[bufferName];if(!buffer){VertexAttributes.disable(gl,location)}else{var divisor=buffer.layout.instanced?1:0;VertexAttributes.enable(gl,location);VertexAttributes.setBuffer({gl:gl,location:location,buffer:buffer});VertexAttributes.setDivisor(gl,location,divisor);drawParams.isInstanced=buffer.layout.instanced>0;this._filledLocations[bufferName]=true}}if(elements){var _buffer=buffers[elements];_buffer.bind();drawParams.isIndexed=true;drawParams.indexType=_buffer.layout.type}if(check){this.checkBuffers()}return this}},{key:"checkBuffers",value:function checkBuffers(){for(var attributeName in this._attributeLocations){if(!this._filledLocations[attributeName]&&!this._warn[attributeName]){var location=this._attributeLocations[attributeName];_utils.log.warn(0,"Program "+this.id+": "+("Attribute "+location+":"+attributeName+" not supplied"));this._warn[attributeName]=true}}return this}},{key:"unsetBuffers",value:function unsetBuffers(){var gl=this.gl;var length=this._attributeCount;for(var i=1;i<length;++i){VertexAttributes.disable(gl,i)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);return this}},{key:"setUniforms",value:function setUniforms(uniforms){for(var uniformName in uniforms){var uniform=uniforms[uniformName];var uniformSetter=this._uniformSetters[uniformName];if(uniformSetter){if(uniform instanceof _texture2.default){if(uniformSetter.textureIndex===undefined){uniformSetter.textureIndex=this._textureIndexCounter++}var texture=uniform;var textureIndex=uniformSetter.textureIndex;texture.bind(textureIndex);uniformSetter(textureIndex)}else{uniformSetter(uniform)}}}return this}},{key:"getAttachedShadersCount",value:function getAttachedShadersCount(){return this.getProgramParameter(_webgl.GL.ATTACHED_SHADERS)}},{key:"getAttributeCount",value:function getAttributeCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_ATTRIBUTES)}},{key:"getAttributeInfo",value:function getAttributeInfo(location){return this.gl.getActiveAttrib(this.handle,location)}},{key:"getAttributeName",value:function getAttributeName(location){return this.getAttributeInfo(location).name}},{key:"getAttributeLocation",value:function getAttributeLocation(attributeName){return this.gl.getAttribLocation(this.handle,attributeName)}},{key:"getUniformCount",value:function getUniformCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_UNIFORMS)}},{key:"getUniformInfo",value:function getUniformInfo(index){return this.gl.getActiveUniform(this.handle,index)}},{key:"getUniformLocation",value:function getUniformLocation(name){return this.gl.getUniformLocation(this.handle,name)}},{key:"getUniformValue",value:function getUniformValue(location){return this.gl.getUniform(this.handle,location)}},{key:"isFlaggedForDeletion",value:function isFlaggedForDeletion(){return this.getProgramParameter(_webgl.GL.DELETE_STATUS)}},{key:"getLastLinkStatus",value:function getLastLinkStatus(){return this.getProgramParameter(_webgl.GL.LINK_STATUS)}},{key:"getLastValidationStatus",value:function getLastValidationStatus(){return this.getProgramParameter(_webgl.GL.VALIDATE_STATUS)}},{key:"getTransformFeedbackBufferMode",value:function getTransformFeedbackBufferMode(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_BUFFER_MODE)}},{key:"getTransformFeedbackVaryingsCount",value:function getTransformFeedbackVaryingsCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_VARYINGS)}},{key:"getActiveUniformBlocksCount",value:function getActiveUniformBlocksCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.ACTIVE_UNIFORM_BLOCKS)}},{key:"getFragDataLocation",value:function getFragDataLocation(varyingName){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.gl.getFragDataLocation(this.handle,varyingName)}},{key:"getProgramParameter",value:function getProgramParameter(pname){return this.gl.getProgramParameter(this.handle,pname)}},{key:"_compileAndLink",value:function _compileAndLink(vs,fs){var gl=this.gl;gl.attachShader(this.handle,this.vs.handle);gl.attachShader(this.handle,this.fs.handle);gl.linkProgram(this.handle);gl.validateProgram(this.handle);var linked=gl.getProgramParameter(this.handle,gl.LINK_STATUS);if(!linked){throw new Error("Error linking "+gl.getProgramInfoLog(this.handle))}}},{key:"_sortBuffersByLocation",value:function _sortBuffersByLocation(buffers){var elements=null;var locations=new Array(this._attributeCount);for(var bufferName in buffers){var buffer=_buffer3.default.makeFrom(this.gl,buffers[bufferName]);var location=this._attributeLocations[bufferName];if(location===undefined){if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER&&elements){throw new Error(this._print(bufferName)+" duplicate gl.ELEMENT_ARRAY_BUFFER")}else if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){elements=bufferName}else if(!this._warn[bufferName]){_utils.log.warn(2,this._print(bufferName)+" not used");this._warn[bufferName]=true}}else{if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){throw new Error(this._print(bufferName)+":"+location+" "+"has both location and type gl.ELEMENT_ARRAY_BUFFER")}locations[location]=bufferName}}return{locations:locations,elements:elements}}},{key:"_areAllAttributesEnabled",value:function _areAllAttributesEnabled(){var gl=this.gl;var length=this._attributeCount;for(var i=0;i<length;++i){if(!VertexAttributes.isEnabled(gl,i)){return false}}return true}},{key:"_getAttributeLocations",value:function _getAttributeLocations(){var attributeLocations={};var length=this.getAttributeCount();for(var location=0;location<length;location++){var name=this.getAttributeName(location);attributeLocations[name]=this.getAttributeLocation(name)}return attributeLocations}},{key:"_getUniformSetters",value:function _getUniformSetters(){var gl=this.gl;var uniformSetters={};var length=this.getUniformCount();for(var i=0;i<length;i++){var info=this.getUniformInfo(i);var parsedName=(0,_uniforms.parseUniformName)(info.name);var location=this.getUniformLocation(parsedName.name);uniformSetters[parsedName.name]=(0,_uniforms.getUniformSetter)(gl,location,info,parsedName.isArray)}return uniformSetters}}]);return Program}();exports.default=Program;function getUniformDescriptors(gl,program){var uniformDescriptors={};var length=program.getUniformCount();for(var i=0;i<length;i++){var info=program.getUniformInfo(i);var location=program.getUniformLocation(info.name);var descriptor=(0,_uniforms.getUniformSetter)(gl,location,info);uniformDescriptors[descriptor.name]=descriptor}return uniformDescriptors}},{"../../shaderlib":448,"../utils":417,"./buffer":422,"./shader":430,"./texture":433,"./uniforms":435,"./vertex-attributes":436,"./webgl":442,"./webgl-checks":438}],429:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webgl2=_interopRequireDefault(_webgl);var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Renderbuffer=function(){_createClass(Renderbuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Renderbuffer?object:new Renderbuffer(gl,{handle:object.handle||object})}}]);function Renderbuffer(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Renderbuffer);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.handle=gl.createRenderbuffer();if(!this.handle){throw new Error("Failed to create WebGL Renderbuffer")}}_createClass(Renderbuffer,[{key:"delete",value:function _delete(){this.gl.deleteRenderbuffer(this.handle);return this}},{key:"bind",value:function bind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,this.handle);return this}},{key:"unbind",value:function unbind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,null);return this}},{key:"storage",value:function storage(_ref){var internalFormat=_ref.internalFormat;var width=_ref.width;var height=_ref.height;var gl=this.gl;(0,_assert2.default)(internalFormat,"Needs internalFormat");this.bind();gl.renderbufferStorage(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(internalFormat),width,height);this.unbind();return this}},{key:"getParameter",value:function getParameter(pname){var gl=this.gl;this.bind();var value=gl.getRenderbufferParameter(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(pname));this.unbind();return value}},{key:"storageMultisample",value:function storageMultisample(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var samples=_ref2.samples;var internalformat=_ref2.internalformat;var width=_ref2.width;var height=_ref2.height;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.renderbufferStorageMultisample(_webgl2.default.RENDERBUFFER,samples,internalformat,width,height);return this}},{key:"getInternalformatParameter",value:function getInternalformatParameter(_ref3){var internalformat=_ref3.internalformat;var _ref3$pname=_ref3.pname;var pname=_ref3$pname===undefined?"SAMPLES":_ref3$pname;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);return gl.getInternalformatParameter(_webgl2.default.RENDERBUFFER,internalformat,pname)}},{key:"width",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_WIDTH)}},{key:"height",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_HEIGHT)}},{key:"internalFormat",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_INTERNAL_FORMAT)}},{key:"greenSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_GREEN_SIZE)}},{key:"blueSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_BLUE_SIZE)}},{key:"redSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_RED_SIZE)}},{key:"alphaSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_ALPHA_SIZE)}},{key:"depthSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_DEPTH_SIZE)}},{key:"stencilSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_STENCIL_SIZE)}},{key:"samples",get:function get(){return this.getParameter(this.gl.RENDERBUFFER_SAMPLES)}}]);return Renderbuffer}();exports.default=Renderbuffer},{"./webgl":442,"./webgl-checks":438,assert:4}],430:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FragmentShader=exports.VertexShader=exports.Shader=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglFormatGlslError=require("./webgl-format-glsl-error");var _webglFormatGlslError2=_interopRequireDefault(_webglFormatGlslError);var _glslShaderName=require("glsl-shader-name");var _glslShaderName2=_interopRequireDefault(_glslShaderName);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Shader=exports.Shader=function(){function Shader(gl,shaderSource,shaderType){_classCallCheck(this,Shader);this.id=(0,_glslShaderName2.default)(shaderSource)||(0,_utils.uid)(this.getTypeName(shaderType));this.gl=gl;this.shaderType=shaderType;this.source=shaderSource;this.handle=gl.createShader(shaderType);if(this.handle===null){throw new Error("Error creating shader with type "+shaderType)}this.compile()}_createClass(Shader,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteShader(this.handle);this.handle=null}}},{key:"getName",value:function getName(){return(0,_glslShaderName2.default)(this.source)}},{key:"getTypeName",value:function getTypeName(shaderType){switch(shaderType){case _webgl.GL.VERTEX_SHADER:return"vertex-shader";case _webgl.GL.FRAGMENT_SHADER:return"fragment-shader";default:return"shader"}}},{key:"compile",value:function compile(){var gl=this.gl;gl.shaderSource(this.handle,this.source);gl.compileShader(this.handle);var compiled=gl.getShaderParameter(this.handle,_webgl.GL.COMPILE_STATUS);if(!compiled){var infoLog=gl.getShaderInfoLog(this.handle);var error=(0,_webglFormatGlslError2.default)(infoLog,this.source,this.shaderType);if(_utils.log.priority>0){this.copyToClipboard(this.source)}this.delete();throw new Error("Error while compiling the shader "+error)}}},{key:"copyToClipboard",value:function copyToClipboard(text){if(_utils.isBrowser){var input=document.createElement("textarea");document.body.appendChild(input);input.value=text;input.focus();input.select();if(!document.execCommand("copy")){console.log("Failed to copy to clipboard")}input.remove()}}}]);return Shader}();var VertexShader=exports.VertexShader=function(_Shader){_inherits(VertexShader,_Shader);function VertexShader(gl,source){_classCallCheck(this,VertexShader);return _possibleConstructorReturn(this,(VertexShader.__proto__||Object.getPrototypeOf(VertexShader)).call(this,gl,source,_webgl.GL.VERTEX_SHADER))}return VertexShader}(Shader);var FragmentShader=exports.FragmentShader=function(_Shader2){_inherits(FragmentShader,_Shader2);function FragmentShader(gl,source){_classCallCheck(this,FragmentShader);return _possibleConstructorReturn(this,(FragmentShader.__proto__||Object.getPrototypeOf(FragmentShader)).call(this,gl,source,_webgl.GL.FRAGMENT_SHADER))}return FragmentShader}(Shader)},{"../utils":417,"./webgl":442,"./webgl-format-glsl-error":440,"glsl-shader-name":348}],431:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _framebuffer=require("./framebuffer");var _framebuffer2=_interopRequireDefault(_framebuffer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Texture2D=function(_Texture){_inherits(Texture2D,_Texture);_createClass(Texture2D,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Texture2D?object:new Texture2D(gl,{handle:object.handle||object})}},{key:"makeFromSolidColor",value:function makeFromSolidColor(gl,_ref){var _ref2=_slicedToArray(_ref,4);var _ref2$=_ref2[0];var r=_ref2$===undefined?0:_ref2$;var _ref2$2=_ref2[1];var g=_ref2$2===undefined?0:_ref2$2;var _ref2$3=_ref2[2];var b=_ref2$3===undefined?0:_ref2$3;var _ref2$4=_ref2[3];var a=_ref2$4===undefined?1:_ref2$4;return new Texture2D(gl,{pixels:new Uint8Array([r,g,b,a]),width:1,format:gl.RGBA,magFilter:gl.NEAREST,minFilter:gl.NEAREST})}},{key:"makeFromPixelArray",value:function makeFromPixelArray(gl,_ref3){var dataArray=_ref3.dataArray;var format=_ref3.format;var width=_ref3.width;var height=_ref3.height;var opts=_objectWithoutProperties(_ref3,["dataArray","format","width","height"]);var dataTypedArray=new Uint8Array(dataArray);return new Texture2D(gl,_extends({pixels:dataTypedArray,width:1,format:gl.RGBA},opts))}}]);function Texture2D(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Texture2D);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(Texture2D.__proto__||Object.getPrototypeOf(Texture2D)).call(this,gl,_extends({},opts,{target:gl.TEXTURE_2D})));_this.width=null;_this.height=null;Object.seal(_this);_this.setImageData(opts);if(opts.generateMipmap){_this.generateMipmap()}return _this}_createClass(Texture2D,[{key:"bind",value:function bind(){var textureUnit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.textureUnit;var gl=this.gl;if(textureUnit===undefined){throw new Error("Texture.bind: must specify texture unit")}this.textureUnit=textureUnit;gl.activeTexture(gl.TEXTURE0+textureUnit);gl.bindTexture(this.target,this.handle);
return textureUnit}},{key:"unbind",value:function unbind(){var gl=this.gl;if(this.textureUnit===undefined){throw new Error("Texture.unbind: texture unit not specified")}gl.activeTexture(gl.TEXTURE0+this.textureUnit);gl.bindTexture(this.target,null);return this.textureUnit}},{key:"getActiveUnit",value:function getActiveUnit(){return this.gl.getParameter(_webgl.GL.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0}},{key:"setPixels",value:function setPixels(_ref4){var buffer=_ref4.buffer;var _ref4$offset=_ref4.offset;var offset=_ref4$offset===undefined?0:_ref4$offset;var _ref4$width=_ref4.width;var width=_ref4$width===undefined?null:_ref4$width;var _ref4$height=_ref4.height;var height=_ref4$height===undefined?null:_ref4$height;var _ref4$mipmapLevel=_ref4.mipmapLevel;var mipmapLevel=_ref4$mipmapLevel===undefined?0:_ref4$mipmapLevel;var _ref4$internalFormat=_ref4.internalFormat;var internalFormat=_ref4$internalFormat===undefined?_webgl.GL.RGBA:_ref4$internalFormat;var _ref4$format=_ref4.format;var format=_ref4$format===undefined?_webgl.GL.RGBA:_ref4$format;var _ref4$type=_ref4.type;var type=_ref4$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref4$type;var _ref4$border=_ref4.border;var border=_ref4$border===undefined?0:_ref4$border;var opts=_objectWithoutProperties(_ref4,["buffer","offset","width","height","mipmapLevel","internalFormat","format","type","border"]);var gl=this.gl;buffer=_buffer2.default.makeFrom(buffer);gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.target);this.bind();gl.texImage2D(gl.TEXTURE_2D,mipmapLevel,format,width,height,border,format,type,buffer.target);this.unbind();gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);return this}},{key:"setImageDataFromCompressedBuffer",value:function setImageDataFromCompressedBuffer(_ref5){var buffer=_ref5.buffer;var _ref5$offset=_ref5.offset;var offset=_ref5$offset===undefined?0:_ref5$offset;var _ref5$width=_ref5.width;var width=_ref5$width===undefined?null:_ref5$width;var _ref5$height=_ref5.height;var height=_ref5$height===undefined?null:_ref5$height;var _ref5$mipmapLevel=_ref5.mipmapLevel;var mipmapLevel=_ref5$mipmapLevel===undefined?0:_ref5$mipmapLevel;var _ref5$internalFormat=_ref5.internalFormat;var internalFormat=_ref5$internalFormat===undefined?_webgl.GL.RGBA:_ref5$internalFormat;var _ref5$format=_ref5.format;var format=_ref5$format===undefined?_webgl.GL.RGBA:_ref5$format;var _ref5$type=_ref5.type;var type=_ref5$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref5$type;var _ref5$border=_ref5.border;var border=_ref5$border===undefined?0:_ref5$border;var opts=_objectWithoutProperties(_ref5,["buffer","offset","width","height","mipmapLevel","internalFormat","format","type","border"]);var gl=this.gl;gl.compressedTexImage2D(this.target,mipmapLevel,internalFormat,width,height,border,buffer);return this}},{key:"copyImageFromFramebuffer",value:function copyImageFromFramebuffer(_ref6){var framebuffer=_ref6.framebuffer;var _ref6$offset=_ref6.offset;var offset=_ref6$offset===undefined?0:_ref6$offset;var x=_ref6.x;var y=_ref6.y;var width=_ref6.width;var height=_ref6.height;var _ref6$mipmapLevel=_ref6.mipmapLevel;var mipmapLevel=_ref6$mipmapLevel===undefined?0:_ref6$mipmapLevel;var _ref6$internalFormat=_ref6.internalFormat;var internalFormat=_ref6$internalFormat===undefined?_webgl.GL.RGBA:_ref6$internalFormat;var _ref6$type=_ref6.type;var type=_ref6$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref6$type;var _ref6$border=_ref6.border;var border=_ref6$border===undefined?0:_ref6$border;var opts=_objectWithoutProperties(_ref6,["framebuffer","offset","x","y","width","height","mipmapLevel","internalFormat","type","border"]);var gl=this.gl;framebuffer=_framebuffer2.default.makeFrom(framebuffer);framebuffer.bind();this.bind();gl.copyTexImage2D(this.target,mipmapLevel,internalFormat,x,y,width,height,border);this.unbind();framebuffer.unbind()}},{key:"copySubImage",value:function copySubImage(_ref7){var pixels=_ref7.pixels;var _ref7$offset=_ref7.offset;var offset=_ref7$offset===undefined?0:_ref7$offset;var x=_ref7.x;var y=_ref7.y;var width=_ref7.width;var height=_ref7.height;var _ref7$mipmapLevel=_ref7.mipmapLevel;var mipmapLevel=_ref7$mipmapLevel===undefined?0:_ref7$mipmapLevel;var _ref7$internalFormat=_ref7.internalFormat;var internalFormat=_ref7$internalFormat===undefined?_webgl.GL.RGBA:_ref7$internalFormat;var _ref7$type=_ref7.type;var type=_ref7$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref7$type;var _ref7$border=_ref7.border;var border=_ref7$border===undefined?0:_ref7$border}}]);return Texture2D}(_texture2.default);exports.default=Texture2D},{"./buffer":422,"./framebuffer":425,"./texture":433,"./webgl":442,"./webgl-checks":438}],432:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TextureCube=function(_Texture){_inherits(TextureCube,_Texture);_createClass(TextureCube,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof TextureCube?object:new TextureCube(gl,{handle:object.handle||object})}}]);function TextureCube(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,TextureCube);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(TextureCube.__proto__||Object.getPrototypeOf(TextureCube)).call(this,gl,_extends({},opts,{target:_webgl.GL.TEXTURE_CUBE_MAP})));_this.setCubeMapImageData(opts);return _this}_createClass(TextureCube,[{key:"bind",value:function bind(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var index=_ref.index;var gl=this.gl;if(index!==undefined){gl.activeTexture(_webgl.GL.TEXTURE0+index)}gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,this.handle);if(index===undefined){var result=gl.getParameter(gl.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0;return result}return index}},{key:"unbind",value:function unbind(){var gl=this.gl;gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,null)}},{key:"setCubeMapImageData",value:function setCubeMapImageData(_ref2){var width=_ref2.width;var height=_ref2.height;var pixels=_ref2.pixels;var data=_ref2.data;var _ref2$border=_ref2.border;var border=_ref2$border===undefined?0:_ref2$border;var _ref2$format=_ref2.format;var format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format;var _ref2$type=_ref2.type;var type=_ref2$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref2$type;var _ref2$generateMipmap=_ref2.generateMipmap;var generateMipmap=_ref2$generateMipmap===undefined?false:_ref2$generateMipmap;var opts=_objectWithoutProperties(_ref2,["width","height","pixels","data","border","format","type","generateMipmap"]);var gl=this.gl;pixels=pixels||data;this.bind();if(this.width||this.height){gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,width,height,border,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,width,height,border,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,width,height,border,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,width,height,border,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,width,height,border,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,width,height,border,format,type,pixels.neg.z)}else{gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,format,type,pixels.neg.z)}this.unbind();if(generateMipmap){this.generateMipmap()}return this}}]);return TextureCube}(_texture2.default);exports.default=TextureCube},{"./texture":433,"./webgl":442,"./webgl-checks":438}],433:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Texture=function(){function Texture(gl,_ref){var _ref$id=_ref.id;var id=_ref$id===undefined?(0,_utils.uid)("texture"):_ref$id;var _ref$unpackFlipY=_ref.unpackFlipY;var unpackFlipY=_ref$unpackFlipY===undefined?true:_ref$unpackFlipY;var _ref$magFilter=_ref.magFilter;var magFilter=_ref$magFilter===undefined?_webgl.GL.NEAREST:_ref$magFilter;var _ref$minFilter=_ref.minFilter;var minFilter=_ref$minFilter===undefined?_webgl.GL.NEAREST:_ref$minFilter;var _ref$wrapS=_ref.wrapS;var wrapS=_ref$wrapS===undefined?_webgl.GL.CLAMP_TO_EDGE:_ref$wrapS;var _ref$wrapT=_ref.wrapT;var wrapT=_ref$wrapT===undefined?_webgl.GL.CLAMP_TO_EDGE:_ref$wrapT;var _ref$target=_ref.target;var target=_ref$target===undefined?_webgl.GL.TEXTURE_2D:_ref$target;var handle=_ref.handle;var opts=_objectWithoutProperties(_ref,["id","unpackFlipY","magFilter","minFilter","wrapS","wrapT","target","handle"]);_classCallCheck(this,Texture);(0,_webglChecks.assertWebGLContext)(gl);this.handle=handle||gl.createTexture();this.id=id;this.gl=gl;this.target=target;this.hasFloatTexture=gl.getExtension("OES_texture_float");this.width=null;this.height=null;this.textureUnit=undefined;this.userData={};this.setPixelStorageModes(_extends({},opts,{unpackFlipY:unpackFlipY}));this.setParameters(_extends({},opts,{magFilter:magFilter,minFilter:minFilter,wrapS:wrapS,wrapT:wrapT}))}_createClass(Texture,[{key:"delete",value:function _delete(){if(this.handle){this.gl.deleteTexture(this.handle);this.handle=null}return this}},{key:"toString",value:function toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}},{key:"generateMipmap",value:function generateMipmap(){this.gl.bindTexture(this.target,this.handle);this.gl.generateMipmap(this.target);this.gl.bindTexture(this.target,null);return this}},{key:"setImageData",value:function setImageData(_ref2){var _ref2$target=_ref2.target;var target=_ref2$target===undefined?this.target:_ref2$target;var _ref2$pixels=_ref2.pixels;var pixels=_ref2$pixels===undefined?null:_ref2$pixels;var _ref2$data=_ref2.data;var data=_ref2$data===undefined?null:_ref2$data;var width=_ref2.width;var height=_ref2.height;var _ref2$mipmapLevel=_ref2.mipmapLevel;var mipmapLevel=_ref2$mipmapLevel===undefined?0:_ref2$mipmapLevel;var _ref2$format=_ref2.format;var format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format;var type=_ref2.type;var _ref2$offset=_ref2.offset;var offset=_ref2$offset===undefined?0:_ref2$offset;var _ref2$border=_ref2.border;var border=_ref2$border===undefined?0:_ref2$border;var opts=_objectWithoutProperties(_ref2,["target","pixels","data","width","height","mipmapLevel","format","type","offset","border"]);var gl=this.gl;pixels=pixels||data;if(pixels&&pixels.data){var ndarray=pixels;pixels=ndarray.data;width=ndarray.shape[0];height=ndarray.shape[1]}gl.bindTexture(this.target,this.handle);if(pixels===null){width=width||1;height=height||1;type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(ArrayBuffer.isView(pixels)){(0,_assert2.default)(width>0&&height>0,"Texture2D: Width and height required");type=type||(0,_webgl.glTypeFromArray)(pixels);if(type===gl.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(pixels instanceof _webgl.WebGLBuffer||pixels instanceof _buffer2.default){(0,_assert2.default)(gl instanceof _webgl.WebGL2RenderingContext,"Requires WebGL2");type=type||_webgl.GL.UNSIGNED_BYTE;var buffer=_buffer2.default.makeFrom(pixels);gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.handle);gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,offset);gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);this.width=width;this.height=height}else{var imageSize=this._deduceImageSize(pixels);(0,_assert2.default)(width===undefined&&height===undefined,"Texture2D.setImageData: Width and height must not be provided");type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,format,type,pixels);this.width=imageSize.width;this.height=imageSize.height}gl.bindTexture(this.target,null);return this}},{key:"_deduceImageSize",value:function _deduceImageSize(image){if(typeof ImageData!=="undefined"&&image instanceof ImageData){return{width:image.width,height:image.height}}else if(typeof HTMLImageElement!=="undefined"&&image instanceof HTMLImageElement){return{width:image.naturalWidth,height:image.naturalHeight}}else if(typeof HTMLCanvasElement!=="undefined"&&image instanceof HTMLCanvasElement){return{width:image.width,height:image.height}}else if(typeof HTMLVideoElement!=="undefined"&&image instanceof HTMLVideoElement){return{width:image.videoWidth,height:image.videoHeight}}throw new Error("Unknown image data format. Failed to deduce image size")}},{key:"setPixelStorageModes",value:function setPixelStorageModes(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var packAlignment=_ref3.packAlignment;var unpackAlignment=_ref3.unpackAlignment;var unpackFlipY=_ref3.unpackFlipY;var unpackPremultiplyAlpha=_ref3.unpackPremultiplyAlpha;var unpackColorspaceConversion=_ref3.unpackColorspaceConversion;var packRowLength=_ref3.packRowLength;var packSkipPixels=_ref3.packSkipPixels;var packSkipRows=_ref3.packSkipRows;var unpackRowLength=_ref3.unpackRowLength;var unpackImageHeight=_ref3.unpackImageHeight;var unpackSkipPixels=_ref3.unpackSkipPixels;var unpackSkipRows=_ref3.unpackSkipRows;var unpackSkipImages=_ref3.unpackSkipImages;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(packAlignment){gl.pixelStorei(gl.PACK_ALIGNMENT,packAlignment)}if(unpackAlignment){gl.pixelStorei(gl.UNPACK_ALIGNMENT,unpackAlignment)}if(unpackFlipY){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,unpackFlipY)}if(unpackPremultiplyAlpha){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,unpackPremultiplyAlpha)}if(unpackColorspaceConversion){gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,unpackColorspaceConversion)}if(packRowLength){gl.pixelStorei(gl.PACK_ROW_LENGTH,packRowLength)}if(packSkipPixels){gl.pixelStorei(gl.PACK_SKIP_PIXELS,packSkipPixels)}if(packSkipRows){gl.pixelStorei(gl.PACK_SKIP_ROWS,packSkipRows)}if(unpackRowLength){gl.pixelStorei(gl.UNPACK_ROW_LENGTH,unpackRowLength)}if(unpackImageHeight){gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT,unpackImageHeight)}if(unpackSkipPixels){gl.pixelStorei(gl.UNPACK_SKIP_PIXELS,unpackSkipPixels)}if(unpackSkipRows){gl.pixelStorei(gl.UNPACK_SKIP_ROWS,unpackSkipRows)}if(unpackSkipImages){gl.pixelStorei(gl.UNPACK_SKIP_IMAGES,unpackSkipImages)}gl.bindTexture(this.target,null);return this}},{key:"setParameters",value:function setParameters(_ref4){var magFilter=_ref4.magFilter;var minFilter=_ref4.minFilter;var wrapS=_ref4.wrapS;var wrapT=_ref4.wrapT;var wrapR=_ref4.wrapR;var baseLevel=_ref4.baseLevel;var maxLevel=_ref4.maxLevel;var minLOD=_ref4.minLOD;var maxLOD=_ref4.maxLOD;var compareFunc=_ref4.compareFunc;var compareMode=_ref4.compareMode;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(magFilter){gl.texParameteri(this.target,gl.TEXTURE_MAG_FILTER,magFilter)}if(minFilter){gl.texParameteri(this.target,gl.TEXTURE_MIN_FILTER,minFilter)}if(wrapS){gl.texParameteri(this.target,gl.TEXTURE_WRAP_S,wrapS)}if(wrapT){gl.texParameteri(this.target,gl.TEXTURE_WRAP_T,wrapT)}if(wrapR){gl.texParameteri(this.target,gl.TEXTURE_WRAP_R,wrapR)}if(baseLevel){gl.texParameteri(this.target,gl.TEXTURE_BASE_LEVEL,baseLevel)}if(maxLevel){gl.texParameteri(this.target,gl.TEXTURE_MAX_LEVEL,maxLevel)}if(compareFunc){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_FUNC,compareFunc)}if(compareMode){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_MODE,compareMode)}if(minLOD){gl.texParameterf(this.target,gl.TEXTURE_MIN_LOD,minLOD)}if(maxLOD){gl.texParameterf(this.target,gl.TEXTURE_MAX_LOD,maxLOD)}gl.bindTexture(this.target,null);return this}},{key:"getParameters",value:function getParameters(){var gl=this.gl;gl.bindTexture(this.target,this.handle);var webglParams={magFilter:gl.getTexParameter(this.target,gl.TEXTURE_MAG_FILTER),minFilter:gl.getTexParameter(this.target,gl.TEXTURE_MIN_FILTER),wrapS:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_S),wrapT:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_T)};gl.bindTexture(this.target,null);return webglParams}},{key:"image2D",value:function image2D(_ref5){var pixels=_ref5.pixels;var _ref5$format=_ref5.format;var format=_ref5$format===undefined?_webgl.GL.RGBA:_ref5$format;var _ref5$type=_ref5.type;var type=_ref5$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref5$type;if(type===_webgl.GL.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}this.gl.bindTexture(this.target,this.handle);this.gl.texImage2D(_webgl.GL.TEXTURE_2D,0,format,format,type,pixels);this.gl.bindTexture(this.target,null);return this}},{key:"update",value:function update(opts){throw new Error("Texture.update() is deprecated()")}}]);return Texture}();exports.default=Texture},{"../utils":417,"./buffer":422,"./webgl":442,"./webgl-checks":438,assert:4}],434:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webglChecks=require("../webgl/webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GL_QUERY_COUNTER_BITS_EXT=34916;var GL_QUERY_RESULT_EXT=34918;var GL_QUERY_RESULT_AVAILABLE_EXT=34919;var GL_TIME_ELAPSED_EXT=35007;var GL_TIMESTAMP_EXT=36392;var GL_GPU_DISJOINT_EXT=36795;var noop=function noop(x){return x};var ERR_GPU_DISJOINT="Disjoint GPU operation invalidated timer queries";var ERR_TIMER_QUERY_NOT_SUPPORTED='Timer queries require "EXT_disjoint_timer_query" extension';var TimerQuery=function(){_createClass(TimerQuery,null,[{key:"isSupported",value:function isSupported(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref$requireTimestamp=_ref.requireTimestamps;var requireTimestamps=_ref$requireTimestamp===undefined?false:_ref$requireTimestamp;(0,_webglChecks.assertWebGLContext)(gl);var ext=gl.getExtension("EXT_disjoint_timer_query");var queryCounterBits=ext?ext.getQueryEXT(GL_TIMESTAMP_EXT,GL_QUERY_COUNTER_BITS_EXT):0;var timestampsSupported=queryCounterBits>0;return Boolean(ext)&&(!requireTimestamps||timestampsSupported)}}]);function TimerQuery(gl){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref2$onComplete=_ref2.onComplete;var onComplete=_ref2$onComplete===undefined?noop:_ref2$onComplete;var _ref2$onError=_ref2.onError;var onError=_ref2$onError===undefined?noop:_ref2$onError;_classCallCheck(this,TimerQuery);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.ext=this.gl.getExtension("EXT_disjoint_timer_query");this.handle=this.ext?this.ext.createQueryEXT():null;this.target=null;this.userData={};this.onComplete=onComplete;this.onError=onError;this.promise=null;Object.seal(this)}_createClass(TimerQuery,[{key:"delete",value:function _delete(){if(this.handle){_queryManager2.default.deleteQuery(this);this.ext.deleteQueryEXT(this.handle);(0,_webglChecks.glCheckError)(this.gl);this.handle=null}return this}},{key:"begin",value:function begin(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.target=GL_TIME_ELAPSED_EXT;this.ext.beginQueryEXT(this.target,this.handle)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"end",value:function end(){if(this.target){this.ext.endQueryEXT(this.target);this.target=null}return this}},{key:"timestamp",value:function timestamp(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.ext.queryCounterEXT(this.handle,GL_TIMESTAMP_EXT)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"cancel",value:function cancel(){this.end();_queryManager2.default.cancelQuery(this);return this}},{key:"isResultAvailable",value:function isResultAvailable(){return this.ext&&this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_AVAILABLE_EXT)}},{key:"getResult",value:function getResult(){return this.ext?this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_EXT)/1e6:0}}]);return TimerQuery}();exports.default=TimerQuery;_queryManager2.default.setInvalidator({queryType:TimerQuery,errorMessage:ERR_GPU_DISJOINT,checkInvalid:function checkInvalid(gl){return gl.getParameter(GL_GPU_DISJOINT_EXT)}})},{"../webgl/webgl-checks":438,"./helpers/query-manager":426}],435:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _UNIFORM_BASE_DESCRIP;exports.parseUniformName=parseUniformName;exports.getUniformSetter=getUniformSetter;exports.checkUniformValues=checkUniformValues;exports.getUniformsTable=getUniformsTable;var _webgl=require("./webgl");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var UNIFORM_BASE_DESCRIPTORS=(_UNIFORM_BASE_DESCRIP={},_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT,{function:"uniform1f",type:Float32Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC2,{function:"uniform2fv",type:Float32Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC3,{function:"uniform3fv",type:Float32Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC4,{function:"uniform4fv",type:Float32Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC3,{function:"uniform3iv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC3,{function:"uniform3fv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT2,{function:"uniformMatrix2fv",type:Float32Array,matrix:true,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT3,{mfunction:"uniformMatrix3fv",type:Float32Array,matrix:true,elements:9}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT4,{function:"uniformMatrix4fv",type:Float32Array,matrix:true,elements:16}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_2D,{function:"uniform1i",type:Uint16Array,texture:true}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_CUBE,{function:"uniform1i",type:Uint16Array,texture:true}),_UNIFORM_BASE_DESCRIP);function parseUniformName(name){var UNIFORM_NAME_REGEXP=/([^\[]*)(\[[0-9]+\])?/;var matches=name.match(UNIFORM_NAME_REGEXP);if(!matches||matches.length<2){throw new Error("Failed to parse GLSL uniform name "+name)}return{name:matches[1],length:matches[2]||1,isArray:Boolean(matches[2])}}function getUniformSetter(gl,location,info){var descriptor=UNIFORM_BASE_DESCRIPTORS[info.type];if(!descriptor){throw new Error("Unknown GLSL uniform type "+info.type)}var glFunction=gl[descriptor.function].bind(gl);var TypedArray=descriptor.type;var flatArrayLength=info.size*(descriptor.elements||1);var setter=void 0;if(flatArrayLength>1){setter=function setter(val){if(!(val instanceof TypedArray)){var typedArray=new TypedArray(flatArrayLength);typedArray.set(val);val=typedArray}(0,_assert2.default)(val.length===flatArrayLength);if(descriptor.matrix){glFunction(location,false,val)}else{glFunction(location,val)}}}else{setter=function setter(val){return glFunction(location,val)}}return setter}function checkUniformValues(uniforms,source){for(var uniformName in uniforms){var value=uniforms[uniformName];if(!checkUniformValue(value)){source=source?source+" ":"";console.error(source+" Bad uniform "+uniformName,value);throw new Error(source+" Bad uniform "+uniformName)}}return true}function checkUniformValue(value){var ok=true;if(value instanceof _texture2.default){ok=true}else if(Array.isArray(value)){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=value[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var element=_step.value;if(!isFinite(element)){ok=false}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}ok=ok&&value.length>0}else if(ArrayBuffer.isView(value)){ok=value.length>0}else if(!isFinite(value)){ok=false}return ok}function getUniformsTable(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$header=_ref.header;var header=_ref$header===undefined?"Uniforms":_ref$header;var program=_ref.program;var uniforms=_ref.uniforms;(0,_assert2.default)(program);var uniformLocations=program._uniformSetters;var table=_defineProperty({},header,{});for(var uniformName in uniformLocations){var uniform=uniforms[uniformName];if(uniform!==undefined){table[uniformName]={Type:uniform,Value:(0,_utils.formatValue)(uniform)}}}for(var _uniformName in uniformLocations){var _uniform=uniforms[_uniformName];if(_uniform===undefined){table[_uniformName]={Type:"NOT PROVIDED",Value:"N/A"}}}var unusedTable={};var unusedCount=0;for(var _uniformName2 in uniforms){var _uniform2=uniforms[_uniformName2];if(!table[_uniformName2]){unusedCount++;unusedTable[_uniformName2]={Type:"NOT USED: "+_uniform2,Value:(0,_utils.formatValue)(_uniform2)}}}return{table:table,unusedTable:unusedTable,unusedCount:unusedCount}}},{"../utils":417,"./texture":433,"./webgl":442,assert:4}],436:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMaxAttributes=getMaxAttributes;exports.hasDivisor=hasDivisor;exports.isEnabled=isEnabled;exports.getBuffer=getBuffer;exports.getGeneric=getGeneric;exports.getSize=getSize;exports.getType=getType;exports.isNormalized=isNormalized;exports.isInteger=isInteger;exports.getStride=getStride;exports.getOffset=getOffset;exports.enable=enable;exports.disable=disable;exports.setDivisor=setDivisor;exports.getDivisor=getDivisor;exports.setBuffer=setBuffer;exports.setGeneric=setGeneric;exports.setGenericValues=setGenericValues;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glGetLumaInfo(gl){if(!gl.luma){gl.luma={extensions:{}}}if(gl.luma.extensions["ANGLE_instanced_arrays"]===undefined){gl.luma.extensions["ANGLE_instanced_arrays"]=gl.getExtension("ANGLE_instanced_arrays")}return gl.luma}function getMaxAttributes(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl.getParameter(gl.MAX_VERTEX_ATTRIBS);
}function hasDivisor(gl){(0,_webglChecks.assertWebGLContext)(gl);return Boolean((0,_webglChecks.isWebGL2Context)(gl)||gl.getExtension(gl,"ANGLE_instanced_arrays"))}function isEnabled(gl,location){return Boolean(get(gl,location,gl.VERTEX_ATTRIB_ARRAY_ENABLED))}function getBuffer(gl,location){return get(gl,location,gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING)}function getGeneric(gl,location){return get(gl,gl.CURRENT_VERTEX_ATTRIB)}function getSize(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_SIZE)}function getType(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_TYPE)}function isNormalized(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED)}function isInteger(gl,location){(0,_webglChecks.assertWebGL2Context)(gl);return get(location,gl.VERTEX_ATTRIB_ARRAY_INTEGER)}function getStride(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_STRIDE)}function getOffset(gl,location){var pname=arguments.length>2&&arguments[2]!==undefined?arguments[2]:gl.VERTEX_ATTRIB_ARRAY_POINTER;return gl.getVertexAttribOffset(location,pname)}function get(gl,location,pname){(0,_webglChecks.assertWebGLContext)(gl);return gl.getVertexAttrib(location,pname)}function enable(gl,location){gl.enableVertexAttribArray(location)}function disable(gl,location){if(location>0){gl.disableVertexAttribArray(location)}}function setDivisor(gl,location,divisor){if((0,_webglChecks.isWebGL2Context)(gl)){gl.vertexAttribDivisor(location,divisor);return}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){ext.vertexAttribDivisorANGLE(location,divisor);return}if(divisor!==0){throw new Error("WebGL instanced rendering not supported")}}function getDivisor(gl,location){(0,_assert2.default)(location>0);if((0,_webglChecks.isWebGL2Context)(gl)){var divisor=get(location,gl.VERTEX_ATTRIB_ARRAY_DIVISOR);return divisor}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){var _divisor=get(location,ext.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE);return _divisor}return 0}function setBuffer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var gl=_ref.gl;var location=_ref.location;var buffer=_ref.buffer;var target=_ref.target;var layout=_ref.layout;(0,_webglChecks.assertWebGLContext)(gl);buffer=_buffer2.default.makeFrom(gl,buffer);target=(0,_webgl.glGet)(target!==undefined?target:buffer.target);layout=layout!==undefined?layout:buffer.layout;(0,_assert2.default)(target,"setBuffer needs target");(0,_assert2.default)(layout,"setBuffer called on uninitialized buffer");buffer.bind({target:gl.ARRAY_BUFFER});if(!layout.integer){gl.vertexAttribPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.normalized,layout.stride,layout.offset)}else{(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribIPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.stride,layout.offset)}buffer.unbind({target:gl.ARRAY_BUFFER})}function setGeneric(_ref2){var gl=_ref2.gl;var location=_ref2.location;var array=_ref2.array;_utils.log.warn(0,"VertexAttributes.setGeneric is not well tested");if(array instanceof Float32Array){gl.vertexAttrib4fv(location,array)}else if(array instanceof Int32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4iv(location,array)}else if(array instanceof Uint32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4uiv(location,array)}}function setGenericValues(gl,location,v0,v1,v2,v3){_utils.log.warn(0,"VertexAttributes.setGenericValues is not well tested");switch(arguments.length-1){case 1:gl.vertexAttrib1f(location,v0);break;case 2:gl.vertexAttrib2f(location,v0,v1);break;case 3:gl.vertexAttrib3f(location,v0,v1,v2);break;case 4:gl.vertexAttrib4f(location,v0,v1,v2,v3);break;default:throw new Error("vertex attribute size must be between 1 and 4")}}},{"../utils":417,"./buffer":422,"./webgl":442,"./webgl-checks":438,assert:4}],437:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glArrayFromType=undefined;exports.glTypeFromArray=glTypeFromArray;exports.glTypeToArray=glTypeToArray;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glTypeFromArray(arrayOrType){var type=ArrayBuffer.isView(arrayOrType)?arrayOrType.constructor:arrayOrType;switch(type){case Float32Array:return _webglConstants2.default.FLOAT;case Uint16Array:return _webglConstants2.default.UNSIGNED_SHORT;case Uint32Array:return _webglConstants2.default.UNSIGNED_INT;case Uint8Array:return _webglConstants2.default.UNSIGNED_BYTE;case Uint8ClampedArray:return _webglConstants2.default.UNSIGNED_BYTE;case Int8Array:return _webglConstants2.default.BYTE;case Int16Array:return _webglConstants2.default.SHORT;case Int32Array:return _webglConstants2.default.INT;default:throw new Error("Failed to deduce type from array/array type")}}function glTypeToArray(glType){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref$clamped=_ref.clamped;var clamped=_ref$clamped===undefined?true:_ref$clamped;switch(glType){case _webglConstants2.default.FLOAT:return Float32Array;case _webglConstants2.default.UNSIGNED_SHORT:case _webglConstants2.default.UNSIGNED_SHORT_5_6_5:case _webglConstants2.default.UNSIGNED_SHORT_4_4_4_4:case _webglConstants2.default.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case _webglConstants2.default.UNSIGNED_INT:return Uint32Array;case _webglConstants2.default.UNSIGNED_BYTE:return clamped?Uint8ClampedArray:Uint8Array;case _webglConstants2.default.BYTE:return Int8Array;case _webglConstants2.default.SHORT:return Int16Array;case _webglConstants2.default.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}exports.glArrayFromType=glTypeToArray},{"./webgl-constants":439}],438:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL_BUFFER_USAGE=exports.GL_TARGETS=exports.GL_DRAW_MODES=exports.GL_INDEX_TYPES=undefined;exports.isWebGLContext=isWebGLContext;exports.isWebGL2Context=isWebGL2Context;exports.assertWebGLContext=assertWebGLContext;exports.assertWebGL2Context=assertWebGL2Context;exports.isIndexType=isIndexType;exports.assertIndexType=assertIndexType;exports.isDrawMode=isDrawMode;exports.assertDrawMode=assertDrawMode;exports.assertArrayTypeMatch=assertArrayTypeMatch;exports.glGetError=glGetError;exports.glCheckError=glCheckError;var _webglTypes=require("./webgl-types");var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);var _webglArrays=require("./webgl-arrays");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ERR_CONTEXT="Invalid WebGLRenderingContext";var ERR_WEBGL2="Requires WebGL2";function isWebGLContext(gl){return gl instanceof _webglTypes.WebGLRenderingContext||gl&&gl.ARRAY_BUFFER===34962}function isWebGL2Context(gl){return gl instanceof _webglTypes.WebGL2RenderingContext||gl&&gl.TEXTURE_BINDING_3D===32874}function assertWebGLContext(gl){(0,_assert2.default)(isWebGLContext(gl),ERR_CONTEXT)}function assertWebGL2Context(gl){(0,_assert2.default)(isWebGL2Context(gl),ERR_WEBGL2)}var GL_INDEX_TYPES=exports.GL_INDEX_TYPES=[_webglConstants2.default.UNSIGNED_BYTE,_webglConstants2.default.UNSIGNED_SHORT,_webglConstants2.default.UNSIGNED_INT];function isIndexType(type){return GL_INDEX_TYPES.indexOf(type)!==-1}function assertIndexType(glType,source){(0,_assert2.default)(isIndexType(glType),"Bad index type "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_DRAW_MODES=exports.GL_DRAW_MODES=[_webglConstants2.default.POINTS,_webglConstants2.default.LINE_STRIP,_webglConstants2.default.LINE_LOOP,_webglConstants2.default.LINES,_webglConstants2.default.TRIANGLE_STRIP,_webglConstants2.default.TRIANGLE_FAN,_webglConstants2.default.TRIANGLES];function isDrawMode(glMode){return GL_DRAW_MODES.indexOf(glMode)!==-1}function assertDrawMode(glType,source){(0,_assert2.default)(isDrawMode(glType),"Bad draw mode "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_TARGETS=exports.GL_TARGETS=[_webglConstants2.default.ARRAY_BUFFER,_webglConstants2.default.ELEMENT_ARRAY_BUFFER,_webglConstants2.default.COPY_READ_BUFFER,_webglConstants2.default.COPY_WRITE_BUFFER,_webglConstants2.default.TRANSFORM_FEEDBACK_BUFFER,_webglConstants2.default.UNIFORM_BUFFER,_webglConstants2.default.PIXEL_PACK_BUFFER,_webglConstants2.default.PIXEL_UNPACK_BUFFER];var GL_BUFFER_USAGE=exports.GL_BUFFER_USAGE=[_webglConstants2.default.STATIC_DRAW,_webglConstants2.default.DYNAMIC_DRAW,_webglConstants2.default.STREAM_DRAW,_webglConstants2.default.STATIC_READ,_webglConstants2.default.DYNAMIC_READ,_webglConstants2.default.STREAM_READ,_webglConstants2.default.STATIC_COPY,_webglConstants2.default.DYNAMIC_COPY,_webglConstants2.default.STREAM_COPY];function assertArrayTypeMatch(array,type,source){(0,_assert2.default)(type===(0,_webglArrays.glTypeFromArray)(array),(array.constructor.name||"Array")+" "+("does not match element type "+(0,_webglConstants.glKey)(type)+" "+source))}function glGetError(gl){var errorStack=[];var glError=gl.getError();while(glError!==gl.NO_ERROR){errorStack.push(glGetErrorMessage(gl,glError));glError=gl.getError()}return errorStack.length?new Error(errorStack.join("\n")):null}function glCheckError(gl){if(gl.debug){var error=glGetError(gl);if(error){throw error}}}function glGetErrorMessage(gl,glError){switch(glError){case _webglConstants2.default.CONTEXT_LOST_WEBGL:return"WebGL context lost";case _webglConstants2.default.INVALID_ENUM:return"WebGL invalid enumerated argument";case _webglConstants2.default.INVALID_VALUE:return"WebGL invalid value";case _webglConstants2.default.INVALID_OPERATION:return"WebGL invalid operation";case _webglConstants2.default.INVALID_FRAMEBUFFER_OPERATION:return"WebGL invalid framebuffer operation";case _webglConstants2.default.OUT_OF_MEMORY:return"WebGL out of memory";default:return"WebGL unknown error "+glError}}},{"./webgl-arrays":437,"./webgl-constants":439,"./webgl-types":441,assert:4}],439:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL=undefined;exports.glGet=glGet;exports.glKey=glKey;var _glConstants=require("gl-constants");var _glConstants2=_interopRequireDefault(_glConstants);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.GL=_glConstants2.default;exports.default=_glConstants2.default;function glGet(name){var value=name;if(typeof name==="string"){value=_glConstants2.default[name];(0,_assert2.default)(value!==undefined,"Accessing GL."+name)}return value}function glKey(value){for(var key in _glConstants2.default){if(_glConstants2.default[key]===value){return"GL."+key}}return String(value)}},{assert:4,"gl-constants":336}],440:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=formatGLSLCompilerError;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);var _glslShaderName=require("glsl-shader-name");var _glslShaderName2=_interopRequireDefault(_glslShaderName);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function formatGLSLCompilerError(errLog,src,shaderType){var errorStrings=errLog.split(/\r?\n/);var errors={};for(var i=0;i<errorStrings.length;i++){var errorString=errorStrings[i];if(errorString.length<=1){continue}var lineNo=parseInt(errorString.split(":")[2],10);if(isNaN(lineNo)){return"Could not parse GLSL compiler error: "+errLog}errors[lineNo]=errorString}var message="";var lines=addLineNumbers(src).split(/\r?\n/);for(var _i=0;_i<lines.length;_i++){var line=lines[_i];if(!errors[_i+3]&&!errors[_i+2]&&!errors[_i+1]){continue}message+=line+"\n";if(errors[_i+1]){var e=errors[_i+1];e=e.substr(e.split(":",3).join(":").length+1).trim();message+="^^^ "+e+"\n\n"}}var name=(0,_glslShaderName2.default)(src)||"unknown name (see npm glsl-shader-name)";var type=getShaderTypeName(shaderType);return"GLSL error in "+type+" shader "+name+"\n"+message}function addLineNumbers(string){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var delim=arguments.length>2&&arguments[2]!==undefined?arguments[2]:": ";var lines=string.split(/\r?\n/);var maxDigits=String(lines.length+start-1).length;return lines.map(function(line,i){var lineNumber=i+start;var digits=String(lineNumber).length;var prefix=padLeft(lineNumber,maxDigits-digits);return prefix+delim+line}).join("\n")}function padLeft(string,digits){var result="";for(var i=0;i<digits;++i){result+=" "}return""+result+string}function getShaderTypeName(type){switch(type){case _webglConstants2.default.FRAGMENT_SHADER:return"fragment";case _webglConstants2.default.VERTEX_SHADER:return"vertex";default:return"unknown type"}}},{"./webgl-constants":439,"glsl-shader-name":348}],441:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WebGL2RenderingContext=exports.WebGLShaderPrecisionFormat=exports.WebGLActiveInfo=exports.WebGLUniformLocation=exports.WebGLTexture=exports.WebGLRenderbuffer=exports.WebGLFramebuffer=exports.WebGLBuffer=exports.WebGLShader=exports.WebGLProgram=exports.WebGLRenderingContext=exports.Image=exports.webGLTypesAvailable=undefined;var _globals=require("../globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var global=_globals2.default.global;var DummyType=function DummyType(){_classCallCheck(this,DummyType)};var _ref=_globals2.default.globals.headlessTypes||global;var _ref$WebGLRenderingCo=_ref.WebGLRenderingContext;var WebGLRenderingContext=_ref$WebGLRenderingCo===undefined?DummyType:_ref$WebGLRenderingCo;var _ref$WebGLProgram=_ref.WebGLProgram;var WebGLProgram=_ref$WebGLProgram===undefined?DummyType:_ref$WebGLProgram;var _ref$WebGLShader=_ref.WebGLShader;var WebGLShader=_ref$WebGLShader===undefined?DummyType:_ref$WebGLShader;var _ref$WebGLBuffer=_ref.WebGLBuffer;var WebGLBuffer=_ref$WebGLBuffer===undefined?DummyType:_ref$WebGLBuffer;var _ref$WebGLFramebuffer=_ref.WebGLFramebuffer;var WebGLFramebuffer=_ref$WebGLFramebuffer===undefined?DummyType:_ref$WebGLFramebuffer;var _ref$WebGLRenderbuffe=_ref.WebGLRenderbuffer;var WebGLRenderbuffer=_ref$WebGLRenderbuffe===undefined?DummyType:_ref$WebGLRenderbuffe;var _ref$WebGLTexture=_ref.WebGLTexture;var WebGLTexture=_ref$WebGLTexture===undefined?DummyType:_ref$WebGLTexture;var _ref$WebGLUniformLoca=_ref.WebGLUniformLocation;var WebGLUniformLocation=_ref$WebGLUniformLoca===undefined?DummyType:_ref$WebGLUniformLoca;var _ref$WebGLActiveInfo=_ref.WebGLActiveInfo;var WebGLActiveInfo=_ref$WebGLActiveInfo===undefined?DummyType:_ref$WebGLActiveInfo;var _ref$WebGLShaderPreci=_ref.WebGLShaderPrecisionFormat;var WebGLShaderPrecisionFormat=_ref$WebGLShaderPreci===undefined?DummyType:_ref$WebGLShaderPreci;var webGLTypesAvailable=exports.webGLTypesAvailable=WebGLRenderingContext!==DummyType&&WebGLProgram!==DummyType&&WebGLShader!==DummyType&&WebGLBuffer!==DummyType&&WebGLFramebuffer!==DummyType&&WebGLRenderbuffer!==DummyType&&WebGLTexture!==DummyType&&WebGLUniformLocation!==DummyType&&WebGLActiveInfo!==DummyType&&WebGLShaderPrecisionFormat!==DummyType;function getWebGL2RenderingContext(){var WebGL2RenderingContextNotSupported=function WebGL2RenderingContextNotSupported(){_classCallCheck(this,WebGL2RenderingContextNotSupported)};return global.WebGL2RenderingContext||WebGL2RenderingContextNotSupported}function getImage(){var ImageNotSupported=function ImageNotSupported(){_classCallCheck(this,ImageNotSupported)};return global.Image||ImageNotSupported}var WebGL2RenderingContext=getWebGL2RenderingContext();var Image=getImage();exports.Image=Image;exports.WebGLRenderingContext=WebGLRenderingContext;exports.WebGLProgram=WebGLProgram;exports.WebGLShader=WebGLShader;exports.WebGLBuffer=WebGLBuffer;exports.WebGLFramebuffer=WebGLFramebuffer;exports.WebGLRenderbuffer=WebGLRenderbuffer;exports.WebGLTexture=WebGLTexture;exports.WebGLUniformLocation=WebGLUniformLocation;exports.WebGLActiveInfo=WebGLActiveInfo;exports.WebGLShaderPrecisionFormat=WebGLShaderPrecisionFormat;exports.WebGL2RenderingContext=WebGL2RenderingContext},{"../globals":386}],442:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _webglTypes=require("./webgl-types");Object.keys(_webglTypes).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglTypes[key]}})});var _webglArrays=require("./webgl-arrays");Object.keys(_webglArrays).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglArrays[key]}})});var _webglConstants=require("./webgl-constants");Object.keys(_webglConstants).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglConstants[key]}})});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_webglConstants).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./webgl-arrays":437,"./webgl-constants":439,"./webgl-types":441}],443:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _vertexArrayObject=require("./vertex-array-object");Object.defineProperty(exports,"VertexArrayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_vertexArrayObject).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./vertex-array-object":444}],444:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.isVertexArray=isVertexArray;var _webglTypes=require("../webgl/webgl-types");var _webglChecks=require("../webgl/webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var OES_vertex_array_object="OES_vertex_array_object";var VertexArrayObject=function(){_createClass(VertexArrayObject,null,[{key:"isSupported",value:function isSupported(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl instanceof _webglTypes.WebGL2RenderingContext||gl.getExtension("OES_vertex_array_object")}},{key:"wrap",value:function wrap(gl,object){return object instanceof VertexArrayObject?object:new VertexArrayObject(gl,{handle:object.handle||object})}}]);function VertexArrayObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var handle=_ref.handle;_classCallCheck(this,VertexArrayObject);(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(VertexArrayObject.isSupported(gl),"VertexArrayObject: WebGL2 or OES_vertex_array_object required");handle=handle||createVertexArray(gl);if(!handle){throw new Error("Could not create VertexArrayObject")}this.gl=gl;this.handle=handle;this.userData={};Object.seal(this)}_createClass(VertexArrayObject,[{key:"delete",value:function _delete(){deleteVertexArray(this.gl,this.handle);return this}},{key:"bind",value:function bind(){bindVertexArray(this.gl,this.handle);return this}},{key:"unbind",value:function unbind(){bindVertexArray(this.gl,null);return this}}]);return VertexArrayObject}();exports.default=VertexArrayObject;function createVertexArray(gl){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.createVertexArray()}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.createVertexArrayOES()}return null}function deleteVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.deleteVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.deleteVertexArrayOES(vertexArray)}}function isVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.isVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.isVertexArrayOES(vertexArray)}return false}function bindVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.bindVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.bindVertexArrayOES(vertexArray)}}},{"../webgl/webgl-checks":438,"../webgl/webgl-types":441,assert:4}],445:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Fx=exports.Shaders=undefined;var _webgl=require("./webgl");Object.keys(_webgl).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl[key]}})});var _webgl2=require("./webgl2");Object.keys(_webgl2).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl2[key]}})});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _scenegraph=require("./scenegraph");Object.keys(_scenegraph).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _scenegraph[key]}})});var _core=require("./core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _shaderlib=require("../shaderlib");Object.defineProperty(exports,"Shaders",{enumerable:true,get:function get(){return _interopRequireDefault(_shaderlib).default}});var _geometry=require("./geometry");Object.keys(_geometry).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _geometry[key]}})});var _models=require("./models");Object.keys(_models).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _models[key]}})});var _fx=require("./addons/fx");Object.defineProperty(exports,"Fx",{enumerable:true,get:function get(){return _interopRequireDefault(_fx).default}});var _deprecated=require("./deprecated");Object.keys(_deprecated).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _deprecated[key]}})});var webgl=_interopRequireWildcard(_webgl);var webgl2=_interopRequireWildcard(_webgl2);var math=_interopRequireWildcard(_math);var scenegraph=_interopRequireWildcard(_scenegraph);var core=_interopRequireWildcard(_core);var _shaderlib2=_interopRequireDefault(_shaderlib);var geometry=_interopRequireWildcard(_geometry);var models=_interopRequireWildcard(_models);var _fx2=_interopRequireDefault(_fx);var deprecated=_interopRequireWildcard(_deprecated);var _globals=require("./globals");var _globals2=_interopRequireDefault(_globals);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.assign(_globals2.default,webgl,webgl2,math,scenegraph,core,_shaderlib2.default,geometry,models,deprecated,{Fx:_fx2.default})},{"../shaderlib":448,"./addons/fx":366,"./core":372,"./deprecated":376,"./geometry":382,"./globals":386,"./math":399,"./models":409,"./scenegraph":411,"./webgl":427,"./webgl2":443}],446:[function(require,module,exports){module.exports={_args:[[{raw:"luma.gl@^2.10.0",scope:null,escapedName:"luma.gl",name:"luma.gl",rawSpec:"^2.10.0",spec:">=2.10.0 <3.0.0",type:"range"},"/Users/ywang/dev/deck.gl"]],_from:"luma.gl@>=2.10.0 <3.0.0",_id:"luma.gl@2.10.0",_inCache:true,_location:"/luma.gl",_nodeVersion:"0.12.13",_npmOperationalInternal:{host:"packages-18-east.internal.npmjs.com",tmp:"tmp/luma.gl-2.10.0.tgz_1478226164051_0.7658752566203475"},_npmUser:{name:"ibgreen",email:"ib.green.home@gmail.com"},_npmVersion:"3.10.5",_phantomChildren:{},_requested:{raw:"luma.gl@^2.10.0",scope:null,escapedName:"luma.gl",name:"luma.gl",rawSpec:"^2.10.0",spec:">=2.10.0 <3.0.0",type:"range"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/luma.gl/-/luma.gl-2.10.0.tgz",_shasum:"7c18a68170adabebd930762dfe9122b9004c465e",_shrinkwrap:null,_spec:"luma.gl@^2.10.0",_where:"/Users/ywang/dev/deck.gl",bugs:{url:"https://github.com/uber/luma.gl/issues"},contributors:[{name:"Ib Green",email:"ib@uber.com"},{name:"Nicolas Belmonte",email:"nico@uber.com"},{name:"Rye Terrell"},{name:"Shan He",email:"shan@uber.com"},{name:"Mikola Lysenko"},{name:"Wesam Manassra",email:"manassra@uber.com"}],dependencies:{"autobind-decorator":"^1.3.3","babel-polyfill":"^6.5.0","canvas-to-blob":"0.0.0","filesaver.js":"^0.2.0","gl-constants":"^1.0.0","gl-matrix":"^2.3.2","glsl-shader-name":"^1.0.0",glslify:"^5.0.2",through:"^2.3.8","webgl-debug":"^1.0.2"},description:"A WebGL JavaScript visualization library.",devDependencies:{"babel-cli":"^6.3.15","babel-core":"^6.7.7","babel-eslint":"^6.0.0","babel-plugin-glslify":"^1.0.0","babel-plugin-transform-builtin-extend":"^1.1.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-preset-es2015":"^6.3.13","babel-preset-stage-2":"^6.3.13",babelify:"^7.2.0",bl:"^1.1.2","blue-tape":"^0.2.0",browserify:"^13.0.0",budo:"^8.0.3","cookie-cutter":"^0.1.1","d3-format":"^1.0.0",disc:"^1.3.2","electron-prebuilt":"^0.37.2",eslint:"^2.0","eslint-config-uber-es2015":"^2.0.0",faucet:"0.0.1","get-pixels":"^3.3.0",gl:"^4.0.2",husky:"^0.10.2",mkdirp:"^0.5.1",ndarray:"^1.0.18","save-pixels":"^2.3.2","source-map-support":"^0.4.2","tap-browser-color":"^0.1.2","tape-catch":"^1.0.4","tape-promise":"^1.1.0",testron:"^1.2.0","uglify-js":"^2.6.1"},directories:{},dist:{shasum:"7c18a68170adabebd930762dfe9122b9004c465e",tarball:"https://registry.npmjs.org/luma.gl/-/luma.gl-2.10.0.tgz"},files:["dist","shaderlib","src","headless.js","node-io.js"],gitHead:"e152d2b8df98b9de37fa5934b1d50125b6599bd7",homepage:"https://github.com/uber/luma.gl#readme",keywords:["webgl","w3c","visualization","canvas","animation","3d"],license:"MIT",main:"dist/index.js",maintainers:[{name:"gnavvy",email:"gnavvy@gmail.com"},{name:"heshan0131",email:"heshan0131@gmail.com"},{name:"ibgreen",email:"ib.green.home@gmail.com"},{name:"pessimistress",email:"cxiaoji@gmail.com"}],name:"luma.gl",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/uber/luma.gl.git"},scripts:{build:"npm run build-clean && npm run build-compile && npm run build-script","build-clean":"rm -fr dist/*","build-compile":"babel src -d dist --source-maps inline --copy-files","build-script":"browserify src/bundle.js --debug -o dist/lumagl.js -t babelify -t glslify && cat dist/lumagl.js | uglifyjs > dist/lumagl.min.js","build-watch":"babel src -d dist --source-maps inline --copy-files --watch & babel examples -d dist --source-maps inline --copy-files --watch &",docs:"npm run docs-build && open ./_docs/docs/index.html","docs-build":"rm -fr _docs/* && jekyll build --config=docs/_config.yml --layouts docs/_layouts","docs-gh-pages":"git subtree push --prefix _docs origin gh-pages","docs-gh-pages-force":"git push origin `git subtree split --prefix _docs dev`:gh-pages --force","docs-publish":"npm run docs-build && git add _docs -f && git commit -m 'UPDATE DOCS' --no-verify && npm run docs-gh-pages",lint:"eslint src",mypublish:"npm run build && npm run test && npm publish",precommit:"npm test","profile-disc":"browserify src/bundle.js --full-paths -t babelify -t glslify | discify --open",start:"npm run build-watch && budo dist/bundle.js:dist/lumagl.js --live --open --port 3000 --watch-glob '**/*.{html,css,js,glsl}' -- -t glslify",test:"npm run lint && npm run test-headless && npm run test-headless-nowebgl","test-browser":"budo test/browser.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,js,glsl}' -- -t babelify -t glslify","test-electron":"browserify test/electron.js | testron | faucet","test-headless":"babel-node --include='' test/headless.js | faucet","test-headless-nowebgl":"babel-node --include='' test/headless-nowebgl.js | faucet"},version:"2.10.0"}},{}],447:[function(require,module,exports){module.exports={hasTexture1:false,hasTextureCube1:false,enableLights:false,useReflection:false,enablePicking:false,hasPickingColors:false,hasFog:false}},{}],448:[function(require,module,exports){module.exports=require("../dist/shaderlib-helpers")},{"../dist/shaderlib-helpers":415}],449:[function(require,module,exports){"use strict";var compile=require("cwise-compiler");var EmptyProc={body:"",args:[],thisVars:[],localVars:[]};function fixup(x){if(!x){return EmptyProc}for(var i=0;i<x.args.length;++i){var a=x.args[i];if(i===0){x.args[i]={name:a,lvalue:true,rvalue:!!x.rvalue,count:x.count||1}}else{x.args[i]={name:a,lvalue:false,rvalue:true,count:1}}}if(!x.thisVars){x.thisVars=[]}if(!x.localVars){x.localVars=[]}return x}function pcompile(user_args){return compile({args:user_args.args,pre:fixup(user_args.pre),body:fixup(user_args.body),post:fixup(user_args.proc),funcName:user_args.funcName})}function makeOp(user_args){var args=[];for(var i=0;i<user_args.args.length;++i){args.push("a"+i)}var wrapper=new Function("P",["return function ",user_args.funcName,"_ndarrayops(",args.join(","),") {P(",args.join(","),");return a0}"].join(""));return wrapper(pcompile(user_args))}var assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var id in assign_ops){var op=assign_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+op+"=b"},rvalue:true,funcName:id+"eq"});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+op+"=s"},rvalue:true,funcName:id+"seq"})}})();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var id in unary_ops){var op=unary_ops[id];exports[id]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+op+"b"},funcName:id});exports[id+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+op+"a"},rvalue:true,count:2,funcName:id+"eq"})}})();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var id in binary_ops){
var op=binary_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+op+"b"},rvalue:true,count:2,funcName:id+"eq"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+op+"s"},rvalue:true,count:2,funcName:id+"seq"})}})();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var i=0;i<math_unary.length;++i){var f=math_unary[i];exports[f]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:f});exports[f+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"})}})();var math_comm=["max","min","atan2","pow"];(function(){for(var i=0;i<math_comm.length;++i){var f=math_comm[i];exports[f]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f});exports[f+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f+"s"});exports[f+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"});exports[f+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"seq"})}})();var math_noncomm=["atan2","pow"];(function(){for(var i=0;i<math_noncomm.length;++i){var f=math_noncomm[i];exports[f+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"op"});exports[f+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"ops"});exports[f+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opeq"});exports[f+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opseq"})}})();exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"});exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"});exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"});exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"});exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"});exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"});exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"});exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"});exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"});exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"});exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"});exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1},{name:"y",lvalue:false,rvalue:true,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":317}],450:[function(require,module,exports){"use strict";var ndarray=require("ndarray");var do_convert=require("./doConvert.js");module.exports=function convert(arr,result){var shape=[],c=arr,sz=1;while(Array.isArray(c)){shape.push(c.length);sz*=c.length;c=c[0]}if(shape.length===0){return ndarray()}if(!result){result=ndarray(new Float64Array(sz),shape)}do_convert(result,arr);return result}},{"./doConvert.js":451,ndarray:452}],451:[function(require,module,exports){module.exports=require("cwise-compiler")({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:true,rvalue:false,count:1},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:1},{name:"_inline_1_arg2_",lvalue:false,rvalue:true,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64})},{"cwise-compiler":317}],452:[function(require,module,exports){var iota=require("iota-array");var isBuffer=require("is-buffer");var hasTypedArrays=typeof Float64Array!=="undefined";function compare1st(a,b){return a[0]-b[0]}function order(){var stride=this.stride;var terms=new Array(stride.length);var i;for(i=0;i<terms.length;++i){terms[i]=[Math.abs(stride[i]),i]}terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i){result[i]=terms[i][1]}return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");if(dimension<0){className="View_Nil"+dtype}var useGetters=dtype==="generic";if(dimension===-1){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}";var procedure=new Function(code);return procedure()}else if(dimension===0){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}";var procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"];var indices=iota(dimension);var args=indices.map(function(i){return"i"+i});var index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+");var shapeArg=indices.map(function(i){return"b"+i}).join(",");var strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension);code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})");if(dimension===1){code.push("proto.order=[0]")}else{code.push("Object.defineProperty(proto,'order',{get:");if(dimension<4){code.push("function "+className+"_order(){");if(dimension===2){code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})")}else if(dimension===3){code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")}}else{code.push("ORDER})")}}code.push("proto.set=function "+className+"_set("+args.join(",")+",v){");if(useGetters){code.push("return this.data.set("+index_str+",v)}")}else{code.push("return this.data["+index_str+"]=v}")}code.push("proto.get=function "+className+"_get("+args.join(",")+"){");if(useGetters){code.push("return this.data.get("+index_str+")}")}else{code.push("return this.data["+index_str+"]}")}code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}");code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"});var c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}");code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");var tShape=new Array(dimension);var tStride=new Array(dimension);for(var i=0;i<dimension;++i){tShape[i]="a[i"+i+"]";tStride[i]="b[i"+i+"]"}code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}");code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}")}code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}");code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(isBuffer(data)){return"buffer"}if(hasTypedArrays){switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}}if(Array.isArray(data)){return"array"}return"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};(function(){for(var id in CACHED_CONSTRUCTORS){CACHED_CONSTRUCTORS[id].push(compileConstructor(id,-1))}});function wrappedNDArrayCtor(data,shape,stride,offset){if(data===undefined){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}else if(typeof data==="number"){data=[data]}if(shape===undefined){shape=[data.length]}var d=shape.length;if(stride===undefined){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i){stride[i]=sz;sz*=shape[i]}}if(offset===undefined){offset=0;for(var i=0;i<d;++i){if(stride[i]<0){offset-=(shape[i]-1)*stride[i]}}}var dtype=arrayDType(data);var ctor_list=CACHED_CONSTRUCTORS[dtype];while(ctor_list.length<=d+1){ctor_list.push(compileConstructor(dtype,ctor_list.length-1))}var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}module.exports=wrappedNDArrayCtor},{"iota-array":359,"is-buffer":360}],453:[function(require,module,exports){function GifWriter(buf,width,height,gopts){var p=0;var gopts=gopts===undefined?{}:gopts;var loop_count=gopts.loop===undefined?null:gopts.loop;var global_palette=gopts.palette===undefined?null:gopts.palette;if(width<=0||height<=0||width>65535||height>65535)throw"Width/Height invalid.";function check_palette_and_num_colors(palette){var num_colors=palette.length;if(num_colors<2||num_colors>256||num_colors&num_colors-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return num_colors}buf[p++]=71;buf[p++]=73;buf[p++]=70;buf[p++]=56;buf[p++]=57;buf[p++]=97;var gp_num_colors_pow2=0;var background=0;if(global_palette!==null){var gp_num_colors=check_palette_and_num_colors(global_palette);while(gp_num_colors>>=1)++gp_num_colors_pow2;gp_num_colors=1<<gp_num_colors_pow2;--gp_num_colors_pow2;if(gopts.background!==undefined){background=gopts.background;if(background>=gp_num_colors)throw"Background index out of range.";if(background===0)throw"Background index explicitly passed as 0."}}buf[p++]=width&255;buf[p++]=width>>8&255;buf[p++]=height&255;buf[p++]=height>>8&255;buf[p++]=(global_palette!==null?128:0)|gp_num_colors_pow2;buf[p++]=background;buf[p++]=0;if(global_palette!==null){for(var i=0,il=global_palette.length;i<il;++i){var rgb=global_palette[i];buf[p++]=rgb>>16&255;buf[p++]=rgb>>8&255;buf[p++]=rgb&255}}if(loop_count!==null){if(loop_count<0||loop_count>65535)throw"Loop count invalid.";buf[p++]=33;buf[p++]=255;buf[p++]=11;buf[p++]=78;buf[p++]=69;buf[p++]=84;buf[p++]=83;buf[p++]=67;buf[p++]=65;buf[p++]=80;buf[p++]=69;buf[p++]=50;buf[p++]=46;buf[p++]=48;buf[p++]=3;buf[p++]=1;buf[p++]=loop_count&255;buf[p++]=loop_count>>8&255;buf[p++]=0}var ended=false;this.addFrame=function(x,y,w,h,indexed_pixels,opts){if(ended===true){--p;ended=false}opts=opts===undefined?{}:opts;if(x<0||y<0||x>65535||y>65535)throw"x/y invalid.";if(w<=0||h<=0||w>65535||h>65535)throw"Width/Height invalid.";if(indexed_pixels.length<w*h)throw"Not enough pixels for the frame size.";var using_local_palette=true;var palette=opts.palette;if(palette===undefined||palette===null){using_local_palette=false;palette=global_palette}if(palette===undefined||palette===null)throw"Must supply either a local or global palette.";var num_colors=check_palette_and_num_colors(palette);var min_code_size=0;while(num_colors>>=1)++min_code_size;num_colors=1<<min_code_size;var delay=opts.delay===undefined?0:opts.delay;var disposal=opts.disposal===undefined?0:opts.disposal;if(disposal<0||disposal>3)throw"Disposal out of range.";var use_transparency=false;var transparent_index=0;if(opts.transparent!==undefined&&opts.transparent!==null){use_transparency=true;transparent_index=opts.transparent;if(transparent_index<0||transparent_index>=num_colors)throw"Transparent color index."}if(disposal!==0||use_transparency||delay!==0){buf[p++]=33;buf[p++]=249;buf[p++]=4;buf[p++]=disposal<<2|(use_transparency===true?1:0);buf[p++]=delay&255;buf[p++]=delay>>8&255;buf[p++]=transparent_index;buf[p++]=0}buf[p++]=44;buf[p++]=x&255;buf[p++]=x>>8&255;buf[p++]=y&255;buf[p++]=y>>8&255;buf[p++]=w&255;buf[p++]=w>>8&255;buf[p++]=h&255;buf[p++]=h>>8&255;buf[p++]=using_local_palette===true?128|min_code_size-1:0;if(using_local_palette===true){for(var i=0,il=palette.length;i<il;++i){var rgb=palette[i];buf[p++]=rgb>>16&255;buf[p++]=rgb>>8&255;buf[p++]=rgb&255}}p=GifWriterOutputLZWCodeStream(buf,p,min_code_size<2?2:min_code_size,indexed_pixels)};this.end=function(){if(ended===false){buf[p++]=59;ended=true}return p}}function GifWriterOutputLZWCodeStream(buf,p,min_code_size,index_stream){buf[p++]=min_code_size;var cur_subblock=p++;var clear_code=1<<min_code_size;var code_mask=clear_code-1;var eoi_code=clear_code+1;var next_code=eoi_code+1;var cur_code_size=min_code_size+1;var cur_shift=0;var cur=0;function emit_bytes_to_buffer(bit_block_size){while(cur_shift>=bit_block_size){buf[p++]=cur&255;cur>>=8;cur_shift-=8;if(p===cur_subblock+256){buf[cur_subblock]=255;cur_subblock=p++}}}function emit_code(c){cur|=c<<cur_shift;cur_shift+=cur_code_size;emit_bytes_to_buffer(8)}var ib_code=index_stream[0]&code_mask;var code_table={};emit_code(clear_code);for(var i=1,il=index_stream.length;i<il;++i){var k=index_stream[i]&code_mask;var cur_key=ib_code<<8|k;var cur_code=code_table[cur_key];if(cur_code===undefined){cur|=ib_code<<cur_shift;cur_shift+=cur_code_size;while(cur_shift>=8){buf[p++]=cur&255;cur>>=8;cur_shift-=8;if(p===cur_subblock+256){buf[cur_subblock]=255;cur_subblock=p++}}if(next_code===4096){emit_code(clear_code);next_code=eoi_code+1;cur_code_size=min_code_size+1;code_table={}}else{if(next_code>=1<<cur_code_size)++cur_code_size;code_table[cur_key]=next_code++}ib_code=k}else{ib_code=cur_code}}emit_code(ib_code);emit_code(eoi_code);emit_bytes_to_buffer(1);if(cur_subblock+1===p){buf[cur_subblock]=0}else{buf[cur_subblock]=p-cur_subblock-1;buf[p++]=0}return p}function GifReader(buf){var p=0;if(buf[p++]!==71||buf[p++]!==73||buf[p++]!==70||buf[p++]!==56||(buf[p++]+1&253)!==56||buf[p++]!==97){throw"Invalid GIF 87a/89a header."}var width=buf[p++]|buf[p++]<<8;var height=buf[p++]|buf[p++]<<8;var pf0=buf[p++];var global_palette_flag=pf0>>7;var num_global_colors_pow2=pf0&7;var num_global_colors=1<<num_global_colors_pow2+1;var background=buf[p++];buf[p++];var global_palette_offset=null;if(global_palette_flag){global_palette_offset=p;p+=num_global_colors*3}var no_eof=true;var frames=[];var delay=0;var transparent_index=null;var disposal=0;var loop_count=null;this.width=width;this.height=height;while(no_eof&&p<buf.length){switch(buf[p++]){case 33:switch(buf[p++]){case 255:if(buf[p]!==11||buf[p+1]==78&&buf[p+2]==69&&buf[p+3]==84&&buf[p+4]==83&&buf[p+5]==67&&buf[p+6]==65&&buf[p+7]==80&&buf[p+8]==69&&buf[p+9]==50&&buf[p+10]==46&&buf[p+11]==48&&buf[p+12]==3&&buf[p+13]==1&&buf[p+16]==0){p+=14;loop_count=buf[p++]|buf[p++]<<8;p++}else{p+=12;while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}}break;case 249:if(buf[p++]!==4||buf[p+4]!==0)throw"Invalid graphics extension block.";var pf1=buf[p++];delay=buf[p++]|buf[p++]<<8;transparent_index=buf[p++];if((pf1&1)===0)transparent_index=null;disposal=pf1>>2&7;p++;break;case 254:while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}break;default:throw"Unknown graphic control label: 0x"+buf[p-1].toString(16)}break;case 44:var x=buf[p++]|buf[p++]<<8;var y=buf[p++]|buf[p++]<<8;var w=buf[p++]|buf[p++]<<8;var h=buf[p++]|buf[p++]<<8;var pf2=buf[p++];var local_palette_flag=pf2>>7;var interlace_flag=pf2>>6&1;var num_local_colors_pow2=pf2&7;var num_local_colors=1<<num_local_colors_pow2+1;var palette_offset=global_palette_offset;var has_local_palette=false;if(local_palette_flag){var has_local_palette=true;palette_offset=p;p+=num_local_colors*3}var data_offset=p;p++;while(true){var block_size=buf[p++];if(block_size===0)break;p+=block_size}frames.push({x:x,y:y,width:w,height:h,has_local_palette:has_local_palette,palette_offset:palette_offset,data_offset:data_offset,data_length:p-data_offset,transparent_index:transparent_index,interlaced:!!interlace_flag,delay:delay,disposal:disposal});break;case 59:no_eof=false;break;default:throw"Unknown gif block: 0x"+buf[p-1].toString(16);break}}this.numFrames=function(){return frames.length};this.loopCount=function(){return loop_count};this.frameInfo=function(frame_num){if(frame_num<0||frame_num>=frames.length)throw"Frame index out of range.";return frames[frame_num]};this.decodeAndBlitFrameBGRA=function(frame_num,pixels){var frame=this.frameInfo(frame_num);var num_pixels=frame.width*frame.height;var index_stream=new Uint8Array(num_pixels);GifReaderLZWOutputIndexStream(buf,frame.data_offset,index_stream,num_pixels);var palette_offset=frame.palette_offset;var trans=frame.transparent_index;if(trans===null)trans=256;var framewidth=frame.width;var framestride=width-framewidth;var xleft=framewidth;var opbeg=(frame.y*width+frame.x)*4;var opend=((frame.y+frame.height)*width+frame.x)*4;var op=opbeg;var scanstride=framestride*4;if(frame.interlaced===true){scanstride+=width*4*7}var interlaceskip=8;for(var i=0,il=index_stream.length;i<il;++i){var index=index_stream[i];if(xleft===0){op+=scanstride;xleft=framewidth;if(op>=opend){scanstride=framestride*4+width*4*(interlaceskip-1);op=opbeg+(framewidth+framestride)*(interlaceskip<<1);interlaceskip>>=1}}if(index===trans){op+=4}else{var r=buf[palette_offset+index*3];var g=buf[palette_offset+index*3+1];var b=buf[palette_offset+index*3+2];pixels[op++]=b;pixels[op++]=g;pixels[op++]=r;pixels[op++]=255}--xleft}};this.decodeAndBlitFrameRGBA=function(frame_num,pixels){var frame=this.frameInfo(frame_num);var num_pixels=frame.width*frame.height;var index_stream=new Uint8Array(num_pixels);GifReaderLZWOutputIndexStream(buf,frame.data_offset,index_stream,num_pixels);var palette_offset=frame.palette_offset;var trans=frame.transparent_index;if(trans===null)trans=256;var framewidth=frame.width;var framestride=width-framewidth;var xleft=framewidth;var opbeg=(frame.y*width+frame.x)*4;var opend=((frame.y+frame.height)*width+frame.x)*4;var op=opbeg;var scanstride=framestride*4;if(frame.interlaced===true){scanstride+=width*4*7}var interlaceskip=8;for(var i=0,il=index_stream.length;i<il;++i){var index=index_stream[i];if(xleft===0){op+=scanstride;xleft=framewidth;if(op>=opend){scanstride=framestride*4+width*4*(interlaceskip-1);op=opbeg+(framewidth+framestride)*(interlaceskip<<1);interlaceskip>>=1}}if(index===trans){op+=4}else{var r=buf[palette_offset+index*3];var g=buf[palette_offset+index*3+1];var b=buf[palette_offset+index*3+2];pixels[op++]=r;pixels[op++]=g;pixels[op++]=b;pixels[op++]=255}--xleft}}}function GifReaderLZWOutputIndexStream(code_stream,p,output,output_length){var min_code_size=code_stream[p++];var clear_code=1<<min_code_size;var eoi_code=clear_code+1;var next_code=eoi_code+1;var cur_code_size=min_code_size+1;var code_mask=(1<<cur_code_size)-1;var cur_shift=0;var cur=0;var op=0;var subblock_size=code_stream[p++];var code_table=new Int32Array(4096);var prev_code=null;while(true){while(cur_shift<16){if(subblock_size===0)break;cur|=code_stream[p++]<<cur_shift;cur_shift+=8;if(subblock_size===1){subblock_size=code_stream[p++]}else{--subblock_size}}if(cur_shift<cur_code_size)break;var code=cur&code_mask;cur>>=cur_code_size;cur_shift-=cur_code_size;if(code===clear_code){next_code=eoi_code+1;cur_code_size=min_code_size+1;code_mask=(1<<cur_code_size)-1;prev_code=null;continue}else if(code===eoi_code){break}var chase_code=code<next_code?code:prev_code;var chase_length=0;var chase=chase_code;while(chase>clear_code){chase=code_table[chase]>>8;++chase_length}var k=chase;var op_end=op+chase_length+(chase_code!==code?1:0);if(op_end>output_length){console.log("Warning, gif stream longer than expected.");return}output[op++]=k;op+=chase_length;var b=op;if(chase_code!==code)output[op++]=k;chase=chase_code;while(chase_length--){chase=code_table[chase];output[--b]=chase&255;chase>>=8}if(prev_code!==null&&next_code<4096){code_table[next_code++]=prev_code<<8|k;if(next_code>=code_mask+1&&cur_code_size<12){++cur_code_size;code_mask=code_mask<<1|1}}prev_code=code}if(op!==output_length){console.log("Warning, gif stream shorter than expected.")}return output}try{exports.GifWriter=GifWriter;exports.GifReader=GifReader}catch(e){}},{}],454:[function(require,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],455:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],456:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],457:[function(require,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],458:[function(require,module,exports){"use strict";var utils=require("../utils/common");var trees=require("./trees");var adler32=require("./adler32");var crc32=require("./crc32");var msg=require("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;
var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}if(len===0){return}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}if(len===0){return 0}strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}if(nice_match>s.lookahead){nice_match=s.lookahead}do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}return s.lookahead}function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0){break}n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head)}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)){s.match_length=MIN_MATCH-1}}if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false)}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}if(strm.state.wrap!==2){return Z_STREAM_ERROR}strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}if(windowBits===8){windowBits=9}var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR)}s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}}if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else{s.status=NAME_STATE}}if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else{s.status=COMMENT_STATE}}if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.status=HCRC_STATE}}else{s.status=HCRC_STATE}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else{s.status=BUSY_STATE}}if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH){return Z_OK}if(s.wrap<=0){return Z_STREAM_END}if(s.wrap===2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm||!strm.state){return Z_STREAM_ERROR}s=strm.state;wrap=s.wrap;if(wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead){return Z_STREAM_ERROR}if(wrap===1){strm.adler=adler32(strm.adler,dictionary,dictLength,0)}s.wrap=0;if(dictLength>=s.w_size){if(wrap===0){zero(s.head);s.strstart=0;s.block_start=0;s.insert=0}tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size}avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s)}s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":454,"./adler32":455,"./crc32":457,"./messages":462,"./trees":463}],459:[function(require,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],460:[function(require,module,exports){"use strict";var utils=require("../utils/common");var adler32=require("./adler32");var crc32=require("./crc32");var inflate_fast=require("./inffast");var inflate_table=require("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave;
}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}state.havedict=1;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":454,"./adler32":455,"./crc32":457,"./inffast":459,"./inftrees":461}],461:[function(require,module,exports){"use strict";var utils=require("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":454}],462:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],463:[function(require,module,exports){"use strict";var utils=require("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length}var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code){continue}s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}if(overflow===0){return}do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1}for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code}}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code}}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code}}for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}if(smaller(tree,v,s.heap[j],s.depth)){break}s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--){pqdownheap(s,tree,n)}node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]!==0){return Z_BINARY}}if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}if(stored_len+4<=opt_lenb&&buf!==-1){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last){bi_windup(s)}}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":454}],464:[function(require,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}],465:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:488}],466:[function(require,module,exports){(function(Buffer){"use strict";var interlaceUtils=require("./interlace");var pixelBppMap={1:{0:0,1:0,2:0,3:255},2:{0:0,1:0,2:0,3:1},3:{0:0,1:1,2:2,3:255},4:{0:0,1:1,2:2,3:3}};function bitRetriever(data,depth){var leftOver=[];var i=0;function split(){if(i===data.length){throw new Error("Ran out of data")}var byte=data[i];i++;var byte8,byte7,byte6,byte5,byte4,byte3,byte2,byte1;switch(depth){default:throw new Error("unrecognised depth");case 16:byte2=data[i];i++;leftOver.push((byte<<8)+byte2);break;case 4:byte2=byte&15;byte1=byte>>4;leftOver.push(byte1,byte2);break;case 2:byte4=byte&3;byte3=byte>>2&3;byte2=byte>>4&3;byte1=byte>>6&3;leftOver.push(byte1,byte2,byte3,byte4);break;case 1:byte8=byte&1;byte7=byte>>1&1;byte6=byte>>2&1;byte5=byte>>3&1;byte4=byte>>4&1;byte3=byte>>5&1;byte2=byte>>6&1;byte1=byte>>7&1;leftOver.push(byte1,byte2,byte3,byte4,byte5,byte6,byte7,byte8);break}}return{get:function(count){while(leftOver.length<count){split()}var returner=leftOver.slice(0,count);leftOver=leftOver.slice(count);return returner},resetAfterLine:function(){leftOver.length=0},end:function(){if(i!==data.length){throw new Error("extra data found")}}}}function mapImage8Bit(image,pxData,getPxPos,bpp,data,rawPos){var imageWidth=image.width;var imageHeight=image.height;var imagePass=image.index;for(var y=0;y<imageHeight;y++){for(var x=0;x<imageWidth;x++){var pxPos=getPxPos(x,y,imagePass);for(var i=0;i<4;i++){var idx=pixelBppMap[bpp][i];if(i===data.length){throw new Error("Ran out of data")}pxData[pxPos+i]=idx!==255?data[idx+rawPos]:255}rawPos+=bpp}}return rawPos}function mapImageCustomBit(image,pxData,getPxPos,bpp,bits,maxBit){var imageWidth=image.width;var imageHeight=image.height;var imagePass=image.index;for(var y=0;y<imageHeight;y++){for(var x=0;x<imageWidth;x++){var pixelData=bits.get(bpp);var pxPos=getPxPos(x,y,imagePass);for(var i=0;i<4;i++){var idx=pixelBppMap[bpp][i];pxData[pxPos+i]=idx!==255?pixelData[idx]:maxBit}}bits.resetAfterLine()}}exports.dataToBitMap=function(data,bitmapInfo){var width=bitmapInfo.width;var height=bitmapInfo.height;var depth=bitmapInfo.depth;var bpp=bitmapInfo.bpp;var interlace=bitmapInfo.interlace;if(depth!==8){var bits=bitRetriever(data,depth)}var pxData;if(depth<=8){pxData=new Buffer(width*height*4)}else{pxData=new Uint16Array(width*height*4)}var maxBit=Math.pow(2,depth)-1;var rawPos=0;var images;var getPxPos;if(interlace){images=interlaceUtils.getImagePasses(width,height);getPxPos=interlaceUtils.getInterlaceIterator(width,height)}else{var nonInterlacedPxPos=0;getPxPos=function(){var returner=nonInterlacedPxPos;nonInterlacedPxPos+=4;return returner;
};images=[{width:width,height:height}]}for(var imageIndex=0;imageIndex<images.length;imageIndex++){if(depth===8){rawPos=mapImage8Bit(images[imageIndex],pxData,getPxPos,bpp,data,rawPos)}else{mapImageCustomBit(images[imageIndex],pxData,getPxPos,bpp,bits,maxBit)}}if(depth===8){if(rawPos!==data.length){throw new Error("extra data found")}}else{bits.end()}return pxData}}).call(this,require("buffer").Buffer)},{"./interlace":476,buffer:13}],467:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");module.exports=function(data,width,height,options){var outHasAlpha=options.colorType===constants.COLORTYPE_COLOR_ALPHA;if(options.inputHasAlpha&&outHasAlpha){return data}if(!options.inputHasAlpha&&!outHasAlpha){return data}var outBpp=outHasAlpha?4:3;var outData=new Buffer(width*height*outBpp);var inBpp=options.inputHasAlpha?4:3;var inIndex=0;var outIndex=0;var bgColor=options.bgColor||{};if(bgColor.red===undefined){bgColor.red=255}if(bgColor.green===undefined){bgColor.green=255}if(bgColor.blue===undefined){bgColor.blue=255}for(var y=0;y<height;y++){for(var x=0;x<width;x++){var red=data[inIndex];var green=data[inIndex+1];var blue=data[inIndex+2];var alpha;if(options.inputHasAlpha){alpha=data[inIndex+3];if(!outHasAlpha){alpha/=255;red=Math.min(Math.max(Math.round((1-alpha)*bgColor.red+alpha*red),0),255);green=Math.min(Math.max(Math.round((1-alpha)*bgColor.green+alpha*green),0),255);blue=Math.min(Math.max(Math.round((1-alpha)*bgColor.blue+alpha*blue),0),255)}}else{alpha=255}outData[outIndex]=red;outData[outIndex+1]=green;outData[outIndex+2]=blue;if(outHasAlpha){outData[outIndex+3]=alpha}inIndex+=inBpp;outIndex+=outBpp}}return outData}}).call(this,require("buffer").Buffer)},{"./constants":469,buffer:13}],468:[function(require,module,exports){(function(process,Buffer){"use strict";var util=require("util");var Stream=require("stream");var ChunkStream=module.exports=function(){Stream.call(this);this._buffers=[];this._buffered=0;this._reads=[];this._paused=false;this._encoding="utf8";this.writable=true};util.inherits(ChunkStream,Stream);ChunkStream.prototype.read=function(length,callback){this._reads.push({length:Math.abs(length),allowLess:length<0,func:callback});process.nextTick(function(){this._process();if(this._paused&&this._reads.length>0){this._paused=false;this.emit("drain")}}.bind(this))};ChunkStream.prototype.write=function(data,encoding){if(!this.writable){this.emit("error",new Error("Stream not writable"));return false}var dataBuffer;if(Buffer.isBuffer(data)){dataBuffer=data}else{dataBuffer=new Buffer(data,encoding||this._encoding)}this._buffers.push(dataBuffer);this._buffered+=dataBuffer.length;this._process();if(this._reads&&this._reads.length===0){this._paused=true}return this.writable&&!this._paused};ChunkStream.prototype.end=function(data,encoding){if(data){this.write(data,encoding)}this.writable=false;if(!this._buffers){return}if(this._buffers.length===0){this._end()}else{this._buffers.push(null);this._process()}};ChunkStream.prototype.destroySoon=ChunkStream.prototype.end;ChunkStream.prototype._end=function(){if(this._reads.length>0){this.emit("error",new Error("There are some read requests waitng on finished stream"))}this.destroy()};ChunkStream.prototype.destroy=function(){if(!this._buffers){return}this.writable=false;this._reads=null;this._buffers=null;this.emit("close")};ChunkStream.prototype._processReadAllowingLess=function(read){this._reads.shift();var smallerBuf=this._buffers[0];if(smallerBuf.length>read.length){this._buffered-=read.length;this._buffers[0]=smallerBuf.slice(read.length);read.func.call(this,smallerBuf.slice(0,read.length))}else{this._buffered-=smallerBuf.length;this._buffers.shift();read.func.call(this,smallerBuf)}};ChunkStream.prototype._processRead=function(read){this._reads.shift();var pos=0;var count=0;var data=new Buffer(read.length);while(pos<read.length){var buf=this._buffers[count++];var len=Math.min(buf.length,read.length-pos);buf.copy(data,pos,0,len);pos+=len;if(len!==buf.length){this._buffers[--count]=buf.slice(len)}}if(count>0){this._buffers.splice(0,count)}this._buffered-=read.length;read.func.call(this,data)};ChunkStream.prototype._process=function(){try{while(this._buffered>0&&this._reads&&this._reads.length>0){var read=this._reads[0];if(read.allowLess){this._processReadAllowingLess(read)}else if(this._buffered>=read.length){this._processRead(read)}else{break}}if(this._buffers&&this._buffers.length>0&&this._buffers[0]===null){this._end()}}catch(ex){this.emit("error",ex)}}}).call(this,require("_process"),require("buffer").Buffer)},{_process:488,buffer:13,stream:504,util:511}],469:[function(require,module,exports){"use strict";module.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],470:[function(require,module,exports){"use strict";var crcTable=[];(function(){for(var i=0;i<256;i++){var currentCrc=i;for(var j=0;j<8;j++){if(currentCrc&1){currentCrc=3988292384^currentCrc>>>1}else{currentCrc=currentCrc>>>1}}crcTable[i]=currentCrc}})();var CrcCalculator=module.exports=function(){this._crc=-1};CrcCalculator.prototype.write=function(data){for(var i=0;i<data.length;i++){this._crc=crcTable[(this._crc^data[i])&255]^this._crc>>>8}return true};CrcCalculator.prototype.crc32=function(){return this._crc^-1};CrcCalculator.crc32=function(buf){var crc=-1;for(var i=0;i<buf.length;i++){crc=crcTable[(crc^buf[i])&255]^crc>>>8}return crc^-1}},{}],471:[function(require,module,exports){(function(Buffer){"use strict";var paethPredictor=require("./paeth-predictor");function filterNone(pxData,pxPos,byteWidth,rawData,rawPos){pxData.copy(rawData,rawPos,pxPos,pxPos+byteWidth)}function filterSumNone(pxData,pxPos,byteWidth){var sum=0;var length=pxPos+byteWidth;for(var i=pxPos;i<length;i++){sum+=Math.abs(pxData[i])}return sum}function filterSub(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var val=pxData[pxPos+x]-left;rawData[rawPos+x]=val}}function filterSumSub(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var val=pxData[pxPos+x]-left;sum+=Math.abs(val)}return sum}function filterUp(pxData,pxPos,byteWidth,rawData,rawPos){for(var x=0;x<byteWidth;x++){var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-up;rawData[rawPos+x]=val}}function filterSumUp(pxData,pxPos,byteWidth){var sum=0;var length=pxPos+byteWidth;for(var x=pxPos;x<length;x++){var up=pxPos>0?pxData[x-byteWidth]:0;var val=pxData[x]-up;sum+=Math.abs(val)}return sum}function filterAvg(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-(left+up>>1);rawData[rawPos+x]=val}}function filterSumAvg(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var val=pxData[pxPos+x]-(left+up>>1);sum+=Math.abs(val)}return sum}function filterPaeth(pxData,pxPos,byteWidth,rawData,rawPos,bpp){for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var upleft=pxPos>0&&x>=bpp?pxData[pxPos+x-(byteWidth+bpp)]:0;var val=pxData[pxPos+x]-paethPredictor(left,up,upleft);rawData[rawPos+x]=val}}function filterSumPaeth(pxData,pxPos,byteWidth,bpp){var sum=0;for(var x=0;x<byteWidth;x++){var left=x>=bpp?pxData[pxPos+x-bpp]:0;var up=pxPos>0?pxData[pxPos+x-byteWidth]:0;var upleft=pxPos>0&&x>=bpp?pxData[pxPos+x-(byteWidth+bpp)]:0;var val=pxData[pxPos+x]-paethPredictor(left,up,upleft);sum+=Math.abs(val)}return sum}var filters={0:filterNone,1:filterSub,2:filterUp,3:filterAvg,4:filterPaeth};var filterSums={0:filterSumNone,1:filterSumSub,2:filterSumUp,3:filterSumAvg,4:filterSumPaeth};module.exports=function(pxData,width,height,options,bpp){var filterTypes;if(!("filterType"in options)||options.filterType===-1){filterTypes=[0,1,2,3,4]}else if(typeof options.filterType==="number"){filterTypes=[options.filterType]}else{throw new Error("unrecognised filter types")}var byteWidth=width*bpp;var rawPos=0;var pxPos=0;var rawData=new Buffer((byteWidth+1)*height);var sel=filterTypes[0];for(var y=0;y<height;y++){if(filterTypes.length>1){var min=Infinity;for(var i=0;i<filterTypes.length;i++){var sum=filterSums[filterTypes[i]](pxData,pxPos,byteWidth,bpp);if(sum<min){sel=filterTypes[i];min=sum}}}rawData[rawPos]=sel;rawPos++;filters[sel](pxData,pxPos,byteWidth,rawData,rawPos,bpp);rawPos+=byteWidth;pxPos+=byteWidth}return rawData}}).call(this,require("buffer").Buffer)},{"./paeth-predictor":480,buffer:13}],472:[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var ChunkStream=require("./chunkstream");var Filter=require("./filter-parse");var FilterAsync=module.exports=function(bitmapInfo){ChunkStream.call(this);var buffers=[];var that=this;this._filter=new Filter(bitmapInfo,{read:this.read.bind(this),write:function(buffer){buffers.push(buffer)},complete:function(){that.emit("complete",Buffer.concat(buffers))}});this._filter.start()};util.inherits(FilterAsync,ChunkStream)}).call(this,require("buffer").Buffer)},{"./chunkstream":468,"./filter-parse":474,buffer:13,util:511}],473:[function(require,module,exports){(function(Buffer){"use strict";var SyncReader=require("./sync-reader");var Filter=require("./filter-parse");exports.process=function(inBuffer,bitmapInfo){var outBuffers=[];var reader=new SyncReader(inBuffer);var filter=new Filter(bitmapInfo,{read:reader.read.bind(reader),write:function(bufferPart){outBuffers.push(bufferPart)},complete:function(){}});filter.start();reader.process();return Buffer.concat(outBuffers)}}).call(this,require("buffer").Buffer)},{"./filter-parse":474,"./sync-reader":486,buffer:13}],474:[function(require,module,exports){(function(Buffer){"use strict";var interlaceUtils=require("./interlace");var paethPredictor=require("./paeth-predictor");function getByteWidth(width,bpp,depth){var byteWidth=width*bpp;if(depth!==8){byteWidth=Math.ceil(byteWidth/(8/depth))}return byteWidth}var Filter=module.exports=function(bitmapInfo,dependencies){var width=bitmapInfo.width;var height=bitmapInfo.height;var interlace=bitmapInfo.interlace;var bpp=bitmapInfo.bpp;var depth=bitmapInfo.depth;this.read=dependencies.read;this.write=dependencies.write;this.complete=dependencies.complete;this._imageIndex=0;this._images=[];if(interlace){var passes=interlaceUtils.getImagePasses(width,height);for(var i=0;i<passes.length;i++){this._images.push({byteWidth:getByteWidth(passes[i].width,bpp,depth),height:passes[i].height,lineIndex:0})}}else{this._images.push({byteWidth:getByteWidth(width,bpp,depth),height:height,lineIndex:0})}if(depth===8){this._xComparison=bpp}else if(depth===16){this._xComparison=bpp*2}else{this._xComparison=1}};Filter.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))};Filter.prototype._unFilterType1=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f1Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;unfilteredLine[x]=rawByte+f1Left}};Filter.prototype._unFilterType2=function(rawData,unfilteredLine,byteWidth){var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f2Up=lastLine?lastLine[x]:0;unfilteredLine[x]=rawByte+f2Up}};Filter.prototype._unFilterType3=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f3Up=lastLine?lastLine[x]:0;var f3Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;var f3Add=Math.floor((f3Left+f3Up)/2);unfilteredLine[x]=rawByte+f3Add}};Filter.prototype._unFilterType4=function(rawData,unfilteredLine,byteWidth){var xComparison=this._xComparison;var xBiggerThan=xComparison-1;var lastLine=this._lastLine;for(var x=0;x<byteWidth;x++){var rawByte=rawData[1+x];var f4Up=lastLine?lastLine[x]:0;var f4Left=x>xBiggerThan?unfilteredLine[x-xComparison]:0;var f4UpLeft=x>xBiggerThan&&lastLine?lastLine[x-xComparison]:0;var f4Add=paethPredictor(f4Left,f4Up,f4UpLeft);unfilteredLine[x]=rawByte+f4Add}};Filter.prototype._reverseFilterLine=function(rawData){var filter=rawData[0];var unfilteredLine;var currentImage=this._images[this._imageIndex];var byteWidth=currentImage.byteWidth;if(filter===0){unfilteredLine=rawData.slice(1,byteWidth+1)}else{unfilteredLine=new Buffer(byteWidth);switch(filter){case 1:this._unFilterType1(rawData,unfilteredLine,byteWidth);break;case 2:this._unFilterType2(rawData,unfilteredLine,byteWidth);break;case 3:this._unFilterType3(rawData,unfilteredLine,byteWidth);break;case 4:this._unFilterType4(rawData,unfilteredLine,byteWidth);break;default:throw new Error("Unrecognised filter type - "+filter)}}this.write(unfilteredLine);currentImage.lineIndex++;if(currentImage.lineIndex>=currentImage.height){this._lastLine=null;this._imageIndex++;currentImage=this._images[this._imageIndex]}else{this._lastLine=unfilteredLine}if(currentImage){this.read(currentImage.byteWidth+1,this._reverseFilterLine.bind(this))}else{this._lastLine=null;this.complete()}}}).call(this,require("buffer").Buffer)},{"./interlace":476,"./paeth-predictor":480,buffer:13}],475:[function(require,module,exports){(function(Buffer){"use strict";function dePalette(indata,outdata,width,height,palette){var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){var color=palette[indata[pxPos]];if(!color){throw new Error("index "+indata[pxPos]+" not in palette")}for(var i=0;i<4;i++){outdata[pxPos+i]=color[i]}pxPos+=4}}}function replaceTransparentColor(indata,outdata,width,height,transColor){var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){var makeTrans=false;if(transColor.length===1){if(transColor[0]===indata[pxPos]){makeTrans=true}}else if(transColor[0]===indata[pxPos]&&transColor[1]===indata[pxPos+1]&&transColor[2]===indata[pxPos+2]){makeTrans=true}if(makeTrans){for(var i=0;i<4;i++){outdata[pxPos+i]=0}}pxPos+=4}}}function scaleDepth(indata,outdata,width,height,depth){var maxOutSample=255;var maxInSample=Math.pow(2,depth)-1;var pxPos=0;for(var y=0;y<height;y++){for(var x=0;x<width;x++){for(var i=0;i<4;i++){outdata[pxPos+i]=Math.floor(indata[pxPos+i]*maxOutSample/maxInSample+.5)}pxPos+=4}}}module.exports=function(indata,imageData){var depth=imageData.depth;var width=imageData.width;var height=imageData.height;var colorType=imageData.colorType;var transColor=imageData.transColor;var palette=imageData.palette;var outdata=indata;if(colorType===3){dePalette(indata,outdata,width,height,palette)}else{if(transColor){replaceTransparentColor(indata,outdata,width,height,transColor)}if(depth!==8){if(depth===16){outdata=new Buffer(width*height*4)}scaleDepth(indata,outdata,width,height,depth)}}return outdata}}).call(this,require("buffer").Buffer)},{buffer:13}],476:[function(require,module,exports){"use strict";var imagePasses=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];exports.getImagePasses=function(width,height){var images=[];var xLeftOver=width%8;var yLeftOver=height%8;var xRepeats=(width-xLeftOver)/8;var yRepeats=(height-yLeftOver)/8;for(var i=0;i<imagePasses.length;i++){var pass=imagePasses[i];var passWidth=xRepeats*pass.x.length;var passHeight=yRepeats*pass.y.length;for(var j=0;j<pass.x.length;j++){if(pass.x[j]<xLeftOver){passWidth++}else{break}}for(j=0;j<pass.y.length;j++){if(pass.y[j]<yLeftOver){passHeight++}else{break}}if(passWidth>0&&passHeight>0){images.push({width:passWidth,height:passHeight,index:i})}}return images};exports.getInterlaceIterator=function(width){return function(x,y,pass){var outerXLeftOver=x%imagePasses[pass].x.length;var outerX=(x-outerXLeftOver)/imagePasses[pass].x.length*8+imagePasses[pass].x[outerXLeftOver];var outerYLeftOver=y%imagePasses[pass].y.length;var outerY=(y-outerYLeftOver)/imagePasses[pass].y.length*8+imagePasses[pass].y[outerYLeftOver];return outerX*4+outerY*width*4}}},{}],477:[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var Stream=require("stream");var constants=require("./constants");var Packer=require("./packer");var PackerAsync=module.exports=function(opt){Stream.call(this);var options=opt||{};this._packer=new Packer(options);this._deflate=this._packer.createDeflate();this.readable=true};util.inherits(PackerAsync,Stream);PackerAsync.prototype.pack=function(data,width,height,gamma){this.emit("data",new Buffer(constants.PNG_SIGNATURE));this.emit("data",this._packer.packIHDR(width,height));if(gamma){this.emit("data",this._packer.packGAMA(gamma))}var filteredData=this._packer.filterData(data,width,height);this._deflate.on("error",this.emit.bind(this,"error"));this._deflate.on("data",function(compressedData){this.emit("data",this._packer.packIDAT(compressedData))}.bind(this));this._deflate.on("end",function(){this.emit("data",this._packer.packIEND());this.emit("end")}.bind(this));this._deflate.end(filteredData)}}).call(this,require("buffer").Buffer)},{"./constants":469,"./packer":479,buffer:13,stream:504,util:511}],478:[function(require,module,exports){(function(Buffer){"use strict";var hasSyncZlib=true;var zlib=require("zlib");if(!zlib.deflateSync){hasSyncZlib=false}var constants=require("./constants");var Packer=require("./packer");module.exports=function(metaData,opt){if(!hasSyncZlib){throw new Error("To use the sync capability of this library in old node versions, please also add a dependency on node-zlb-backport")}var options=opt||{};var packer=new Packer(options);var chunks=[];chunks.push(new Buffer(constants.PNG_SIGNATURE));chunks.push(packer.packIHDR(metaData.width,metaData.height));if(metaData.gamma){chunks.push(packer.packGAMA(metaData.gamma))}var filteredData=packer.filterData(metaData.data,metaData.width,metaData.height);var compressedData=zlib.deflateSync(filteredData,packer.getDeflateOptions());filteredData=null;if(!compressedData||!compressedData.length){throw new Error("bad png - invalid compressed data response")}chunks.push(packer.packIDAT(compressedData));chunks.push(packer.packIEND());return Buffer.concat(chunks)}}).call(this,require("buffer").Buffer)},{"./constants":469,"./packer":479,buffer:13,zlib:11}],479:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");var CrcStream=require("./crc");var bitPacker=require("./bitpacker");var filter=require("./filter-pack");var zlib=require("zlib");var Packer=module.exports=function(options){this._options=options;options.deflateChunkSize=options.deflateChunkSize||32*1024;options.deflateLevel=options.deflateLevel!=null?options.deflateLevel:9;options.deflateStrategy=options.deflateStrategy!=null?options.deflateStrategy:3;options.inputHasAlpha=options.inputHasAlpha!=null?options.inputHasAlpha:true;options.deflateFactory=options.deflateFactory||zlib.createDeflate;options.bitDepth=options.bitDepth||8;options.colorType=typeof options.colorType==="number"?options.colorType:constants.COLORTYPE_COLOR_ALPHA;if(options.colorType!==constants.COLORTYPE_COLOR&&options.colorType!==constants.COLORTYPE_COLOR_ALPHA){throw new Error("option color type:"+options.colorType+" is not supported at present")}if(options.bitDepth!==8){throw new Error("option bit depth:"+options.bitDepth+" is not supported at present")}};Packer.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}};Packer.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())};Packer.prototype.filterData=function(data,width,height){var packedData=bitPacker(data,width,height,this._options);var bpp=constants.COLORTYPE_TO_BPP_MAP[this._options.colorType];var filteredData=filter(packedData,width,height,this._options,bpp);return filteredData};Packer.prototype._packChunk=function(type,data){var len=data?data.length:0;var buf=new Buffer(len+12);buf.writeUInt32BE(len,0);buf.writeUInt32BE(type,4);if(data){data.copy(buf,8)}buf.writeInt32BE(CrcStream.crc32(buf.slice(4,buf.length-4)),buf.length-4);return buf};Packer.prototype.packGAMA=function(gamma){var buf=new Buffer(4);buf.writeUInt32BE(Math.floor(gamma*constants.GAMMA_DIVISION),0);return this._packChunk(constants.TYPE_gAMA,buf)};Packer.prototype.packIHDR=function(width,height){var buf=new Buffer(13);buf.writeUInt32BE(width,0);buf.writeUInt32BE(height,4);buf[8]=this._options.bitDepth;buf[9]=this._options.colorType;buf[10]=0;buf[11]=0;buf[12]=0;return this._packChunk(constants.TYPE_IHDR,buf)};Packer.prototype.packIDAT=function(data){return this._packChunk(constants.TYPE_IDAT,data)};Packer.prototype.packIEND=function(){return this._packChunk(constants.TYPE_IEND,null)}}).call(this,require("buffer").Buffer)},{"./bitpacker":467,"./constants":469,"./crc":470,"./filter-pack":471,buffer:13,zlib:11}],480:[function(require,module,exports){"use strict";module.exports=function paethPredictor(left,above,upLeft){var paeth=left+above-upLeft;var pLeft=Math.abs(paeth-left);var pAbove=Math.abs(paeth-above);var pUpLeft=Math.abs(paeth-upLeft);if(pLeft<=pAbove&&pLeft<=pUpLeft){return left}if(pAbove<=pUpLeft){return above}return upLeft}},{}],481:[function(require,module,exports){"use strict";var util=require("util");var zlib=require("zlib");var ChunkStream=require("./chunkstream");var FilterAsync=require("./filter-parse-async");var Parser=require("./parser");var bitmapper=require("./bitmapper");var formatNormaliser=require("./format-normaliser");var ParserAsync=module.exports=function(options){ChunkStream.call(this);this._parser=new Parser(options,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this)});this._options=options;this.writable=true;this._parser.start()};util.inherits(ParserAsync,ChunkStream);ParserAsync.prototype._handleError=function(err){this.emit("error",err);this.writable=false;this.destroy();if(this._inflate&&this._inflate.destroy){this._inflate.destroy()}this.errord=true};ParserAsync.prototype._inflateData=function(data){if(!this._inflate){this._inflate=zlib.createInflate();this._inflate.on("error",this.emit.bind(this,"error"));this._filter.on("complete",this._complete.bind(this));this._inflate.pipe(this._filter)}this._inflate.write(data)};ParserAsync.prototype._handleMetaData=function(metaData){this.emit("metadata",metaData);this._bitmapInfo=Object.create(metaData);this._filter=new FilterAsync(this._bitmapInfo)};ParserAsync.prototype._handleTransColor=function(transColor){this._bitmapInfo.transColor=transColor};ParserAsync.prototype._handlePalette=function(palette){this._bitmapInfo.palette=palette};ParserAsync.prototype._finished=function(){if(this.errord){return}if(!this._inflate){this.emit("error","No Inflate block")}else{this._inflate.end()}this.destroySoon()};ParserAsync.prototype._complete=function(filteredData){if(this.errord){return}try{var bitmapData=bitmapper.dataToBitMap(filteredData,this._bitmapInfo);var normalisedBitmapData=formatNormaliser(bitmapData,this._bitmapInfo);bitmapData=null}catch(ex){this._handleError(ex);return}this.emit("parsed",normalisedBitmapData)}},{"./bitmapper":466,"./chunkstream":468,"./filter-parse-async":472,"./format-normaliser":475,"./parser":483,util:511,zlib:11}],482:[function(require,module,exports){(function(Buffer){"use strict";var hasSyncZlib=true;var zlib=require("zlib");if(!zlib.deflateSync){hasSyncZlib=false}var SyncReader=require("./sync-reader");var FilterSync=require("./filter-parse-sync");var Parser=require("./parser");var bitmapper=require("./bitmapper");var formatNormaliser=require("./format-normaliser");module.exports=function(buffer,options){if(!hasSyncZlib){throw new Error("To use the sync capability of this library in old node versions, please also add a dependency on node-zlb-backport")}var err;function handleError(_err_){err=_err_}var metaData;function handleMetaData(_metaData_){metaData=_metaData_}function handleTransColor(transColor){metaData.transColor=transColor}function handlePalette(palette){metaData.palette=palette}var gamma;function handleGamma(_gamma_){gamma=_gamma_}var inflateDataList=[];function handleInflateData(inflatedData){inflateDataList.push(inflatedData)}var reader=new SyncReader(buffer);var parser=new Parser(options,{read:reader.read.bind(reader),error:handleError,metadata:handleMetaData,gamma:handleGamma,palette:handlePalette,transColor:handleTransColor,inflateData:handleInflateData});parser.start();reader.process();if(err){throw err}var inflateData=Buffer.concat(inflateDataList);inflateDataList.length=0;var inflatedData=zlib.inflateSync(inflateData);inflateData=null;if(!inflatedData||!inflatedData.length){throw new Error("bad png - invalid inflate data response")}var unfilteredData=FilterSync.process(inflatedData,metaData);inflateData=null;var bitmapData=bitmapper.dataToBitMap(unfilteredData,metaData);unfilteredData=null;var normalisedBitmapData=formatNormaliser(bitmapData,metaData);metaData.data=normalisedBitmapData;metaData.gamma=gamma||0;return metaData}}).call(this,require("buffer").Buffer)},{"./bitmapper":466,"./filter-parse-sync":473,"./format-normaliser":475,"./parser":483,"./sync-reader":486,buffer:13,zlib:11}],483:[function(require,module,exports){(function(Buffer){"use strict";var constants=require("./constants");var CrcCalculator=require("./crc");var Parser=module.exports=function(options,dependencies){this._options=options;options.checkCRC=options.checkCRC!==false;this._hasIHDR=false;this._hasIEND=false;this._palette=[];this._colorType=0;this._chunks={};this._chunks[constants.TYPE_IHDR]=this._handleIHDR.bind(this);this._chunks[constants.TYPE_IEND]=this._handleIEND.bind(this);this._chunks[constants.TYPE_IDAT]=this._handleIDAT.bind(this);this._chunks[constants.TYPE_PLTE]=this._handlePLTE.bind(this);this._chunks[constants.TYPE_tRNS]=this._handleTRNS.bind(this);this._chunks[constants.TYPE_gAMA]=this._handleGAMA.bind(this);this.read=dependencies.read;this.error=dependencies.error;this.metadata=dependencies.metadata;this.gamma=dependencies.gamma;this.transColor=dependencies.transColor;this.palette=dependencies.palette;this.parsed=dependencies.parsed;this.inflateData=dependencies.inflateData;this.inflateData=dependencies.inflateData;this.finished=dependencies.finished};Parser.prototype.start=function(){this.read(constants.PNG_SIGNATURE.length,this._parseSignature.bind(this))};Parser.prototype._parseSignature=function(data){var signature=constants.PNG_SIGNATURE;for(var i=0;i<signature.length;i++){if(data[i]!==signature[i]){this.error(new Error("Invalid file signature"));return}}this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._parseChunkBegin=function(data){var length=data.readUInt32BE(0);var type=data.readUInt32BE(4);var name="";for(var i=4;i<8;i++){name+=String.fromCharCode(data[i])}var ancillary=Boolean(data[4]&32);if(!this._hasIHDR&&type!==constants.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}this._crc=new CrcCalculator;this._crc.write(new Buffer(name));if(this._chunks[type]){return this._chunks[type](length)}if(!ancillary){this.error(new Error("Unsupported critical chunk type "+name));return}this.read(length+4,this._skipChunk.bind(this))};Parser.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))};Parser.prototype._parseChunkEnd=function(data){var fileCrc=data.readInt32BE(0);var calcCrc=this._crc.crc32();if(this._options.checkCRC&&calcCrc!==fileCrc){this.error(new Error("Crc error - "+fileCrc+" - "+calcCrc));return}if(!this._hasIEND){this.read(8,this._parseChunkBegin.bind(this))}};Parser.prototype._handleIHDR=function(length){this.read(length,this._parseIHDR.bind(this))};Parser.prototype._parseIHDR=function(data){this._crc.write(data);var width=data.readUInt32BE(0);var height=data.readUInt32BE(4);var depth=data[8];var colorType=data[9];var compr=data[10];var filter=data[11];var interlace=data[12];if(depth!==8&&depth!==4&&depth!==2&&depth!==1&&depth!==16){this.error(new Error("Unsupported bit depth "+depth));return}if(!(colorType in constants.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(compr!==0){this.error(new Error("Unsupported compression method"));return}if(filter!==0){this.error(new Error("Unsupported filter method"));return}if(interlace!==0&&interlace!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=colorType;var bpp=constants.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=true;this.metadata({width:width,height:height,depth:depth,interlace:Boolean(interlace),palette:Boolean(colorType&constants.COLORTYPE_PALETTE),color:Boolean(colorType&constants.COLORTYPE_COLOR),alpha:Boolean(colorType&constants.COLORTYPE_ALPHA),bpp:bpp,colorType:colorType});this._handleChunkEnd()};Parser.prototype._handlePLTE=function(length){this.read(length,this._parsePLTE.bind(this))};Parser.prototype._parsePLTE=function(data){this._crc.write(data);var entries=Math.floor(data.length/3);for(var i=0;i<entries;i++){this._palette.push([data[i*3],data[i*3+1],data[i*3+2],255])}this.palette(this._palette);this._handleChunkEnd()};Parser.prototype._handleTRNS=function(length){this.read(length,this._parseTRNS.bind(this))};Parser.prototype._parseTRNS=function(data){this._crc.write(data);if(this._colorType===constants.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(data.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(var i=0;i<data.length;i++){this._palette[i][3]=data[i]}this.palette(this._palette)}if(this._colorType===constants.COLORTYPE_GRAYSCALE){this.transColor([data.readUInt16BE(0)])}if(this._colorType===constants.COLORTYPE_COLOR){this.transColor([data.readUInt16BE(0),data.readUInt16BE(2),data.readUInt16BE(4)])}this._handleChunkEnd()};Parser.prototype._handleGAMA=function(length){this.read(length,this._parseGAMA.bind(this))};Parser.prototype._parseGAMA=function(data){this._crc.write(data);this.gamma(data.readUInt32BE(0)/constants.GAMMA_DIVISION);this._handleChunkEnd()};Parser.prototype._handleIDAT=function(length){this.read(-length,this._parseIDAT.bind(this,length))};Parser.prototype._parseIDAT=function(length,data){this._crc.write(data);if(this._colorType===constants.COLORTYPE_PALETTE_COLOR&&this._palette.length===0){throw new Error("Expected palette not found")}this.inflateData(data);var leftOverLength=length-data.length;if(leftOverLength>0){this._handleIDAT(leftOverLength)}else{this._handleChunkEnd()}};Parser.prototype._handleIEND=function(length){this.read(length,this._parseIEND.bind(this))};Parser.prototype._parseIEND=function(data){this._crc.write(data);this._hasIEND=true;this._handleChunkEnd();if(this.finished){this.finished()}}}).call(this,require("buffer").Buffer)},{"./constants":469,"./crc":470,buffer:13}],484:[function(require,module,exports){"use strict";var parse=require("./parser-sync");var pack=require("./packer-sync");exports.read=function(buffer,options){return parse(buffer,options||{})};exports.write=function(png){return pack(png)}},{"./packer-sync":478,"./parser-sync":482}],485:[function(require,module,exports){(function(process,Buffer){"use strict";var util=require("util");
var Stream=require("stream");var Parser=require("./parser-async");var Packer=require("./packer-async");var PNGSync=require("./png-sync");var PNG=exports.PNG=function(options){Stream.call(this);options=options||{};this.width=options.width||0;this.height=options.height||0;this.data=this.width>0&&this.height>0?new Buffer(4*this.width*this.height):null;if(options.fill&&this.data){this.data.fill(0)}this.gamma=0;this.readable=this.writable=true;this._parser=new Parser(options);this._parser.on("error",this.emit.bind(this,"error"));this._parser.on("close",this._handleClose.bind(this));this._parser.on("metadata",this._metadata.bind(this));this._parser.on("gamma",this._gamma.bind(this));this._parser.on("parsed",function(data){this.data=data;this.emit("parsed",data)}.bind(this));this._packer=new Packer(options);this._packer.on("data",this.emit.bind(this,"data"));this._packer.on("end",this.emit.bind(this,"end"));this._parser.on("close",this._handleClose.bind(this));this._packer.on("error",this.emit.bind(this,"error"))};util.inherits(PNG,Stream);PNG.sync=PNGSync;PNG.prototype.pack=function(){if(!this.data||!this.data.length){this.emit("error","No data provided");return this}process.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this));return this};PNG.prototype.parse=function(data,callback){if(callback){var onParsed,onError;onParsed=function(parsedData){this.removeListener("error",onError);this.data=parsedData;callback(null,this)}.bind(this);onError=function(err){this.removeListener("parsed",onParsed);callback(err,null)}.bind(this);this.once("parsed",onParsed);this.once("error",onError)}this.end(data);return this};PNG.prototype.write=function(data){this._parser.write(data);return true};PNG.prototype.end=function(data){this._parser.end(data)};PNG.prototype._metadata=function(metadata){this.width=metadata.width;this.height=metadata.height;this.emit("metadata",metadata)};PNG.prototype._gamma=function(gamma){this.gamma=gamma};PNG.prototype._handleClose=function(){if(!this._parser.writable&&!this._packer.readable){this.emit("close")}};PNG.bitblt=function(src,dst,srcX,srcY,width,height,deltaX,deltaY){if(srcX>src.width||srcY>src.height||srcX+width>src.width||srcY+height>src.height){throw new Error("bitblt reading outside image")}if(deltaX>dst.width||deltaY>dst.height||deltaX+width>dst.width||deltaY+height>dst.height){throw new Error("bitblt writing outside image")}for(var y=0;y<height;y++){src.data.copy(dst.data,(deltaY+y)*dst.width+deltaX<<2,(srcY+y)*src.width+srcX<<2,(srcY+y)*src.width+srcX+width<<2)}};PNG.prototype.bitblt=function(dst,srcX,srcY,width,height,deltaX,deltaY){PNG.bitblt(this,dst,srcX,srcY,width,height,deltaX,deltaY);return this};PNG.adjustGamma=function(src){if(src.gamma){for(var y=0;y<src.height;y++){for(var x=0;x<src.width;x++){var idx=src.width*y+x<<2;for(var i=0;i<3;i++){var sample=src.data[idx+i]/255;sample=Math.pow(sample,1/2.2/src.gamma);src.data[idx+i]=Math.round(sample*255)}}}src.gamma=0}};PNG.prototype.adjustGamma=function(){PNG.adjustGamma(this)}}).call(this,require("_process"),require("buffer").Buffer)},{"./packer-async":477,"./parser-async":481,"./png-sync":484,_process:488,buffer:13,stream:504,util:511}],486:[function(require,module,exports){"use strict";var SyncReader=module.exports=function(buffer){this._buffer=buffer;this._reads=[]};SyncReader.prototype.read=function(length,callback){this._reads.push({length:Math.abs(length),allowLess:length<0,func:callback})};SyncReader.prototype.process=function(){while(this._reads.length>0&&this._buffer.length){var read=this._reads[0];if(this._buffer.length&&(this._buffer.length>=read.length||read.allowLess)){this._reads.shift();var buf=this._buffer;this._buffer=buf.slice(read.length);read.func.call(this,buf.slice(0,read.length))}else{break}}if(this._reads.length>0){return new Error("There are some read requests waitng on finished stream")}if(this._buffer.length>0){return new Error("unrecognised content at end of stream")}}},{}],487:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:488}],488:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],489:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":490}],490:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":492,"./_stream_writable":494,"core-util-is":316,inherits:358,"process-nextick-args":487}],491:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":493,"core-util-is":316,inherits:358}],492:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events");var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=undefined;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var StringDecoder;util.inherits(Readable,Stream);var Duplex;function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}var Duplex;function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else{return state.length}}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){if(state.pipesCount===1&&state.pipes[0]===dest&&src.listenerCount("data")===1&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var _i=0;_i<len;_i++){dests[_i].emit("unpipe",this)}return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&!this._readableState.endEmitted){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else if(list.length===1)ret=list[0];else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":490,_process:488,buffer:13,"core-util-is":316,events:322,inherits:358,isarray:361,"process-nextick-args":487,"string_decoder/":505,util:9}],493:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":490,"core-util-is":316,inherits:358}],494:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}var Duplex;function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this);this.corkedRequestsFree.next=new CorkedRequest(this)}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var Duplex;function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);
state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;state.corkedRequestsFree=holder.next;holder.next=null}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":490,_process:488,buffer:13,"core-util-is":316,events:322,inherits:358,"process-nextick-args":487,"util-deprecate":508}],495:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":491}],496:[function(require,module,exports){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":490,"./lib/_stream_passthrough.js":491,"./lib/_stream_readable.js":492,"./lib/_stream_transform.js":493,"./lib/_stream_writable.js":494}],497:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":493}],498:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":494}],499:[function(require,module,exports){(function(process,global){!function(global){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var undefined;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";var inModule=typeof module==="object";var runtime=global.regeneratorRuntime;if(runtime){if(inModule){module.exports=runtime}return}runtime=global.regeneratorRuntime=inModule?module.exports:{};function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in genFun)){genFun[toStringTagSymbol]="GeneratorFunction"}}genFun.prototype=Object.create(Gp);return genFun};runtime.awrap=function(arg){return new AwaitArgument(arg)};function AwaitArgument(arg){this.arg=arg}function AsyncIterator(generator){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value instanceof AwaitArgument){return Promise.resolve(value.arg).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)})}return Promise.resolve(value).then(function(unwrapped){result.value=unwrapped;resolve(result)},reject)}}if(typeof process==="object"&&process.domain){invoke=process.domain.bind(invoke)}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}while(true){var delegate=context.delegate;if(delegate){if(method==="return"||method==="throw"&&delegate.iterator[method]===undefined){context.delegate=null;var returnMethod=delegate.iterator["return"];if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if(record.type==="throw"){method="throw";arg=record.arg;continue}}if(method==="return"){continue}}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if(record.type==="throw"){context.delegate=null;method="throw";arg=record.arg;continue}method="next";arg=undefined;var info=record.arg;if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc}else{state=GenStateSuspendedYield;return info}context.delegate=null}if(method==="next"){context.sent=context._sent=arg}else if(method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw arg}if(context.dispatchException(arg)){method="next";arg=undefined}}else if(method==="return"){context.abrupt("return",arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg===ContinueSentinel){if(context.delegate&&method==="next"){arg=undefined}}else{return info}}else if(record.type==="throw"){state=GenStateCompleted;method="throw";arg=record.arg}}}}defineIteratorMethods(Gp);Gp[iteratorSymbol]=function(){return this};Gp[toStringTagSymbol]="Generator";Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.next=finallyEntry.finallyLoc}else{this.complete(record)}return ContinueSentinel},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=record.arg;this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};return ContinueSentinel}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:488}],500:[function(require,module,exports){var encode=require("./lib/encoder"),decode=require("./lib/decoder");module.exports={encode:encode,decode:decode}},{"./lib/decoder":501,"./lib/encoder":502}],501:[function(require,module,exports){(function(Buffer){var JpegImage=function jpegImage(){"use strict";var dctZigZag=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);var dctCos1=4017;var dctSin1=799;var dctCos3=3406;var dctSin3=2276;var dctCos6=1567;var dctSin6=3784;var dctSqrt2=5793;var dctSqrt1d2=2896;function constructor(){}function buildHuffmanTable(codeLengths,values){var k=0,code=[],i,j,length=16;while(length>0&&!codeLengths[length-1])length--;code.push({children:[],index:0});var p=code[0],q;for(i=0;i<length;i++){for(j=0;j<codeLengths[i];j++){p=code.pop();p.children[p.index]=values[k];while(p.index>0){p=code.pop()}p.index++;code.push(p);while(code.length<=i){code.push(q={children:[],index:0});p.children[p.index]=q.children;p=q}k++}if(i+1<length){code.push(q={children:[],index:0});p.children[p.index]=q.children;p=q}}return code[0].children}function decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successivePrev,successive){var precision=frame.precision;var samplesPerLine=frame.samplesPerLine;var scanLines=frame.scanLines;var mcusPerLine=frame.mcusPerLine;var progressive=frame.progressive;var maxH=frame.maxH,maxV=frame.maxV;var startOffset=offset,bitsData=0,bitsCount=0;function readBit(){if(bitsCount>0){bitsCount--;return bitsData>>bitsCount&1}bitsData=data[offset++];if(bitsData==255){var nextByte=data[offset++];if(nextByte){throw"unexpected marker: "+(bitsData<<8|nextByte).toString(16)}}bitsCount=7;return bitsData>>>7}function decodeHuffman(tree){var node=tree,bit;while((bit=readBit())!==null){node=node[bit];if(typeof node==="number")return node;if(typeof node!=="object")throw"invalid huffman sequence"}return null}function receive(length){var n=0;while(length>0){var bit=readBit();if(bit===null)return;n=n<<1|bit;length--}return n}function receiveAndExtend(length){var n=receive(length);if(n>=1<<length-1)return n;return n+(-1<<length)+1}function decodeBaseline(component,zz){var t=decodeHuffman(component.huffmanTableDC);var diff=t===0?0:receiveAndExtend(t);zz[0]=component.pred+=diff;var k=1;while(k<64){var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15)break;k+=16;continue}k+=r;var z=dctZigZag[k];zz[z]=receiveAndExtend(s);k++}}function decodeDCFirst(component,zz){var t=decodeHuffman(component.huffmanTableDC);var diff=t===0?0:receiveAndExtend(t)<<successive;zz[0]=component.pred+=diff}function decodeDCSuccessive(component,zz){zz[0]|=readBit()<<successive}var eobrun=0;function decodeACFirst(component,zz){if(eobrun>0){eobrun--;return}var k=spectralStart,e=spectralEnd;while(k<=e){var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15){eobrun=receive(r)+(1<<r)-1;break}k+=16;continue}k+=r;var z=dctZigZag[k];zz[z]=receiveAndExtend(s)*(1<<successive);k++}}var successiveACState=0,successiveACNextValue;function decodeACSuccessive(component,zz){var k=spectralStart,e=spectralEnd,r=0;while(k<=e){var z=dctZigZag[k];switch(successiveACState){case 0:var rs=decodeHuffman(component.huffmanTableAC);var s=rs&15,r=rs>>4;if(s===0){if(r<15){eobrun=receive(r)+(1<<r);successiveACState=4}else{r=16;successiveACState=1}}else{if(s!==1)throw"invalid ACn encoding";successiveACNextValue=receiveAndExtend(s);successiveACState=r?2:3}continue;case 1:case 2:if(zz[z])zz[z]+=readBit()<<successive;else{r--;if(r===0)successiveACState=successiveACState==2?3:0}break;case 3:if(zz[z])zz[z]+=readBit()<<successive;else{zz[z]=successiveACNextValue<<successive;successiveACState=0}break;case 4:if(zz[z])zz[z]+=readBit()<<successive;break}k++}if(successiveACState===4){eobrun--;if(eobrun===0)successiveACState=0}}function decodeMcu(component,decode,mcu,row,col){var mcuRow=mcu/mcusPerLine|0;var mcuCol=mcu%mcusPerLine;var blockRow=mcuRow*component.v+row;var blockCol=mcuCol*component.h+col;decode(component,component.blocks[blockRow][blockCol])}function decodeBlock(component,decode,mcu){var blockRow=mcu/component.blocksPerLine|0;var blockCol=mcu%component.blocksPerLine;decode(component,component.blocks[blockRow][blockCol])}var componentsLength=components.length;var component,i,j,k,n;var decodeFn;if(progressive){if(spectralStart===0)decodeFn=successivePrev===0?decodeDCFirst:decodeDCSuccessive;else decodeFn=successivePrev===0?decodeACFirst:decodeACSuccessive}else{decodeFn=decodeBaseline}var mcu=0,marker;var mcuExpected;if(componentsLength==1){mcuExpected=components[0].blocksPerLine*components[0].blocksPerColumn}else{mcuExpected=mcusPerLine*frame.mcusPerColumn}if(!resetInterval)resetInterval=mcuExpected;var h,v;while(mcu<mcuExpected){for(i=0;i<componentsLength;i++)components[i].pred=0;eobrun=0;if(componentsLength==1){component=components[0];for(n=0;n<resetInterval;n++){decodeBlock(component,decodeFn,mcu);mcu++}}else{for(n=0;n<resetInterval;n++){for(i=0;i<componentsLength;i++){component=components[i];h=component.h;v=component.v;for(j=0;j<v;j++){for(k=0;k<h;k++){decodeMcu(component,decodeFn,mcu,j,k)}}}mcu++;if(mcu===mcuExpected)break}}bitsCount=0;marker=data[offset]<<8|data[offset+1];if(marker<65280){throw"marker was not found"}if(marker>=65488&&marker<=65495){offset+=2}else break}return offset-startOffset}function buildComponentData(frame,component){var lines=[];var blocksPerLine=component.blocksPerLine;var blocksPerColumn=component.blocksPerColumn;var samplesPerLine=blocksPerLine<<3;var R=new Int32Array(64),r=new Uint8Array(64);function quantizeAndInverse(zz,dataOut,dataIn){var qt=component.quantizationTable;var v0,v1,v2,v3,v4,v5,v6,v7,t;var p=dataIn;var i;for(i=0;i<64;i++)p[i]=zz[i]*qt[i];for(i=0;i<8;++i){var row=8*i;if(p[1+row]==0&&p[2+row]==0&&p[3+row]==0&&p[4+row]==0&&p[5+row]==0&&p[6+row]==0&&p[7+row]==0){t=dctSqrt2*p[0+row]+512>>10;p[0+row]=t;p[1+row]=t;p[2+row]=t;p[3+row]=t;p[4+row]=t;p[5+row]=t;p[6+row]=t;p[7+row]=t;continue}v0=dctSqrt2*p[0+row]+128>>8;v1=dctSqrt2*p[4+row]+128>>8;v2=p[2+row];v3=p[6+row];v4=dctSqrt1d2*(p[1+row]-p[7+row])+128>>8;v7=dctSqrt1d2*(p[1+row]+p[7+row])+128>>8;v5=p[3+row]<<4;v6=p[5+row]<<4;t=v0-v1+1>>1;v0=v0+v1+1>>1;v1=t;t=v2*dctSin6+v3*dctCos6+128>>8;v2=v2*dctCos6-v3*dctSin6+128>>8;v3=t;t=v4-v6+1>>1;v4=v4+v6+1>>1;v6=t;t=v7+v5+1>>1;v5=v7-v5+1>>1;v7=t;t=v0-v3+1>>1;v0=v0+v3+1>>1;v3=t;t=v1-v2+1>>1;v1=v1+v2+1>>1;v2=t;t=v4*dctSin3+v7*dctCos3+2048>>12;v4=v4*dctCos3-v7*dctSin3+2048>>12;v7=t;t=v5*dctSin1+v6*dctCos1+2048>>12;v5=v5*dctCos1-v6*dctSin1+2048>>12;v6=t;p[0+row]=v0+v7;p[7+row]=v0-v7;p[1+row]=v1+v6;p[6+row]=v1-v6;p[2+row]=v2+v5;p[5+row]=v2-v5;p[3+row]=v3+v4;p[4+row]=v3-v4}for(i=0;i<8;++i){var col=i;if(p[1*8+col]==0&&p[2*8+col]==0&&p[3*8+col]==0&&p[4*8+col]==0&&p[5*8+col]==0&&p[6*8+col]==0&&p[7*8+col]==0){t=dctSqrt2*dataIn[i+0]+8192>>14;p[0*8+col]=t;p[1*8+col]=t;p[2*8+col]=t;p[3*8+col]=t;p[4*8+col]=t;p[5*8+col]=t;p[6*8+col]=t;p[7*8+col]=t;continue}v0=dctSqrt2*p[0*8+col]+2048>>12;v1=dctSqrt2*p[4*8+col]+2048>>12;v2=p[2*8+col];v3=p[6*8+col];v4=dctSqrt1d2*(p[1*8+col]-p[7*8+col])+2048>>12;v7=dctSqrt1d2*(p[1*8+col]+p[7*8+col])+2048>>12;v5=p[3*8+col];v6=p[5*8+col];t=v0-v1+1>>1;v0=v0+v1+1>>1;v1=t;t=v2*dctSin6+v3*dctCos6+2048>>12;v2=v2*dctCos6-v3*dctSin6+2048>>12;v3=t;t=v4-v6+1>>1;v4=v4+v6+1>>1;v6=t;t=v7+v5+1>>1;v5=v7-v5+1>>1;v7=t;t=v0-v3+1>>1;v0=v0+v3+1>>1;v3=t;t=v1-v2+1>>1;v1=v1+v2+1>>1;v2=t;t=v4*dctSin3+v7*dctCos3+2048>>12;v4=v4*dctCos3-v7*dctSin3+2048>>12;v7=t;t=v5*dctSin1+v6*dctCos1+2048>>12;v5=v5*dctCos1-v6*dctSin1+2048>>12;v6=t;p[0*8+col]=v0+v7;p[7*8+col]=v0-v7;p[1*8+col]=v1+v6;p[6*8+col]=v1-v6;p[2*8+col]=v2+v5;p[5*8+col]=v2-v5;p[3*8+col]=v3+v4;p[4*8+col]=v3-v4}for(i=0;i<64;++i){var sample=128+(p[i]+8>>4);dataOut[i]=sample<0?0:sample>255?255:sample}}var i,j;for(var blockRow=0;blockRow<blocksPerColumn;blockRow++){var scanLine=blockRow<<3;for(i=0;i<8;i++)lines.push(new Uint8Array(samplesPerLine));for(var blockCol=0;blockCol<blocksPerLine;blockCol++){quantizeAndInverse(component.blocks[blockRow][blockCol],r,R);var offset=0,sample=blockCol<<3;for(j=0;j<8;j++){var line=lines[scanLine+j];for(i=0;i<8;i++)line[sample+i]=r[offset++]}}}return lines}function clampTo8bit(a){return a<0?0:a>255?255:a}constructor.prototype={load:function load(path){var xhr=new XMLHttpRequest;xhr.open("GET",path,true);xhr.responseType="arraybuffer";xhr.onload=function(){var data=new Uint8Array(xhr.response||xhr.mozResponseArrayBuffer);this.parse(data);if(this.onload)this.onload()}.bind(this);xhr.send(null)},parse:function parse(data){var offset=0,length=data.length;function readUint16(){var value=data[offset]<<8|data[offset+1];offset+=2;return value}function readDataBlock(){var length=readUint16();var array=data.subarray(offset,offset+length-2);offset+=array.length;return array}function prepareComponents(frame){var maxH=0,maxV=0;var component,componentId;for(componentId in frame.components){if(frame.components.hasOwnProperty(componentId)){component=frame.components[componentId];if(maxH<component.h)maxH=component.h;if(maxV<component.v)maxV=component.v}}var mcusPerLine=Math.ceil(frame.samplesPerLine/8/maxH);var mcusPerColumn=Math.ceil(frame.scanLines/8/maxV);for(componentId in frame.components){if(frame.components.hasOwnProperty(componentId)){component=frame.components[componentId];var blocksPerLine=Math.ceil(Math.ceil(frame.samplesPerLine/8)*component.h/maxH);var blocksPerColumn=Math.ceil(Math.ceil(frame.scanLines/8)*component.v/maxV);var blocksPerLineForMcu=mcusPerLine*component.h;var blocksPerColumnForMcu=mcusPerColumn*component.v;var blocks=[];for(var i=0;i<blocksPerColumnForMcu;i++){var row=[];for(var j=0;j<blocksPerLineForMcu;j++)row.push(new Int32Array(64));blocks.push(row)}component.blocksPerLine=blocksPerLine;component.blocksPerColumn=blocksPerColumn;component.blocks=blocks}}frame.maxH=maxH;frame.maxV=maxV;frame.mcusPerLine=mcusPerLine;frame.mcusPerColumn=mcusPerColumn}var jfif=null;var adobe=null;var pixels=null;var frame,resetInterval;var quantizationTables=[],frames=[];var huffmanTablesAC=[],huffmanTablesDC=[];var fileMarker=readUint16();if(fileMarker!=65496){throw"SOI not found"}fileMarker=readUint16();while(fileMarker!=65497){var i,j,l;switch(fileMarker){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var appData=readDataBlock();if(fileMarker===65504){if(appData[0]===74&&appData[1]===70&&appData[2]===73&&appData[3]===70&&appData[4]===0){jfif={version:{major:appData[5],minor:appData[6]},densityUnits:appData[7],xDensity:appData[8]<<8|appData[9],yDensity:appData[10]<<8|appData[11],thumbWidth:appData[12],thumbHeight:appData[13],thumbData:appData.subarray(14,14+3*appData[12]*appData[13])}}}if(fileMarker===65518){if(appData[0]===65&&appData[1]===100&&appData[2]===111&&appData[3]===98&&appData[4]===101&&appData[5]===0){adobe={version:appData[6],flags0:appData[7]<<8|appData[8],flags1:appData[9]<<8|appData[10],transformCode:appData[11]}}}break;case 65499:var quantizationTablesLength=readUint16();var quantizationTablesEnd=quantizationTablesLength+offset-2;while(offset<quantizationTablesEnd){var quantizationTableSpec=data[offset++];var tableData=new Int32Array(64);if(quantizationTableSpec>>4===0){for(j=0;j<64;j++){var z=dctZigZag[j];tableData[z]=data[offset++]}}else if(quantizationTableSpec>>4===1){for(j=0;j<64;j++){var z=dctZigZag[j];tableData[z]=readUint16()}}else throw"DQT: invalid table spec";quantizationTables[quantizationTableSpec&15]=tableData}break;case 65472:case 65473:case 65474:readUint16();frame={};frame.extended=fileMarker===65473;frame.progressive=fileMarker===65474;frame.precision=data[offset++];frame.scanLines=readUint16();frame.samplesPerLine=readUint16();frame.components={};frame.componentsOrder=[];var componentsCount=data[offset++],componentId;var maxH=0,maxV=0;for(i=0;i<componentsCount;i++){componentId=data[offset];var h=data[offset+1]>>4;var v=data[offset+1]&15;var qId=data[offset+2];frame.componentsOrder.push(componentId);frame.components[componentId]={h:h,v:v,quantizationTable:quantizationTables[qId]};offset+=3}prepareComponents(frame);frames.push(frame);break;case 65476:var huffmanLength=readUint16();for(i=2;i<huffmanLength;){var huffmanTableSpec=data[offset++];var codeLengths=new Uint8Array(16);var codeLengthSum=0;for(j=0;j<16;j++,offset++)codeLengthSum+=codeLengths[j]=data[offset];var huffmanValues=new Uint8Array(codeLengthSum);for(j=0;j<codeLengthSum;j++,offset++)huffmanValues[j]=data[offset];i+=17+codeLengthSum;(huffmanTableSpec>>4===0?huffmanTablesDC:huffmanTablesAC)[huffmanTableSpec&15]=buildHuffmanTable(codeLengths,huffmanValues)}break;case 65501:readUint16();resetInterval=readUint16();break;case 65498:var scanLength=readUint16();var selectorsCount=data[offset++];var components=[],component;for(i=0;i<selectorsCount;i++){component=frame.components[data[offset++]];var tableSpec=data[offset++];component.huffmanTableDC=huffmanTablesDC[tableSpec>>4];component.huffmanTableAC=huffmanTablesAC[tableSpec&15];components.push(component)}var spectralStart=data[offset++];var spectralEnd=data[offset++];var successiveApproximation=data[offset++];var processed=decodeScan(data,offset,frame,components,resetInterval,spectralStart,spectralEnd,successiveApproximation>>4,successiveApproximation&15);offset+=processed;break;default:if(data[offset-3]==255&&data[offset-2]>=192&&data[offset-2]<=254){offset-=3;break}throw"unknown JPEG marker "+fileMarker.toString(16)}fileMarker=readUint16()}if(frames.length!=1)throw"only single frame JPEGs supported";this.width=frame.samplesPerLine;this.height=frame.scanLines;this.jfif=jfif;this.adobe=adobe;this.components=[];for(var i=0;i<frame.componentsOrder.length;i++){var component=frame.components[frame.componentsOrder[i]];this.components.push({lines:buildComponentData(frame,component),scaleX:component.h/frame.maxH,scaleY:component.v/frame.maxV})}},getData:function getData(width,height){var scaleX=this.width/width,scaleY=this.height/height;var component1,component2,component3,component4;var component1Line,component2Line,component3Line,component4Line;var x,y;var offset=0;var Y,Cb,Cr,K,C,M,Ye,R,G,B;var colorTransform;var dataLength=width*height*this.components.length;var data=new Uint8Array(dataLength);switch(this.components.length){case 1:component1=this.components[0];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];for(x=0;x<width;x++){Y=component1Line[0|x*component1.scaleX*scaleX];data[offset++]=Y}}break;case 2:component1=this.components[0];component2=this.components[1];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];for(x=0;x<width;x++){Y=component1Line[0|x*component1.scaleX*scaleX];data[offset++]=Y;Y=component2Line[0|x*component2.scaleX*scaleX];data[offset++]=Y}}break;case 3:colorTransform=true;if(this.adobe&&this.adobe.transformCode)colorTransform=true;else if(typeof this.colorTransform!=="undefined")colorTransform=!!this.colorTransform;component1=this.components[0];component2=this.components[1];component3=this.components[2];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];component3Line=component3.lines[0|y*component3.scaleY*scaleY];for(x=0;x<width;x++){if(!colorTransform){R=component1Line[0|x*component1.scaleX*scaleX];G=component2Line[0|x*component2.scaleX*scaleX];B=component3Line[0|x*component3.scaleX*scaleX]}else{Y=component1Line[0|x*component1.scaleX*scaleX];Cb=component2Line[0|x*component2.scaleX*scaleX];Cr=component3Line[0|x*component3.scaleX*scaleX];R=clampTo8bit(Y+1.402*(Cr-128));G=clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128));B=clampTo8bit(Y+1.772*(Cb-128))}data[offset++]=R;data[offset++]=G;data[offset++]=B}}break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";colorTransform=false;if(this.adobe&&this.adobe.transformCode)colorTransform=true;else if(typeof this.colorTransform!=="undefined")colorTransform=!!this.colorTransform;component1=this.components[0];component2=this.components[1];component3=this.components[2];component4=this.components[3];for(y=0;y<height;y++){component1Line=component1.lines[0|y*component1.scaleY*scaleY];component2Line=component2.lines[0|y*component2.scaleY*scaleY];component3Line=component3.lines[0|y*component3.scaleY*scaleY];component4Line=component4.lines[0|y*component4.scaleY*scaleY];for(x=0;x<width;x++){if(!colorTransform){C=component1Line[0|x*component1.scaleX*scaleX];M=component2Line[0|x*component2.scaleX*scaleX];Ye=component3Line[0|x*component3.scaleX*scaleX];K=component4Line[0|x*component4.scaleX*scaleX]}else{Y=component1Line[0|x*component1.scaleX*scaleX];Cb=component2Line[0|x*component2.scaleX*scaleX];Cr=component3Line[0|x*component3.scaleX*scaleX];K=component4Line[0|x*component4.scaleX*scaleX];C=255-clampTo8bit(Y+1.402*(Cr-128));M=255-clampTo8bit(Y-.3441363*(Cb-128)-.71413636*(Cr-128));Ye=255-clampTo8bit(Y+1.772*(Cb-128))}data[offset++]=C;data[offset++]=M;data[offset++]=Ye;data[offset++]=K}}break;default:throw"Unsupported color mode"}return data},copyToImageData:function copyToImageData(imageData){var width=imageData.width,height=imageData.height;var imageDataArray=imageData.data;var data=this.getData(width,height);var i=0,j=0,x,y;var Y,K,C,M,R,G,B;switch(this.components.length){case 1:for(y=0;y<height;y++){for(x=0;x<width;x++){Y=data[i++];imageDataArray[j++]=Y;imageDataArray[j++]=Y;imageDataArray[j++]=Y;imageDataArray[j++]=255}}break;case 3:for(y=0;y<height;y++){for(x=0;x<width;x++){R=data[i++];G=data[i++];B=data[i++];imageDataArray[j++]=R;imageDataArray[j++]=G;imageDataArray[j++]=B;imageDataArray[j++]=255}}break;case 4:for(y=0;y<height;y++){for(x=0;x<width;x++){C=data[i++];M=data[i++];Y=data[i++];K=data[i++];R=255-clampTo8bit(C*(1-K/255)+K);G=255-clampTo8bit(M*(1-K/255)+K);B=255-clampTo8bit(Y*(1-K/255)+K);imageDataArray[j++]=R;imageDataArray[j++]=G;imageDataArray[j++]=B;imageDataArray[j++]=255}}break;default:throw"Unsupported color mode"}}};return constructor}();module.exports=decode;function decode(jpegData){var arr=new Uint8Array(jpegData);var decoder=new JpegImage;decoder.parse(arr);var data=decoder.getData(decoder.width,decoder.height);var buf=new Buffer(decoder.width*decoder.height*4);var n=0;for(var i=0;i<buf.length;i++){buf[i+(i/3|0)]=data[n++];if(i%4==3)buf[i]=255}return{data:buf,width:decoder.width,height:decoder.height}}}).call(this,require("buffer").Buffer)},{buffer:13}],502:[function(require,module,exports){(function(Buffer){var btoa=btoa||function(buf){return new Buffer(buf).toString("base64");
};function JPEGEncoder(quality){var self=this;var fround=Math.round;var ffloor=Math.floor;var YTable=new Array(64);var UVTable=new Array(64);var fdtbl_Y=new Array(64);var fdtbl_UV=new Array(64);var YDC_HT;var UVDC_HT;var YAC_HT;var UVAC_HT;var bitcode=new Array(65535);var category=new Array(65535);var outputfDCTQuant=new Array(64);var DU=new Array(64);var byteout=[];var bytenew=0;var bytepos=7;var YDU=new Array(64);var UDU=new Array(64);var VDU=new Array(64);var clt=new Array(256);var RGB_YUV_TABLE=new Array(2048);var currentQuality;var ZigZag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var std_dc_luminance_nrcodes=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var std_dc_luminance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_luminance_nrcodes=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var std_ac_luminance_values=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var std_dc_chrominance_nrcodes=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var std_dc_chrominance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_chrominance_nrcodes=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var std_ac_chrominance_values=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function initQuantTables(sf){var YQT=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var i=0;i<64;i++){var t=ffloor((YQT[i]*sf+50)/100);if(t<1){t=1}else if(t>255){t=255}YTable[ZigZag[i]]=t}var UVQT=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var j=0;j<64;j++){var u=ffloor((UVQT[j]*sf+50)/100);if(u<1){u=1}else if(u>255){u=255}UVTable[ZigZag[j]]=u}var aasf=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];var k=0;for(var row=0;row<8;row++){for(var col=0;col<8;col++){fdtbl_Y[k]=1/(YTable[ZigZag[k]]*aasf[row]*aasf[col]*8);fdtbl_UV[k]=1/(UVTable[ZigZag[k]]*aasf[row]*aasf[col]*8);k++}}}function computeHuffmanTbl(nrcodes,std_table){var codevalue=0;var pos_in_table=0;var HT=new Array;for(var k=1;k<=16;k++){for(var j=1;j<=nrcodes[k];j++){HT[std_table[pos_in_table]]=[];HT[std_table[pos_in_table]][0]=codevalue;HT[std_table[pos_in_table]][1]=k;pos_in_table++;codevalue++}codevalue*=2}return HT}function initHuffmanTbl(){YDC_HT=computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);UVDC_HT=computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);YAC_HT=computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);UVAC_HT=computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values)}function initCategoryNumber(){var nrlower=1;var nrupper=2;for(var cat=1;cat<=15;cat++){for(var nr=nrlower;nr<nrupper;nr++){category[32767+nr]=cat;bitcode[32767+nr]=[];bitcode[32767+nr][1]=cat;bitcode[32767+nr][0]=nr}for(var nrneg=-(nrupper-1);nrneg<=-nrlower;nrneg++){category[32767+nrneg]=cat;bitcode[32767+nrneg]=[];bitcode[32767+nrneg][1]=cat;bitcode[32767+nrneg][0]=nrupper-1+nrneg}nrlower<<=1;nrupper<<=1}}function initRGBYUVTable(){for(var i=0;i<256;i++){RGB_YUV_TABLE[i]=19595*i;RGB_YUV_TABLE[i+256>>0]=38470*i;RGB_YUV_TABLE[i+512>>0]=7471*i+32768;RGB_YUV_TABLE[i+768>>0]=-11059*i;RGB_YUV_TABLE[i+1024>>0]=-21709*i;RGB_YUV_TABLE[i+1280>>0]=32768*i+8421375;RGB_YUV_TABLE[i+1536>>0]=-27439*i;RGB_YUV_TABLE[i+1792>>0]=-5329*i}}function writeBits(bs){var value=bs[0];var posval=bs[1]-1;while(posval>=0){if(value&1<<posval){bytenew|=1<<bytepos}posval--;bytepos--;if(bytepos<0){if(bytenew==255){writeByte(255);writeByte(0)}else{writeByte(bytenew)}bytepos=7;bytenew=0}}}function writeByte(value){byteout.push(value)}function writeWord(value){writeByte(value>>8&255);writeByte(value&255)}function fDCTQuant(data,fdtbl){var d0,d1,d2,d3,d4,d5,d6,d7;var dataOff=0;var i;const I8=8;const I64=64;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+1];d2=data[dataOff+2];d3=data[dataOff+3];d4=data[dataOff+4];d5=data[dataOff+5];d6=data[dataOff+6];d7=data[dataOff+7];var tmp0=d0+d7;var tmp7=d0-d7;var tmp1=d1+d6;var tmp6=d1-d6;var tmp2=d2+d5;var tmp5=d2-d5;var tmp3=d3+d4;var tmp4=d3-d4;var tmp10=tmp0+tmp3;var tmp13=tmp0-tmp3;var tmp11=tmp1+tmp2;var tmp12=tmp1-tmp2;data[dataOff]=tmp10+tmp11;data[dataOff+4]=tmp10-tmp11;var z1=(tmp12+tmp13)*.707106781;data[dataOff+2]=tmp13+z1;data[dataOff+6]=tmp13-z1;tmp10=tmp4+tmp5;tmp11=tmp5+tmp6;tmp12=tmp6+tmp7;var z5=(tmp10-tmp12)*.382683433;var z2=.5411961*tmp10+z5;var z4=1.306562965*tmp12+z5;var z3=tmp11*.707106781;var z11=tmp7+z3;var z13=tmp7-z3;data[dataOff+5]=z13+z2;data[dataOff+3]=z13-z2;data[dataOff+1]=z11+z4;data[dataOff+7]=z11-z4;dataOff+=8}dataOff=0;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+8];d2=data[dataOff+16];d3=data[dataOff+24];d4=data[dataOff+32];d5=data[dataOff+40];d6=data[dataOff+48];d7=data[dataOff+56];var tmp0p2=d0+d7;var tmp7p2=d0-d7;var tmp1p2=d1+d6;var tmp6p2=d1-d6;var tmp2p2=d2+d5;var tmp5p2=d2-d5;var tmp3p2=d3+d4;var tmp4p2=d3-d4;var tmp10p2=tmp0p2+tmp3p2;var tmp13p2=tmp0p2-tmp3p2;var tmp11p2=tmp1p2+tmp2p2;var tmp12p2=tmp1p2-tmp2p2;data[dataOff]=tmp10p2+tmp11p2;data[dataOff+32]=tmp10p2-tmp11p2;var z1p2=(tmp12p2+tmp13p2)*.707106781;data[dataOff+16]=tmp13p2+z1p2;data[dataOff+48]=tmp13p2-z1p2;tmp10p2=tmp4p2+tmp5p2;tmp11p2=tmp5p2+tmp6p2;tmp12p2=tmp6p2+tmp7p2;var z5p2=(tmp10p2-tmp12p2)*.382683433;var z2p2=.5411961*tmp10p2+z5p2;var z4p2=1.306562965*tmp12p2+z5p2;var z3p2=tmp11p2*.707106781;var z11p2=tmp7p2+z3p2;var z13p2=tmp7p2-z3p2;data[dataOff+40]=z13p2+z2p2;data[dataOff+24]=z13p2-z2p2;data[dataOff+8]=z11p2+z4p2;data[dataOff+56]=z11p2-z4p2;dataOff++}var fDCTQuant;for(i=0;i<I64;++i){fDCTQuant=data[i]*fdtbl[i];outputfDCTQuant[i]=fDCTQuant>0?fDCTQuant+.5|0:fDCTQuant-.5|0}return outputfDCTQuant}function writeAPP0(){writeWord(65504);writeWord(16);writeByte(74);writeByte(70);writeByte(73);writeByte(70);writeByte(0);writeByte(1);writeByte(1);writeByte(0);writeWord(1);writeWord(1);writeByte(0);writeByte(0)}function writeSOF0(width,height){writeWord(65472);writeWord(17);writeByte(8);writeWord(height);writeWord(width);writeByte(3);writeByte(1);writeByte(17);writeByte(0);writeByte(2);writeByte(17);writeByte(1);writeByte(3);writeByte(17);writeByte(1)}function writeDQT(){writeWord(65499);writeWord(132);writeByte(0);for(var i=0;i<64;i++){writeByte(YTable[i])}writeByte(1);for(var j=0;j<64;j++){writeByte(UVTable[j])}}function writeDHT(){writeWord(65476);writeWord(418);writeByte(0);for(var i=0;i<16;i++){writeByte(std_dc_luminance_nrcodes[i+1])}for(var j=0;j<=11;j++){writeByte(std_dc_luminance_values[j])}writeByte(16);for(var k=0;k<16;k++){writeByte(std_ac_luminance_nrcodes[k+1])}for(var l=0;l<=161;l++){writeByte(std_ac_luminance_values[l])}writeByte(1);for(var m=0;m<16;m++){writeByte(std_dc_chrominance_nrcodes[m+1])}for(var n=0;n<=11;n++){writeByte(std_dc_chrominance_values[n])}writeByte(17);for(var o=0;o<16;o++){writeByte(std_ac_chrominance_nrcodes[o+1])}for(var p=0;p<=161;p++){writeByte(std_ac_chrominance_values[p])}}function writeSOS(){writeWord(65498);writeWord(12);writeByte(3);writeByte(1);writeByte(0);writeByte(2);writeByte(17);writeByte(3);writeByte(17);writeByte(0);writeByte(63);writeByte(0)}function processDU(CDU,fdtbl,DC,HTDC,HTAC){var EOB=HTAC[0];var M16zeroes=HTAC[240];var pos;const I16=16;const I63=63;const I64=64;var DU_DCT=fDCTQuant(CDU,fdtbl);for(var j=0;j<I64;++j){DU[ZigZag[j]]=DU_DCT[j]}var Diff=DU[0]-DC;DC=DU[0];if(Diff==0){writeBits(HTDC[0])}else{pos=32767+Diff;writeBits(HTDC[category[pos]]);writeBits(bitcode[pos])}var end0pos=63;for(;end0pos>0&&DU[end0pos]==0;end0pos--){}if(end0pos==0){writeBits(EOB);return DC}var i=1;var lng;while(i<=end0pos){var startpos=i;for(;DU[i]==0&&i<=end0pos;++i){}var nrzeroes=i-startpos;if(nrzeroes>=I16){lng=nrzeroes>>4;for(var nrmarker=1;nrmarker<=lng;++nrmarker)writeBits(M16zeroes);nrzeroes=nrzeroes&15}pos=32767+DU[i];writeBits(HTAC[(nrzeroes<<4)+category[pos]]);writeBits(bitcode[pos]);i++}if(end0pos!=I63){writeBits(EOB)}return DC}function initCharLookupTable(){var sfcc=String.fromCharCode;for(var i=0;i<256;i++){clt[i]=sfcc(i)}}this.encode=function(image,quality){var time_start=(new Date).getTime();if(quality)setQuality(quality);byteout=new Array;bytenew=0;bytepos=7;writeWord(65496);writeAPP0();writeDQT();writeSOF0(image.width,image.height);writeDHT();writeSOS();var DCY=0;var DCU=0;var DCV=0;bytenew=0;bytepos=7;this.encode.displayName="_encode_";var imageData=image.data;var width=image.width;var height=image.height;var quadWidth=width*4;var tripleWidth=width*3;var x,y=0;var r,g,b;var start,p,col,row,pos;while(y<height){x=0;while(x<quadWidth){start=quadWidth*y+x;p=start;col=-1;row=0;for(pos=0;pos<64;pos++){row=pos>>3;col=(pos&7)*4;p=start+row*quadWidth+col;if(y+row>=height){p-=quadWidth*(y+1+row-height)}if(x+col>=quadWidth){p-=x+col-quadWidth+4}r=imageData[p++];g=imageData[p++];b=imageData[p++];YDU[pos]=(RGB_YUV_TABLE[r]+RGB_YUV_TABLE[g+256>>0]+RGB_YUV_TABLE[b+512>>0]>>16)-128;UDU[pos]=(RGB_YUV_TABLE[r+768>>0]+RGB_YUV_TABLE[g+1024>>0]+RGB_YUV_TABLE[b+1280>>0]>>16)-128;VDU[pos]=(RGB_YUV_TABLE[r+1280>>0]+RGB_YUV_TABLE[g+1536>>0]+RGB_YUV_TABLE[b+1792>>0]>>16)-128}DCY=processDU(YDU,fdtbl_Y,DCY,YDC_HT,YAC_HT);DCU=processDU(UDU,fdtbl_UV,DCU,UVDC_HT,UVAC_HT);DCV=processDU(VDU,fdtbl_UV,DCV,UVDC_HT,UVAC_HT);x+=32}y+=8}if(bytepos>=0){var fillbits=[];fillbits[1]=bytepos+1;fillbits[0]=(1<<bytepos+1)-1;writeBits(fillbits)}writeWord(65497);return new Buffer(byteout);var jpegDataUri="data:image/jpeg;base64,"+btoa(byteout.join(""));byteout=[];var duration=(new Date).getTime()-time_start;return jpegDataUri};function setQuality(quality){if(quality<=0){quality=1}if(quality>100){quality=100}if(currentQuality==quality)return;var sf=0;if(quality<50){sf=Math.floor(5e3/quality)}else{sf=Math.floor(200-quality*2)}initQuantTables(sf);currentQuality=quality}function init(){var time_start=(new Date).getTime();if(!quality)quality=50;initCharLookupTable();initHuffmanTbl();initCategoryNumber();initRGBYUVTable();setQuality(quality);var duration=(new Date).getTime()-time_start}init()}module.exports=encode;function encode(imgData,qu){if(typeof qu==="undefined")qu=50;var encoder=new JPEGEncoder(qu);var data=encoder.encode(imgData,qu);return{data:data,width:imgData.width,height:imgData.height}}function getImageDataFromImage(idOrElement){var theImg=typeof idOrElement=="string"?document.getElementById(idOrElement):idOrElement;var cvs=document.createElement("canvas");cvs.width=theImg.width;cvs.height=theImg.height;var ctx=cvs.getContext("2d");ctx.drawImage(theImg,0,0);return ctx.getImageData(0,0,cvs.width,cvs.height)}}).call(this,require("buffer").Buffer)},{buffer:13}],503:[function(require,module,exports){(function(Buffer){"use strict";var ContentStream=require("contentstream");var GifEncoder=require("gif-encoder");var jpegJs=require("jpeg-js");var PNG=require("pngjs-nozlib").PNG;var ndarray=require("ndarray");var ops=require("ndarray-ops");var through=require("through");function handleData(array,data,frame){var i,j,ptr=0,c;if(array.shape.length===4){return handleData(array.pick(frame),data,0)}else if(array.shape.length===3){if(array.shape[2]===3){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),array);ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else if(array.shape[2]===4){ops.assign(ndarray(data,[array.shape[0],array.shape[1],4],[4,array.shape[0]*4,1]),array)}else if(array.shape[2]===1){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),ndarray(array.data,[array.shape[0],array.shape[1],3],[array.stride[0],array.stride[1],0],array.offset));ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else{return new Error("Incompatible array shape")}}else if(array.shape.length===2){ops.assign(ndarray(data,[array.shape[0],array.shape[1],3],[4,4*array.shape[0],1]),ndarray(array.data,[array.shape[0],array.shape[1],3],[array.stride[0],array.stride[1],0],array.offset));ops.assigns(ndarray(data,[array.shape[0]*array.shape[1]],[4],3),255)}else{return new Error("Incompatible array shape")}return data}function haderror(err){var result=through();result.emit("error",err);return result}module.exports=function savePixels(array,type,options){options=options||{};switch(type.toUpperCase()){case"JPG":case".JPG":case"JPEG":case".JPEG":case"JPE":case".JPE":var width=array.shape[0];var height=array.shape[1];var data=new Buffer(width*height*4);data=handleData(array,data);var rawImageData={data:data,width:width,height:height};var jpegImageData=jpegJs.encode(rawImageData,options.quality);return new ContentStream(jpegImageData.data);case"GIF":case".GIF":var frames=array.shape.length===4?array.shape[0]:1;var width=array.shape.length===4?array.shape[1]:array.shape[0];var height=array.shape.length===4?array.shape[2]:array.shape[1];var data=new Buffer(width*height*4);var gif=new GifEncoder(width,height);gif.writeHeader();for(var i=0;i<frames;i++){data=handleData(array,data,i);gif.addFrame(data)}gif.finish();return gif;case"PNG":case".PNG":var png=new PNG({width:array.shape[0],height:array.shape[1]});var data=handleData(array,png.data);if(typeof data==="Error")return haderror(data);png.data=data;return png.pack();case"CANVAS":var canvas=document.createElement("canvas");var context=canvas.getContext("2d");canvas.width=array.shape[0];canvas.height=array.shape[1];var imageData=context.getImageData(0,0,canvas.width,canvas.height);var data=imageData.data;data=handleData(array,data);if(typeof data==="Error")return haderror(data);context.putImageData(imageData,0,0);return canvas;default:return haderror(new Error("Unsupported file type: "+type))}}}).call(this,require("buffer").Buffer)},{buffer:13,contentstream:14,"gif-encoder":326,"jpeg-js":500,ndarray:452,"ndarray-ops":449,"pngjs-nozlib":485,through:506}],504:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:322,inherits:358,"readable-stream/duplex.js":489,"readable-stream/passthrough.js":495,"readable-stream/readable.js":496,"readable-stream/transform.js":497,"readable-stream/writable.js":498}],505:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:13}],506:[function(require,module,exports){(function(process){var Stream=require("stream");exports=module.exports=through;through.through=through;function through(write,end,opts){write=write||function(data){this.queue(data)};end=end||function(){this.queue(null)};var ended=false,destroyed=false,buffer=[],_ended=false;var stream=new Stream;stream.readable=stream.writable=true;stream.paused=false;stream.autoDestroy=!(opts&&opts.autoDestroy===false);stream.write=function(data){write.call(this,data);return!stream.paused};function drain(){while(buffer.length&&!stream.paused){var data=buffer.shift();if(null===data)return stream.emit("end");else stream.emit("data",data)}}stream.queue=stream.push=function(data){if(_ended)return stream;if(data===null)_ended=true;buffer.push(data);drain();return stream};stream.on("end",function(){stream.readable=false;if(!stream.writable&&stream.autoDestroy)process.nextTick(function(){stream.destroy()})});function _end(){stream.writable=false;end.call(stream);if(!stream.readable&&stream.autoDestroy)stream.destroy()}stream.end=function(data){if(ended)return;ended=true;if(arguments.length)stream.write(data);_end();return stream};stream.destroy=function(){if(destroyed)return;destroyed=true;ended=true;buffer.length=0;stream.writable=stream.readable=false;stream.emit("close");return stream};stream.pause=function(){if(stream.paused)return;stream.paused=true;return stream};stream.resume=function(){if(stream.paused){stream.paused=false;stream.emit("resume")}drain();if(!stream.paused)stream.emit("drain");return stream};return stream}}).call(this,require("_process"))},{_process:488,stream:504}],507:[function(require,module,exports){"use strict";function unique_pred(list,compare){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i){b=a;a=list[i];if(compare(a,b)){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique_eq(list){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i,b=a){b=a;a=list[i];if(a!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique(list,compare,sorted){if(list.length===0){return list}if(compare){if(!sorted){list.sort(compare)}return unique_pred(list,compare)}if(!sorted){list.sort()}return unique_eq(list)}module.exports=unique},{}],508:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],509:[function(require,module,exports){arguments[4][358][0].apply(exports,arguments)},{dup:358}],510:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],511:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){
if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":510,_process:488,inherits:509}],512:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.COORDINATE_SYSTEM=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _glMatrix=require("gl-matrix");var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}var PI=Math.PI;var PI_4=PI/4;var DEGREES_TO_RADIANS=PI/180;var RADIANS_TO_DEGREES=180/PI;var TILE_SIZE=512;var WORLD_SCALE=TILE_SIZE/(2*PI);var DEFAULT_MAP_STATE={latitude:37,longitude:-122,zoom:11,pitch:0,bearing:0,altitude:1.5};var COORDINATE_SYSTEM=exports.COORDINATE_SYSTEM={LNGLAT:1,METERS:2,IDENTITY:0};var Viewport=(_class=function(){function Viewport(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},width=_ref.width,height=_ref.height,latitude=_ref.latitude,longitude=_ref.longitude,zoom=_ref.zoom,pitch=_ref.pitch,bearing=_ref.bearing,altitude=_ref.altitude,mercatorEnabled=_ref.mercatorEnabled;_classCallCheck(this,Viewport);this.width=width!==undefined?width:DEFAULT_MAP_STATE.width;this.height=height!==undefined?height:DEFAULT_MAP_STATE.height;this.zoom=zoom!==undefined?zoom:DEFAULT_MAP_STATE.zoom;this.latitude=latitude!==undefined?latitude:DEFAULT_MAP_STATE.latitude;this.longitude=longitude!==undefined?longitude:DEFAULT_MAP_STATE.longitude;this.bearing=bearing!==undefined?bearing:DEFAULT_MAP_STATE.bearing;this.pitch=pitch!==undefined?pitch:DEFAULT_MAP_STATE.pitch;this.altitude=altitude!==undefined?altitude:DEFAULT_MAP_STATE.altitude;this.mercatorEnabled=mercatorEnabled!==undefined?mercatorEnabled:true;this.width=this.width||1;this.height=this.height||1;this._initialize()}_createClass(Viewport,[{key:"project",value:function project(lngLatZ){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$topLeft=_ref2.topLeft,topLeft=_ref2$topLeft===undefined?true:_ref2$topLeft;var _ref3=this.mercatorEnabled||this.mercator?this.projectFlat(lngLatZ):lngLatZ,_ref4=_slicedToArray(_ref3,2),X=_ref4[0],Y=_ref4[1];var v=[X,Y,lngLatZ[2]||0,1];_glMatrix.vec4.transformMat4(v,v,this.pixelProjectionMatrix);var scale=1/v[3];_glMatrix.vec4.multiply(v,v,[scale,scale,scale,scale]);var x=v[0],y=v[1],z=v[2];var y2=topLeft?this.height-y:y;return lngLatZ.length===2?[x,y2]:[x,y2,z]}},{key:"unproject",value:function unproject(xyz){var _ref5=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref5$topLeft=_ref5.topLeft,topLeft=_ref5$topLeft===undefined?true:_ref5$topLeft;var _xyz=_slicedToArray(xyz,3),_xyz$=_xyz[0],x=_xyz$===undefined?0:_xyz$,_xyz$2=_xyz[1],y=_xyz$2===undefined?0:_xyz$2,_xyz$3=_xyz[2],z=_xyz$3===undefined?0:_xyz$3;var y2=topLeft?this.height-y:y;var v=[x,y2,z,1];_glMatrix.vec4.transformMat4(v,v,this.pixelUnprojectionMatrix);var scale=1/v[3];_glMatrix.vec4.multiply(v,v,[scale,scale,scale,scale]);var _unprojectFlat=this.unprojectFlat(v),_unprojectFlat2=_slicedToArray(_unprojectFlat,2),x0=_unprojectFlat2[0],y0=_unprojectFlat2[1];var z0=v[2];return xyz.length===2?[x0,y0]:[x0,y0,z0]}},{key:"projectFlat",value:function projectFlat(_ref6){var _ref7=_slicedToArray(_ref6,2),lng=_ref7[0],lat=_ref7[1];var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;scale=scale*WORLD_SCALE;var lambda2=lng*DEGREES_TO_RADIANS;var phi2=lat*DEGREES_TO_RADIANS;var x=scale*(lambda2+PI);var y=scale*(PI-Math.log(Math.tan(PI_4+phi2*.5)));return[x,y]}},{key:"unprojectFlat",value:function unprojectFlat(_ref8){var _ref9=_slicedToArray(_ref8,2),x=_ref9[0],y=_ref9[1];var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;scale=scale*WORLD_SCALE;var lambda2=x/scale-PI;var phi2=2*(Math.atan(Math.exp(PI-y/scale))-PI_4);return[lambda2*RADIANS_TO_DEGREES,phi2*RADIANS_TO_DEGREES]}},{key:"getProjections",value:function getProjections(){return{pixelProjectionMatrix:this.pixelProjectionMatrix,pixelUnprojectionMatrix:this.pixelUnprojectionMatrix,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix}}},{key:"getDistanceScales",value:function getDistanceScales(){return{pixelsPerMeter:this.pixelsPerMeter,metersPerPixel:this.metersPerPixel}}},{key:"_initialize",value:function _initialize(){this.scale=Math.pow(2,this.zoom);this.worldSize=TILE_SIZE*this.scale;this.tileZoom=Math.floor(this.zoom);this.zoomFraction=this.zoom-Math.floor(this.zoom);this.bearingRadians=this.bearing/180*Math.PI;this.bearingRotationMatrix=_glMatrix.mat2.create();_glMatrix.mat2.rotate(this.bearingRotationMatrix,this.bearingRotationMatrix,this.bearing);this.originalPitch=this.pitch;this.pitch=Math.min(60,this.pitch);this.pitchRadians=this.pitch/180*Math.PI;this.originalAltitude=this.altitude;this.altitude=Math.max(.75,this.altitude);this.center=this.projectFlat([this.longitude,this.latitude]);this.centerX=this.center[0];this.centerY=this.center[1];this.halfFov=Math.atan(.5/this.altitude);this.topHalfSurfaceDistance=Math.sin(this.halfFov)*this.altitude/Math.sin(Math.PI/2-this.pitchRadians-this.halfFov);this.farZ=Math.cos(Math.PI/2-this.pitchRadians)*this.topHalfSurfaceDistance+this.altitude;this._calculateDistanceScales();this._calculateTransformationMatrices()}},{key:"_calculateDistanceScales",value:function _calculateDistanceScales(){var METERS_PER_DEGREE=111e3;var latitude=this.latitude,longitude=this.longitude;var latCosine=Math.cos(latitude*Math.PI/180);var metersPerDegree=METERS_PER_DEGREE*latCosine;var pixelsPerDegreeX=_glMatrix.vec2.distance(this.projectFlat([longitude+.5,latitude]),this.projectFlat([longitude-.5,latitude]));var pixelsPerDegreeY=_glMatrix.vec2.distance(this.projectFlat([longitude,latitude+.5]),this.projectFlat([longitude,latitude-.5]));var pixelsPerMeterX=pixelsPerDegreeX/metersPerDegree;var pixelsPerMeterY=pixelsPerDegreeY/metersPerDegree;var pixelsPerMeterZ=(pixelsPerMeterX+pixelsPerMeterY)/2;var altPixelsPerMeter=this.worldSize/(4e7*latCosine);var pixelsPerMeter=[altPixelsPerMeter,altPixelsPerMeter,altPixelsPerMeter];var metersPerPixel=[1/pixelsPerMeterX,1/pixelsPerMeterY,1/pixelsPerMeterZ];this.pixelsPerMeter=pixelsPerMeter;this.metersPerPixel=metersPerPixel}},{key:"_calculateTransformationMatrices",value:function _calculateTransformationMatrices(){this.projectionMatrix=_glMatrix.mat4.perspective(this._createMat4(),2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,this.farZ*10);var vm=this._createMat4();_glMatrix.mat4.translate(vm,vm,[0,0,-this.altitude]);_glMatrix.mat4.scale(vm,vm,[1,-1,1/this.height]);_glMatrix.mat4.rotateX(vm,vm,this.pitchRadians);_glMatrix.mat4.rotateZ(vm,vm,-this.bearingRadians);this.viewMatrix=this._createMat4();_glMatrix.mat4.translate(this.viewMatrix,vm,[-this.centerX,-this.centerY,0]);var vpm=this._createMat4();_glMatrix.mat4.multiply(vpm,vpm,this.projectionMatrix);_glMatrix.mat4.multiply(vpm,vpm,this.viewMatrix);this.viewProjectionMatrix=vpm;var m=this._createMat4();_glMatrix.mat4.scale(m,m,[this.width,this.height,1]);_glMatrix.mat4.translate(m,m,[.5,.5,0]);_glMatrix.mat4.scale(m,m,[.5,.5,0]);_glMatrix.mat4.multiply(m,m,this.viewProjectionMatrix);this.pixelProjectionMatrix=m;var mInverse=this._createMat4();_glMatrix.mat4.invert(mInverse,m);this.pixelUnprojectionMatrix=mInverse}},{key:"_calculatePixelProjectionMatrices",value:function _calculatePixelProjectionMatrices(){var m=this._createMat4();_glMatrix.mat4.scale(m,m,[this.width,this.height,1]);_glMatrix.mat4.translate(m,m,[.5,.5,0]);_glMatrix.mat4.scale(m,m,[.5,.5,0]);_glMatrix.mat4.multiply(m,m,this.viewProjectionMatrix);this.pixelProjectionMatrix=m;var mInverse=this._createMat4();_glMatrix.mat4.invert(mInverse,m);this.pixelUnprojectionMatrix=mInverse}},{key:"_createMat4",value:function _createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}]);return Viewport}(),_applyDecoratedDescriptor(_class.prototype,"project",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"project"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unproject",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unproject"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"projectFlat",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"projectFlat"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"unprojectFlat",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"unprojectFlat"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjections",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjections"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getDistanceScales",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getDistanceScales"),_class.prototype),_class);exports.default=Viewport},{"autobind-decorator":6,"gl-matrix":337}],513:[function(require,module,exports){module.exports=require("./dist/perspective-viewport")},{"./dist/perspective-viewport":512}],514:[function(require,module,exports){(function(global){WebGLDebugUtils=function(){if(typeof window=="undefined"){window=global}var log=function(msg){if(window.console&&window.console.log){window.console.log(msg)}};var error=function(msg){if(window.console&&window.console.error){window.console.error(msg)}else{log(msg)}};var glValidEnumContexts={enable:{1:{0:true}},disable:{1:{0:true}},getParameter:{1:{0:true}},drawArrays:{3:{0:true}},drawElements:{4:{0:true,2:true}},createShader:{1:{0:true}},getShaderParameter:{2:{1:true}},getProgramParameter:{2:{1:true}},getShaderPrecisionFormat:{2:{0:true,1:true}},getVertexAttrib:{2:{1:true}},vertexAttribPointer:{6:{2:true}},bindTexture:{2:{0:true}},activeTexture:{1:{0:true}},getTexParameter:{2:{0:true,1:true}},texParameterf:{3:{0:true,1:true}},texParameteri:{3:{0:true,1:true,2:true}},texImage2D:{9:{0:true,2:true,6:true,7:true},6:{0:true,2:true,3:true,4:true}},texSubImage2D:{9:{0:true,6:true,7:true},7:{0:true,4:true,5:true}},copyTexImage2D:{8:{0:true,2:true}},copyTexSubImage2D:{8:{0:true}},generateMipmap:{1:{0:true}},compressedTexImage2D:{7:{0:true,2:true}},compressedTexSubImage2D:{8:{0:true,6:true}},bindBuffer:{2:{0:true}},bufferData:{3:{0:true,2:true}},bufferSubData:{3:{0:true}},getBufferParameter:{2:{0:true,1:true}},pixelStorei:{2:{0:true,1:true}},readPixels:{7:{4:true,5:true}},bindRenderbuffer:{2:{0:true}},bindFramebuffer:{2:{0:true}},checkFramebufferStatus:{1:{0:true}},framebufferRenderbuffer:{4:{0:true,1:true,2:true}},framebufferTexture2D:{5:{0:true,1:true,2:true}},getFramebufferAttachmentParameter:{3:{0:true,1:true,2:true}},getRenderbufferParameter:{2:{0:true,1:true}},renderbufferStorage:{4:{0:true,1:true}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:true}},blendFunc:{2:{0:true,1:true}},blendFuncSeparate:{4:{0:true,1:true,2:true,3:true}},blendEquation:{1:{0:true}},blendEquationSeparate:{2:{0:true,1:true}},stencilFunc:{3:{0:true}},stencilFuncSeparate:{4:{0:true,1:true}},stencilMaskSeparate:{2:{0:true}},stencilOp:{3:{0:true,1:true,2:true}},stencilOpSeparate:{4:{0:true,1:true,2:true,3:true}},cullFace:{1:{0:true}},frontFace:{1:{0:true}},drawArraysInstancedANGLE:{4:{0:true}},drawElementsInstancedANGLE:{5:{0:true,2:true}},blendEquationEXT:{1:{0:true}}};var glEnums=null;var enumStringToValue=null;function init(ctx){if(glEnums==null){glEnums={};enumStringToValue={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="number"){glEnums[ctx[propertyName]]=propertyName;enumStringToValue[propertyName]=ctx[propertyName]}}}}function checkInit(){if(glEnums==null){throw"WebGLDebugUtils.init(ctx) not called"}}function mightBeEnum(value){checkInit();return glEnums[value]!==undefined}function glEnumToString(value){checkInit();var name=glEnums[value];return name!==undefined?"gl."+name:"/*UNKNOWN WebGL ENUM*/ 0x"+value.toString(16)+""}function glFunctionArgToString(functionName,numArgs,argumentIndex,value){var funcInfo=glValidEnumContexts[functionName];if(funcInfo!==undefined){var funcInfo=funcInfo[numArgs];if(funcInfo!==undefined){if(funcInfo[argumentIndex]){if(typeof funcInfo[argumentIndex]==="object"&&funcInfo[argumentIndex]["enumBitwiseOr"]!==undefined){var enums=funcInfo[argumentIndex]["enumBitwiseOr"];var orResult=0;var orEnums=[];for(var i=0;i<enums.length;++i){var enumValue=enumStringToValue[enums[i]];if((value&enumValue)!==0){orResult|=enumValue;orEnums.push(glEnumToString(enumValue))}}if(orResult===value){return orEnums.join(" | ")}else{return glEnumToString(value)}}else{return glEnumToString(value)}}}}if(value===null){return"null"}else if(value===undefined){return"undefined"}else{return value.toString()}}function glFunctionArgsToString(functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}return argStr}function makePropertyWrapper(wrapper,original,propertyName){wrapper.__defineGetter__(propertyName,function(){return original[propertyName]});wrapper.__defineSetter__(propertyName,function(value){original[propertyName]=value})}function makeFunctionWrapper(original,functionName){var f=original[functionName];return function(){var result=f.apply(original,arguments);return result}}function makeDebugContext(ctx,opt_onErrorFunc,opt_onFunc,opt_err_ctx){opt_err_ctx=opt_err_ctx||ctx;init(ctx);opt_onErrorFunc=opt_onErrorFunc||function(err,functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}error("WebGL error "+glEnumToString(err)+" in "+functionName+"("+argStr+")")};var glErrorShadow={};function makeErrorWrapper(ctx,functionName){return function(){if(opt_onFunc){opt_onFunc(functionName,arguments)}var result=ctx[functionName].apply(ctx,arguments);var err=opt_err_ctx.getError();if(err!=0){glErrorShadow[err]=true;opt_onErrorFunc(err,functionName,arguments)}return result}}var wrapper={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){if(propertyName!="getExtension"){wrapper[propertyName]=makeErrorWrapper(ctx,propertyName)}else{var wrapped=makeErrorWrapper(ctx,propertyName);wrapper[propertyName]=function(){var result=wrapped.apply(ctx,arguments);return makeDebugContext(result,opt_onErrorFunc,opt_onFunc,opt_err_ctx)}}}else{makePropertyWrapper(wrapper,ctx,propertyName)}}wrapper.getError=function(){for(var err in glErrorShadow){if(glErrorShadow.hasOwnProperty(err)){if(glErrorShadow[err]){glErrorShadow[err]=false;return err}}}return ctx.NO_ERROR};return wrapper}function resetToInitialState(ctx){var numAttribs=ctx.getParameter(ctx.MAX_VERTEX_ATTRIBS);var tmp=ctx.createBuffer();ctx.bindBuffer(ctx.ARRAY_BUFFER,tmp);for(var ii=0;ii<numAttribs;++ii){ctx.disableVertexAttribArray(ii);ctx.vertexAttribPointer(ii,4,ctx.FLOAT,false,0,0);ctx.vertexAttrib1f(ii,0)}ctx.deleteBuffer(tmp);var numTextureUnits=ctx.getParameter(ctx.MAX_TEXTURE_IMAGE_UNITS);for(var ii=0;ii<numTextureUnits;++ii){ctx.activeTexture(ctx.TEXTURE0+ii);ctx.bindTexture(ctx.TEXTURE_CUBE_MAP,null);ctx.bindTexture(ctx.TEXTURE_2D,null)}ctx.activeTexture(ctx.TEXTURE0);ctx.useProgram(null);ctx.bindBuffer(ctx.ARRAY_BUFFER,null);ctx.bindBuffer(ctx.ELEMENT_ARRAY_BUFFER,null);ctx.bindFramebuffer(ctx.FRAMEBUFFER,null);ctx.bindRenderbuffer(ctx.RENDERBUFFER,null);ctx.disable(ctx.BLEND);ctx.disable(ctx.CULL_FACE);ctx.disable(ctx.DEPTH_TEST);ctx.disable(ctx.DITHER);ctx.disable(ctx.SCISSOR_TEST);ctx.blendColor(0,0,0,0);ctx.blendEquation(ctx.FUNC_ADD);ctx.blendFunc(ctx.ONE,ctx.ZERO);ctx.clearColor(0,0,0,0);ctx.clearDepth(1);ctx.clearStencil(-1);ctx.colorMask(true,true,true,true);ctx.cullFace(ctx.BACK);ctx.depthFunc(ctx.LESS);ctx.depthMask(true);ctx.depthRange(0,1);ctx.frontFace(ctx.CCW);ctx.hint(ctx.GENERATE_MIPMAP_HINT,ctx.DONT_CARE);ctx.lineWidth(1);ctx.pixelStorei(ctx.PACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_FLIP_Y_WEBGL,false);ctx.pixelStorei(ctx.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL){ctx.pixelStorei(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL,ctx.BROWSER_DEFAULT_WEBGL)}ctx.polygonOffset(0,0);ctx.sampleCoverage(1,false);ctx.scissor(0,0,ctx.canvas.width,ctx.canvas.height);ctx.stencilFunc(ctx.ALWAYS,0,4294967295);ctx.stencilMask(4294967295);ctx.stencilOp(ctx.KEEP,ctx.KEEP,ctx.KEEP);ctx.viewport(0,0,ctx.canvas.width,ctx.canvas.height);ctx.clear(ctx.COLOR_BUFFER_BIT|ctx.DEPTH_BUFFER_BIT|ctx.STENCIL_BUFFER_BIT);while(ctx.getError());}function makeLostContextSimulatingCanvas(canvas){var unwrappedContext_;var wrappedContext_;var onLost_=[];var onRestored_=[];var wrappedContext_={};var contextId_=1;var contextLost_=false;var resourceId_=0;var resourceDb_=[];var numCallsToLoseContext_=0;var numCalls_=0;var canRestore_=false;var restoreTimeout_=0;var glErrorShadow_={};canvas.getContext=function(f){return function(){var ctx=f.apply(canvas,arguments);if(ctx instanceof WebGLRenderingContext){if(ctx!=unwrappedContext_){if(unwrappedContext_){throw"got different context"}unwrappedContext_=ctx;wrappedContext_=makeLostContextSimulatingContext(unwrappedContext_)}return wrappedContext_}return ctx}}(canvas.getContext);function wrapEvent(listener){if(typeof listener=="function"){return listener}else{return function(info){listener.handleEvent(info)}}}var addOnContextLostListener=function(listener){onLost_.push(wrapEvent(listener))};var addOnContextRestoredListener=function(listener){onRestored_.push(wrapEvent(listener))};function wrapAddEventListener(canvas){var f=canvas.addEventListener;canvas.addEventListener=function(type,listener,bubble){switch(type){case"webglcontextlost":addOnContextLostListener(listener);break;case"webglcontextrestored":addOnContextRestoredListener(listener);break;default:f.apply(canvas,arguments)}}}wrapAddEventListener(canvas);canvas.loseContext=function(){if(!contextLost_){contextLost_=true;numCallsToLoseContext_=0;++contextId_;while(unwrappedContext_.getError());clearErrors();glErrorShadow_[unwrappedContext_.CONTEXT_LOST_WEBGL]=true;var event=makeWebGLContextEvent("context lost");var callbacks=onLost_.slice();setTimeout(function(){for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}if(restoreTimeout_>=0){setTimeout(function(){canvas.restoreContext()},restoreTimeout_)}},0)}};canvas.restoreContext=function(){if(contextLost_){if(onRestored_.length){setTimeout(function(){if(!canRestore_){throw"can not restore. webglcontestlost listener did not call event.preventDefault"}freeResources();resetToInitialState(unwrappedContext_);contextLost_=false;numCalls_=0;canRestore_=false;var callbacks=onRestored_.slice();var event=makeWebGLContextEvent("context restored");for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}},0)}}};canvas.loseContextInNCalls=function(numCalls){if(contextLost_){throw"You can not ask a lost contet to be lost"}numCallsToLoseContext_=numCalls_+numCalls};canvas.getNumCalls=function(){return numCalls_};canvas.setRestoreTimeout=function(timeout){restoreTimeout_=timeout};function isWebGLObject(obj){return obj instanceof WebGLBuffer||obj instanceof WebGLFramebuffer||obj instanceof WebGLProgram||obj instanceof WebGLRenderbuffer||obj instanceof WebGLShader||obj instanceof WebGLTexture}function checkResources(args){for(var ii=0;ii<args.length;++ii){var arg=args[ii];if(isWebGLObject(arg)){return arg.__webglDebugContextLostId__==contextId_}}return true}function clearErrors(){var k=Object.keys(glErrorShadow_);for(var ii=0;ii<k.length;++ii){delete glErrorShadow_[k]}}function loseContextIfTime(){++numCalls_;if(!contextLost_){if(numCallsToLoseContext_==numCalls_){canvas.loseContext()}}}function makeLostContextFunctionWrapper(ctx,functionName){var f=ctx[functionName];return function(){loseContextIfTime();if(!contextLost_){var result=f.apply(ctx,arguments);return result}}}function freeResources(){for(var ii=0;ii<resourceDb_.length;++ii){var resource=resourceDb_[ii];if(resource instanceof WebGLBuffer){unwrappedContext_.deleteBuffer(resource)}else if(resource instanceof WebGLFramebuffer){unwrappedContext_.deleteFramebuffer(resource)}else if(resource instanceof WebGLProgram){unwrappedContext_.deleteProgram(resource)}else if(resource instanceof WebGLRenderbuffer){unwrappedContext_.deleteRenderbuffer(resource)}else if(resource instanceof WebGLShader){unwrappedContext_.deleteShader(resource)}else if(resource instanceof WebGLTexture){unwrappedContext_.deleteTexture(resource)}}}function makeWebGLContextEvent(statusMessage){return{statusMessage:statusMessage,preventDefault:function(){canRestore_=true}}}return canvas;function makeLostContextSimulatingContext(ctx){for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){wrappedContext_[propertyName]=makeLostContextFunctionWrapper(ctx,propertyName)}else{makePropertyWrapper(wrappedContext_,ctx,propertyName)}}wrappedContext_.getError=function(){loseContextIfTime();if(!contextLost_){var err;while(err=unwrappedContext_.getError()){glErrorShadow_[err]=true}}for(var err in glErrorShadow_){if(glErrorShadow_[err]){delete glErrorShadow_[err];return err}}return wrappedContext_.NO_ERROR};var creationFunctions=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(var ii=0;ii<creationFunctions.length;++ii){var functionName=creationFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}var obj=f.apply(ctx,arguments);obj.__webglDebugContextLostId__=contextId_;resourceDb_.push(obj);return obj}}(ctx[functionName])}var functionsThatShouldReturnNull=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(var ii=0;ii<functionsThatShouldReturnNull.length;++ii){var functionName=functionsThatShouldReturnNull[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}var isFunctions=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(var ii=0;ii<isFunctions.length;++ii){var functionName=isFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return false}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}wrappedContext_.checkFramebufferStatus=function(f){return function(){loseContextIfTime();if(contextLost_){return wrappedContext_.FRAMEBUFFER_UNSUPPORTED}return f.apply(ctx,arguments)}}(wrappedContext_.checkFramebufferStatus);wrappedContext_.getAttribLocation=function(f){return function(){loseContextIfTime();if(contextLost_){return-1}return f.apply(ctx,arguments)}}(wrappedContext_.getAttribLocation);wrappedContext_.getVertexAttribOffset=function(f){return function(){loseContextIfTime();if(contextLost_){return 0}return f.apply(ctx,arguments)}}(wrappedContext_.getVertexAttribOffset);wrappedContext_.isContextLost=function(){return contextLost_};return wrappedContext_}}return{init:init,mightBeEnum:mightBeEnum,glEnumToString:glEnumToString,glFunctionArgToString:glFunctionArgToString,glFunctionArgsToString:glFunctionArgsToString,makeDebugContext:makeDebugContext,makeLostContextSimulatingCanvas:makeLostContextSimulatingCanvas,resetToInitialState:resetToInitialState}}();module.exports=WebGLDebugUtils}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],515:[function(require,module,exports){module.exports={name:"deck.gl",description:"A suite of 3D-enabled data visualization overlays, suitable for react-map-gl",license:"MIT",version:"3.0.8",keywords:["webgl","visualization","overlay","layer"],repository:{type:"git",url:"https://github.com/uber/deck.gl.git"},main:"index.js",files:["dist","shaderlib","src","index.js","react.js","viewport.js","samples.js"],dependencies:{"autobind-decorator":"^1.3.3","babel-polyfill":"^6.1.19",earcut:"^2.0.6","extrude-polyline":"^1.0.6","geojson-normalize":"0.0.1","get-pixels":"^3.3.0","gl-matrix":"^2.3.2",glslify:"^5.0.0","lodash.flattendeep":"^3.0.2","save-pixels":"^2.3.0","viewport-mercator-project":"3.0.0-beta2","webgl-obj-loader":"^0.1.1"},devDependencies:{"babel-cli":"^6.3.15","babel-core":"^6.7.7","babel-eslint":"^6.0.0","babel-plugin-glslify":"1.0.2","babel-plugin-static-fs":"^1.1.0","babel-plugin-transform-class-properties":"^6.18.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-preset-es2015":"^6.3.13","babel-preset-react":"^6.3.13","babel-preset-stage-2":"^6.3.13","babel-runtime":"^6.11.6",babelify:"^7.2.0","brfs-babel":"^1.0.0",browserify:"13.0.0",budo:"^8.0.3","d3-color":"^1.0.1","d3-request":"^1.0.2","d3-scale":"^1.0.3",discify:"^1.2.0","electron-prebuilt":"^0.37.2",envify:"^3.4.0",eslint:"^2.0.0","eslint-config-uber-es2015":"^2.0.0","eslint-config-uber-jsx":"^2.0.0","eslint-plugin-react":"^5.0.0",faucet:"0.0.1",gl:"^4.0.1","highlight.js":"^9.7.0",immutable:"^3.7.5","luma.gl":"^2.10.0",marked:"^0.3.6",react:"^15.3.2","react-addons-pure-render-mixin":"^15.3.2","react-addons-test-utils":"^15.0.2","react-dom":"^15.3.2","react-map-gl":"^1.7.2","react-redux":"^4.4.5","react-router":"^2.8.1",redux:"^3.6.0","redux-thunk":"^2.1.0",sassify:"^2.0.0","stats.js":"^0.17.0","tap-browser-color":"^0.1.2",tape:"^4.6.0","tape-catch":"^1.0.4",testron:"^1.2.0","tween.js":"^16.3.5","uglify-js":"^2.6.1"},peerDependencies:{react:"0.14.x - 15.x","react-dom":"0.14.x - 15.x","luma.gl":"^2.10.0"},scripts:{build:"npm run build-dist && npm run build-script","build-clean":"rm -fr dist/*","build-dist":"npm run build-clean && npm run build-src && npm run build-shaderlib","build-src":"babel src -d dist --source-maps inline --copy-files","build-shaderlib":"babel shaderlib -d dist/shaderlib --source-maps inline --copy-files","build-script":"browserify src/bundle.js -t babelify -t glslify | uglifyjs > dist/deckgl.min.js","build-watch":"npm run build-clean && npm run build-src-watch && npm run build-shaderlib-watch","build-src-watch":"babel src -d dist --source-maps inline --copy-files --watch &","build-shaderlib-watch":"babel shaderlib -d dist/shaderlib --source-maps inline --copy-files --watch &","demo-start":"npm run demo-build-copy && budo demo/src/javascripts/main.js:main.min.js --dir dist-demo/ --open --  -t babelify -t sassify -t glslify","demo-build":"npm run demo-build-clean && npm run demo-build-copy && npm run demo-build-script","demo-build-clean":"rm -fr dist-demo && mkdir -p dist-demo","demo-build-copy":" mkdir -p dist-demo/docs && cp -R demo/src/static/* dist-demo/ && cp -R docs dist-demo","demo-build-script":"NODE_ENV=production browserify demo/src/javascripts/main.js -o -t babelify -t sassify -t glslify | uglifyjs > dist-demo/main.min.js","demo-gh-pages":"git subtree push --prefix dist-demo origin gh-pages","demo-gh-pages-force":"git push origin `git subtree split --prefix dist-demo master`:gh-pages --force","demo-publish":"npm run build && npm run demo-build && git add dist-demo -f && git commit -m 'UPDATE DOCS' --no-verify && npm run demo-gh-pages","demo-publish-force":"npm run build && npm run demo-build && git add dist-demo -f && git commit -m 'UPDATE DOCS' --no-verify && npm run demo-gh-pages-force",lint:"eslint src",precommit:"npm test",mypublish:"npm run build && npm run test-fast && npm publish",test:"npm run lint && npm run build-dist && npm run test-headless","test-fast":"npm run lint && npm run test-headless","test-headless":"node dist/test/headless.js","test-headless-src":"babel-node --only=deck.gl/test,deck.gl/src,deck.gl/shaderlib src/test/headless.js","test-browser":"budo src/test/browser.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,scss,js,glsl}' -- -t babelify -t glslify","test-electron":"browserify dist/test/electron.js | testron | faucet","test-shader":"npm run build-dist && budo src/test/shader.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,scss,js,glsl}' -- -t babelify -t glslify","profile-disc":"browserify src/bundle.js --full-paths -t babelify -t glslify | uglifyjs | discify --open",start:"npm run build-watch && budo example/main.js:example/bundle.js --live --open --port 3000 --css example/main.css --title 'deck.gl' --watch-glob '**/*.{html,css,js,glsl}' -- -t brfs-babel -t babelify -t envify"}}},{}],516:[function(require,module,exports){"use strict";require("babel-polyfill");var _index=require("./index");var DeckGL=_interopRequireWildcard(_index);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}(function exposeAsGlobal(){if(typeof window!=="undefined"){window.DeckGL=DeckGL}})()},{"./index":517,"babel-polyfill":7}],517:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lib=require("./lib");Object.keys(_lib).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _lib[key]}})});var _viewport=require("./viewport");Object.keys(_viewport).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _viewport[key]}})});var _shaderUtils=require("./shader-utils");
Object.keys(_shaderUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _shaderUtils[key]}})});var _core=require("./layers/core");Object.keys(_core).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _core[key]}})});var _fp=require("./layers/fp64");Object.keys(_fp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _fp[key]}})})},{"./layers/core":522,"./layers/fp64":535,"./lib":541,"./shader-utils":552,"./viewport":554}],518:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color};var ArcLayer=function(_Layer){_inherits(ArcLayer,_Layer);function ArcLayer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getSourceColor=_ref.getSourceColor,getSourceColor=_ref$getSourceColor===undefined?defaultGetColor:_ref$getSourceColor,_ref$getTargetColor=_ref.getTargetColor,getTargetColor=_ref$getTargetColor===undefined?defaultGetColor:_ref$getTargetColor,props=_objectWithoutProperties(_ref,["strokeWidth","getSourcePosition","getTargetPosition","getSourceColor","getTargetColor"]);_classCallCheck(this,ArcLayer);return _possibleConstructorReturn(this,(ArcLayer.__proto__||Object.getPrototypeOf(ArcLayer)).call(this,_extends({strokeWidth:strokeWidth,getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getSourceColor:getSourceColor,getTargetColor:getTargetColor},props)))}_createClass(ArcLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,update:this.calculateInstancePositions},instanceSourceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceSourceColors},instanceTargetColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceTargetColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"_createModel",value:function _createModel(gl){var positions=[];var NUM_SEGMENTS=50;for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[i,i,i])}return new _luma.Model(_extends({gl:gl},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME arc-layer-vertex-shader\n\n// #pragma glslify: preproject = require(../../../../shaderlib/preproject)\n// #pragma glslify: scale = require(../../../../shaderlib/scale)\n// #pragma glslify: project = require(../../../../shaderlib/project)\n\nconst float N = 49.0;\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvoid main(void) {\n  vec2 source = preproject(instancePositions.xy);\n  vec2 target = preproject(instancePositions.zw);\n\n  float segmentRatio = smoothstep(0.0, 1.0, positions.x / N);\n\n  float vertex_height = paraboloid(source, target, segmentRatio);\n  if (vertex_height < 0.0) vertex_height = 0.0;\n  vec3 p = vec3(\n    // xy: linear interpolation of source & target\n    mix(source, target, segmentRatio),\n    // z: paraboloid interpolate of source & target\n    sqrt(vertex_height)\n  );\n\n  gl_Position = project(vec4(p, 1.0));\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition,getTargetPosition=_props.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=targetPosition[0];value[i+3]=targetPosition[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceSourceColors",value:function calculateInstanceSourceColors(attribute){var _props2=this.props,data=_props2.data,getSourceColor=_props2.getSourceColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var color=getSourceColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceTargetColors",value:function calculateInstanceTargetColors(attribute){var _props3=this.props,data=_props3.data,getTargetColor=_props3.getTargetColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getTargetColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return ArcLayer}(_lib.Layer);ArcLayer.layerName="ArcLayer";exports.default=ArcLayer},{"../../../lib":541,"../../../shader-utils":552,"luma.gl":387}],519:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arcLayer=require("./arc-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./arc-layer":518}],520:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _geojsonNormalize=require("geojson-normalize");var _geojsonNormalize2=_interopRequireDefault(_geojsonNormalize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetColor=function defaultGetColor(feature){return feature.properties.color};var ChoroplethLayer=function(_Layer){_inherits(ChoroplethLayer,_Layer);function ChoroplethLayer(props){_classCallCheck(this,ChoroplethLayer);return _possibleConstructorReturn(this,(ChoroplethLayer.__proto__||Object.getPrototypeOf(ChoroplethLayer)).call(this,_extends({getColor:defaultGetColor,drawCountour:false,strokeWidth:1},props)))}_createClass(ChoroplethLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addDynamic({indices:{size:1,update:this.calculateIndices,isIndexed:true},positions:{size:3,update:this.calculatePositions},colors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateColors},pickingColors:{type:_luma.GL.UNSIGNED_BYTE,size:3,update:this.calculatePickingColors,noAlloc:true}});var IndexType=gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array;this.setState({model:this.getModel(gl),numInstances:0,IndexType:IndexType})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.state.choropleths=extractChoropleths(props.data);attributeManager.invalidateAll()}if(oldProps.opacity!==props.opacity){this.setUniforms({opacity:props.opacity})}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"pick",value:function pick(opts){_get(ChoroplethLayer.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME choropleth-layer-vertex-shader\n\n// #pragma glslify: preproject = require(../../../../shaderlib/preproject)\n// #pragma glslify: scale = require(../../../../shaderlib/scale)\n// #pragma glslify: project = require(../../../../shaderlib/project)\n\nattribute vec3 positions;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// PICKING\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\nvoid picking_setPickColor(vec3 pickingColor) {\n  vPickingColor = vec4(pickingColor,  1.);\n}\nvec4 picking_setNormalAndPickColors(vec4 color, vec3 pickingColor) {\n  vec4 pickingColor4 = vec4(pickingColor.rgb, 1.);\n  vPickingColor = mix(color, pickingColor4, pickingEnabled);\n  return vPickingColor;\n}\n// PICKING\n\n// vec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n//   vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n//   vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n//   return mix(color4, pickingColor4, renderPickingBuffer);\n// }\n\nvoid main(void) {\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n\n  picking_setNormalAndPickColors(\n    color,\n    pickingColors / 255.\n  );\n\n  vec3 p = project_position(positions);\n  gl_Position = project_to_clipspace(vec4(p, 1.));\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME choropleth-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\n// PICKING\n// uniform bool pickingEnabled;\nvarying vec4 vPickingColor;\nvec4 picking_getColor() {\n  return vPickingColor;\n}\n// PICKING\n\nvoid main(void) {\n  gl_FragColor = picking_getColor();\n}\n'}),{geometry:new _luma.Geometry({drawMode:this.props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this2=this;var offsets=this.state.choropleths.reduce(function(acc,choropleth){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+choropleth.reduce(function(count,polygon){return count+polygon.length},0)])},[0]);var IndexType=this.state.IndexType;if(IndexType===Uint16Array&&offsets[offsets.length-1]>65535){throw new Error("Vertex count exceeds browser's limit")}var indices=this.state.choropleths.map(function(choropleth,choroplethIndex){return _this2.props.drawContour?calculateContourIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]}):calculateSurfaceIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new IndexType((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositions",value:function calculatePositions(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices)}},{key:"calculateColors",value:function calculateColors(attribute){var _props=this.props,features=_props.data.features,getColor=_props.getColor;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var feature=features[choropleth.featureIndex];var color=getColor(feature)||DEFAULT_COLOR;if(isNaN(color[3])){color[3]=DEFAULT_COLOR[3]}return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this3=this;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var featureIndex=choropleth.featureIndex;var color=_this3.props.drawContour?[0,0,0]:[(featureIndex+1)%256,Math.floor((featureIndex+1)/256)%256,Math.floor((featureIndex+1)/256/256)%256];return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}}]);return ChoroplethLayer}(_lib.Layer);ChoroplethLayer.layerName="ChoroplethLayer";exports.default=ChoroplethLayer;function extractChoropleths(data){var normalizedGeojson=(0,_geojsonNormalize2.default)(data);var result=[];normalizedGeojson.features.map(function(feature,featureIndex){var choropleths=featureToChoropleths(feature);choropleths.forEach(function(choropleth){choropleth.featureIndex=featureIndex});result.push.apply(result,_toConsumableArray(choropleths))});return result}function featureToChoropleths(feature){var _feature$geometry=feature.geometry,coordinates=_feature$geometry.coordinates,type=_feature$geometry.type;var choropleths=void 0;switch(type){case"MultiPolygon":choropleths=coordinates;break;case"Polygon":choropleths=[coordinates];break;case"LineString":choropleths=[[coordinates]];break;case"MultiLineString":choropleths=coordinates.map(function(coords){return[coords]});break;default:choropleths=[]}return choropleths.map(function(choropleth){return choropleth.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],coordinate[2]||0]})})})}function calculateContourIndices(choropleth){var offset=0;return choropleth.reduce(function(acc,polygon){var numVertices=polygon.length;var indices=[].concat(_toConsumableArray(acc),[offset]);for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset+numVertices-1);offset+=numVertices;return indices},[])}function calculateSurfaceIndices(choropleth){var holes=null;if(choropleth.length>1){holes=choropleth.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,choropleth.length)}return(0,_earcut2.default)((0,_lodash2.default)(choropleth),holes,3)}},{"../../../lib":541,"../../../shader-utils":552,earcut:321,"geojson-normalize":324,"lodash.flattendeep":363,"luma.gl":387}],521:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _choroplethLayer=require("./choropleth-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./choropleth-layer":520}],522:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arcLayer=require("./arc-layer");Object.defineProperty(exports,"ArcLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});var _choroplethLayer=require("./choropleth-layer");Object.defineProperty(exports,"ChoroplethLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});var _lineLayer=require("./line-layer");Object.defineProperty(exports,"LineLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_lineLayer).default}});var _scatterplotLayer=require("./scatterplot-layer");Object.defineProperty(exports,"ScatterplotLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});var _screenGridLayer=require("./screen-grid-layer");Object.defineProperty(exports,"ScreenGridLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_screenGridLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./arc-layer":519,"./choropleth-layer":521,"./line-layer":523,"./scatterplot-layer":525,"./screen-grid-layer":527}],523:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lineLayer=require("./line-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_lineLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./line-layer":524}],524:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,255,0,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var LineLayer=function(_Layer){_inherits(LineLayer,_Layer);function LineLayer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,opts=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getColor","strokeWidth"]);_classCallCheck(this,LineLayer);return _possibleConstructorReturn(this,(LineLayer.__proto__||Object.getPrototypeOf(LineLayer)).call(this,_extends({getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getColor:getColor,strokeWidth:strokeWidth},opts)))}_createClass(LineLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this.createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,update:this.calculateInstancePositions},instanceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"createModel",value:function createModel(gl){var positions=[0,0,0,1,1,1];return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-vertex-shader\n\n// #pragma glslify: preproject = require(../../../../shaderlib/preproject)\n// #pragma glslify: scale = require(../../../../shaderlib/scale)\n// #pragma glslify: project = require(../../../../shaderlib/project)\n\nattribute vec3 positions;\nattribute vec4 instanceColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec2 source = preproject(instancePositions.xy);\n  vec2 target = preproject(instancePositions.zw);\n\n  float segmentIndex = positions.x;\n  // xy: linear interpolation of source & target\n  vec2 p = mix(source, target, segmentIndex);\n\n  gl_Position = project(vec4(p, 0., 1.));\n\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',
fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition,getTargetPosition=_props.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=targetPosition[0];value[i+3]=targetPosition[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props2=this.props,data=_props2.data,getColor=_props2.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var color=getColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}]);return LineLayer}(_lib.Layer);LineLayer.layerName="LineLayer";exports.default=LineLayer},{"../../../lib":541,"../../../shader-utils":552,"luma.gl":387}],525:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _scatterplotLayer=require("./scatterplot-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./scatterplot-layer":526}],526:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[255,0,255,255];var defaultGetPosition=function defaultGetPosition(x){return x.position};var defaultGetRadius=function defaultGetRadius(x){return x.radius};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var ScatterplotLayer=function(_Layer){_inherits(ScatterplotLayer,_Layer);function ScatterplotLayer(_ref){var _ref$getPosition=_ref.getPosition,getPosition=_ref$getPosition===undefined?defaultGetPosition:_ref$getPosition,_ref$getRadius=_ref.getRadius,getRadius=_ref$getRadius===undefined?defaultGetRadius:_ref$getRadius,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$radius=_ref.radius,radius=_ref$radius===undefined?30:_ref$radius,_ref$drawOutline=_ref.drawOutline,drawOutline=_ref$drawOutline===undefined?false:_ref$drawOutline,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getPosition","getRadius","getColor","radius","drawOutline","strokeWidth"]);_classCallCheck(this,ScatterplotLayer);return _possibleConstructorReturn(this,(ScatterplotLayer.__proto__||Object.getPrototypeOf(ScatterplotLayer)).call(this,_extends({getPosition:getPosition,getRadius:getRadius,getColor:getColor,drawOutline:drawOutline,strokeWidth:strokeWidth,radius:radius},props)))}_createClass(ScatterplotLayer,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var model=this._getModel(gl);this.setState({model:model});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,update:this.calculateInstancePositions},instanceColors:{type:_luma.GL.UNSIGNED_BYTE,size:4,update:this.calculateInstanceColors}})}},{key:"updateState",value:function updateState(evt){_get(ScatterplotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterplotLayer.prototype),"updateState",this).call(this,evt);var props=evt.props,oldProps=evt.oldProps;if(props.drawOutline!==oldProps.drawOutline){this.state.model.geometry.drawMode=props.drawOutline?_luma.GL.LINE_LOOP:_luma.GL.TRIANGLE_FAN}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(_extends({},uniforms,{radius:this.props.radius}));gl.lineWidth(1)}},{key:"_getModel",value:function _getModel(gl){var NUM_SEGMENTS=16;var PI2=Math.PI*2;var positions=[];for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[Math.cos(PI2*i/NUM_SEGMENTS),Math.sin(PI2*i/NUM_SEGMENTS),0])}return new _luma.Model(_extends({gl:gl,id:"scatterplot"},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec4 instancePositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radius;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec3 center = project_position(instancePositions.xyz);\n  vec3 vertex = positions * project_scale(radius * instancePositions.w);\n  gl_Position = project_to_clipspace(vec4(center + vertex, 1.0));\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getPosition=_props.getPosition,getRadius=_props.getRadius;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);var radius=getRadius(point)||1;value[i+0]=position[0]||0;value[i+1]=position[1]||0;value[i+2]=position[2]||0;value[i+3]=radius||1;i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props2=this.props,data=_props2.data,getColor=_props2.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var color=getColor(point);value[i+0]=color[0]||0;value[i+1]=color[1]||0;value[i+2]=color[2]||0;value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}]);return ScatterplotLayer}(_lib.Layer);ScatterplotLayer.layerName="ScatterplotLayer";exports.default=ScatterplotLayer},{"../../../lib":541,"../../../shader-utils":552,"luma.gl":387}],527:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _screenGridLayer=require("./screen-grid-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_screenGridLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./screen-grid-layer":528}],528:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ScreenGridLayer=function(_Layer){_inherits(ScreenGridLayer,_Layer);function ScreenGridLayer(opts){_classCallCheck(this,ScreenGridLayer);return _possibleConstructorReturn(this,(ScreenGridLayer.__proto__||Object.getPrototypeOf(ScreenGridLayer)).call(this,_extends({unitWidth:100,unitHeight:100,minColor:[0,0,0,255],maxColor:[0,255,0,255],getPosition:function getPosition(d){return d.position},getWeight:function getWeight(d){return 1}},opts)))}_createClass(ScreenGridLayer,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCount:{size:1,update:this.calculateInstanceCount}});var gl=this.context.gl;this.setState({model:this.getModel(gl)})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var cellSizeChanged=props.unitWidth!==oldProps.unitWidth||props.unitHeight!==oldProps.unitHeight;if(cellSizeChanged||changeFlags.viewportChanged){this.updateCell()}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var _props=this.props,minColor=_props.minColor,maxColor=_props.maxColor;var _state=this.state,model=_state.model,cellScale=_state.cellScale,maxCount=_state.maxCount;var gl=this.context.gl;gl.depthMask(true);model.render(_extends({},uniforms,{minColor:minColor,maxColor:maxColor,cellScale:cellScale,maxCount:maxCount}))}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the grid-layer */\n#define SHADER_NAME grid-layer-vs\n\n// #pragma glslify: preproject = require(../../../../shaderlib/preproject)\n// #pragma glslify: scale = require(../../../../shaderlib/scale)\n// #pragma glslify: project = require(../../../../shaderlib/project)\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute float instanceCount;\nattribute vec3 instancePickingColors;\n\nuniform float maxCount;\nuniform float opacity;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float renderPickingBuffer;\nuniform vec3 cellScale;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 color = mix(minColor, maxColor, instanceCount / maxCount) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the grid-layer */\n#define SHADER_NAME grid-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n'}),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}),isInstanced:true}))}},{key:"updateCell",value:function updateCell(){var _context$viewport=this.context.viewport,width=_context$viewport.width,height=_context$viewport.height;var _props2=this.props,unitWidth=_props2.unitWidth,unitHeight=_props2.unitHeight;var MARGIN=2;var cellScale=new Float32Array([(unitWidth-MARGIN)/width*2,-(unitHeight-MARGIN)/height*2,1]);var numCol=Math.ceil(width/unitWidth);var numRow=Math.ceil(height/unitHeight);this.setState({cellScale:cellScale,numCol:numCol,numRow:numRow,numInstances:numCol*numRow});var attributeManager=this.state.attributeManager;attributeManager.invalidateAll()}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute,_ref3){var numInstances=_ref3.numInstances;var _context$viewport2=this.context.viewport,width=_context$viewport2.width,height=_context$viewport2.height;var _props3=this.props,unitWidth=_props3.unitWidth,unitHeight=_props3.unitHeight;var numCol=this.state.numCol;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var x=i%numCol;var y=Math.floor(i/numCol);value[i*size+0]=x*unitWidth/width*2-1;value[i*size+1]=1-y*unitHeight/height*2;value[i*size+2]=0}}},{key:"calculateInstanceCount",value:function calculateInstanceCount(attribute){var _props4=this.props,data=_props4.data,unitWidth=_props4.unitWidth,unitHeight=_props4.unitHeight,getPosition=_props4.getPosition,getWeight=_props4.getWeight;var _state2=this.state,numCol=_state2.numCol,numRow=_state2.numRow;var value=attribute.value;var maxCount=0;value.fill(0);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var pixel=this.project(getPosition(point));var colId=Math.floor(pixel[0]/unitWidth);var rowId=Math.floor(pixel[1]/unitHeight);if(colId>=0&&colId<numCol&&rowId>=0&&rowId<numRow){var i=colId+rowId*numCol;value[i]+=getWeight(point);if(value[i]>maxCount){maxCount=value[i]}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.setState({maxCount:maxCount})}}]);return ScreenGridLayer}(_lib.Layer);ScreenGridLayer.layerName="ScreenGridLayer";exports.default=ScreenGridLayer},{"../../../lib":541,"../../../shader-utils":552,"luma.gl":387}],529:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color};var ArcLayer64=function(_Layer){_inherits(ArcLayer64,_Layer);function ArcLayer64(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getSourceColor=_ref.getSourceColor,getSourceColor=_ref$getSourceColor===undefined?defaultGetColor:_ref$getSourceColor,_ref$getTargetColor=_ref.getTargetColor,getTargetColor=_ref$getTargetColor===undefined?defaultGetColor:_ref$getTargetColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getSourceColor","getTargetColor","strokeWidth"]);_classCallCheck(this,ArcLayer64);return _possibleConstructorReturn(this,(ArcLayer64.__proto__||Object.getPrototypeOf(ArcLayer64)).call(this,_extends({getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getSourceColor:getSourceColor,getTargetColor:getTargetColor,strokeWidth:strokeWidth},props)))}_createClass(ArcLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceSourceColors},instanceTargetColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceTargetColors},instanceSourcePositionsFP64:{size:4,update:this.calculateInstanceSourcePositions},instanceTargetPositionsFP64:{size:4,update:this.calculateInstanceTargetPositions}});this.setState({model:this.createModel(gl)})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"createModel",value:function createModel(gl){var positions=[];var NUM_SEGMENTS=50;for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[i,i,i])}return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-64-vertex-shader\n\nconst float N = 49.0;\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceSourcePositionsFP64;\nattribute vec4 instanceTargetPositionsFP64;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\n\nvoid main(void) {\n  vec2 projectedSourceCoord[2];\n  project_position_fp64(instanceSourcePositionsFP64, projectedSourceCoord);\n  vec2 projectedTargetCoord[2];\n  project_position_fp64(instanceTargetPositionsFP64, projectedTargetCoord);\n\n  float segmentRatio = smoothstep(0.0, 1.0, positions.x / N);\n\n  vec2 mixed_temp[2];\n\n  vec2_mix_fp64(projectedSourceCoord, projectedTargetCoord, segmentRatio, mixed_temp);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = mixed_temp[0];\n  vertex_pos_modelspace[1] = mixed_temp[1];\n\n  vec2 vertex_height = paraboloid_fp64(projectedSourceCoord, projectedTargetCoord, segmentRatio);\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) vertex_height = vec2(0.0, 0.0);\n\n  vertex_pos_modelspace[2] = sqrt_fp64(vertex_height);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n',
fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var _fp64ify=(0,_fp.fp64ify)(sourcePosition[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(sourcePosition[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);var _fp64ify5=(0,_fp.fp64ify)(targetPosition[0]);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];var _fp64ify7=(0,_fp.fp64ify)(targetPosition[1]);var _fp64ify8=_slicedToArray(_fp64ify7,2);value[i+2]=_fp64ify8[0];value[i+3]=_fp64ify8[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceSourceColors",value:function calculateInstanceSourceColors(attribute){var _props3=this.props,data=_props3.data,getSourceColor=_props3.getSourceColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getSourceColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceTargetColors",value:function calculateInstanceTargetColors(attribute){var _props4=this.props,data=_props4.data,getTargetColor=_props4.getTargetColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getTargetColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return ArcLayer64}(_lib.Layer);ArcLayer64.layerName="ArcLayer64";exports.default=ArcLayer64},{"../../../lib":541,"../../../lib/utils/fp64":547,"../../../shader-utils":552,"luma.gl":387}],530:[function(require,module,exports){arguments[4][519][0].apply(exports,arguments)},{"./arc-layer":529,dup:519}],531:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _geojsonNormalize=require("geojson-normalize");var _geojsonNormalize2=_interopRequireDefault(_geojsonNormalize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultGetColor=function defaultGetColor(feature){return feature.properties.color};var ChoroplethLayer64=function(_Layer){_inherits(ChoroplethLayer64,_Layer);function ChoroplethLayer64(props){_classCallCheck(this,ChoroplethLayer64);return _possibleConstructorReturn(this,(ChoroplethLayer64.__proto__||Object.getPrototypeOf(ChoroplethLayer64)).call(this,_extends({getColor:defaultGetColor,drawCountour:false,strokeWidth:1},props)))}_createClass(ChoroplethLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.addDynamic({indices:{size:1,update:this.calculateIndices,isIndexed:true},positionsFP64:{size:4,update:this.calculatePositionsFP64},heightsFP64:{size:2,update:this.calculateHeightsFP64},colors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateColors},pickingColors:{size:3,update:this.calculatePickingColors,noAlloc:true}});var IndexType=gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array;this.setState({model:this.getModel(gl),numInstances:0,IndexType:IndexType})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.state.choropleths=extractChoropleths(props.data);attributeManager.invalidateAll()}if(oldProps.opacity!==props.opacity){this.setUniforms({opacity:props.opacity})}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"pick",value:function pick(opts){_get(ChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer64.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getModel",value:function getModel(gl){return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME choropleth-layer-64-vertex-shader\n\nattribute vec4 positionsFP64;\nattribute vec2 heightsFP64;\n\nattribute vec3 positions;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n  vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n  vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n  return mix(color4, pickingColor4, renderPickingBuffer);\n}\n\nvoid main(void) {\n  // For some reason, need to add one to elevation to show up in untilted mode\n  vec2 projectedCoord[2];\n  project_position_fp64(positionsFP64, projectedCoord);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = projectedCoord[0];\n  vertex_pos_modelspace[1] = projectedCoord[1];\n  vertex_pos_modelspace[2] = heightsFP64;\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(pickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME choropleth-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}),{geometry:new _luma.Geometry({drawMode:this.props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this2=this;var offsets=this.state.choropleths.reduce(function(acc,choropleth){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+choropleth.reduce(function(count,polygon){return count+polygon.length},0)])},[0]);var IndexType=this.state.IndexType;if(IndexType===Uint16Array&&offsets[offsets.length-1]>65535){throw new Error("Vertex count exceeds browser's limit")}var indices=this.state.choropleths.map(function(choropleth,choroplethIndex){return _this2.props.drawContour?calculateContourIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]}):calculateSurfaceIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new IndexType((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositionsFP64",value:function calculatePositionsFP64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*4);for(var index=0;index<vertices.length/3;index++){var _fp64ify=(0,_fp.fp64ify)(vertices[index*3]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[index*4]=_fp64ify2[0];attribute.value[index*4+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(vertices[index*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);attribute.value[index*4+2]=_fp64ify4[0];attribute.value[index*4+3]=_fp64ify4[1]}}},{key:"calculateHeightsFP64",value:function calculateHeightsFP64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*2);for(var index=0;index<vertices.length/3;index++){var _fp64ify5=(0,_fp.fp64ify)(vertices[index*3+2]);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[index*2]=_fp64ify6[0];attribute.value[index*2+1]=_fp64ify6[1]}}},{key:"calculateColors",value:function calculateColors(attribute){var _props=this.props,features=_props.data.features,getColor=_props.getColor;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var feature=features[choropleth.featureIndex];var color=getColor(feature)||DEFAULT_COLOR;if(isNaN(color[3])){color[3]=DEFAULT_COLOR[3]}return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this3=this;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var featureIndex=choropleth.featureIndex;var color=_this3.props.drawContour?_this3.nullPickingColor():_this3.encodePickingColor(featureIndex);return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_lodash2.default)(colors))}}]);return ChoroplethLayer64}(_lib.Layer);ChoroplethLayer64.layerName="ChoroplethLayer64";exports.default=ChoroplethLayer64;function extractChoropleths(data){var normalizedGeojson=(0,_geojsonNormalize2.default)(data);var result=[];normalizedGeojson.features.map(function(feature,featureIndex){var choropleths=featureToChoropleths(feature);choropleths.forEach(function(choropleth){choropleth.featureIndex=featureIndex});result.push.apply(result,_toConsumableArray(choropleths))});return result}function featureToChoropleths(feature){var _feature$geometry=feature.geometry,coordinates=_feature$geometry.coordinates,type=_feature$geometry.type;var choropleths=void 0;switch(type){case"MultiPolygon":choropleths=coordinates;break;case"Polygon":choropleths=[coordinates];break;case"LineString":choropleths=[[coordinates]];break;case"MultiLineString":choropleths=coordinates.map(function(coords){return[coords]});break;default:choropleths=[]}return choropleths.map(function(choropleth){return choropleth.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],coordinate[2]||0]})})})}function calculateContourIndices(choropleth){var offset=0;return choropleth.reduce(function(acc,polygon){var numVertices=polygon.length;var indices=[].concat(_toConsumableArray(acc),[offset]);for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset+numVertices-1);offset+=numVertices;return indices},[])}function calculateSurfaceIndices(choropleth){var holes=null;if(choropleth.length>1){holes=choropleth.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,choropleth.length)}return(0,_earcut2.default)((0,_lodash2.default)(choropleth),holes,3)}},{"../../../lib":541,"../../../lib/utils/fp64":547,"../../../shader-utils":552,earcut:321,"geojson-normalize":324,"lodash.flattendeep":363,"luma.gl":387}],532:[function(require,module,exports){arguments[4][521][0].apply(exports,arguments)},{"./choropleth-layer":531,dup:521}],533:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _glMatrix=require("gl-matrix");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ExtrudedChoroplethLayer64=function(_Layer){_inherits(ExtrudedChoroplethLayer64,_Layer);function ExtrudedChoroplethLayer64(_ref){var _ref$opacity=_ref.opacity,opacity=_ref$opacity===undefined?1:_ref$opacity,_ref$elevation=_ref.elevation,elevation=_ref$elevation===undefined?1:_ref$elevation,props=_objectWithoutProperties(_ref,["opacity","elevation"]);_classCallCheck(this,ExtrudedChoroplethLayer64);return _possibleConstructorReturn(this,(ExtrudedChoroplethLayer64.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64)).call(this,_extends({opacity:opacity,elevation:elevation},props)))}_createClass(ExtrudedChoroplethLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;var _props=this.props,elevation=_props.elevation,color=_props.color,ambientColor=_props.ambientColor,pointLightColor=_props.pointLightColor,pointLightLocation=_props.pointLightLocation,pointLightAmbientCoefficient=_props.pointLightAmbientCoefficient,pointLightAttenuation=_props.pointLightAttenuation,materialSpecularColor=_props.materialSpecularColor,materialShininess=_props.materialShininess;attributeManager.addDynamic({indices:{size:1,0:"index",isIndexed:true},positions:{size:4,0:"x",2:"y"},heights:{size:2,0:"height"},normals:{size:3,0:"x",1:"y",2:"z"},colors:{size:3,0:"red",1:"green",2:"blue"}},{indices:{update:this.calculateIndices},positions:{update:this.calculatePositions},heights:{update:this.calculateHeights},colors:{update:this.calculateColors},normals:{update:this.calculateNormals}});this.setState({numInstances:0,model:this.getModel(gl)});this.setUniforms({elevation:Number.isFinite(elevation)?elevation:1,colors:color||[180,180,200],uAmbientColor:ambientColor||[255,255,255],uPointLightAmbientCoefficient:pointLightAmbientCoefficient||.1,uPointLightLocation:pointLightLocation||[40.4406,-79.9959,100],uPointLightColor:pointLightColor||[255,255,255],uPointLightAttenuation:pointLightAttenuation||1,uMaterialSpecularColor:materialSpecularColor||[255,255,255],uMaterialShininess:materialShininess||1})}},{key:"updateState",value:function updateState(_ref2){var changeFlags=_ref2.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.extractExtrudedChoropleth();attributeManager.invalidateAll()}}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;this.state.model.render(_extends({},uniforms))}},{key:"pick",value:function pick(opts){_get(ExtrudedChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64.prototype),"pick",this).call(this,opts);var info=opts.info;var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature}},{key:"getModel",value:function getModel(gl){if(!gl.getExtension("OES_element_index_uint")){throw new Error("Extruded choropleth layer needs 32 bit indices")}gl.enable(_luma.GL.DEPTH_TEST);gl.depthFunc(_luma.GL.LEQUAL);return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:"#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// import MATH_FP64 from '../shaderlib/fp64/math-fp64';\n// import PROJECT from '../shaderlib/project';\n// import LIGHTING from '../shaderlib/lighting';\n// /* vertex shader for the choropleth-layer */\n// export default `\\\n#define SHADER_NAME extruded-choropleths-layer-vertex-shader\n\nuniform float opacity;\nuniform vec3 colors;\nuniform float elevation;\n\nuniform vec3 uAmbientColor;\nuniform float uPointLightAmbientCoefficient;\nuniform vec3 uPointLightLocation;\nuniform vec3 uPointLightColor;\nuniform float uPointLightAttenuation;\n\nuniform vec3 uMaterialSpecularColor;\nuniform float uMaterialShininess;\n\nattribute vec4 positions;\nattribute vec2 heights;\nattribute vec3 normals;\n\nvarying vec4 vColor;\n\nvec3 applyLighting(vec3 position_modelspace, vec3 normal_modelspace, vec3 color) {\n\n  vec3 pointLightLocation_modelspace = vec3(project_position(uPointLightLocation));\n  vec3 lightDirection = normalize(pointLightLocation_modelspace - position_modelspace);\n\n  vec3 ambient = uPointLightAmbientCoefficient * color / 255.0 * uAmbientColor / 255.0;\n\n  float diffuseCoefficient = max(dot(normal_modelspace, lightDirection), 0.0);\n  vec3 diffuse = diffuseCoefficient * uPointLightColor / 255. * color / 255.;\n\n  return ambient + uPointLightAttenuation * diffuse;\n}\n\nvoid main(void) {\n  vec2 projected_xy[2];\n  project_position_fp64(positions, projected_xy);\n  vec2 scaled_height = mul_fp64(heights, vec2(projectionPixelsPerUnit.x * elevation, 0.0));\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_xy[0];\n  vertex_pos_modelspace[1] = projected_xy[1];\n  vertex_pos_modelspace[2] = sum_fp64(scaled_height, vec2(1.0, 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec3 color = applyLighting(\n  \tvec3(\n  \t  vertex_pos_modelspace[0].x,\n  \t  vertex_pos_modelspace[1].x,\n  \t  vertex_pos_modelspace[2].x),\n  \tnormals,\n  \tcolors\n  );\n  vColor = vec4(color, opacity);\n}\n// `;\n",fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the building-layer */\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n// `;\n',fp64:true,project64:true}),{geometry:new _luma.Geometry({drawMode:this.props.drawWireframe?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true}))}},{key:"calculatePositions",value:function calculatePositions(attribute){var _this2=this;var positions=this.state.positions;if(!positions){positions=(0,_lodash2.default)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this2.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*4);for(var i=0;i<positions.length/3;i++){var _fp64ify=(0,_fp.fp64ify)(positions[i*3+0]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[i*4+0]=_fp64ify2[0];attribute.value[i*4+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(positions[i*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);
attribute.value[i*4+2]=_fp64ify4[0];attribute.value[i*4+3]=_fp64ify4[1]}}},{key:"calculateHeights",value:function calculateHeights(attribute){var _this3=this;var positions=this.state.positions;if(!positions){positions=(0,_lodash2.default)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this3.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*2);for(var i=0;i<positions.length/3;i++){var _fp64ify5=(0,_fp.fp64ify)(positions[i*3+2]+.1);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[i*2+0]=_fp64ify6[0];attribute.value[i*2+1]=_fp64ify6[1]}}},{key:"calculateNormals",value:function calculateNormals(attribute){var _this4=this;var up=[0,1,0];var normals=this.state.groupedVertices.map(function(vertices,buildingIndex){var topNormals=new Array(countVertices(vertices)).fill(up);var sideNormals=vertices.map(function(polygon){return _this4.calculateSideNormals(polygon)});var sideNormalsForward=sideNormals.map(function(n){return n[0]});var sideNormalsBackward=sideNormals.map(function(n){return n[1]});return _this4.props.drawWireframe?[topNormals,topNormals]:[topNormals,sideNormalsForward,sideNormalsBackward,sideNormalsForward,sideNormalsBackward]});attribute.value=new Float32Array((0,_lodash2.default)(normals))}},{key:"calculateSideNormals",value:function calculateSideNormals(vertices){var numVertices=vertices.length;var normals=[];for(var i=0;i<numVertices-1;i++){var n=getNormal(vertices[i],vertices[i+1]);normals.push(n)}return[[].concat(normals,[normals[0]]),[normals[0]].concat(normals)]}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this5=this;var multiplier=this.props.drawWireframe?2:5;var offsets=this.state.groupedVertices.reduce(function(acc,vertices){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+countVertices(vertices)*multiplier])},[0]);var indices=this.state.groupedVertices.map(function(vertices,buildingIndex){return _this5.props.drawWireframe?_this5.calculateContourIndices(vertices,offsets[buildingIndex]):_this5.calculateSurfaceIndices(vertices,offsets[buildingIndex])});attribute.value=new Uint32Array((0,_lodash2.default)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculateColors",value:function calculateColors(attribute){var _this6=this;var colors=this.state.groupedVertices.map(function(vertices,buildingIndex){var color=_this6.props.color;var baseColor=Array.isArray(color)?color[0]:color;var topColor=Array.isArray(color)?color[color.length-1]:color;var numVertices=countVertices(vertices);var topColors=new Array(numVertices).fill(topColor);var baseColors=new Array(numVertices).fill(baseColor);return _this6.props.drawWireframe?[topColors,baseColors]:[topColors,topColors,topColors,baseColors,baseColors]});attribute.value=new Float32Array((0,_lodash2.default)(colors))}},{key:"extractExtrudedChoropleth",value:function extractExtrudedChoropleth(){var _this7=this;var data=this.props.data;this.state.buildings=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var _state$buildings;var building=_step.value;var properties=building.properties,_building$geometry=building.geometry,coordinates=_building$geometry.coordinates,type=_building$geometry.type;if(!properties.height){properties.height=Math.random()*1e3}switch(type){case"MultiPolygon":var buildings=coordinates.map(function(coords){return{coordinates:coords,properties:properties}});(_state$buildings=_this7.state.buildings).push.apply(_state$buildings,_toConsumableArray(buildings));break;case"Polygon":_this7.state.buildings.push({coordinates:coordinates,properties:properties});break;default:}};for(var _iterator=data.features[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.state.groupedVertices=this.state.buildings.map(function(building){return building.coordinates.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],building.properties.height||10]})})})}},{key:"calculateContourIndices",value:function calculateContourIndices(vertices,offset){var stride=countVertices(vertices);return vertices.map(function(polygon){var indices=[offset];var numVertices=polygon.length;for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset);for(var _i=0;_i<numVertices-1;_i++){indices.push(_i+offset,_i+stride+offset)}offset+=numVertices;return indices})}},{key:"calculateSurfaceIndices",value:function calculateSurfaceIndices(vertices,offset){var stride=countVertices(vertices);var holes=null;var quad=[[0,1],[0,3],[1,2],[1,2],[0,3],[1,4]];if(vertices.length>1){holes=vertices.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,vertices.length)}var topIndices=(0,_earcut2.default)((0,_lodash2.default)(vertices),holes,3).map(function(index){return index+offset});var sideIndices=vertices.map(function(polygon){var numVertices=polygon.length;var indices=[];for(var i=0;i<numVertices-1;i++){indices.push.apply(indices,_toConsumableArray(drawRectangle(i)))}offset+=numVertices;return indices});return[topIndices,sideIndices];function drawRectangle(i){return quad.map(function(v){return i+v[0]+stride*v[1]+offset})}}}]);return ExtrudedChoroplethLayer64}(_lib.Layer);ExtrudedChoroplethLayer64.layerName="ExtrudedChoroplethLayer64";exports.default=ExtrudedChoroplethLayer64;function getNormal(p1,p2){if(p1[0]===p2[0]&&p1[1]===p2[1]){return[1,0,0]}var degrees2radians=Math.PI/180;var lon1=degrees2radians*p1[0];var lon2=degrees2radians*p2[0];var lat1=degrees2radians*p1[1];var lat2=degrees2radians*p2[1];var a=Math.sin(lon2-lon1)*Math.cos(lat2);var b=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);return _glMatrix.vec3.normalize([],[b,0,-a])}function countVertices(vertices){return vertices.reduce(function(count,polygon){return count+polygon.length},0)}},{"../../../lib":541,"../../../lib/utils/fp64":547,"../../../shader-utils":552,earcut:321,"gl-matrix":337,"lodash.flattendeep":363,"luma.gl":387}],534:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extrudedChoroplethLayer=require("./extruded-choropleth-layer");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_extrudedChoroplethLayer).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./extruded-choropleth-layer":533}],535:[function(require,module,exports){"use strict";var _scatterplotLayer=require("./scatterplot-layer");var _scatterplotLayer2=_interopRequireDefault(_scatterplotLayer);var _arcLayer=require("./arc-layer");var _arcLayer2=_interopRequireDefault(_arcLayer);var _choroplethLayer=require("./choropleth-layer");var _choroplethLayer2=_interopRequireDefault(_choroplethLayer);var _extrudedChoroplethLayer=require("./extruded-choropleth-layer");var _extrudedChoroplethLayer2=_interopRequireDefault(_extrudedChoroplethLayer);var _lineLayer=require("./line-layer");var _lineLayer2=_interopRequireDefault(_lineLayer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports={ScatterplotLayer64:_scatterplotLayer2.default,ArcLayer64:_arcLayer2.default,ChoroplethLayer64:_choroplethLayer2.default,ExtrudedChoroplethLayer64:_extrudedChoroplethLayer2.default,LineLayer64:_lineLayer2.default}},{"./arc-layer":530,"./choropleth-layer":532,"./extruded-choropleth-layer":534,"./line-layer":536,"./scatterplot-layer":538}],536:[function(require,module,exports){arguments[4][523][0].apply(exports,arguments)},{"./line-layer":537,dup:523}],537:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,255,0,255];var defaultGetSourcePosition=function defaultGetSourcePosition(x){return x.sourcePosition};var defaultGetTargetPosition=function defaultGetTargetPosition(x){return x.targetPosition};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var LineLayer64=function(_Layer){_inherits(LineLayer64,_Layer);function LineLayer64(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$getSourcePositio=_ref.getSourcePosition,getSourcePosition=_ref$getSourcePositio===undefined?defaultGetSourcePosition:_ref$getSourcePositio,_ref$getTargetPositio=_ref.getTargetPosition,getTargetPosition=_ref$getTargetPositio===undefined?defaultGetTargetPosition:_ref$getTargetPositio,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,opts=_objectWithoutProperties(_ref,["getSourcePosition","getTargetPosition","getColor","strokeWidth"]);_classCallCheck(this,LineLayer64);return _possibleConstructorReturn(this,(LineLayer64.__proto__||Object.getPrototypeOf(LineLayer64)).call(this,_extends({strokeWidth:strokeWidth,getSourcePosition:getSourcePosition,getTargetPosition:getTargetPosition,getColor:getColor},opts)))}_createClass(LineLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this.createModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourcePositionsFP64:{size:4,update:this.calculateInstanceSourcePositions},instanceTargetPositionsFP64:{size:4,update:this.calculateInstanceTargetPositions},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"createModel",value:function createModel(gl){var positions=[0,0,0,1,1,1];return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-64-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceColors;\nattribute vec4 instanceSourcePositionsFP64;\nattribute vec4 instanceTargetPositionsFP64;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec2 projectedSourceCoord[2];\n  project_position_fp64(instanceSourcePositionsFP64, projectedSourceCoord);\n  vec2 projectedTargetCoord[2];\n  project_position_fp64(instanceTargetPositionsFP64, projectedTargetCoord);\n\n  float segmentIndex = positions.x;\n  vec2 mixed_temp[2];\n\n  vec2_mix_fp64(projectedSourceCoord, projectedTargetCoord, segmentIndex, mixed_temp);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = mixed_temp[0];\n  vertex_pos_modelspace[1] = mixed_temp[1];\n  vertex_pos_modelspace[2] = vec2(0.0, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',fp64:true,project64:true}),{geometry:new _luma.Geometry({drawMode:_luma.GL.LINE_STRIP,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var _fp64ify=(0,_fp.fp64ify)(sourcePosition[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(sourcePosition[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);var _fp64ify5=(0,_fp.fp64ify)(targetPosition[0]);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];var _fp64ify7=(0,_fp.fp64ify)(targetPosition[1]);var _fp64ify8=_slicedToArray(_fp64ify7,2);value[i+2]=_fp64ify8[0];value[i+3]=_fp64ify8[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props3=this.props,data=_props3.data,getColor=_props3.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return LineLayer64}(_lib.Layer);LineLayer64.layerName="LineLayer64";exports.default=LineLayer64},{"../../../lib":541,"../../../lib/utils/fp64":547,"../../../shader-utils":552,"luma.gl":387}],538:[function(require,module,exports){arguments[4][525][0].apply(exports,arguments)},{"./scatterplot-layer":539,dup:525}],539:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[255,0,255,255];var defaultGetPosition=function defaultGetPosition(x){return x.position};var defaultGetRadius=function defaultGetRadius(x){return x.radius};var defaultGetColor=function defaultGetColor(x){return x.color||DEFAULT_COLOR};var ScatterplotLayer64=function(_Layer){_inherits(ScatterplotLayer64,_Layer);function ScatterplotLayer64(_ref){var _ref$getPosition=_ref.getPosition,getPosition=_ref$getPosition===undefined?defaultGetPosition:_ref$getPosition,_ref$getRadius=_ref.getRadius,getRadius=_ref$getRadius===undefined?defaultGetRadius:_ref$getRadius,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?defaultGetColor:_ref$getColor,_ref$radius=_ref.radius,radius=_ref$radius===undefined?30:_ref$radius,_ref$drawOutline=_ref.drawOutline,drawOutline=_ref$drawOutline===undefined?false:_ref$drawOutline,_ref$strokeWidth=_ref.strokeWidth,strokeWidth=_ref$strokeWidth===undefined?1:_ref$strokeWidth,props=_objectWithoutProperties(_ref,["getPosition","getRadius","getColor","radius","drawOutline","strokeWidth"]);_classCallCheck(this,ScatterplotLayer64);return _possibleConstructorReturn(this,(ScatterplotLayer64.__proto__||Object.getPrototypeOf(ScatterplotLayer64)).call(this,_extends({getPosition:getPosition,getRadius:getRadius,getColor:getColor,radius:radius,drawOutline:drawOutline,strokeWidth:strokeWidth},props)))}_createClass(ScatterplotLayer64,[{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;this.setState({model:this.getModel(gl)});attributeManager.addInstanced({instancePositionsFP64:{size:4,update:this.calculateInstancePositions},instanceRadius:{size:1,update:this.calculateInstanceRadius},layerHeight:{size:2,update:this.calculateLayerHeight},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateInstanceColors}})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;this.calculateZoomRadius();this.state.model.render(_extends({},uniforms,{zoomRadiusFP64:this.state.zoomRadiusFP64}))}},{key:"getModel",value:function getModel(gl){var NUM_SEGMENTS=16;var PI2=Math.PI*2;var positions=[];for(var i=0;i<NUM_SEGMENTS;i++){positions=[].concat(_toConsumableArray(positions),[Math.cos(PI2*i/NUM_SEGMENTS),Math.sin(PI2*i/NUM_SEGMENTS),0])}return new _luma.Model(_extends({gl:gl,id:this.props.id},(0,_shaderUtils.assembleShaders)(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME scatterplot-layer-64-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instancePositionsFP64;\nattribute vec2 layerHeight;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Only one-dimensional arrays may be declared in GLSL ES 1.0. specs p.24\nuniform float opacity;\nuniform vec2 zoomRadiusFP64;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  // For some reason, need to add one to elevation to show up in untilted mode\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositionsFP64, projected_coord_xy);\n\n  vec2 pos_mul_radius[4];\n  vec4_fp64(vec4(positions * instanceRadius, 0.0), pos_mul_radius);\n\n  vec2 vertex_pos_localspace[4];\n  vec4_scalar_mul_fp64(pos_mul_radius, zoomRadiusFP64, vertex_pos_localspace);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vertex_pos_localspace[0], projected_coord_xy[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vertex_pos_localspace[1], projected_coord_xy[1]);\n  vertex_pos_modelspace[2] = sum_fp64(vertex_pos_localspace[2], vec2(layerHeight.x + 1.0, layerHeight.y));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n',fs:'// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n\n',fp64:true,project64:true}),{geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true}))}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getPosition=_props.getPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);var _fp64ify=(0,_fp.fp64ify)(position[0]);var _fp64ify2=_slicedToArray(_fp64ify,2);value[i+0]=_fp64ify2[0];value[i+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(position[1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);value[i+2]=_fp64ify4[0];value[i+3]=_fp64ify4[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateLayerHeight",value:function calculateLayerHeight(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point);var _fp64ify5=(0,_fp.fp64ify)(position[2]);var _fp64ify6=_slicedToArray(_fp64ify5,2);value[i+0]=_fp64ify6[0];value[i+1]=_fp64ify6[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceRadius",value:function calculateInstanceRadius(attribute){var _props3=this.props,data=_props3.data,getRadius=_props3.getRadius;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var radius=getRadius(point)||1;value[i+0]=radius;i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;
var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var point=_step4.value;var color=getColor(point);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?DEFAULT_COLOR[3]:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"calculateZoomRadius",value:function calculateZoomRadius(){var pixel0=this.projectFlat([-122,37.5]);var pixel1=this.projectFlat([-122,37.5002]);var dx=pixel0[0]-pixel1[0];var dy=pixel0[1]-pixel1[1];var radius=Math.max(Math.sqrt(dx*dx+dy*dy),2);this.state.zoomRadiusFP64=(0,_fp.fp64ify)(radius)}}]);return ScatterplotLayer64}(_lib.Layer);ScatterplotLayer64.layerName="ScatterplotLayer64";exports.default=ScatterplotLayer64},{"../../../lib":541,"../../../lib/utils/fp64":547,"../../../shader-utils":552,"luma.gl":387}],540:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _luma=require("luma.gl");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var AttributeManager=function(){function AttributeManager(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$id=_ref.id,id=_ref$id===undefined?"attribute-manager":_ref$id,otherProps=_objectWithoutProperties(_ref,["id"]);_classCallCheck(this,AttributeManager);this.id=id;this.attributes={};this.allocedInstances=-1;this.needsRedraw=true;this.userData={};this.onUpdateStart=noop;this.onUpdateEnd=noop;this.onLog=this._defaultLog;Object.seal(this)}_createClass(AttributeManager,[{key:"add",value:function add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"invalidate",value:function invalidate(attributeName){var attributes=this.attributes;var attribute=attributes[attributeName];(0,_assert2.default)(attribute);attribute.needsUpdate=true;this.onLog(1,"invalidated attribute "+attributeName+" for "+this.id)}},{key:"invalidateAll",value:function invalidateAll(){var attributes=this.attributes;for(var attributeName in attributes){this.invalidate(attributeName)}}},{key:"update",value:function update(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref2.data,numInstances=_ref2.numInstances,_ref2$buffers=_ref2.buffers,buffers=_ref2$buffers===undefined?{}:_ref2$buffers,_ref2$props=_ref2.props,props=_ref2$props===undefined?{}:_ref2$props,_ref2$context=_ref2.context,context=_ref2$context===undefined?{}:_ref2$context,opts=_objectWithoutProperties(_ref2,["data","numInstances","buffers","props","context"]);this._checkExternalBuffers(buffers,opts);this._setExternalBuffers(buffers);if(this._analyzeBuffers({numInstances:numInstances})){this.onUpdateStart(this.id);this._updateBuffers({numInstances:numInstances,data:data,props:props,context:context});this.onUpdateEnd(this.id)}}},{key:"setLogFunctions",value:function setLogFunctions(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},onLog=_ref3.onLog,onUpdateStart=_ref3.onUpdateStart,onUpdateEnd=_ref3.onUpdateEnd;this.onLog=onLog!==undefined?onLog:this.onLog;this.onUpdateStart=onUpdateStart!==undefined?onUpdateStart:this.onUpdateStart;this.onUpdateEnd=onUpdateEnd!==undefined?onUpdateEnd:this.onUpdateEnd}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"getChangedAttributes",value:function getChangedAttributes(_ref4){var _ref4$clearChangedFla=_ref4.clearChangedFlags,clearChangedFlags=_ref4$clearChangedFla===undefined?false:_ref4$clearChangedFla;var attributes=this.attributes;var changedAttributes={};for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.changed){attribute.changed=attribute.changed&&!clearChangedFlags;changedAttributes[attributeName]=attribute}}return changedAttributes}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;var redraw=this.needsRedraw;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=true;return this}},{key:"addDynamic",value:function addDynamic(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"addInstanced",value:function addInstanced(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters,{instanced:1})}},{key:"_defaultLog",value:function _defaultLog(level,message){_utils.log.log(level,message)}},{key:"_add",value:function _add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _extraProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var newAttributes={};for(var attributeName in attributes){if(attributeName in updaters){attributes[attributeName]=_extends({},attributes[attributeName],updaters[attributeName])}var attribute=attributes[attributeName];this._validate(attributeName,attribute);var attributeData=_extends({target:undefined,isIndexed:false,userData:{}},attribute,{isExternalBuffer:false,needsAlloc:false,needsUpdate:false,changed:false,size:attribute.size,value:attribute.value||null},_extraProps);Object.seal(attributeData);this.attributes[attributeName]=attributeData}Object.assign(this.attributes,newAttributes)}},{key:"_validate",value:function _validate(attributeName,attribute){(0,_assert2.default)(typeof attribute.size==="number","Attribute definition for "+attributeName+" missing size");(0,_assert2.default)(typeof attribute.update==="function"||attribute.noAlloc,"Attribute updater for "+attributeName+" missing update method")}},{key:"_checkExternalBuffers",value:function _checkExternalBuffers(){var bufferMap=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var attributes=this.attributes;for(var attributeName in bufferMap){var attribute=attributes[attributeName];if(!attribute&&!opts.ignoreUnknownAttributes){throw new Error("Unknown attribute prop "+attributeName)}}}},{key:"_setExternalBuffers",value:function _setExternalBuffers(bufferMap){var attributes=this.attributes,numInstances=this.numInstances;for(var attributeName in attributes){var attribute=attributes[attributeName];var buffer=bufferMap[attributeName];attribute.isExternalBuffer=false;if(buffer){if(!(buffer instanceof Float32Array)){throw new Error("Attribute properties must be of type Float32Array")}if(attribute.auto&&buffer.length<=numInstances*attribute.size){throw new Error("Attribute prop array must match length and size")}attribute.isExternalBuffer=true;attribute.needsUpdate=false;if(attribute.value!==buffer){attribute.value=buffer;attribute.changed=true;this.needsRedraw=true}}}}},{key:"_analyzeBuffers",value:function _analyzeBuffers(_ref6){var numInstances=_ref6.numInstances;var attributes=this.attributes;(0,_assert2.default)(numInstances!==undefined);var needsUpdate=false;for(var attributeName in attributes){var attribute=attributes[attributeName];if(!attribute.isExternalBuffer){var needsAlloc=attribute.value===null||attribute.value.length/attribute.size<numInstances;if(needsAlloc&&attribute.update){attribute.needsAlloc=true;needsUpdate=true}if(attribute.needsUpdate){needsUpdate=true}}}return needsUpdate}},{key:"_updateBuffers",value:function _updateBuffers(_ref7){var numInstances=_ref7.numInstances,data=_ref7.data,props=_ref7.props,context=_ref7.context;var attributes=this.attributes;var allocCount=Math.max(numInstances,1);for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.needsAlloc){var ArrayType=(0,_luma.glArrayFromType)(attribute.type||_luma.GL.FLOAT);attribute.value=new ArrayType(attribute.size*allocCount);this.onLog(2,this.id+":"+attributeName+" allocated "+allocCount);attribute.needsAlloc=false;attribute.needsUpdate=true}if(attribute.needsUpdate){var update=attribute.update;if(update){this.onLog(2,this.id+":"+attributeName+" updating "+numInstances);update.call(context,attribute,{data:data,props:props,numInstances:numInstances})}else{this.onLog(2,this.id+":"+attributeName+" missing update function")}attribute.needsUpdate=false;attribute.changed=true;this.needsRedraw=true}}this.allocedInstances=allocCount}}]);return AttributeManager}();exports.default=AttributeManager},{"./utils":548,assert:4,"luma.gl":387}],541:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerManager=exports.AttributeManager=exports.Layer=undefined;var _layer=require("./layer");Object.defineProperty(exports,"Layer",{enumerable:true,get:function get(){return _interopRequireDefault(_layer).default}});var _attributeManager=require("./attribute-manager");Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _interopRequireDefault(_attributeManager).default}});var _layerManager=require("./layer-manager");Object.defineProperty(exports,"LayerManager",{enumerable:true,get:function get(){return _interopRequireDefault(_layerManager).default}});var _objectIterator=require("./utils/object-iterator");Object.keys(_objectIterator).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _objectIterator[key]}})});require("./init");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./attribute-manager":540,"./init":542,"./layer":544,"./layer-manager":543,"./utils/object-iterator":550}],542:[function(require,module,exports){"use strict";var _package=require("../../package.json");var STARTUP_MESSAGE="set deck.log.priority=2 to trace attribute updates";console.log("deck.gl "+_package.version+" - "+STARTUP_MESSAGE)},{"../../package.json":515}],543:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _layer=require("./layer");var _layer2=_interopRequireDefault(_layer);var _viewport=require("../viewport");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _pickLayers=require("./pick-layers");var _luma=require("luma.gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LayerManager=function(){function LayerManager(_ref){var gl=_ref.gl;_classCallCheck(this,LayerManager);this.prevLayers=[];this.layers=[];this.drewLayers=false;this.oldContext={};this.context={gl:gl,uniforms:{},viewport:null,viewportChanged:true,pickingFBO:null};this.redrawNeeded=true;Object.seal(this.context)}_createClass(LayerManager,[{key:"setContext",value:function setContext(_ref2){var width=_ref2.width,height=_ref2.height,latitude=_ref2.latitude,longitude=_ref2.longitude,zoom=_ref2.zoom,pitch=_ref2.pitch,bearing=_ref2.bearing,altitude=_ref2.altitude;var oldViewport=this.context.viewport;var viewportChanged=!oldViewport||width!==oldViewport.width||height!==oldViewport.height||latitude!==oldViewport.latitude||longitude!==oldViewport.longitude||zoom!==oldViewport.zoom||bearing!==oldViewport.bearing||pitch!==oldViewport.pitch||altitude!==oldViewport.altitude;if(viewportChanged||!this.context.viewport){Object.assign(this.oldContext,this.context);var viewport=new _viewport.Viewport({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude,tileSize:512});this.context.viewport=viewport;this.context.viewportChanged=viewportChanged;this.context.uniforms={};(0,_utils.log)(4,viewport,latitude,longitude,zoom)}return this}},{key:"updateLayers",value:function updateLayers(_ref3){var newLayers=_ref3.newLayers;(0,_assert2.default)(this.context.viewport,"LayerManager.updateLayers: viewport not set");newLayers=newLayers.filter(function(newLayer){return Boolean(newLayer)});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=newLayers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var layer=_step.value;layer.context=this.context}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.prevLayers=this.layers;var _updateLayers2=this._updateLayers({oldLayers:this.prevLayers,newLayers:newLayers}),error=_updateLayers2.error,generatedLayers=_updateLayers2.generatedLayers;this.layers=generatedLayers;if(error){throw error}return this}},{key:"drawLayers",value:function drawLayers(){(0,_assert2.default)(this.context.viewport,"LayerManager.drawLayers: viewport not set");var uniforms=this.context.uniforms;var layerIndex=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.layers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var layer=_step2.value;if(layer.props.visible){layer.drawLayer({uniforms:uniforms,layerIndex:layerIndex});layerIndex++}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return this}},{key:"pickLayer",value:function pickLayer(_ref4){var x=_ref4.x,y=_ref4.y,mode=_ref4.mode;var _context=this.context,gl=_context.gl,uniforms=_context.uniforms;if(this.context.pickingFBO===null||gl.canvas.width!==this.context.pickingFBO.width||gl.canvas.height!==this.context.pickingFBO.height){this.context.pickingFBO=new _luma.FramebufferObject(gl,{width:gl.canvas.width,height:gl.canvas.height})}return(0,_pickLayers.pickLayers)(gl,{x:x,y:y,uniforms:uniforms,layers:this.layers,mode:mode,pickingFBO:this.context.pickingFBO})}},{key:"needsRedraw",value:function needsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;if(!this.context.viewport){return false}var redraw=false;if(this.layers.length===0&&this.drewLayers){redraw=true;return true}if(this.redrawNeeded){this.redrawNeeded=false;redraw=true}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.layers[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var layer=_step3.value;redraw=redraw||layer.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});this.drewLayers=true}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return redraw}},{key:"_updateLayers",value:function _updateLayers(_ref6){var oldLayers=_ref6.oldLayers,newLayers=_ref6.newLayers;var oldLayerMap={};var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=oldLayers[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var oldLayer=_step4.value;if(oldLayerMap[oldLayer.id]){_utils.log.once(0,"Multipe old layers with same id "+layerName(oldLayer))}else{oldLayerMap[oldLayer.id]=oldLayer}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var generatedLayers=[];var error=this._matchSublayers({newLayers:newLayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers});var error2=this._finalizeOldLayers(oldLayers);var firstError=error||error2;return{error:firstError,generatedLayers:generatedLayers}}},{key:"_matchSublayers",value:function _matchSublayers(_ref7){var newLayers=_ref7.newLayers,oldLayerMap=_ref7.oldLayerMap,generatedLayers=_ref7.generatedLayers;newLayers=newLayers.filter(function(newLayer){return Boolean(newLayer)});var error=null;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=newLayers[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var newLayer=_step5.value;newLayer.context=this.context;try{var oldLayer=oldLayerMap[newLayer.id];oldLayerMap[newLayer.id]=null;if(oldLayer===null){_utils.log.once(0,"Multipe new layers with same id "+layerName(newLayer))}if(oldLayer){(0,_utils.log)(3,"matched "+layerName(newLayer),oldLayer,"=>",newLayer);this._transferLayerState(oldLayer,newLayer);this._updateLayer(newLayer)}else{this._initializeNewLayer(newLayer)}generatedLayers.push(newLayer);var sublayers=newLayer.renderLayers();if(sublayers){sublayers=Array.isArray(sublayers)?sublayers:[sublayers];this._matchSublayers({newLayers:sublayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers})}}catch(err){_utils.log.once(0,"deck.gl error during matching of "+layerName(newLayer)+" "+err,err);error=error||err}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}return error}},{key:"_transferLayerState",value:function _transferLayerState(oldLayer,newLayer){var state=oldLayer.state,props=oldLayer.props;(0,_assert2.default)(state,"deck.gl sanity check - Matching layer has no state");(0,_assert2.default)(oldLayer!==newLayer,"deck.gl sanity check - Matching layer is same");newLayer.state=state;state.layer=newLayer;if(state.model){state.model.userData.layer=newLayer}newLayer.oldProps=props;oldLayer.state=null}},{key:"_finalizeOldLayers",value:function _finalizeOldLayers(oldLayers){var error=null;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=oldLayers[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var layer=_step6.value;if(layer.state){error=error||this._finalizeLayer(layer)}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return error}},{key:"_initializeNewLayer",value:function _initializeNewLayer(layer){var error=null;if(!layer.state){(0,_utils.log)(1,"initializing "+layerName(layer));try{layer.initializeLayer({oldProps:{},props:layer.props,oldContext:this.oldContext,context:this.context,changeFlags:layer.diffProps({},layer.props,this.context)})}catch(err){_utils.log.once(0,"deck.gl error during initialization of "+layerName(layer)+" "+err,err);error=error||err}if(layer.state){layer.state.layer=layer}if(layer.state&&layer.state.model){layer.state.model.userData.layer=layer}}return error}},{key:"_updateLayer",value:function _updateLayer(layer){var oldProps=layer.oldProps,props=layer.props;var error=null;if(oldProps){try{layer.updateLayer({oldProps:oldProps,props:props,context:this.context,oldContext:this.oldContext,changeFlags:layer.diffProps(oldProps,layer.props,this.context)})}catch(err){_utils.log.once(0,"deck.gl error during update of "+layerName(layer),err);error=err}(0,_utils.log)(2,"updating "+layerName(layer))}return error}},{key:"_finalizeLayer",value:function _finalizeLayer(layer){var error=null;var state=layer.state;if(state){try{layer.finalizeLayer()}catch(err){_utils.log.once(0,"deck.gl error during finalization of "+layerName(layer),err);error=err}layer.state=null;(0,_utils.log)(1,"finalizing "+layerName(layer))}return error}}]);return LayerManager}();exports.default=LayerManager;function layerName(layer){if(layer instanceof _layer2.default){return""+layer}return!layer?"null layer":"invalid layer"}},{"../viewport":554,"./layer":544,"./pick-layers":545,"./utils":548,assert:4,"luma.gl":387}],544:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _attributeManager=require("./attribute-manager");var _attributeManager2=_interopRequireDefault(_attributeManager);var _luma=require("luma.gl");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_PROPS={data:[],dataIterator:null,dataComparator:null,numInstances:undefined,visible:true,pickable:false,opacity:.8,onHover:function onHover(){},onClick:function onClick(){},getValue:function getValue(x){return x},updateTriggers:{}};var counter=0;var Layer=function(){function Layer(props){_classCallCheck(this,Layer);props=_extends({},DEFAULT_PROPS,props,{data:props.data||[],id:props.id||this.constructor.layerName});this.id=props.id;this.count=counter++;this.props=props;this.oldProps=null;this.state=null;this.context=null;Object.seal(this);this.validateRequiredProp("id",function(x){return typeof x==="string"});this.validateRequiredProp("data");if(props.data){(0,_utils.addIterator)(props.data);if(!props.data[Symbol.iterator]){_utils.log.once(0,"data prop must have iterator")}}this._validateDeprecatedProps()}_createClass(Layer,[{key:"toString",value:function toString(){var className=this.constructor.name;return className!==this.props.id?"<"+className+":'"+this.props.id+"'>":"<"+className+">"}},{key:"initializeState",value:function initializeState(){throw new Error("Layer "+this+" has not defined initializeState")}},{key:"finalizeState",value:function finalizeState(){}},{key:"shouldUpdateState",value:function shouldUpdateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,oldContext=_ref.oldContext,context=_ref.context,changeFlags=_ref.changeFlags;return changeFlags.somethingChanged}},{key:"updateState",value:function updateState(_ref2){var oldProps=_ref2.oldProps,props=_ref2.props,oldContext=_ref2.oldContext,context=_ref2.context,changeFlags=_ref2.changeFlags;if(changeFlags.dataChanged&&this.state.attributeManager){this.state.attributeManager.invalidateAll()}}},{key:"renderLayers",value:function renderLayers(){return null}},{key:"draw",value:function draw(_ref3){var _ref3$uniforms=_ref3.uniforms,uniforms=_ref3$uniforms===undefined?{}:_ref3$uniforms;if(this.state.model){this.state.model.render(uniforms)}}},{key:"pick",value:function pick(_ref4){var info=_ref4.info,uniforms=_ref4.uniforms,pickEnableUniforms=_ref4.pickEnableUniforms,pickDisableUniforms=_ref4.pickDisableUniforms,mode=_ref4.mode;var gl=this.context.gl;var model=this.state.model;if(model){model.setUniforms(pickEnableUniforms);model.render(uniforms);model.setUniforms(pickDisableUniforms);var _info$devicePixel=_slicedToArray(info.devicePixel,2),x=_info$devicePixel[0],y=_info$devicePixel[1];var color=new Uint8Array(4);gl.readPixels(x,y,1,1,_luma.GL.RGBA,_luma.GL.UNSIGNED_BYTE,color);info.index=this.decodePickingColor(color);info.color=color;if(mode==="hover"){var selectedPickingColor=new Float32Array(3);selectedPickingColor[0]=color[0];selectedPickingColor[1]=color[1];selectedPickingColor[2]=color[2];this.setUniforms({selectedPickingColor:selectedPickingColor})}}}},{key:"setState",value:function setState(updateObject){Object.assign(this.state,updateObject);this.state.needsRedraw=true}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.state){this.state.needsRedraw=redraw}}},{key:"project",value:function project(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.project(lngLat)}},{key:"unproject",value:function unproject(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unproject(xy)}},{key:"projectFlat",value:function projectFlat(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.projectFlat(lngLat)}},{key:"unprojectFlat",value:function unprojectFlat(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unprojectFlat(xy)}},{key:"screenToDevicePixels",value:function screenToDevicePixels(screenPixels){var devicePixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;return screenPixels*devicePixelRatio}},{key:"nullPickingColor",value:function nullPickingColor(){return[0,0,0]}},{key:"encodePickingColor",value:function encodePickingColor(i){return[(i+1)%256,Math.floor((i+1)/256)%256,Math.floor((i+1)/256/256)%256]}},{key:"decodePickingColor",value:function decodePickingColor(color){(0,_assert2.default)(color instanceof Uint8Array);var _color=_slicedToArray(color,3),i1=_color[0],i2=_color[1],i3=_color[2];var index=i1+i2*256+i3*65536-1;return index}},{key:"calculateInstancePickingColors",value:function calculateInstancePickingColors(attribute,_ref5){var numInstances=_ref5.numInstances;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var pickingColor=this.encodePickingColor(i);value[i*size+0]=pickingColor[0];value[i*size+1]=pickingColor[1];value[i*size+2]=pickingColor[2]}}},{key:"getFirstObject",value:function getFirstObject(){var data=this.props.data;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;return object}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"getNumInstances",value:function getNumInstances(props){props=props||this.props;if(this.state&&this.state.numInstances!==undefined){return this.state.numInstances}if(props.numInstances!==undefined){return props.numInstances}var _props=props,data=_props.data;if(data&&typeof data.count==="function"){return data.count()}if(data&&data.size!==undefined){return data.size}if(data&&data.length!==undefined){return data.length}throw new Error("Could not deduce numInstances")}},{key:"initializeLayer",value:function initializeLayer(updateParams){(0,_assert2.default)(this.context.gl);(0,_assert2.default)(!this.state);this.state={};this.setState({attributeManager:new _attributeManager2.default({id:this.props.id}),model:null,needsRedraw:true,dataChanged:true});this.state.attributeManager.setLogFunctions(this.props);var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePickingColors:{type:_luma.GL.UNSIGNED_BYTE,size:3,update:this.calculateInstancePickingColors}});this.initializeState();this.updateState(updateParams);this._updateAttributes(this.props);this._updateBaseUniforms();var model=this.state.model;if(model){model.setInstanceCount(this.getNumInstances());model.id=this.props.id;model.program.id=this.props.id+"-program";model.geometry.id=this.props.id+"-geometry";model.setAttributes(attributeManager.getAttributes())}}},{key:"updateLayer",value:function updateLayer(updateParams){if(this.shouldUpdate){_utils.log.once(0,"deck.gl v3 shouldUpdate deprecated. Use shouldUpdateState in "+this)}var stateNeedsUpdate=this.shouldUpdateState(updateParams);if(stateNeedsUpdate){var hasRedefinedMethod=this.willReceiveProps&&this.willReceiveProps!==Layer.prototype.willReceiveProps;if(hasRedefinedMethod){_utils.log.once(0,"deck.gl v3 willReceiveProps deprecated. Use updateState in "+this);var oldProps=updateParams.oldProps,props=updateParams.props,changeFlags=updateParams.changeFlags;this.setState(changeFlags);this.willReceiveProps(oldProps,props,changeFlags);
this.setState({dataChanged:false,viewportChanged:false})}this.updateState(updateParams);this._updateAttributes(updateParams.newProps);this._updateBaseUniforms();if(this.state.model){this.state.model.setInstanceCount(this.getNumInstances())}}}},{key:"finalizeLayer",value:function finalizeLayer(){this.finalizeState()}},{key:"drawLayer",value:function drawLayer(_ref6){var _ref6$uniforms=_ref6.uniforms,uniforms=_ref6$uniforms===undefined?{}:_ref6$uniforms,_ref6$layerIndex=_ref6.layerIndex,layerIndex=_ref6$layerIndex===undefined?0:_ref6$layerIndex;(0,_assert2.default)(this.context.viewport,"Layer missing context.viewport");var viewportUniforms=this.context.viewport.getUniforms(this.props);uniforms=_extends({},uniforms,viewportUniforms,{layerIndex:layerIndex});this.draw({uniforms:uniforms})}},{key:"pickLayer",value:function pickLayer(_ref7){var _ref7$uniforms=_ref7.uniforms,uniforms=_ref7$uniforms===undefined?{}:_ref7$uniforms,opts=_objectWithoutProperties(_ref7,["uniforms"]);var viewportUniforms=this.context.viewport.getUniforms(this.props);uniforms=_extends({},uniforms,viewportUniforms,{renderPickingBuffer:true});return this.pick(_extends({uniforms:uniforms},opts))}},{key:"diffProps",value:function diffProps(oldProps,newProps,context){var propsChangedReason=(0,_utils.compareProps)({newProps:newProps,oldProps:oldProps,ignoreProps:{data:null,updateTriggers:null}});var dataChangedReason=this._diffDataProps(oldProps,newProps);var propsChanged=Boolean(propsChangedReason);var dataChanged=Boolean(dataChangedReason);var viewportChanged=context.viewportChanged;var somethingChanged=propsChanged||dataChanged||viewportChanged;if(!dataChanged){this._diffUpdateTriggers(oldProps,newProps)}else{_utils.log.log(1,"dataChanged: "+dataChanged)}return{propsChanged:propsChanged,dataChanged:dataChanged,viewportChanged:viewportChanged,somethingChanged:somethingChanged,reason:dataChangedReason||propsChangedReason}}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$clearRedrawFlag=_ref8.clearRedrawFlags,clearRedrawFlags=_ref8$clearRedrawFlag===undefined?false:_ref8$clearRedrawFlag;if(!this.state){return false}var redraw=false;redraw=redraw||this.state.needsRedraw;this.state.needsRedraw=this.state.needsRedraw&&!clearRedrawFlags;var _state=this.state,attributeManager=_state.attributeManager,model=_state.model;redraw=redraw||attributeManager&&attributeManager.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});redraw=redraw||model&&model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"_diffDataProps",value:function _diffDataProps(oldProps,newProps){var dataComparator=newProps.dataComparator;if(dataComparator){if(!dataComparator(newProps.data,oldProps.data)){return"Data comparator detected a change"}}else if(newProps.data!==oldProps.data){return"A new data container was supplied"}return null}},{key:"_diffUpdateTriggers",value:function _diffUpdateTriggers(oldProps,newProps){var attributeManager=this.state.attributeManager;if(!attributeManager){return false}var change=false;for(var propName in newProps.updateTriggers){var oldTriggers=oldProps.updateTriggers[propName];var newTriggers=newProps.updateTriggers[propName];var diffReason=(0,_utils.compareProps)({oldProps:oldTriggers,newProps:newTriggers});if(diffReason){if(propName==="all"){_utils.log.log(1,"updateTriggers invalidating all attributes: "+diffReason);attributeManager.invalidateAll();change=true}else{_utils.log.log(1,"updateTriggers invalidating attribute "+propName+": "+diffReason);attributeManager.invalidate(propName);change=true}}}return change}},{key:"validateRequiredProp",value:function validateRequiredProp(propertyName,condition){var value=this.props[propertyName];if(value===undefined){throw new Error("Property "+propertyName+" undefined in layer "+this)}if(condition&&!condition(value)){throw new Error("Bad property "+propertyName+" in layer "+this)}}},{key:"_updateAttributes",value:function _updateAttributes(props){var _state2=this.state,attributeManager=_state2.attributeManager,model=_state2.model;if(!attributeManager){return}var numInstances=this.getNumInstances(props);attributeManager.update({numInstances:numInstances,bufferMap:props,context:this,ignoreUnknownAttributes:true});if(model){var changedAttributes=attributeManager.getChangedAttributes({clearChangedFlags:true});model.setAttributes(changedAttributes)}}},{key:"_updateBaseUniforms",value:function _updateBaseUniforms(){this.setUniforms({opacity:Math.pow(this.props.opacity,1/2.2),ONE:1})}},{key:"willReceiveProps",value:function willReceiveProps(){}},{key:"setUniforms",value:function setUniforms(uniformMap){if(this.state.model){this.state.model.setUniforms(uniformMap)}this.state.needsRedraw=true;(0,_utils.log)(3,"layer.setUniforms",uniformMap)}},{key:"_validateDeprecatedProps",value:function _validateDeprecatedProps(){if(this.props.isPickable!==undefined){_utils.log.once(0,"No isPickable prop in deckgl v3 - use pickable instead")}var hasViewportProps=this.props.latitude!==undefined||this.props.longitude!==undefined||this.props.zoom!==undefined||this.props.pitch!==undefined||this.props.bearing!==undefined;if(hasViewportProps){_utils.log.once(0,"deck.gl v3 no longer needs viewport props in Layer "+this)}}}]);return Layer}();exports.default=Layer},{"./attribute-manager":540,"./utils":548,assert:4,"luma.gl":387}],545:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pickLayers=pickLayers;var _luma=require("luma.gl");function pickLayers(gl,_ref){var layers=_ref.layers,pickingFBO=_ref.pickingFBO,_ref$uniforms=_ref.uniforms,uniforms=_ref$uniforms===undefined?{}:_ref$uniforms,x=_ref.x,y=_ref.y,mode=_ref.mode;var pixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*pixelRatio;var deviceY=gl.canvas.height-y*pixelRatio;var pickedInfos=[];(0,_luma.glContextWithState)(gl,{frameBuffer:pickingFBO,framebuffer:pickingFBO,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){var zOrder=0;for(var i=layers.length-1;i>=0;--i){var layer=layers[i];if(layer.props.visible&&layer.props.pickable){gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);var info=createInfo({layer:layer,pixel:[x,y],devicePixel:[deviceX,deviceY],pixelRatio:pixelRatio});layer.pickLayer({info:info,uniforms:uniforms,pickEnableUniforms:{renderPickingBuffer:1,pickingEnabled:1},pickDisableUniforms:{renderPickingBuffer:0,pickingEnabled:0},deviceX:deviceX,deviceY:deviceY,mode:mode});if(info.index>=0){info.picked=true;info.zOrder=zOrder++;if(Array.isArray(layer.props.data)){info.object=layer.props.data[info.index]}}pickedInfos.push(info)}}});var unhandledPickInfos=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=pickedInfos[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var info=_step.value;var handled=null;switch(mode){case"click":handled=info.layer.props.onClick(info);break;case"hover":handled=info.layer.props.onHover(info);break;default:throw new Error("unknown pick type")}if(!handled){unhandledPickInfos.push(info)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return unhandledPickInfos}function createInfo(_ref2){var info=_ref2.info,layer=_ref2.layer,pixel=_ref2.pixel,devicePixel=_ref2.devicePixel,pixelRatio=_ref2.pixelRatio;return{layer:layer,index:-1,picked:false,x:pixel[0],y:pixel[1],pixel:pixel,devicePixel:devicePixel,pixelRatio:pixelRatio,lngLat:layer.unproject(pixel)}}},{"luma.gl":387}],546:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.compareProps=compareProps;exports.areEqualShallow=areEqualShallow;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compareProps(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},oldProps=_ref.oldProps,newProps=_ref.newProps,_ref$ignoreProps=_ref.ignoreProps,ignoreProps=_ref$ignoreProps===undefined?{}:_ref$ignoreProps;(0,_assert2.default)(oldProps!==undefined&&newProps!==undefined,"compareProps args");if(oldProps===newProps){return null}if((typeof oldProps==="undefined"?"undefined":_typeof(oldProps))!=="object"||oldProps===null){return"old props is not an object"}if((typeof newProps==="undefined"?"undefined":_typeof(newProps))!=="object"||newProps===null){return"new props is not an object"}for(var key in oldProps){if(!(key in ignoreProps)){if(!newProps.hasOwnProperty(key)){return"prop "+key+" dropped: "+oldProps[key]+" -> (undefined)"}else if(oldProps[key]!==newProps[key]){return"prop "+key+" changed: "+oldProps[key]+" -> "+newProps[key]}}}for(var _key in newProps){if(!(_key in ignoreProps)){if(!oldProps.hasOwnProperty(_key)){return"prop "+_key+" added: (undefined) -> "+newProps[_key]}}}return null}function areEqualShallow(a,b){var _ref2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref2$ignore=_ref2.ignore,ignore=_ref2$ignore===undefined?{}:_ref2$ignore;if(a===b){return true}if((typeof a==="undefined"?"undefined":_typeof(a))!=="object"||a===null||(typeof b==="undefined"?"undefined":_typeof(b))!=="object"||b===null){return false}if(Object.keys(a).length!==Object.keys(b).length){return false}for(var key in a){if(!(key in ignore)&&(!(key in b)||a[key]!==b[key])){return false}}for(var _key2 in b){if(!(_key2 in ignore)&&!(_key2 in a)){return false}}return true}},{assert:4}],547:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fp64ify=fp64ify;function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}},{}],548:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _objectIterator=require("./object-iterator");Object.keys(_objectIterator).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _objectIterator[key]}})});var _compareObjects=require("./compare-objects");Object.keys(_compareObjects).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _compareObjects[key]}})});var _log=require("./log");Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});var _fp=require("./fp64");Object.keys(_fp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _fp[key]}})});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./compare-objects":546,"./fp64":547,"./log":549,"./object-iterator":550}],549:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=log;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function log(priority){(0,_assert2.default)(typeof priority==="number");if(priority<=log.priority){var _console;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}(_console=console).debug.apply(_console,args)}}var cache={};function once(priority,arg){if(!cache[arg]){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}log.apply(undefined,[priority,arg].concat(args))}cache[arg]=true}log.priority=0;log.log=log;log.once=once;if(typeof window!=="undefined"){window.deck=window.deck||{log:log}}},{assert:4}],550:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.makeObjectValueIterator=makeObjectValueIterator;exports.addIterator=addIterator;exports.isPlainObject=isPlainObject;var _marked=[makeObjectValueIterator].map(regeneratorRuntime.mark);function makeObjectValueIterator(obj){var key;return regeneratorRuntime.wrap(function makeObjectValueIterator$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=regeneratorRuntime.keys(obj);case 1:if((_context.t1=_context.t0()).done){_context.next=8;break}key=_context.t1.value;if(!obj.hasOwnProperty(key)){_context.next=6;break}_context.next=6;return obj[key];case 6:_context.next=1;break;case 8:case"end":return _context.stop()}}},_marked[0],this)}function addIterator(object){if(isPlainObject(object)&&!object[Symbol.iterator]){object[Symbol.iterator]=function iterator(){return makeObjectValueIterator(object)}}}function isPlainObject(o){return o!==null&&(typeof o==="undefined"?"undefined":_typeof(o))==="object"&&o.constructor===Object}},{}],551:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.checkRendererVendor=checkRendererVendor;exports.getPlatformShaderDefines=getPlatformShaderDefines;exports.assembleShaders=assembleShaders;var _luma=require("luma.gl");var _shaderChunks=require("./shader-chunks");var _shaderChunks2=_interopRequireDefault(_shaderChunks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function checkRendererVendor(debugInfo,gpuVendor){var vendor=debugInfo.vendor,renderer=debugInfo.renderer;var result=void 0;switch(gpuVendor){case"nvidia":result=vendor.match(/NVIDIA/i)||renderer.match(/NVIDIA/i);break;case"intel":result=vendor.match(/INTEL/i)||renderer.match(/INTEL/i);break;case"amd":result=vendor.match(/AMD/i)||renderer.match(/AMD/i)||vendor.match(/ATI/i)||renderer.match(/ATI/i);break;default:result=false}return result}function getPlatformShaderDefines(gl){var platformDefines="";var debugInfo=(0,_luma.glGetDebugInfo)(gl);if(checkRendererVendor(debugInfo,"nvidia")){platformDefines+="#define NVIDIA_GPU\n#define NVIDIA_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"intel")){platformDefines+="#define INTEL_GPU\n#define INTEL_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n #define INTEL_TAN_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"amd")){platformDefines+="#define AMD_GPU\n"}else{platformDefines+="#define DEFAULT_GPU\n"}return platformDefines}function assembleShader(gl,_ref){var vs=_ref.vs,fs=_ref.fs,_ref$fp=_ref.fp64,fp64=_ref$fp===undefined?false:_ref$fp,_ref$project=_ref.project,project=_ref$project===undefined?true:_ref$project,_ref$project2=_ref.project64,project64=_ref$project2===undefined?false:_ref$project2,opts=_objectWithoutProperties(_ref,["vs","fs","fp64","project","project64"]);if(project64===true){fp64=true}var source=getPlatformShaderDefines(gl)+"\n";opts=_extends({},opts,{project:project,project64:project64,fp64:fp64});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(_shaderChunks2.default)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var chunkName=_step.value;if(opts[chunkName]){source+=_shaderChunks2.default[chunkName].source+"\n"}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}source+=vs;return source}function assembleShaders(gl,_ref2){var vs=_ref2.vs,fs=_ref2.fs,opts=_objectWithoutProperties(_ref2,["vs","fs"]);return{gl:gl,vs:assembleShader(gl,_extends({},opts,{vs:vs})),fs:fs}}},{"./shader-chunks":553,"luma.gl":387}],552:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assembleShaders=require("./assemble-shaders");Object.keys(_assembleShaders).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _assembleShaders[key]}})})},{"./assemble-shaders":551}],553:[function(require,module,exports){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _fp=require("../../dist/shaderlib/fp64");var _fp2=_interopRequireDefault(_fp);var _project=require("../../dist/shaderlib/project");var _project2=_interopRequireDefault(_project);var _project3=require("../../dist/shaderlib/project64");var _project4=_interopRequireDefault(_project3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_extends({},_fp2.default,_project2.default,_project4.default)},{"../../dist/shaderlib/fp64":1,"../../dist/shaderlib/project":2,"../../dist/shaderlib/project64":3}],554:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _viewport=require("./viewport");Object.keys(_viewport).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _viewport[key]}})});Object.defineProperty(exports,"Viewport",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./viewport":555}],555:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.COORDINATE_SYSTEM=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _desc,_value,_class;var _perspective=require("viewport-mercator-project/perspective");Object.defineProperty(exports,"COORDINATE_SYSTEM",{enumerable:true,get:function get(){return _perspective.COORDINATE_SYSTEM}});var _perspective2=_interopRequireDefault(_perspective);var _autobindDecorator=require("autobind-decorator");var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object["ke"+"ys"](descriptor).forEach(function(key){desc[key]=descriptor[key]});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if("value"in desc||desc.initializer){desc.writable=true}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined}if(desc.initializer===void 0){Object["define"+"Property"](target,property,desc);desc=null}return desc}function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}var WebGLViewport=(_class=function(_Viewport){_inherits(WebGLViewport,_Viewport);function WebGLViewport(options){_classCallCheck(this,WebGLViewport);var _this=_possibleConstructorReturn(this,(WebGLViewport.__proto__||Object.getPrototypeOf(WebGLViewport)).call(this,options));_this._calculateWebGLMatrices();return _this}_createClass(WebGLViewport,[{key:"getProjectionMatrix",value:function getProjectionMatrix(){return this.glProjectionMatrix}},{key:"getProjectionMatrixFP64",value:function getProjectionMatrixFP64(){return this.glProjectionMatrixFP64}},{key:"getProjectionMatrixUncentered",value:function getProjectionMatrixUncentered(){return this.glProjectionMatrixUncentered}},{key:"getWebGLMatrices",value:function getWebGLMatrices(){return{projectionMatrix:this.glProjectionMatrix,projectionFP64:this.glProjectionMatrixFP64}}},{key:"getUniforms",value:function getUniforms(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$projectionMode=_ref.projectionMode,projectionMode=_ref$projectionMode===undefined?_perspective.COORDINATE_SYSTEM.LNGLAT:_ref$projectionMode,_ref$positionOrigin=_ref.positionOrigin,positionOrigin=_ref$positionOrigin===undefined?[0,0]:_ref$positionOrigin,_ref$modelMatrix=_ref.modelMatrix,modelMatrix=_ref$modelMatrix===undefined?null:_ref$modelMatrix;var positionOriginPixels=this.projectFlat(positionOrigin);var projectedPositionOrigin=[positionOriginPixels[0],positionOriginPixels[1],0,1];var projections=this.getProjections();var viewProjectionMatrix=projections.viewProjectionMatrix;var projectionCenter=_glMatrix.vec4.transformMat4([],projectedPositionOrigin,viewProjectionMatrix);if(modelMatrix){_glMatrix.mat4.multiply(viewProjectionMatrix,viewProjectionMatrix,modelMatrix)}return{projectionMode:projectionMode,projectionCenter:projectionCenter,projectionMatrix:this.glProjectionMatrix,projectionFP64:this.glProjectionMatrixFP64,projectionPixelsPerUnit:this.pixelsPerMeter,projectionScale:this.scale,projectionScaleFP64:fp64ify(this.scale),mercatorScale:Math.pow(2,this.zoom),mercatorCenter:this.center}}},{key:"_calculateWebGLMatrices",value:function _calculateWebGLMatrices(){this.glProjectionMatrix=new Float32Array(this.viewProjectionMatrix);this.glProjectionMatrixFP64=new Float32Array(32);this._dy64ifyProjectionMatrix()}},{key:"_dy64ifyProjectionMatrix",value:function _dy64ifyProjectionMatrix(){for(var i=0;i<4;++i){for(var j=0;j<4;++j){var _fp64ify=fp64ify(this.viewProjectionMatrix[j*4+i]);var _fp64ify2=_slicedToArray(_fp64ify,2);this.glProjectionMatrixFP64[(i*4+j)*2]=_fp64ify2[0];this.glProjectionMatrixFP64[(i*4+j)*2+1]=_fp64ify2[1]}}}}]);return WebGLViewport}(_perspective2.default),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrix",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrix"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrixFP64",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrixFP64"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getProjectionMatrixUncentered",[_autobindDecorator2.default],Object.getOwnPropertyDescriptor(_class.prototype,"getProjectionMatrixUncentered"),_class.prototype),_class);exports.default=WebGLViewport},{"autobind-decorator":6,"gl-matrix":337,"viewport-mercator-project/perspective":513}]},{},[516]);
