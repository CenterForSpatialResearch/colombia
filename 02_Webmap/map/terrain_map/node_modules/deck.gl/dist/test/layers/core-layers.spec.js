'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; // Copyright (c) 2015 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
/* eslint-disable func-style, no-console, max-len */


// Import private method to test that layers can successfully be updated


var _tapeCatch = require('tape-catch');

var _tapeCatch2 = _interopRequireDefault(_tapeCatch);

require('luma.gl/headless');

var _luma = require('luma.gl');

var _ = require('../..');

var _lib = require('../../lib');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import CHOROPLETHS from '../../example/data/sf.zip.geo.json';
// const HEXAGONS_FILE = './example/data/hexagons.csv';
// const POINTS_FILE = './example/data/sf.bike.parking.csv';

var gl = (0, _luma.createGLContext)();

var FIXTURE = {

  layerState: {
    oldLayers: [],
    gl: gl,
    scene: new _luma.Scene(gl)
  },

  mapSize: {
    width: 800,
    height: 640
  },

  mapState: {
    latitude: 37.751537058389985,
    longitude: -122.42694203247012,
    zoom: 11.5
  },

  choropleths: [],
  hexagons: [],
  points: [{ position: [100, 100], color: [255, 0, 0] }],
  arcs: [{ sourcePosition: [0, 0], targetPosition: [1, 3], color: [255, 0, 0] }]
};

(0, _tapeCatch2.default)('ScreenGridLayer#constructor', function (t) {
  var points = FIXTURE.points;


  var layer = new _.ScreenGridLayer({
    data: points,
    pickable: false,
    opacity: 0.06
  });

  t.ok(layer, 'ScreenGridLayer created');
  t.end();
});

(0, _tapeCatch2.default)('ChoroplethLayer#constructor', function (t) {
  var choropleths = FIXTURE.choropleths;


  var layer = new _.ChoroplethLayer({
    data: choropleths,
    opacity: 0.8,
    pickable: false,
    drawContour: true
  });

  t.ok(layer, 'ChoroplethLayer created');
  t.end();
});

(0, _tapeCatch2.default)('ScatterplotLayer#constructor', function (t) {
  var mapSize = FIXTURE.mapSize,
      mapState = FIXTURE.mapState,
      points = FIXTURE.points;


  var layer = new _.ScatterplotLayer({
    data: points,
    pickable: true
  });
  t.ok(layer instanceof _.ScatterplotLayer, 'ScatterplotLayer created');

  var emptyLayer = new _.ScatterplotLayer({
    id: 'emptyScatterplotLayer',
    data: [],
    pickable: true
  });
  t.ok(emptyLayer instanceof _.ScatterplotLayer, 'Empty ScatterplotLayer created');

  t.doesNotThrow(function () {
    return new _.ScatterplotLayer({
      id: 'nullScatterplotLayer',
      data: null,
      pickable: true
    });
  }, 'Null ScatterplotLayer did not throw exception');

  var layerManager = new _lib.LayerManager({ gl: gl }).setContext(_extends({}, mapState, mapSize));
  t.doesNotThrow(function () {
    return layerManager.updateLayers({ newLayers: [layer, emptyLayer] });
  }, 'ScatterplotLayer update does not throw');

  t.end();
});

(0, _tapeCatch2.default)('ArcLayer#constructor', function (t) {
  var mapSize = FIXTURE.mapSize,
      mapState = FIXTURE.mapState,
      arcs = FIXTURE.arcs;


  var layer = new _.ArcLayer({
    id: 'arcLayer',
    data: arcs,
    pickable: true
  });
  t.ok(layer instanceof _.ArcLayer, 'ArcLayer created');

  var emptyLayer = new _.ArcLayer({
    id: 'emptyArcLayer',
    data: [],
    pickable: true
  });
  t.ok(emptyLayer instanceof _.ArcLayer, 'Empty ArcLayer created');

  t.doesNotThrow(function () {
    return new _.ArcLayer({
      id: 'nullArcLayer',
      data: null,
      pickable: true
    });
  }, 'Null ArcLayer did not throw exception');

  var layerManager = new _lib.LayerManager({ gl: gl }).setContext(_extends({}, mapState, mapSize));
  t.doesNotThrow(function () {
    return layerManager.updateLayers({ newLayers: [layer, emptyLayer] });
  }, 'ArcLayer update does not throw');

  t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90ZXN0L2xheWVycy9jb3JlLWxheWVycy5zcGVjLmpzIl0sIm5hbWVzIjpbImdsIiwiRklYVFVSRSIsImxheWVyU3RhdGUiLCJvbGRMYXllcnMiLCJzY2VuZSIsIm1hcFNpemUiLCJ3aWR0aCIsImhlaWdodCIsIm1hcFN0YXRlIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJ6b29tIiwiY2hvcm9wbGV0aHMiLCJoZXhhZ29ucyIsInBvaW50cyIsInBvc2l0aW9uIiwiY29sb3IiLCJhcmNzIiwic291cmNlUG9zaXRpb24iLCJ0YXJnZXRQb3NpdGlvbiIsImxheWVyIiwiZGF0YSIsInBpY2thYmxlIiwib3BhY2l0eSIsInQiLCJvayIsImVuZCIsImRyYXdDb250b3VyIiwiZW1wdHlMYXllciIsImlkIiwiZG9lc05vdFRocm93IiwibGF5ZXJNYW5hZ2VyIiwic2V0Q29udGV4dCIsInVwZGF0ZUxheWVycyIsIm5ld0xheWVycyJdLCJtYXBwaW5ncyI6Ijs7a1FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBWUE7OztBQVhBOzs7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBUUE7Ozs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsSUFBTUEsS0FBSyw0QkFBWDs7QUFFQSxJQUFNQyxVQUFVOztBQUVkQyxjQUFZO0FBQ1ZDLGVBQVcsRUFERDtBQUVWSCxVQUZVO0FBR1ZJLFdBQU8sZ0JBQVVKLEVBQVY7QUFIRyxHQUZFOztBQVFkSyxXQUFTO0FBQ1BDLFdBQU8sR0FEQTtBQUVQQyxZQUFRO0FBRkQsR0FSSzs7QUFhZEMsWUFBVTtBQUNSQyxjQUFVLGtCQURGO0FBRVJDLGVBQVcsQ0FBQyxrQkFGSjtBQUdSQyxVQUFNO0FBSEUsR0FiSTs7QUFtQmRDLGVBQWEsRUFuQkM7QUFvQmRDLFlBQVUsRUFwQkk7QUFxQmRDLFVBQVEs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QUFNUSxhQUFhLGVBQWE7QUFDOUJDLFFBQUksZUFEMEI7QUFFOUJSLFVBQU0sRUFGd0I7QUFHOUJDLGNBQVU7QUFIb0IsR0FBYixDQUFuQjtBQUtBRSxJQUFFQyxFQUFGLENBQUtHLGdDQUFMLEVBQXFDLHdCQUFyQzs7QUFFQUosSUFBRU0sWUFBRixDQUNFO0FBQUEsV0FBTSxlQUFhO0FBQ2pCRCxVQUFJLGNBRGE7QUFFakJSLFlBQU0sSUFGVztBQUdqQkMsZ0JBQVU7QUFITyxLQUFiLENBQU47QUFBQSxHQURGLEVBTUUsdUNBTkY7O0FBU0EsTUFBTVMsZUFBZSxzQkFBaUIsRUFBQy9CLE1BQUQsRUFBakIsRUFDbEJnQyxVQURrQixjQUNIeEIsUUFERyxFQUNVSCxPQURWLEVBQXJCO0FBRUFtQixJQUFFTSxZQUFGLENBQ0U7QUFBQSxXQUFNQyxhQUFhRSxZQUFiLENBQTBCLEVBQUNDLFdBQVcsQ0FBQ2QsS0FBRCxFQUFRUSxVQUFSLENBQVosRUFBMUIsQ0FBTjtBQUFBLEdBREYsRUFFRSxnQ0FGRjs7QUFJQUosSUFBRUUsR0FBRjtBQUNELENBakNEIiwiZmlsZSI6ImNvcmUtbGF5ZXJzLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTUgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuLyogZXNsaW50LWRpc2FibGUgZnVuYy1zdHlsZSwgbm8tY29uc29sZSwgbWF4LWxlbiAqL1xuaW1wb3J0IHRlc3QgZnJvbSAndGFwZS1jYXRjaCc7XG5pbXBvcnQgJ2x1bWEuZ2wvaGVhZGxlc3MnO1xuaW1wb3J0IHtTY2VuZSwgY3JlYXRlR0xDb250ZXh0fSBmcm9tICdsdW1hLmdsJztcblxuaW1wb3J0IHtcbiAgQ2hvcm9wbGV0aExheWVyLFxuICBTY2F0dGVycGxvdExheWVyLFxuICBBcmNMYXllcixcbiAgU2NyZWVuR3JpZExheWVyXG59IGZyb20gJy4uLy4uJztcblxuLy8gSW1wb3J0IHByaXZhdGUgbWV0aG9kIHRvIHRlc3QgdGhhdCBsYXllcnMgY2FuIHN1Y2Nlc3NmdWxseSBiZSB1cGRhdGVkXG5pbXBvcnQge0xheWVyTWFuYWdlcn0gZnJvbSAnLi4vLi4vbGliJztcblxuLy8gaW1wb3J0IENIT1JPUExFVEhTIGZyb20gJy4uLy4uL2V4YW1wbGUvZGF0YS9zZi56aXAuZ2VvLmpzb24nO1xuLy8gY29uc3QgSEVYQUdPTlNfRklMRSA9ICcuL2V4YW1wbGUvZGF0YS9oZXhhZ29ucy5jc3YnO1xuLy8gY29uc3QgUE9JTlRTX0ZJTEUgPSAnLi9leGFtcGxlL2RhdGEvc2YuYmlrZS5wYXJraW5nLmNzdic7XG5cbmNvbnN0IGdsID0gY3JlYXRlR0xDb250ZXh0KCk7XG5cbmNvbnN0IEZJWFRVUkUgPSB7XG5cbiAgbGF5ZXJTdGF0ZToge1xuICAgIG9sZExheWVyczogW10sXG4gICAgZ2wsXG4gICAgc2NlbmU6IG5ldyBTY2VuZShnbClcbiAgfSxcblxuICBtYXBTaXplOiB7XG4gICAgd2lkdGg6IDgwMCxcbiAgICBoZWlnaHQ6IDY0MFxuICB9LFxuXG4gIG1hcFN0YXRlOiB7XG4gICAgbGF0aXR1ZGU6IDM3Ljc1MTUzNzA1ODM4OTk4NSxcbiAgICBsb25naXR1ZGU6IC0xMjIuNDI2OTQyMDMyNDcwMTIsXG4gICAgem9vbTogMTEuNVxuICB9LFxuXG4gIGNob3JvcGxldGhzOiBbXSxcbiAgaGV4YWdvbnM6IFtdLFxuICBwb2ludHM6IFt7cG9zaXRpb246IFsxMDAsIDEwMF0sIGNvbG9yOiBbMjU1LCAwLCAwXX1dLFxuICBhcmNzOiBbe3NvdXJjZVBvc2l0aW9uOiBbMCwgMF0sIHRhcmdldFBvc2l0aW9uOiBbMSwgM10sIGNvbG9yOiBbMjU1LCAwLCAwXX1dXG59O1xuXG50ZXN0KCdTY3JlZW5HcmlkTGF5ZXIjY29uc3RydWN0b3InLCB0ID0+IHtcbiAgY29uc3Qge3BvaW50c30gPSBGSVhUVVJFO1xuXG4gIGNvbnN0IGxheWVyID0gbmV3IFNjcmVlbkdyaWRMYXllcih7XG4gICAgZGF0YTogcG9pbnRzLFxuICAgIHBpY2thYmxlOiBmYWxzZSxcbiAgICBvcGFjaXR5OiAwLjA2XG4gIH0pO1xuXG4gIHQub2sobGF5ZXIsICdTY3JlZW5HcmlkTGF5ZXIgY3JlYXRlZCcpO1xuICB0LmVuZCgpO1xufSk7XG5cbnRlc3QoJ0Nob3JvcGxldGhMYXllciNjb25zdHJ1Y3RvcicsIHQgPT4ge1xuICBjb25zdCB7Y2hvcm9wbGV0aHN9ID0gRklYVFVSRTtcblxuICBjb25zdCBsYXllciA9IG5ldyBDaG9yb3BsZXRoTGF5ZXIoe1xuICAgIGRhdGE6IGNob3JvcGxldGhzLFxuICAgIG9wYWNpdHk6IDAuOCxcbiAgICBwaWNrYWJsZTogZmFsc2UsXG4gICAgZHJhd0NvbnRvdXI6IHRydWVcbiAgfSk7XG5cbiAgdC5vayhsYXllciwgJ0Nob3JvcGxldGhMYXllciBjcmVhdGVkJyk7XG4gIHQuZW5kKCk7XG59KTtcblxudGVzdCgnU2NhdHRlcnBsb3RMYXllciNjb25zdHJ1Y3RvcicsIHQgPT4ge1xuICBjb25zdCB7bWFwU2l6ZSwgbWFwU3RhdGUsIHBvaW50c30gPSBGSVhUVVJFO1xuXG4gIGNvbnN0IGxheWVyID0gbmV3IFNjYXR0ZXJwbG90TGF5ZXIoe1xuICAgIGRhdGE6IHBvaW50cyxcbiAgICBwaWNrYWJsZTogdHJ1ZVxuICB9KTtcbiAgdC5vayhsYXllciBpbnN0YW5jZW9mIFNjYXR0ZXJwbG90TGF5ZXIsICdTY2F0dGVycGxvdExheWVyIGNyZWF0ZWQnKTtcblxuICBjb25zdCBlbXB0eUxheWVyID0gbmV3IFNjYXR0ZXJwbG90TGF5ZXIoe1xuICAgIGlkOiAnZW1wdHlTY2F0dGVycGxvdExheWVyJyxcbiAgICBkYXRhOiBbXSxcbiAgICBwaWNrYWJsZTogdHJ1ZVxuICB9KTtcbiAgdC5vayhlbXB0eUxheWVyIGluc3RhbmNlb2YgU2NhdHRlcnBsb3RMYXllciwgJ0VtcHR5IFNjYXR0ZXJwbG90TGF5ZXIgY3JlYXRlZCcpO1xuXG4gIHQuZG9lc05vdFRocm93KFxuICAgICgpID0+IG5ldyBTY2F0dGVycGxvdExheWVyKHtcbiAgICAgIGlkOiAnbnVsbFNjYXR0ZXJwbG90TGF5ZXInLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIHBpY2thYmxlOiB0cnVlXG4gICAgfSksXG4gICAgJ051bGwgU2NhdHRlcnBsb3RMYXllciBkaWQgbm90IHRocm93IGV4Y2VwdGlvbidcbiAgKTtcblxuICBjb25zdCBsYXllck1hbmFnZXIgPSBuZXcgTGF5ZXJNYW5hZ2VyKHtnbH0pXG4gICAgLnNldENvbnRleHQoey4uLm1hcFN0YXRlLCAuLi5tYXBTaXplfSk7XG4gIHQuZG9lc05vdFRocm93KFxuICAgICgpID0+IGxheWVyTWFuYWdlci51cGRhdGVMYXllcnMoe25ld0xheWVyczogW2xheWVyLCBlbXB0eUxheWVyXX0pLFxuICAgICdTY2F0dGVycGxvdExheWVyIHVwZGF0ZSBkb2VzIG5vdCB0aHJvdydcbiAgKTtcblxuICB0LmVuZCgpO1xufSk7XG5cbnRlc3QoJ0FyY0xheWVyI2NvbnN0cnVjdG9yJywgdCA9PiB7XG4gIGNvbnN0IHttYXBTaXplLCBtYXBTdGF0ZSwgYXJjc30gPSBGSVhUVVJFO1xuXG4gIGNvbnN0IGxheWVyID0gbmV3IEFyY0xheWVyKHtcbiAgICBpZDogJ2FyY0xheWVyJyxcbiAgICBkYXRhOiBhcmNzLFxuICAgIHBpY2thYmxlOiB0cnVlXG4gIH0pO1xuICB0Lm9rKGxheWVyIGluc3RhbmNlb2YgQXJjTGF5ZXIsICdBcmNMYXllciBjcmVhdGVkJyk7XG5cbiAgY29uc3QgZW1wdHlMYXllciA9IG5ldyBBcmNMYXllcih7XG4gICAgaWQ6ICdlbXB0eUFyY0xheWVyJyxcbiAgICBkYXRhOiBbXSxcbiAgICBwaWNrYWJsZTogdHJ1ZVxuICB9KTtcbiAgdC5vayhlbXB0eUxheWVyIGluc3RhbmNlb2YgQXJjTGF5ZXIsICdFbXB0eSBBcmNMYXllciBjcmVhdGVkJyk7XG5cbiAgdC5kb2VzTm90VGhyb3coXG4gICAgKCkgPT4gbmV3IEFyY0xheWVyKHtcbiAgICAgIGlkOiAnbnVsbEFyY0xheWVyJyxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBwaWNrYWJsZTogdHJ1ZVxuICAgIH0pLFxuICAgICdOdWxsIEFyY0xheWVyIGRpZCBub3QgdGhyb3cgZXhjZXB0aW9uJ1xuICApO1xuXG4gIGNvbnN0IGxheWVyTWFuYWdlciA9IG5ldyBMYXllck1hbmFnZXIoe2dsfSlcbiAgICAuc2V0Q29udGV4dCh7Li4ubWFwU3RhdGUsIC4uLm1hcFNpemV9KTtcbiAgdC5kb2VzTm90VGhyb3coXG4gICAgKCkgPT4gbGF5ZXJNYW5hZ2VyLnVwZGF0ZUxheWVycyh7bmV3TGF5ZXJzOiBbbGF5ZXIsIGVtcHR5TGF5ZXJdfSksXG4gICAgJ0FyY0xheWVyIHVwZGF0ZSBkb2VzIG5vdCB0aHJvdycpO1xuXG4gIHQuZW5kKCk7XG59KTtcbiJdfQ==